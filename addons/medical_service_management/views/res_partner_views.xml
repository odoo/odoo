<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <!-- 客戶清單視圖增強 -->
    <record id="res_partner_tree_view_medical_service" model="ir.ui.view">
        <field name="name">res.partner.tree.medical.service</field>
        <field name="model">res.partner</field>
        <field name="inherit_id" ref="base.view_partner_tree"/>
        <field name="arch" type="xml">
            
            <!-- 在清單中新增相關欄位 -->
            <field name="complete_name" position="after">
                <field name="x_payment_method" optional="hide"/>
                <field name="x_department_count" string="部門數" optional="show"/>
                <field name="x_contact_count" string="聯絡人數" optional="show"/>
                <field name="x_equipment_count" string="設備數" optional="show"/>
            </field>
            
        </field>
    </record>

    <!-- 客戶搜尋視圖增強 -->
    <record id="res_partner_search_view_medical_service" model="ir.ui.view">
        <field name="name">res.partner.search.medical.service</field>
        <field name="model">res.partner</field>
        <field name="inherit_id" ref="base.view_res_partner_filter"/>
        <field name="arch" type="xml">
            <!-- 新增群組篩選 -->
            <filter name="inactive" position="after">
                <separator/>
                <filter name="has_departments" string="有部門架構"
                        domain="[('x_department_count', '>', 0)]"/>
                <filter name="has_contacts" string="有聯絡人"
                        domain="[('x_contact_count', '>', 0)]"/>
                <filter name="has_equipments" string="有設備"
                        domain="[('x_equipment_count', '>', 0)]"/>
            </filter>
            
            <!-- 新增群組 -->
            <group position="inside">
                <filter string="付款方式" name="payment_method" 
                        context="{'group_by': 'x_payment_method'}"/>
                <filter string="交易幣別" name="currency" 
                        context="{'group_by': 'x_payment_currency'}"/>
            </group>
            
        </field>
    </record>

    <!-- 公司表單增加部門管理分頁 -->
    <record id="res_partner_form_view_medical_departments" model="ir.ui.view">
        <field name="name">res.partner.form.medical.departments</field>
        <field name="model">res.partner</field>
        <field name="inherit_id" ref="base.view_partner_form"/>
        <field name="arch" type="xml">
            <!-- 按照 Employee 模組設計，在職位欄位後添加部門選擇 -->
            <field name="function" position="after">
                <field name="x_department_id" 
                       string="部門"
                       invisible="is_company or not parent_id"
                       domain="[('company_id', '=', parent_id)]"
                       options="{'no_create': True}"
                       context="{'default_company_id': parent_id}"/>
            </field>
            
            <!-- 在公司的 notebook 中增加部門管理分頁（僅對公司顯示） -->
            <xpath expr="//notebook" position="inside">
                <page name="department_management" 
                      string="部門架構" 
                      invisible="not is_company">
                    <div class="o_setting_box">
                        <div class="o_setting_left_pane">
                            <field name="code" invisible="1"/>
                            <field name="x_department_count" invisible="1"/>
                        </div>
                        <div class="o_setting_right_pane">
                            <label for="x_department_ids" string="部門清單"/>
                            <div class="text-muted">
                                管理該公司的組織架構和部門設定
                            </div>
                        </div>
                    </div>
                    
                    <field name="x_department_ids" 
                           widget="one2many" 
                           context="{'default_company_id': id}"/>
                </page>
            </xpath>
        </field>
    </record>

</odoo>