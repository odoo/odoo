<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <template id="assets_backend" inherit_id="web.assets_backend" name="Payment Method Assets Backend">
        <xpath expr="." position="inside">
            <link rel="stylesheet" href="/payment/static/src/less/payment_acquirer.less"/>
        </xpath>
    </template>

    <!-- save payment data -->
    <template id="save_payment_data" name="Save My Payment Data">
        <div id="payment_data"> <!-- add class as per user ui view using xpath-->
            <t t-foreach="acquirers or []" t-as="acquirer" id="acquirers_list">
                <div t-att-data-id="acquirer.id" class="o_acquirer_button hidden pull-right">
                    <div t-raw="acquirer.button"/>
                    <div class="token_hide">
                        <div t-if="acquirer.save_token == 'ask' and save_option">
                            <input type="checkbox" name="odoo_save_token" id="odoo_save_token"/>
                            <label for="odoo_save_token">Save my payment data</label>
                        </div>
                        <div class="pre_msg" t-field="acquirer.pre_msg" />
                    </div>
                </div>
            </t>
        </div>
    </template>

    <!-- show all payment method -->
    <template id="payment_method" name="Payment Method">
        <div id="payment_list"> <!-- add class as per user ui view using xpath-->
            <!-- loaded all acquirer -->
            <h4><strong>Choose a payment method</strong></h4>
            <ul class="list-unstyled">
                <t t-set="payment_methods_available" t-value="False"/>
                <t t-foreach="acquirers or []" t-as="acquirer">
                    <li t-if="not acquirer.country_ids or partner_country in acquirer.country_ids">
                        <label t-if="acquirer.button">
                            <input t-att-value="acquirer.id" type="radio" name="acquirer" t-att-checked="acquirers[0] == acquirer" />
                            <span t-field="acquirer.image_small" t-att-title="acquirer.name" t-options='{"widget": "image", "style":"max-width: 60px; display: inline-block"}'/>
                            <span t-field="acquirer.name" />
                            <span t-if="acquirer.fees_active">(processing fees apply)</span>
                        </label>
                        <t t-set="payment_methods_available" t-value="True"/>
                    </li>
                </t>
                <li t-if="not payment_methods_available">
                    <div class="alert alert-warning">
                        <span>No payment gateway is available for your country</span>
                    </div>
                </li>
                <li t-if="tokens and any(token for token in tokens if not token.acquirer_id.country_ids or partner_country in token.acquirer_id.country_ids)">
                    <label>
                        <input type="radio" name="acquirer" />
                        <span class='fa fa-2x fa-credit-card'/>
                        Saved Cards
                    </label>

                    <div class="list-group">
                        <t t-foreach='tokens' t-as='token'>
                            <a t-if="not token.acquirer_id.country_ids or partner_country in token.acquirer_id.country_ids" class="list-group-item btn_payment_token" t-att-data-acquirer="token.acquirer_id.id" t-att-data-token='token.id'>
                                <span class="js_radio fa fa-circle-o"></span>&amp;nbsp;
                                <t t-esc="token.name" />
                                <t t-if="len(set(tokens.mapped('acquirer_id')))>1">
                                    (<t t-esc='token.acquirer_id.name'/>)
                                </t>
                                <span t-if="token.acquirer_id.fees_active">(processing fees apply)</span>
                            </a>
                        </t>
                    </div>
                </li>
            </ul>
        </div>
    </template>

    <!-- payment modal -->
    <template id="payment" name="Payment">
        <div class="modal fade" id="modalpayment" role="dialog" aria-hidden="true">
            <div class="modal-dialog modal-content" id="modal-dialog">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&amp;times;</button>
                    <h4 class="modal-title">Payment Method</h4>
                </div>
                <div class="modal-body" id="sign-dialog">
                </div>
                <div class="modal-footer" id="modal_footer">
                    <div class="row text-left">
                        <div t-if="acquirers" id="payment_method" class="js_payment">
                            <div class="col-md-6">
                                <t t-call="payment.payment_method"/>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </template>

    <template id="payment_token_form">
        <form method='POST' action="/payment/transaction_token">
            <input type="hidden" name="csrf_token" t-att-value="request.csrf_token()"/>
            <input type="hidden" name="tx_id" t-att-value="tx.id"/>
        </form>
    </template>
</odoo>
