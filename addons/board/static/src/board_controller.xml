<?xml version="1.0" encoding="UTF-8"?>
<templates xml:space="preserve">

    <t t-name="board.BoardView">
        <div class="o_dashboard d-flex flex-column">
            <t t-if="board.isEmpty">
                <t t-call="board.NoContent"/>
            </t>
            <t t-else="">
                <t t-call="board.Content"/>
            </t>
        </div>
    </t>

    <t t-name="board.Content">
        <div t-if="!env.isSmall" class="o-dashboard-header d-flex justify-content-end my-2">
            <Dropdown>
                <button class="btn btn-secondary mx-3 p-2">
                    <img t-attf-src="/board/static/img/layout_{{board.layout}}.png" width="16" height="14" t-att-alt="board.layout"/>
                    Layout
                </button>
                <t t-set-slot="content">
                    <DropdownItem
                        t-foreach="'1 1-1 1-1-1 1-2 2-1'.split(' ')"
                        t-as="layout"
                        t-key="layout"
                        onSelected="() => this.selectLayout(layout)"
                        class="{ selected: layout == board.layout }"
                    >
                        <t t-set="layoutValue" t-value="layout.split('-')"/>
                        <t t-set="layoutLength" t-value="layoutValue.length"/>
                        <t t-set="layoutTotal" t-value="layoutValue.reduce((a, b) => parseInteger(a) + parseInteger(b), 0)"/>
                        <img t-attf-src="/board/static/img/layout_{{layout}}.png" class="img-fluid w-25 me-1"/>
                        <t t-if="layoutLength > 1">
                            <t t-foreach="layoutValue" t-as="column" t-key="column_index">
                                <t t-out="column + '/' + layoutTotal"/>
                                <t t-if="(layoutLength - 1) gt column_index"> + </t>
                            </t>
                        </t>
                        <t t-else="">
                            <t t-out="layoutLength + ' column'"/>
                        </t>
                    </DropdownItem>
                </t>
            </Dropdown>
        </div>
        <div class="o-dashboard-layout flex-grow-1 gap-3 mx-3 mt-3 mt-md-0" t-attf-class="o-dashboard-layout-{{board.layout}}" t-ref="main">
            <t t-foreach="board.columns" t-as="column" t-key="column_index">
                <div t-if="column_index lt board.colNumber" class="o-dashboard-column h-100" t-att-data-idx="column_index">
                    <t t-foreach="column.actions" t-as="action" t-key="action.id">
                        <div class="o-dashboard-action mb-2 bg-view border" t-att-data-idx="action_index">
                            <h3 t-attf-class="o-dashboard-action-header {{action.title ? '' : 'oe_header_empty'}} d-flex align-items-center justify-content-end gap-1 m-2 py-2 px-0">
                                <button class="btn btn-light d-flex p-1 opacity-50 opacity-100-hover" t-if="!action.isFolded" t-on-click="() => this.toggleAction(action, !env.isSmall)"><i class="oi oi-chevron-down" aria-hidden="true"/></button>
                                <button class="btn btn-light d-flex p-1 opacity-50 opacity-100-hover" t-if="action.isFolded"  t-on-click="() => this.toggleAction(action, !env.isSmall)"><i class="oi oi-chevron-right" aria-hidden="true"/></button>
                                <span class="me-auto"> <t t-esc="action.title"/> </span>
                                <button t-if="!env.isSmall" class="btn btn-light d-flex p-1 opacity-50 opacity-100-hover" t-on-click="() => this.closeAction(column, action)"><i class="oi oi-close" aria-hidden="true"/></button>
                            </h3>
                            <BoardAction t-if="!action.isFolded" action="action" />
                        </div>
                    </t>
                </div>
            </t>
        </div>
    </t>

    <t t-name="board.NoContent">
        <div class="o_view_nocontent">
            <div class="o_nocontent_help">
                <p class="o_view_nocontent_neutral_face">
                  Your personal dashboard is empty
                </p>
                <p>
                  To add your first report into this dashboard, go to any
                  menu, switch to list or graph view, and click <i>"Add to
                  Dashboard"</i> in the extended search options.
                </p>
                <p>
                  You can filter and group data before inserting into the
                  dashboard using the search options.
                </p>
            </div>
        </div>
    </t>

    <t t-name="board.arch">
        <form t-att-string="title">
            <board t-att-style="layout">
                <column t-foreach="columns" t-as="column" t-key="column_index">
                    <t t-foreach="column.actions" t-as="action" t-key="action_index">
                        <action
                            t-att-name="action.actionId"
                            t-att-string="action.title"
                            t-att-view_mode="action.viewMode"
                            t-att-context="action.context"
                            t-att-domain="action.domain"
                            t-att-fold="action.isFolded ? 1 : 0"/>
                    </t>
                </column>
            </board>
        </form>
    </t>


</templates>
