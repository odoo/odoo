<?xml version="1.0" encoding="utf-8" ?>
<odoo>

    <template id="partner_info" name="Peruvian partner">

        <!-- show identification type -->
        <div t-attf-class="mb-3 #{error.get('l10n_latam_identification_type_id') and 'o_has_error' or ''} col-xl-6">
            <label class="col-form-label" for="l10n_latam_identification_type_id">Identification Type</label>
            <t t-if="partner.can_edit_vat()">
                <select
                    name="l10n_latam_identification_type_id"
                    t-attf-class="form-select #{error.get('l10n_latam_identification_type_id') and 'is-invalid' or ''}"
                >
                    <option value="">Identification Type...</option>
                    <t t-foreach="identification_types or []" t-as="id_type">
                        <option
                            t-att-value="id_type.id"
                            t-att-selected="id_type.id == int(identification) if identification else id_type.id == partner.l10n_latam_identification_type_id.id"
                        >
                            <t t-esc="id_type.name" />
                        </option>
                    </t>
                </select>
            </t>
            <t t-else="">
                <p
                    class="form-control"
                    t-esc="partner.l10n_latam_identification_type_id.name"
                    readonly="1"
                    title="Changing Identification type is not allowed once document(s) have been issued for your account. Please contact us directly for this operation."
                />
                <input
                    name="l10n_latam_identification_type_id"
                    class="form-control"
                    t-att-value="partner.l10n_latam_identification_type_id.id"
                    type='hidden'
                />
            </t>
        </div>

    </template>

    <template id="partner_address_info" name="Peruvian partner address">

        <!-- show city -->
        <div
            t-attf-class="mb-3 #{error.get('city_id') and 'o_has_error' or ''} col-lg-6 div_city_id"
            t-att-style="not state and 'display: none'"
        >
            <label class="col-form-label" for="city_id">City</label>
            <select
                id="city_id"
                name="city_id"
                t-attf-class="form-select #{error.get('city_id') and 'is-invalid' or ''}"
                data-init="1"
            >
                <t t-foreach="state_cities" t-as="c">
                    <option
                        t-att-value="c.id"
                        t-att-selected="c.id == ('city_id' in checkout and checkout['city_id'] != '' and int(checkout['city_id']))"
                    >
                        <t t-esc="c.name" />
                    </option>
                </t>
            </select>
        </div>

        <!-- show district -->
        <div
            t-attf-class="mb-3 #{error.get('l10n_pe_district') and 'o_has_error' or ''} col-lg-6 div_district"
            t-att-style="not city and 'display: none'"
        >
            <label class="col-form-label" for="l10n_pe_district">District</label>
            <select
                id="l10n_pe_district"
                name="l10n_pe_district"
                t-attf-class="form-select #{error.get('l10n_pe_district') and 'is-invalid' or ''}"
                data-init="1"
            >
                <t t-foreach="city_districts" t-as="d">
                    <option
                        t-att-value="d.id"
                        t-att-selected="d.id == ('l10n_pe_district' in checkout and checkout['l10n_pe_district'] != '' and int(checkout['l10n_pe_district']))"
                    >
                        <t t-esc="d.name" />
                    </option>
                </t>
            </select>
        </div>

    </template>

    <template id="address" inherit_id="website_sale.address">
        <xpath expr="//input[@name='vat']/.." position="before">
            <t t-if="mode[1] == 'billing'" positon="inside">
                <t t-if="res_company.country_id.code == 'PE'">
                    <t t-set="partner" t-value="website_sale_order.partner_id" />
                    <t t-call="l10n_pe_website_sale.partner_info" />
                </t>
            </t>
        </xpath>
        <label for="vat" position="attributes">
            <attribute name="t-if">res_company.country_id.code != 'PE'</attribute>
        </label>
        <label for="vat" position="after">
            <label
                t-if="res_company.country_id.code == 'PE'"
                class="col-form-label label-optional"
                for="vat"
            >Number</label>
        </label>
        <xpath expr="//select[@name='state_id']/.." position="after">
            <div class="w-100" />
            <t t-if="mode[1] == 'billing'">
                <t t-if="res_company.country_id.code == 'PE'">
                    <t t-call="l10n_pe_website_sale.partner_address_info" />
                </t>
            </t>
        </xpath>
        <select name="state_id" position="attributes">
            <attribute name="id">state_id</attribute>
        </select>
        <xpath expr="//input[@name='city']/.." position="attributes">
            <attribute name="t-attf-class" add="d-none" separator=" " />
        </xpath>
    </template>

</odoo>
