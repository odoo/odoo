<?xml version="1.0" encoding="utf-8"?>
<odoo>

<template id="assets_frontend" inherit_id="website.assets_frontend" name="Sale Coupon Assets">
    <xpath expr="." position="inside">
        <script type="text/javascript" src="/website_sale_coupon/static/src/js/sale_coupon.js"/>
    </xpath>
</template>

<template id="sales_coupon_code_payment" inherit_id="website_sale.payment" active="True">
    <xpath expr="//div[@id='right_column']" position="inside">
        <div class="coupon_box">
            <h4>Promo Code</h4>
            <p>
            Have a promo code? Fill in this field and apply.
            </p>
            <div class="input-group">
                <input name="promo" class='form-control' type="text" placeholder="code..."/>
                <div class="input-group-btn">
                    <a class="btn btn-default a-submit check_coupon">Apply</a>
                </div>
            </div>
        </div>
    </xpath>
    <xpath expr="//table[@id='cart_products']/tbody" position="replace">
        <t t-foreach="website_sale_order.website_order_line" t-as="line">
            <tr t-if="line.product_id.name !='Reward'">
                <td colspan="2" t-if="not line.product_id.product_tmpl_id"></td>
                <td t-if="line.product_id.product_tmpl_id">
                    <a t-attf-href="/shop/product/#{ slug(line.product_id.product_tmpl_id) }">
                        <span t-field="line.product_id.image_small"
                            t-field-options='{"widget": "image", "class": "img-rounded"}'/>
                    </a>
                </td>
                <td t-if="line.product_id.product_tmpl_id">
                    <strong t-field="line.product_id.with_context(display_default_code=False).display_name"/>
                </td>
                <td class="text-center">
                    <span t-field="line.price_unit" style="white-space: nowrap;" t-field-options='{
                     "widget": "monetary",
                     "display_currency": "user_id.partner_id.property_product_pricelist.currency_id"
                    }'/>
                </td>
                <td>
                    <div t-esc="line.product_uom_qty"/>
                </td>
            </tr>
        </t>
    </xpath>
</template>

<template id="sales_coupon_code_cart" inherit_id="website_sale.cart" active="True">
    <xpath expr="//div[@id='right_column']" position="inside">
        <div class="coupon_box">
            <h4>Promo Code</h4>
            <p>
            Have a promo code? Fill in this field and apply.
            </p>
            <div class="input-group">
                <input name="promo" class='form-control' type="text" placeholder="code..."/>
                <div class="input-group-btn">
                    <a class="btn btn-default a-submit check_coupon">Apply</a>
                </div>
            </div>
        </div>
    </xpath>
    <xpath expr="//table[@id='cart_products']/tbody//tr" position="attributes">
        <attribute name="t-if">line.product_id.name !='Reward'</attribute>
    </xpath>
</template>

<template id="sales_coupon_reward" inherit_id="website_sale.total">
    <xpath expr="//table[@id='cart_total']/thead//tr[last()]" position="after">
        <tr width="120" class="text-muted" id="order_reward_amount">
            <td><abbr>Reward:</abbr></td>
            <td class="text-right">
                <span t-field="website_sale_order.reward_amouunt" style="white-space: nowrap;" t-field-options='{
                      "widget": "monetary",
                      "display_currency": "user_id.partner_id.property_product_pricelist.currency_id"
                    }'/>
            </td>
        </tr>
    </xpath>
</template>
</odoo>
