<?xml version="1.0" encoding="UTF-8"?>
<templates xml:space="preserve">
    <t t-name="ImportDataSidepanel">
        <div class="o_import_data_sidepanel p-3 bg-view flex-shrink-0">
            <div class="pb-3">
                <div t-if="props.options.sheets.length > 1" class="flex-row my-2">
                    <label for="o_import_sheet">Sheet:</label>
                    <select
                        class="o_select o_import_sheet w-100 mb-3 form-select"
                        name="o_import_sheet"
                        t-on-change="ev => this.props.onOptionChanged('sheet', ev.target.value)"
                        t-att-value="props.options.sheet"
                    >
                        <option t-foreach="props.options.sheets" t-as="sheet" t-key="sheet" t-att-value="sheet" t-att-selected="sheet === props.options.sheet">
                            <t t-esc="sheet" />
                        </option>
                    </select>
                </div>
                <CheckBox value="props.options.has_headers" onChange.bind="isChecked => this.props.onOptionChanged('has_headers', isChecked)">
                    Use first row as header<sup class="text-info p-1 cursor-default" t-att-data-tooltip="headersTooltip" t-esc="'?'" />
                </CheckBox>
                <CheckBox value="!props.options.tracking_disable" onChange.bind="(isChecked) => this.props.onOptionChanged('tracking_disable', !isChecked)">
                    Track changes in chatter<sup class="text-info p-1 cursor-default" t-att-data-tooltip="trackingTooltip" t-esc="'?'" />
                </CheckBox>
                <div t-if="props.isBatched and env.debug" class="o_import_grid gap-1">
                    <div class="o_import_grid_col">
                        <label for="o_import_batch_limit">Batch size</label>
                        <sup class="text-info p-1 cursor-default" t-att-data-tooltip="batchLimitTooltip" t-esc="'?'"/>
                    </div>
                    <div class="o_import_grid_col">
                        <input class="w-100 border rounded-2" type="number" id="o_import_batch_limit" t-att-value="getOptionValue('limit')" t-on-change="(ev) => this.setOptionValue('limit', ev.target.value || 1)" />
                    </div>
                </div>
            </div>
            <div t-if="fileExtension.toLowerCase() === '.csv'" class="o_import_formatting pt-3 border-top">
                <h4>Formatting</h4>
                <div t-foreach="Object.entries(props.formattingOptions)" t-as="option" t-key="`${option[0]}-${option_index}`" class="o_import_options">
                    <label t-att-for="`${option[0]}-${option_index}`">
                        <t t-esc="option[1].label" />
                        <sup t-if="option[1].help" class="text-info p-1" t-att-data-tooltip="option[1].help" t-esc="'?'" />
                    </label>
                    <input
                        t-if="option[1].type === 'input'"
                        t-att-id="`${option[0]}-${option_index}`"
                        t-att-list="option[1].options ? `list-${ option_index }` : null"
                        t-attf-class="o_import_#{option[0]} o_import_dropdown w-100 mb-3 border rounded-2 p-1"
                        t-att-value="option[1].value"
                        t-att-placeholder="option[1].placeholder"
                        t-on-change="(ev) => this.setOptionValue(option[0], ev.target.value)"
                    />
                    <datalist t-if="option[1].type === 'input' and option[1].options" t-att-id="`list-${ option_index }`">
                        <option t-foreach="option[1].options" t-as="opt" t-key="opt_index" t-att-value="opt.value or opt" t-att-selected="opt.value ? opt.value === option[1].value : opt === option[1].value">
                            <t t-esc="opt.label ? opt.label : opt" />
                        </option>
                    </datalist>
                    <select
                        t-elif="option[1].type === 'select'"
                        t-att-class="`o_select form-select w-100 mb-3 o_import_${option[0]} o_import_dropdown p-1`"
                        t-att-name="`${option[0]}-${option_index}`"
                        t-on-change="(ev) => this.setOptionValue(option[0], ev.target.value)"
                    >
                        <option t-foreach="option[1].options" t-as="opt" t-key="opt_index" t-att-value="opt.value or opt.value === '' ? opt.value : opt" t-att-selected="opt.value or opt.value === '' ? opt.value === option[1].value : opt === option[1].value">
                            <t t-esc="opt.label ? opt.label : opt" />
                        </option>
                    </select>
                    <input
                        t-if="option[1].other?.length and !option[1].other.includes(option[1].value)"
                        t-attf-class="o_import_#{option[0]}_other w-100 mb-3 border rounded-2 p-1"
                        t-att-value="option[1].value"
                        t-on-change="(ev) => this.setOptionValue(option[0], ev.target.value)"
                        t-att-placeholder="option[1].label"
                    />
                </div>
            </div>
            <div t-if="props.hasBinaryFields" class="py-3 border-top o_import_file">
                <h4>Attachments<sup class="text-info p-1" t-att-data-tooltip="attachmentsTooltip" t-esc="'?'" /></h4>
                <div class="o_import_grid gap-1">
                    <!-- First row-->
                    <div class="o_import_grid_col">
                        <label>
                            <span class="btn btn-sm btn-primary">Upload</span>
                            <input type="file" multiple="multiple" hidden="hidden"
                                   t-on-change="(event) => this.props.onBinaryFilesParamsChanged('binaryFiles', event.target.files)"/>
                        </label>
                    </div>
                    <div class="o_import_grid_col o_grid_span_2 align-content-center">
                        <t t-esc="binaryFilesLabel"/>
                    </div>

                    <!-- Second row-->
                    <t t-if="env.debug">
                        <div class="o_import_grid_col">
                            <label for="o_input_maxSizePerBatch">Batch max size</label>
                            <sup t-if="props.binaryFilesParams.maxSizePerBatch.help" class="text-info p-1 cursor-default" t-att-data-tooltip="props.binaryFilesParams.maxSizePerBatch.help" t-esc="'?'"/>
                        </div>
                        <div class="o_import_grid_col">
                                <input 
                                    type="number"
                                    id="o_input_maxSizePerBatch"
                                    class="border rounded-2"
                                    t-att-value="props.binaryFilesParams.maxSizePerBatch.value"
                                    t-att-max="props.binaryFilesParams.maxSizePerBatch.max"
                                    t-att-min="props.binaryFilesParams.maxSizePerBatch.min"
                                    t-on-change="(event) => this.props.onBinaryFilesParamsChanged('maxSizePerBatch', event.target.value)"
                                />
                        </div>
                        <div class="o_import_grid_col">
                            <label for="o_input_maxSizePerBatch">Mb</label>
                        </div>

                        <!-- Third row-->
                        <div class="o_import_grid_col">
                            <label for="o_input_delayAfterEachBatch">Batch interval</label>
                            <sup t-if="props.binaryFilesParams.delayAfterEachBatch.help" class="text-info p-1 cursor-default" t-att-data-tooltip="props.binaryFilesParams.delayAfterEachBatch.help" t-esc="'?'"/>
                        </div>
                        <div class="o_import_grid_col">
                                <input 
                                    type="number"
                                    id="o_input_delayAfterEachBatch"
                                    class="border rounded-2"
                                    t-att-value="props.binaryFilesParams.delayAfterEachBatch.value"
                                    t-att-min="props.binaryFilesParams.delayAfterEachBatch.min"
                                    t-on-change="(event) => this.props.onBinaryFilesParamsChanged('delayAfterEachBatch', event.target.value)"
                                />
                        </div>
                        <div class="o_import_grid_col">
                            <label for="o_input_delayAfterEachBatch">seconds</label>
                        </div>
                    </t>
                </div>

            </div>
            <div class="py-3 border-top">
                <h4>Help</h4>
                <t t-foreach="props.importTemplates" t-as="template" t-key="template">
                    <a class="d-block my-2" t-att-href="template.template" aria-label="Download" data-tooltip="Download">
                        <i class="fa fa-download"/> <span><t t-esc="template.label"/></span>
                    </a>
                </t>
                <DocumentationLink path="'/applications/general/export_import_data.html'" label.translate="Documentation" icon="'fa-question-circle'"/>
            </div>
        </div>
    </t>
</templates>
