<?xml version="1.0" ?>
<odoo><data>

<!-- Slide: main template: detailed view -->
<template id="slide_main" name="Slide Detailed View" track="1">
    <t t-set="body_classname" t-value="'o_wslides_body'"/>
    <t t-call="website.layout">
        <div id="wrap" class="wrap o_wslides_wrap my-4">
            <div class="container o_wslides_lesson_main">
                <div class="o_wslides_lesson_header position-relative mb-4 d-flex align-items-center justify-content-between">
                    <t t-call="website_slides.course_nav">
                        <t t-set="channel" t-value="slide.channel_id"/>
                    </t>
                    <a class="btn btn-light d-lg-none ms-auto" data-bs-toggle="offcanvas" href="#o_wslides_lessons_navigation" role="button" aria-controls="o_wslides_lessons_navigation">
                        <i class="fa fa-list"/>
                        Contents
                    </a>
                </div>
                <div class="row">
                    <t t-set="can_access_channel" t-value="slide.channel_id.is_member or slide.channel_id.can_publish"/>
                    <div class="o_wslides_lesson_content col-lg-8 col-xl-9">
                        <t t-call="website_slides.slide_content_detailed"/>
                    </div>
                    <div class="o_wslides_lesson_aside col-lg-4 col-xl-3 d-none d-lg-block">
                        <t t-call="website_slides.slide_aside_training"/>
                    </div>
                </div>
            </div>
        </div>
    </t>
</template>

<!-- Slide: sidebar documentation mode -->
<template id="slide_aside_documentation" name="Slide: Sidebar in Documentation">
    <div class="o_wslides_lesson_aside_doc position-relative bg-white pb-1 my-3 border-bottom">
        <ul class="nav nav-tabs nav-fill" role="tablist">
            <li class="nav-item" role="presentation"><a aria-controls="related" href="#related" class="nav-link rounded-0 border-top-0 border-start-0 py-2 active" data-bs-toggle="tab" role="tab">Related</a></li>
            <li class="nav-item" role="presentation"><a aria-controls="most_viewed" href="#most_viewed" class="nav-link rounded-0 border-top-0 border-end-0 py-2" data-bs-toggle="tab" role="tab">Most Viewed</a></li>
        </ul>
        <div class="tab-content">
            <div role="tabpanel" id="related" class="tab-pane active bg-100">
                <ul class="list-group list-group-flush">
                    <t t-set="related_slides_list" t-value="list(related_slides)"/>
                    <t t-if="not related_slides_list">
                        No presentation available.
                    </t>
                    <t t-else="" t-foreach="related_slides_list" t-as="aside_slide">
                        <t t-call="website_slides.slide_aside_card"/>
                    </t>
                </ul>
            </div>
            <div role="tabpanel" id="most_viewed" class="tab-pane bg-100">
                <ul class="list-group list-group-flush">
                    <t t-set="most_viewed_slides_list" t-value="list(most_viewed_slides)"/>
                    <t t-if="not list(most_viewed_slides_list)">
                        No presentation available.
                    </t>
                    <t t-else="" t-foreach="most_viewed_slides_list" t-as="aside_slide">
                        <t t-call="website_slides.slide_aside_card"/>
                    </t>
                </ul>
            </div>
        </div>
    </div>
</template>

<!-- Slide sub-template: display an item in a list of related slides (Related, Most Viewed, ...) -->
<template id="slide_aside_card" name="Related Slide">
    <a class="list-group-item list-group-item-action d-flex align-items-start px-2" t-att-href="'/slides/slide/%s' % (slug(aside_slide))">
        <div class="me-1 border o_wslides_background_image_aside_card" t-attf-style="background-image: url(#{website.image_url(aside_slide, 'image_256')});"/>
        <div class="overflow-hidden d-flex flex-column justify-content-start">
            <h6 t-esc="aside_slide.name" class="o_wslides_desc_truncate_2 mb-1" style="line-height: 1.15"/>
            <small class="text-600">
                <t t-esc="aside_slide.total_views"/> Views &#8226; <timeago class="timeago" t-att-datetime="aside_slide.create_date"></timeago>
            </small>
        </div>
    </a>
</template>

<!-- Slide: sidebar training mode -->
<template id="slide_aside_training" name="Slide: Sidebar in Training">
    <div class="o_wslides_lesson_aside_list">
        <ul class="list-unstyled my-0 pb-3">
            <t t-set="i" t-value="0"/>
            <t t-if="category.get('slides')" t-foreach="category_data" t-as="category">
                <t t-call="website_slides.slide_aside_training_category">
                    <t t-set="category_slide_ids" t-value="category['slides']"/>
                </t>
            </t>
        </ul>
    </div>
</template>

<template id="slide_aside_training_category" name="Category item for the slide detailed view list">
    <t t-if="category" t-set="category" t-value="category.get('category')"/>
    <li class="o_wslides_fs_sidebar_section">
        <h6 class="mt-3 pb-2 border-bottom">
            <t t-if="category">
                <t t-out="category.name"/>
            </t>
            <t t-else="">
                Uncategorized
            </t>
        </h6>
        <ul class="p-0 m-0 list-unstyled" >
            <t t-set="is_member" t-value="slide.channel_id.is_member"/>
            <t t-set="can_access_channel" t-value="is_member or slide.channel_id.can_publish"/>
            <t t-foreach="category_slide_ids" t-as="aside_slide">
                <t t-set="slide_completed" t-value="channel_progress[aside_slide.id].get('completed')"/>
                <t t-set="can_access" t-value="aside_slide.is_preview or can_access_channel"/>
                <li class="p-0 pb-1">
                    <div t-att-class="'o_wslides_lesson_aside_list_link d-flex p-1 %s%s' % (('active rounded bg-light' if aside_slide == slide else ''), 'text-muted' if not can_access else '')"
                        t-att-data-id="slide.id"
                        t-att-data-completed="slide_completed">
                        <t t-call="website_slides.slide_sidebar_done_button">
                            <t t-set="slide" t-value="aside_slide"/>
                            <t t-set="slide_completed" t-value="channel_progress[aside_slide.id].get('completed')"/>
                            <t t-set="use_slide_icon" t-value="True"/>
                        </t>
                        <div>
                            <a t-att-href="'/slides/slide/%s' % (slug(aside_slide)) if can_access else '#'"
                                t-attf-class="d-flex text-decoration-none mw-100 overflow-hidden text-reset #{'text-muted' if not can_access else ''}">
                                <div class="o_wslides_lesson_link_name" t-att-title="aside_slide.name">
                                    <span t-esc="aside_slide.name"/>
                                    <span class="align-items-end small" t-if="aside_slide.question_ids">
                                        <span t-att-class="'badge rounded-pill %s' % ('text-bg-success' if channel_progress[aside_slide.id].get('completed') else 'text-bg-info')">
                                            <t t-esc="channel_progress[aside_slide.id].get('quiz_karma_won') if channel_progress[aside_slide.id].get('completed') else channel_progress[aside_slide.id].get('quiz_karma_gain')"/> xp
                                        </span>
                                    </span>
                                </div>
                            </a>
                            <ul t-if="aside_slide.sudo().slide_resource_ids or aside_slide.question_ids" class="o_wslides_lesson_aside_list_links list-group mb-1 list-unstyled fw-light">
                                <t t-if="can_access_channel" t-foreach="aside_slide.slide_resource_ids" t-as="resource">
                                <li>
                                        <a t-if="resource.resource_type == 'url'" t-att-href="resource.link" target="new" class="text-decoration-none small">
                                            <i class="fa fa-link me-1"/><span t-field="resource.name"/>
                                        </a>
                                        <a t-else="" t-att-href="resource.download_url" class="text-decoration-none small">
                                            <i class="fa fa-download me-1"/><span t-field="resource.name"/>
                                        </a>
                                    </li>
                                </t>
                                <div t-else="" class="o_wslides_js_course_join o_wslides_no_access">
                                    <li t-if="aside_slide.channel_id.enroll == 'public' or (aside_slide.channel_id.enroll == 'invite' and aside_slide.channel_id.is_member_invited)"
                                        class="text-decoration-none small">
                                        <i class="fa fa-download"/>
                                        <t t-call="website_slides.join_course_link">
                                            <t t-set="for_resources" t-value="1"/>
                                        </t>
                                    </li>
                                </div>
                                <li t-if="aside_slide.question_ids and aside_slide.slide_category != 'quiz'">
                                    <a t-if="can_access" t-att-href="'/slides/slide/%s#lessonQuiz' % (slug(aside_slide))"
                                        class="o_wslides_lesson_aside_list_link text-decoration-none small text-600">
                                        <i class="fa fa-flag text-warning"/> Quiz
                                    </a>
                                    <span t-else="" class="o_wslides_lesson_aside_list_link text-decoration-none small text-600 text-muted">
                                        <i class="fa fa-flag text-warning"/> Quiz
                                    </span>
                                </li>
                            </ul>
                        </div>
                    </div>
                </li>
            </t>
        </ul>
    </li>
</template>

<!-- Slide: all its content, not fullscreen mode -->
<template id="slide_content_detailed" name="Slide: Detailed Content">
    <div class="offcanvas offcanvas-end" tabindex="-1" id="o_wslides_lessons_navigation" aria-labelledby="o_wslides_course_navigation">
        <div class="offcanvas-header">
            <h5 class="offcanvas-title" id="o_wslides_course_navigation">Course content</h5>
            <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
        </div>
        <div class="offcanvas-body">
            <t t-call="website_slides.slide_aside_training"/>
        </div>
    </div>
    <div class="d-flex align-items-center gap-3 mb-3">
        <t t-set="slide_completed" t-value="channel_progress[slide.id].get('completed')"/>
        <h1 class="h3 flex-grow-1 mb-0" t-field="slide.name"/>
        <a class="btn btn-light" role="button" t-att-href="'/slides/slide/%s?fullscreen=1' % (slug(slide))" aria-label="Fullscreen">
            <i class="fa fa-expand" role="img"/>
        </a>
    </div>
    <div class="oe_structure oe_empty" id="oe_structure_website_slides_lesson_top_1" data-editor-message.translate="BUILDING BLOCKS DROPPED HERE WILL BE SHOWN ACROSS ALL LESSONS"/>
    <div t-if="slide.slide_category == 'infographic'" class="o_wslides_lesson_content_type" t-field='slide.image_1920' t-options="{'widget': 'image', 'style': 'width: 100%;'}"/>
    <div t-else="" class="o_wslides_lesson_content_type">
        <div t-if="slide.slide_category == 'document'" class="ratio ratio-4x3 embed-responsive-item" style="height: 600px;">
            <t t-out="slide.embed_code"/>
        </div>
        <div t-if="slide.slide_category == 'video'" class="ratio ratio-16x9 embed-responsive-item">
            <t t-out="slide.embed_code"/>
        </div>
        <div t-if="slide.slide_category == 'article'">
            <div t-if="is_html_empty(slide.html_content)" class="alert alert-info o_not_editable">
                Click on the "Edit" button in the top corner of the screen to edit your slide content.
            </div>
            <div class="bg-white p-3">
                <div t-field="slide.html_content" placeholder="Add your content here..."/>
            </div>
        </div>
        <div t-if="slide.slide_category == 'quiz'">
            <t t-call="website_slides.lesson_content_quiz"/>
        </div>
    </div>

    <div class="position-relative mt-2 mb-5">
        <div class="d-flex align-items-center mb-3">
            <div t-if="slide.tag_ids" class="small">
                <t t-foreach="slide.tag_ids" t-as="tag">
                    <a t-att-href="'/slides/%s/tag/%s' % (slug(slide.channel_id), slug(tag))" class="badge bg-light" t-esc="tag.name"/>
                </t>
            </div>
            <div class="d-flex align-items-center ms-auto">
                <div t-if="slide.channel_id.allow_comment" class="d-flex">
                    <div class="o_wslides_js_slide_like me-2">
                        <span t-attf-class="o_wslides_js_slide_like_up text-success #{'disabled' if not slide.channel_id.can_vote else ''}" tabindex="0" data-bs-toggle="popover" t-att-data-slide-id="slide.id" t-att-data-user-vote="slide.user_vote">
                            <i t-attf-class="fa fa-1x #{'fa-thumbs-up' if slide.user_vote == 1 else 'fa-thumbs-o-up'}" role="img" aria-label="Likes" title="Like"/>
                            <span t-field="slide.likes" t-options="{'format_decimalized_number': True}"/>
                        </span>
                        <span t-attf-class="o_wslides_js_slide_like_down ms-3 text-danger #{'disabled' if not slide.channel_id.can_vote else ''}" tabindex="0" data-bs-toggle="popover" t-att-data-slide-id="slide.id" t-att-data-user-vote="slide.user_vote">
                            <i t-attf-class="fa fa-1x #{'fa-thumbs-down' if slide.user_vote == -1 else 'fa-thumbs-o-down'}" role="img" aria-label="Dislikes" title="Dislike"/>
                            <span t-field="slide.dislikes" t-options="{'format_decimalized_number': True}"/>
                        </span>
                    </div>
                </div>
                <a class="o_wslides_share btn btn-link" role="button" t-att-data-name="slide.name"
                t-att-data-id="slide.id" t-att-data-url="slide.website_share_url" t-att-data-category="slide.slide_category"
                t-att-data-email-sharing="bool(slide.channel_id.share_slide_template_id)"
                t-att-data-embed-code="slide.embed_code_external if slide.slide_category in ['video', 'document'] else False"
                aria-label="Share">
                    <i class="fa fa-share-alt me-1" role="img"/>
                    Share
                </a>
            </div>
        </div>
        <ul class="nav nav-underline o_wslides_lesson_nav" role="tablist">
            <li class="nav-item" role="presentation">
                <a href="#about" aria-controls="about" t-att-class="'nav-link active' if not comments else 'nav-link'" role="tab" data-bs-toggle="tab">
                    About
                </a>
            </li>
            <li class="nav-item" role="presentation">
                <a href="#discuss" aria-controls="discuss" t-att-class="'nav-link active' if comments else 'nav-link'" role="tab" data-bs-toggle="tab">
                    <i class="fa fa-comments me-1" role="img"/>Comments (<span t-esc="slide.comments_count"/>)
                </a>
            </li>
            <li class="nav-item" role="presentation" groups="base.group_user">
                <a href="#statistic" aria-controls="statistic" class="nav-link" role="tab" data-bs-toggle="tab">
                    <i class="fa fa-bar-chart me-1" role="img"/>Statistics
                </a>
            </li>
        </ul>
        <div class="tab-content mt-3">
            <div role="tabpanel" t-att-class="not comments and 'tab-pane fade in show active' or 'tab-pane fade'" id="about">
                <div t-field="slide.description"/>
            </div>
            <div role="tabpanel" t-att-class="comments and 'tab-pane fade in show active' or 'tab-pane fade'" id="discuss">
                <t t-set="enable_slide_comments" t-value="0"/>
                <p t-if="not (slide.channel_id.allow_comment and slide.channel_id.channel_type == 'training')">
                    Commenting is not enabled on this course.
                </p>
                <t t-elif="not slide.comments_count">
                    <p t-if="not can_access_channel">
                        There are no comments for now.
                        <t t-if="slide.channel_id.enroll != 'invite'">
                            <div class="o_wslides_js_course_join o_wslides_no_access_comments d-inline">
                                <t t-if="slide.channel_id.enroll == 'public'" t-call="website_slides.join_course_link"/>
                            </div>
                            to be the first to leave a comment.
                        </t>
                    </p>
                    <p t-elif="not slide.channel_id.can_comment">
                        There are no comments for now. Earn more Karma to be the first to leave a comment.
                    </p>
                    <t t-else="" t-set="enable_slide_comments" t-value="1"/>
                </t>
                <t t-else="">
                    <t t-set="enable_slide_comments" t-value="1"/>
                    <t t-if="not slide.channel_id.can_comment and can_access_channel"><p>Earn more Karma to leave a comment.</p></t>
                </t>
                <t t-if="enable_slide_comments" t-call="portal.message_thread">
                    <t t-set="object" t-value="slide"/>
                    <t t-set="disable_composer" t-value="not (slide.channel_id.can_comment and slide.channel_id.allow_comment)"/>
                    <t t-set="display_rating" t-value="False"/>
                </t>
            </div>
            <div role="tabpanel" class="tab-pane fade" groups="base.group_user" id="statistic" t-att-slide-url="slide.website_absolute_url">
                <div class="row">
                    <div class="col-md-6">
                        <table class="table table-sm">
                            <tbody>
                                <tr>
                                    <th colspan="2" class="border-top-0">Views</th>
                                </tr>
                                <tr class="border-top-0">
                                    <th class="border-top-0"><span t-esc="slide.total_views"/></th>
                                    <td class="border-top-0 w-100">Total Views</td>
                                </tr>
                                <tr>
                                    <th><span t-esc="slide.slide_views"/></th>
                                    <td>Members Views</td>
                                </tr>
                                <tr>
                                    <th><span t-esc="slide.public_views"/></th>
                                    <td>Public Views</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="o_wslides_js_quiz_container" t-att-data-slide-id="slide.id" id="quiz_container">
        <div class="row" t-if="slide.slide_category != 'certification'">
            <t t-if="slide.question_ids and slide.slide_category != 'quiz'">
                <t t-call="website_slides.lesson_content_quiz"/>
            </t>
        </div>
    </div>
    <div class="mt-3 mb-3">
        <t t-if="slide.sudo().slide_resource_ids">
            <t t-set="can_access_channel" t-value="slide.channel_id.is_member or slide.channel_id.can_publish"/>
            <t t-if="can_access_channel">
                <t t-set="links" t-value="slide.slide_resource_ids.filtered(lambda res: res.resource_type == 'url')"/>
                <div class="row mb-4 mt-4" t-if="links">
                    <span class="text-muted fw-bold col-4 col-md-3">External sources</span>
                    <div class="text-muted me-auto border-start ps-3 col-8 col-md-9">
                        <t t-foreach="links" t-as="link">
                            <a t-att-href="link.link" t-esc="link.name"/><br />
                        </t>
                    </div>
                </div>
                <t t-set="files" t-value="slide.slide_resource_ids.filtered(lambda res: res.resource_type == 'file' and res.data)"/>
                <div class="row mb-4 o_wslides_js_course_join" t-if="files">
                    <span class="text-muted fw-bold col-4 col-md-3">
                        Additional Resources
                    </span>
                    <div class="text-muted me-auto border-start ps-3 col-8 col-md-9">
                        <t t-foreach="slide.slide_resource_ids" t-as="resource" t-if="resource.resource_type == 'file' and resource.data">
                            <a t-att-href="resource.download_url" t-esc="resource.name"/><br />
                        </t>
                    </div>
                </div>
            </t>
            <t t-else="">
                <span t-if="slide.is_preview" class="text-muted fw-bold me-3">
                    Additional Resources
                </span>
                <div class="o_wslides_js_course_join o_wslides_no_access">
                    <div t-if="slide.channel_id.enroll == 'invite' and not slide.channel_id.is_member_invited">
                        <span>Content only accessible to course attendees.</span>
                    </div>
                    <div t-else="" class="text-muted me-auto border-start ps-3">
                        <t t-call="website_slides.join_course_link">
                            <t t-set="for_resources" t-value="1"/>
                        </t>
                    </div>
                </div>
            </t>
        </t>
    </div>
</template>

<!-- Slide sub-tempalte: render a quiz serverside. Should be sync with JS qweb template "slide.slide.quiz" -->
<template id="lesson_content_quiz" name="Lesson: Quiz specific content">
    <t t-set="slide_completed" t-value="channel_progress[slide.id].get('completed')"/>
    <div class="o_wslides_js_lesson_quiz col" id="lessonQuiz"
        t-att-data-id="slide.id"
        t-att-data-name="slide.name"
        t-att-data-slide-category="slide.slide_category"
        t-att-data-is-member="slide.channel_id.is_member"
        t-att-data-is-member-or-invited="slide.channel_id.is_member or slide.channel_id.is_member_invited"
        t-att-data-can-self-mark-completed="slide.can_self_mark_completed"
        t-att-data-can-self-mark-uncompleted="slide.can_self_mark_uncompleted"
        t-att-data-completed="slide_completed"
        t-att-data-quiz-attempts-count="quiz_attempts_count"
        t-att-data-quiz-karma-max="quiz_karma_max"
        t-att-data-quiz-karma-gain="quiz_karma_gain"
        t-att-data-quiz-karma-won="quiz_karma_won"
        t-att-data-has-next="1 if next_slide else 0"
        t-att-data-next-slide-url="'/slides/slide/%s' % (slug(next_slide)) if next_slide else None"
        t-att-data-channel-id="slide.channel_id.id"
        t-att-data-channel-enroll="slide.channel_id.enroll"
        t-att-data-channel-requested-access="slide.channel_id.has_requested_access"
        t-att-data-channel-can-upload="slide.channel_id.can_upload"
        t-att-data-signup-allowed="signup_allowed"
        t-att-data-session-answers="session_answers">
        <t t-foreach="slide_questions" t-as="question">
            <t t-call="website_slides.lesson_content_quiz_question"/>
        </t>
        <div class="o_wslides_js_lesson_quiz_validation pt-3"/>
    </div>
</template>

<template id="lesson_content_quiz_question" name="Lesson: Quiz question template">
    <div t-att-class="'o_wslides_js_lesson_quiz_question mt-4 %s' % ('completed-disabled' if slide_completed else ('disabled' if not (slide.channel_id.is_member or slide.is_preview) else ''))"
         t-att-data-question-id="question['id']" t-att-data-title="question['question']" >
        <h5>
            <t t-if="question_index != NoneType"><span class="o_wslides_quiz_question_sequence" t-esc="question_index+1"/>.</t>
            <t t-else=""><span class="o_wslides_quiz_question_sequence" t-esc="question['sequence']"/>.</t>
            <span t-esc="question['question']"/>
        </h5>
        <div class="list-group">
            <t t-foreach="question['answer_ids']" t-as="answer">
                <a t-att-data-answer-id="answer['id']" href="#"
                    t-att-data-text="answer['text_value']" t-att-data-is-correct="answer['is_correct']" t-att-data-comment="answer['comment']"
                    t-att-class="'o_wslides_quiz_answer list-group-item list-group-item-action d-flex align-items-center %s' % ('list-group-item-success' if slide_completed and answer['is_correct'] else '')">
                    <label class="my-0 d-flex align-items-center justify-content-center me-2">
                        <input type="radio"
                            t-att-name="question['id']"
                            t-att-value="answer['id']"
                            class="d-none"
                            t-att-disabled="True if not slide.channel_id.is_member or slide_completed else ''"/>
                        <i t-att-class="'fa fa-circle text-400 %s' % ('d-none' if slide_completed and answer['is_correct'] else '')"/>
                        <i class="fa fa-times-circle text-danger d-none"></i>
                        <i t-att-class="'fa fa-check-circle text-success %s' % ('d-none' if not (slide_completed and answer['is_correct']) else '')"></i>
                    </label>
                    <span t-esc="answer['text_value']"/>
                </a>
                <t t-if="slide_completed and answer['is_correct']" t-set="correct_answer_comment" t-value="answer['comment']"/>
            </t>
            <div t-attf-class="o_wslides_quiz_answer_info list-group-item list-group-item-info #{'' if correct_answer_comment else 'd-none'}">
                <i class="fa fa-info-circle"/>
                <span class="o_wslides_quiz_answer_comment ms-1">
                    <t t-if="correct_answer_comment" t-out="correct_answer_comment"/>
                </span>
            </div>
        </div>
    </div>
</template>

</data></odoo>
