<?xml version="1.0" encoding="utf-8"?>
<odoo>

<record id="view_account_payment_group_tree" model="ir.ui.view">
    <field name="name">account.payment.group.tree</field>
    <field name="model">account.payment.group</field>
    <field name="arch" type="xml">
        <tree decoration-info="state=='draft'" decoration-muted="state in ['reconciled', 'cancel']">
            <field name="date"/>
            <field name="partner_id"/>
            <field name="payments_amount" sum="Total"/>
            <field name="state"/>
            <field name="company_id" groups="base.group_multi_company"/>
            <field name="currency_id" invisible="1"/>
        </tree>
    </field>
</record>

<record id="view_account_payment_group_search" model="ir.ui.view">
    <field name="name">account.payment.group.search</field>
    <field name="model">account.payment.group</field>
    <field name="arch" type="xml">
        <search string="Payments">
            <field name="name"/>
            <separator/>
            <field name="partner_id" />
            <field name="company_id" groups="base.group_multi_company" />
            <separator/>
            <filter string="Draft" name="state_draft" domain="[('state', '=', 'draft')]"/>
            <filter string="Posted" name="state_posted" domain="[('state', '=', 'posted')]"/>
            <separator/>
            <filter name="partner_id" string="Partner" domain="[]" context="{'group_by': 'partner_id'}"/>
            <filter name="state" string="State" domain="[]" context="{'group_by': 'state'}"/>
            <filter name="currency_id" string="Currency" domain="[]" context="{'group_by': 'currency_id'}" groups="base.group_multi_currency"/>
            <filter name="company_id" string="Company" domain="[]" context="{'group_by': 'company_id'}" groups="base.group_multi_company"/>
        </search>
    </field>
</record>

<record id="view_account_payment_group_form" model="ir.ui.view">
    <field name="name">Payment Multi</field>
    <field name="model">account.payment.group</field>
    <field name="arch" type="xml">
        <form string="Register Payment">
            <header>
                <button name="action_post" string="Confirm" type="object" class="oe_highlight"
                        attrs="{'invisible': [('state', '!=', 'draft')]}"/>
                <button name="action_draft" string="Reset To Draft" type="object" class="btn btn-secondary"
                        attrs="{'invisible': [('state', 'not in', ('posted', 'cancel'))]}"
                        groups="account.group_account_invoice"/>
                <button name="action_cancel" string="Cancel" type="object"
                        attrs="{'invisible': [('state', '!=', 'draft')]}"/>
                <field name="state" widget="statusbar" statusbar_visible="draft,posted"/>
            </header>
            <sheet>
                <field name="company_id" invisible="1"/>
                <field name="currency_id" invisible="1"/>
                <field name="partner_type" invisible="1"/>
                <div class="oe_button_box" name="button_box">
                </div>

                <div class="oe_title">
                    <h1 attrs="{'invisible': [('state', '!=', 'draft')]}"><span>Draft</span></h1>
                    <h1 attrs="{'invisible': [('state', '=', 'draft')]}"><field name="name" readonly="1"/></h1>
                </div>

                <group>
                    <group name="group1">
                        <field name="partner_id" context="{'default_is_company': True}" string="Customer"
                                attrs="{'readonly':[('state', '!=', 'draft')],
                                        'invisible':[('partner_type','!=','customer')],
                                        'required': [('partner_type','=','customer')]}"/>
                        <field name="partner_id" context="{'default_is_company': True}" string="Vendor"
                                attrs="{'readonly':[('state', '!=', 'draft')],
                                        'invisible':[('partner_type','!=','supplier')],
                                        'required': [('partner_type','=','supplier')]}"/>
                        <field name="date" attrs="{'readonly': [('state', '!=', 'draft')]}"/>
                    </group>
                    <group name="group2">
                    </group>
                    <group name="group3">
                        <field name="selected_debt" options="{'currency_field': 'currency_id'}" states="draft, confirmed"/>
                        <field name="unreconciled_amount" options="{'currency_field': 'currency_id'}" states="draft, confirmed"/>
                        <field name="to_pay_amount" options="{'currency_field': 'currency_id'}" states="draft, confirmed"/>
                    </group>
                    <group name="group4">
                        <field name="payments_amount" string="Payments Amount" options="{'currency_field': 'currency_id'}"/>
                        <field name="payment_difference" options="{'currency_field': 'currency_id'}" states="draft,confirmed"/>
                    </group>
                </group>
                <notebook>
                    <page string="Payments">
                        <field name="payment_ids" context="{'form_view_ref': 'account_payment_group.view_account_payment_from_group_form','tree_view_ref': 'account_payment_group.view_account_payment_from_group_tree', 'default_partner_id': partner_id, 'default_partner_type': partner_type, 'default_payment_type': partner_type == 'supplier' and 'outbound' or 'inbound', 'default_date': date, 'default_move_journal_types': ('bank', 'cash')}"/>
                    </page>
                    <page string="To Pay" states="draft, confirmed">
                        <button name="add_all" string="Add All / Refresh" states="draft" type="object"/>
                        <button name="remove_all" string="Remove All" states="draft" type="object"/>
                        <field name="to_pay_move_line_ids" domain="[('partner_id', '=', partner_id),('account_id.reconcile', '=', True),('reconciled', '=', False),('full_reconcile_id', '=', False), ('company_id', '=', company_id), ('move_id.state', '=', 'posted'), ('account_id.internal_type', '=', 'receivable' if partner_type == 'customer' else 'payable')]"/>
                    </page>
                </notebook>
            </sheet>
        <div class="oe_chatter">
            <field name="message_follower_ids" widget="mail_followers" groups="base.group_user"/>
            <field name="message_ids" widget="mail_thread"/>
        </div>
        </form>
    </field>
</record>


<record id="action_account_payments_group" model="ir.actions.act_window">
    <field name="name">Payment Groups</field>
    <field name="res_model">account.payment.group</field>
    <field name="view_mode">tree,form</field>
    <field name="context">{
        'default_payment_type': 'inbound',
        'default_partner_type': 'customer',
        'search_default_inbound_filter': 1,
        'default_move_journal_types': ('bank', 'cash'),
    }</field>
    <field name="help" type="html">
        <p class="o_view_nocontent_smiling_face">
            Register a payment group
        </p><p>
        <!-- TODO -->
            Payments Groups are used to register ... (TODO)
        </p>
    </field>
</record>

<record id="action_account_payments_group_payable" model="ir.actions.act_window">
    <field name="name">Payments Groups</field>
    <field name="res_model">account.payment.group</field>
    <field name="view_mode">tree,form</field>
    <field name="context">{
        'default_payment_type': 'outbound',
        'default_partner_type': 'supplier',
        'search_default_outbound_filter': 1,
        'default_move_journal_types': ('bank', 'cash'),
    }</field>
    <field name="help" type="html">
        <p class="o_view_nocontent_smiling_face">
            Register a payment
        </p><p>
            Payments Groups are used to register ... (TODO)
        </p>
    </field>
</record>

<menuitem id="menu_action_account_payments_group_receivable" action="action_account_payments_group" parent="account.menu_finance_receivables" sequence="16"/>
<menuitem id="menu_action_account_payments_group_payable" action="action_account_payments_group_payable" parent="account.menu_finance_payables" sequence="21"/>

</odoo>
