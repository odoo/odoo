<?xml version="1.0" encoding="UTF-8"?>
<templates>
    <div t-name="LunchKanbanWidget" class="o_lunch_kanban_banner">
        <div class="o_lunch_widget">
            <div class="o_lunch_widget_info d-flex flex-row">
                <div>
                    <img class="rounded-circle" t-attf-src="{{ widget.userimage }}"/>
                </div>
                <div class="w-50 ml-2 py-3">
                    <div class="o_lunch_user_field"/>
                    <div class="o_lunch_location_field"/>
                    <div class="d-flex flex-row">
                        <span class="flex-grow-1">Your Account</span>
                        <t t-call="currency_field">
                            <t t-set="value" t-value="widget.wallet"/>
                            <t t-set="currency" t-value="widget.currency"/>
                        </t>
                    </div>
                </div>
            </div>
            <div class="o_lunch_widget_info">
                <t t-if="!_.isEmpty(widget.lines)">
                    <t t-if="widget.raw_state == 'ordered'">
                        <t t-set="state_class" t-value="'o_lunch_ordered'"/>
                    </t>
                    <t t-else="widget.raw_state == 'confirmed'">
                        <t t-set="state_class" t-value="'o_lunch_confirmed'"/>
                    </t>
                    <div class="d-flex flex-row">
                        <div class="flex-grow-1">
                            <span class="o_lunch_widget_title">Your order</span>
                            <a href="#"><i t-if="widget.raw_state != 'confirmed'" class="fa fa-trash o_lunch_widget_unlink"/></a>
                        </div>
                        <div t-if="widget.raw_state != 'new'" t-esc="widget.state" t-attf-class="flex-grow-0 {{ state_class }}"/>
                    </div>
                    <div t-foreach="widget.lines" t-as="line">
                        <div class="d-flex flex-row">
                            <div class="flex-grow-0">
                                <a class="o_remove_product" t-if="widget.raw_state != 'confirmed'" t-attf-data-id="{{ line.id }}" href="#"><i class="fa fa-minus-circle"/></a>
                                <span t-esc="line.quantity"/>
                                <a class="o_add_product" t-if="widget.raw_state != 'confirmed'" t-attf-data-id="{{ line.id }}" href="#"><i class="fa fa-plus-circle"/></a>
                            </div>
                            <div class="flex-grow-1 pl-2">
                                <a t-esc="line.product[1]" class="o_lunch_open_wizard" t-attf-data-product-id="{{ line.product[0] }}" t-attf-data-id="{{ line.id }}"/>
                            </div>
                            <div class="flex-grow-0">
                                <t t-call="currency_field">
                                    <t t-set="value" t-value="line.product[2]"/>
                                    <t t-set="currency" t-value="widget.currency"/>
                                </t>
                            </div>
                        </div>
                        <div t-foreach="line.toppings" t-as="topping" class="d-flex flex-row">
                            <div class="flex-grow-1 pl-5">
                                <span>+ <t t-esc="topping[0]"/></span>
                            </div>
                            <div class="flex-grow-0">
                                <t t-call="currency_field">
                                    <t t-set="value" t-value="topping[1]"/>
                                    <t t-set="currency" t-value="widget.currency"/>
                                </t>
                            </div>
                        </div>
                        <span t-if="line.note" t-esc="line.note" class="text-muted pl-5"/>
                    </div>
                </t>
            </div>
            <div class="o_lunch_widget_info">
                <t t-if="!_.isEmpty(widget.lines) &amp;&amp; widget.raw_state == 'new'">
                    <div class="d-flex flex-row">
                        <div class="o_lunch_widget_title flex-grow-1">
                            Total
                        </div>
                        <div class="flex-grow-0 pr-1">
                            <t t-call="currency_field">
                                <t t-set="value" t-value="widget.total"/>
                                <t t-set="currency" t-value="widget.currency"/>
                            </t>
                        </div>
                    </div>
                    <button t-if="widget.raw_state == 'new'" class="btn btn-primary o_lunch_widget_order_button">ORDER NOW</button>
                </t>
            </div>
        </div>
        <t t-foreach="widget.alerts" t-as="alert">
            <div class="alert alert-danger" role="alert">
                <t t-raw="alert.message"/> <!-- alert.message is coming from a fields.Html so it should be safe -->
            </div>
        </t>
    </div>

    <t t-name="currency_field">
        <t t-js="ctx">
            ctx.value = _.str.sprintf('%.2f', parseFloat(ctx.value));
        </t>
        <t t-if="currency">
            <t t-if="currency.position == 'after'">
                <t t-esc="value"/><t t-esc="currency.symbol"/>
            </t>
            <t t-else="">
                <t t-esc="currency.symbol"/><t t-esc="value"/>
            </t>
        </t>
        <t t-else="">
            <t t-esc="value"/>
        </t>
    </t>

    <div t-name="lunch.LunchPaymentDialog">
        <span t-esc="widget.message"/>
    </div>
</templates>
