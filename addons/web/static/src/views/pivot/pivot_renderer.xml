<?xml version="1.0" encoding="UTF-8"?>
<templates xml:space="preserve">

    <t t-name="web.PivotRenderer">
        <div>
            <t t-call="{{ this.props.buttonTemplate }}"/>
            <div t-if="this.model.hasData() and this.model.metaData.activeMeasures.length" t-att-class="this.env.isSmall ? 'table-responsive' : ''" class="o_pivot mx-3">
                <table
                    class="table-hover table table-sm table-bordered table-borderless"
                    t-att-class="{ o_enable_linking: !this.model.metaData.disableLinking }"
                    t-ref="table"
                >
                    <thead>
                        <tr t-foreach="this.table.headers" t-as="row" t-key="'header_' + this.row_index" class="border-top-0">
                            <t t-foreach="this.row" t-as="cell" t-key="'header_row_' + this.cell_index">
                                <t t-if="this.cell.measure" t-call="web.PivotMeasure"/>
                                <t t-elif="this.cell.isLeaf !== undefined">
                                    <t t-call="web.PivotHeader.title">
                                        <t t-set="isXAxis" t-value="true"/>
                                        <t t-set="isInHead" t-value="true"/>
                                    </t>
                                </t>
                                <th t-else="" t-att-colspan="cell.width" t-att-rowspan="cell.height" class="border-0 bg-100 fw-normal" t-att-class="{ 'border-0': cell_index != 0 }"/>
                            </t>
                        </tr>
                    </thead>
                    <tbody>
                        <tr t-foreach="this.table.rows" t-as="row" t-key="'row_' + this.row_index">
                            <t t-call="web.PivotHeader.title">
                                <t t-set="cell" t-value="this.row"/>
                                <t t-set="isXAxis" t-value="false"/>
                                <t t-set="isInHead" t-value="false"/>
                            </t>
                            <t t-foreach="this.row.subGroupMeasurements" t-as="cell" t-key="'row_cell_' + this.cell_index">
                                <td class="o_pivot_cell_value bg-100" t-att-class="{
                                        o_empty: cell.value === undefined,
                                        'cursor-pointer': cell.value !== undefined and !this.model.metaData.disableLinking,
                                        'fw-bold': cell.isBold,
                                    }" t-custom-click.synthetic="(ev, isMiddleClick) => this.onOpenView(cell, isMiddleClick)"
                                    t-on-mouseover="this.onMouseEnter" t-on-mouseout="this.onMouseLeave">
                                    <t t-if="this.cell.value !== undefined">
                                        <div t-if="this.model.metaData.measures[this.cell.measure].type === 'boolean'" class="o_value">
                                            <CheckBox disabled="true" value="cell.value" />
                                        </div>
                                        <div t-else="" class="o_value">
                                            <t t-set="formattedValue" t-value="this.getFormattedValue(this.cell)"/>
                                            <span t-att-data-tooltip="formattedValue.help">
                                                <t t-esc="this.formattedValue.value"/>
                                                <sup
                                                    t-if="this.formattedValue.currencies"
                                                    class="p-1 fw-bolder text-info"
                                                    t-on-mouseover.stop="(ev) => this.openMultiCurrencyPopover(ev, formattedValue.rawValue, formattedValue.currencies)"
                                                    t-on-touchstart.stop="(ev) => this.openMultiCurrencyPopover(ev, formattedValue.rawValue, formattedValue.currencies)"
                                                >?</sup>
                                            </span>
                                        </div>
                                    </t>
                                </td>
                            </t>
                        </tr>
                    </tbody>
                </table>
            </div>
            <PivotDropdown state="this.dropdown.state" manual="true">
                <t t-set-slot="content">
                    <t t-call="web.PivotHeader.menu"/>
                </t>
            </PivotDropdown>
        </div>
    </t>

    <t t-name="web.PivotHeader.menu">
        <t t-set="currentGroup" t-value="null"/>
        <t t-foreach="this.groupByItems" t-as="item" t-key="this.item.id">
            <t t-if="this.currentGroup !== null and this.currentGroup !== this.item.groupNumber">
                <div class="dropdown-divider" role="separator"/>
            </t>
            <t t-if="this.item.fieldType === 'properties'">
                <PropertiesGroupByItem item="item" onGroup.bind="this.onGroupBySelected"/>
            </t>
            <t t-elif="this.item.options">
                <Dropdown>
                    <button class="o_menu_item" t-esc="this.item.description"/>
                    <t t-set-slot="content">
                        <t t-set="subGroup" t-value="null"/>
                        <t t-foreach="this.item.options" t-as="option" t-key="this.option.id">
                            <t t-if="this.subGroup !== null and this.subGroup !== this.option.groupNumber">
                                <div class="dropdown-divider" role="separator"/>
                            </t>
                            <DropdownItem class="'o_item_option'"
                                t-esc="this.option.description"
                                onSelected="() => this.onGroupBySelected({ itemId: item.id, optionId: option.id})"
                            />
                            <t t-set="subGroup" t-value="this.option.groupNumber"/>
                        </t>
                    </t>
                </Dropdown>
            </t>
            <t t-else="">
                <DropdownItem class="'o_menu_item'"
                    t-esc="this.item.description"
                    onSelected="() => this.onGroupBySelected({ itemId: item.id })"
                />
            </t>
            <t t-set="currentGroup" t-value="this.item.groupNumber"/>
        </t>
        <t t-if="!this.hideCustomGroupBy and this.fields.length">
            <div t-if="this.groupByItems.length" role="separator" class="dropdown-divider"/>
            <CustomGroupByItem fields="this.fields" onAddCustomGroup.bind="this.onAddCustomGroupBy"/>
        </t>
    </t>

    <t t-name="web.PivotHeader.title">
        <t t-set="padding" t-value="5 + this.cell.indent * 30"/>
        <th
            class="bg-view text-nowrap cursor-pointer fw-normal user-select-none"
            t-att-colspan="isXAxis ? cell.width : undefined"
            t-att-rowspan="isXAxis ? cell.height : undefined"
            t-att-class="{
                o_pivot_header_cell_closed: cell.isLeaf,
                o_pivot_header_cell_opened: !cell.isLeaf,
                'border-top': isInHead,
            }"
            t-attf-style="{{isXAxis
                    ? undefined
                    : this.l10n.direction === 'ltr'
                        ? 'padding-left: ' + padding + 'px;'
                        : 'padding-right: ' + padding + 'px;'            }}"
            t-att-data-tooltip="cell.label"
            t-attf-data-tooltip-position="{{ this.l10n.direction === 'ltr' ? 'right' : 'left' }}"
            t-on-pointerdown.capture.stop.synthetic=""
            t-on-click.stop.synthetic="(ev) => this.onHeaderClick(ev, cell, isXAxis)"
        >
            <i t-attf-class="fa fa-{{ cell.isLeaf ? 'plus-square' : 'minus-square-o' }} me-1"/>
            <span t-esc="this.cell.title"/>
        </th>
    </t>

    <t t-name="web.PivotMeasure">
        <th class="bg-view text-muted text-center text-nowrap fw-normal o_pivot_measure_row cursor-pointer user-select-none" t-att-colspan="this.cell.width" t-att-rowspan="this.cell.height" t-att-class="{
                o_pivot_sort_order_asc: this.cell.order === 'asc',
                o_pivot_sort_order_desc: this.cell.order === 'desc',
            }" t-on-click.prevent="() => this.onMeasureClick(this.cell)" t-on-mouseover="this.onMouseEnter" t-on-mouseout="this.onMouseLeave">
            <t t-esc="this.cell.title"/>
            <i t-if="this.cell.order === 'asc' || this.cell.order ==='desc'" t-attf-class="fa fa-caret-{{ this.cell.order === 'asc' ? 'up' : 'down' }} ms-1"/>
        </th>
    </t>

</templates>
