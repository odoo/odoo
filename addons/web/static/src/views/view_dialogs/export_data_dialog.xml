<?xml version="1.0" encoding="UTF-8"?>
<templates xml:space="preserve">

    <t t-name="web.ExportDataItem" owl="1">
        <div t-att-data-field_id="props.field.id" class="o_export_tree_item o_cursor_pointer position-relative pl-3" role="treeitem" t-on-click.stop="onClick"> 
            <span t-if="props.isFieldExpandable(props.field)" t-attf-class="o_expand_parent d-inline-block position-absolute small fa {{ state.isExpanded ? 'fa-chevron-down' : 'fa-chevron-right' }}" role="img" aria-label="Show sub-fields" title="expandText" />
            <div class="o_tree_column text-wrap">
                <span t-esc="formattedName" />
                <span title="Select field" t-attf-class="fa fa-plus float-end m-1 o_add_field {{ isFieldSelected(props.field.id) ? 'o_inactive' : '' }}" t-on-click.stop="(ev) => !this.isFieldSelected(props.field.id) and this.props.onAdd(ev)" />
            </div>
            <t t-if="state.isExpanded">
                <t t-foreach="state.subFields" t-as="field" t-key="field.id">
                    <ExportDataItem
                        field="field"
                        expandedContent="props.expandedContent"
                        isFieldExpanded="props.isFieldExpanded"
                        isFieldExpandable="props.isFieldExpandable"
                        exportedFields="props.exportedFields"
                        onClick="props.onClick"
                        onAdd="props.onAdd"
                    />
                </t>
            </t>
        </div>
    </t>

    <t t-name="web.ExportDataDialog" owl="1">
        <Dialog contentClass="'o_export_data_dialog h100'" title="title" size="'lg'">
            <div class="o_left_panel col-12 col-md-6 d-flex flex-column flex-nowrap">
                <div class="o_import_compat">
                    <CheckBox className="'o_import_compat'" id="'o-update-data'" value="state.compatible" onChange.bind="onCompatibleDataChange">
                        <span>I want to update data (import-compatible export) </span>
                    </CheckBox>
                </div>
                <h4 class="mt-3">Available fields</h4>
                <input t-ref="search" type="search" class="form-control mb-3 o_export_search_input" id="o-export-search-filter" placeholder="Search" t-on-input="onSearch" />
                <div class="o_left_field_panel h-100 px-2 overflow-auto border">
                    <div class="o_field_tree_structure">
                        <t t-if="fieldsAvailable">
                            <t t-foreach="rootFields" t-as="field" t-key="field.id">
                                <ExportDataItem
                                    field="field"
                                    expandedContent.bind="expandedContent"
                                    isFieldExpanded.bind="isFieldExpanded"
                                    exportedFields="state.exportedFields"
                                    isFieldExpandable="isFieldExpandable"
                                    onClick.bind="onToggleExpandField"
                                    onAdd.bind="onAddItemExportList"
                                />
                            </t>
                        </t>
                        <h3 t-else="" class="text-center text-muted mt-5 o_no_match">No match found.</h3>
                    </div>
                </div>
            </div>
            <div class="o_right_panel col-12 col-md-6 d-flex flex-column flex-nowrap mt-3 mt-md-0">
                <div class="o_export_format">
                    <strong>Export Format:</strong>
                    <t t-foreach="availableFormats" t-as="format" t-key="format.tag">
                        <div class="radio form-check form-check-inline pl-4">
                            <input t-att-id="'o_radio' + format.tag" type="radio" t-att-checked="format.tag === availableFormats[state.selectedFormat].tag" name="o_export_format_name" t-att-value="format.tag" class="form-check-input" t-on-change="setFormat" />
                            <label class="form-check-label" t-att-for="'o_radio' + format.tag" t-esc="format.label" />
                        </div>
                    </t>
                </div>
                <div class="mt-3">
                    <h4>Fields to export</h4>
                </div>
                <div class="o_exported_lists">
                    <div class="input-group mb-3">
                        <t t-if="state.templateId === 'new_template'">
                            <label class="pt-2 mb-0 font-weight-bold">Save as: </label>
                            <input t-ref="exportList" class="form-control ml-4 o_save_list_name" t-att-placeholder="newTemplateText" />
                        </t>
                        <t t-else="">
                            <label class="pt-2 mb-0 font-weight-bold">Template: </label>
                            <select class="form-control ml-4 o_exported_lists_select" t-on-change="onChangeExportList">
                                <option />
                                <t t-foreach="templates" t-as="template" t-key="template.id">
                                    <option t-att-value="template.id" t-esc="template.name or 'undefined'" t-att-selected="state.templateId === template.id" />
                                </t>
                                <option class="font-italic" value="new_template">New template </option>
                            </select>
                        </t>
                        <t t-if="state.templateisEditing">
                            <button type="button" class="btn btn-secondary ml-1 o_save_list_btn" t-on-click.stop="onSaveExportListEdition">
                                <i class="fa fa-floppy-o" />
                            </button>
                            <button type="button" class="btn btn-secondary ml-1 o_cancel_list_btn" t-on-click.stop="onClearExportListEdition">
                                <i class="fa fa-times" />
                            </button>
                        </t>
                        <t t-else="">
                            <button t-if="state.templateId" type="button" class="btn btn-secondary ml-1 o_delete_exported_list" t-on-click.stop="onClearExportListEdition">
                                <i class="fa fa-trash" />
                            </button>
                        </t>
                    </div>
                </div>
                <div class="o_right_field_panel h-100 px-2 overflow-auto border">
                    <ul class="o_fields_list list-unstyled" t-ref="draggable">
                        <t t-foreach="exportList" t-as="field" t-key="field.id">
                            <li class="o_export_field" t-att-data-field_id="field.id">
                                <span class="fa fa-sort o_sort_field mx-1" t-attf-style="opacity:{{ exportList.length === 1 ? 0 : 1 }}" />
                                <span t-esc="field.string" />
                                <span class="fa fa-trash m-1 float-end o_remove_field o_cursor_pointer" t-att-title="removeFieldText" t-on-click.stop="onRemoveItemExportList" />
                            </li>
                        </t>
                    </ul>
                </div>
            </div>
            <t t-set-slot="footer">
                <button class="btn btn-primary o_select_button" data-hotkey="v" t-on-click.stop="onExportButtonClicked">Export</button>
                <button class="btn o_form_button_cancel" t-att-class="(props.disableMultipleSelection &amp;&amp; props.noCreate) ? 'btn-primary' : 'btn-secondary'" data-hotkey="z" t-on-click.stop="props.close">Close</button>
            </t>
        </Dialog>
    </t>

</templates>
