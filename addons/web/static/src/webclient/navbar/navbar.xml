<?xml version="1.0" encoding="UTF-8" ?>
<templates xml:space="preserve">

  <t t-name="web.NavBar">
    <header class="o_navbar" t-ref="root">
      <nav
        class="o_main_navbar d-print-none"
        data-command-category="disabled"
      >
        <!-- Apps Menu -->
        <t t-call="web.NavBar.AppsMenu">
          <t t-set="apps" t-value="this.menuService.getApps()" />
        </t>

        <!-- App Brand -->
        <DropdownItem
          t-if="!this.env.isSmall and this.currentApp"
          t-esc="this.currentApp.name"
          class="'o_menu_brand d-flex'"
          onSelected="() => this.onNavBarDropdownItemSelection(this.currentApp)"
          attrs="{ href: this.getMenuItemHref(this.currentApp), 'data-menu-xmlid': this.currentApp.xmlid, 'data-section': this.currentApp.id }"
        />

        <div class="o_navbar_breadcrumbs d-contents"/>

        <t t-if="!this.env.isSmall">
          <!-- Current App Sections -->
          <t t-if="this.currentAppSections.length" t-call="web.NavBar.SectionsMenu">
            <t t-set="sections" t-value="this.currentAppSections" />
          </t>
        </t>

        <!-- Systray -->
        <div class="o_menu_systray d-flex flex-shrink-0 ms-auto bg-inherit" role="menu">
          <t t-foreach="this.systrayItems" t-as="item" t-key="this.item.key">
            <!-- This ensures the correct order of the systray items -->
            <div t-att-data-index="item.index"/>
            <ErrorHandler onError="error => this.handleItemError(error, item)">
                <t t-component="this.item.Component" t-props="this.item.props"/>
            </ErrorHandler>
          </t>
        </div>
      </nav>
    </header>
  </t>

  <t t-name="web.SectionMenu">
    <li class="px-3" t-if="this.section.childrenTree.length">
        <div class="bg-transparent"
            t-att-class="{
                'fw-bolder text-900 pt-3 pb-2': !isNested,
                'border-top': !isNested &amp;&amp; this.subMenu_index != 0,
                'py-2': isNested,
            }"
            t-att-data-menu-xmlid="section.xmlid" t-esc="this.section.name"/>
        <ul class="list-unstyled ps-0">
            <t t-foreach="this.section.childrenTree" t-as="subSection" t-key="this.subSection_index">
                <t t-call="web.SectionMenu">
                    <t t-set="section" t-value="this.subSection"/>
                    <t t-set="isNested" t-value="true"/>
                </t>
            </t>
        </ul>
    </li>
    <li t-else="" t-on-click="() => this._onMenuClicked(section)"  t-att-data-menu-xmlid="section.xmlid"
        t-att-class="{
            'fw-bold text-900 py-3': !isNested,
            'border-top': !isNested &amp;&amp; this.subMenu_index != 0,
            'py-2': isNested,
        }">
        <t t-esc="this.section.name"/>
    </li>
  </t>

  <t t-name="web.NavBar.AppsMenu">
    <t t-if="this.env.isSmall">
      <a href="/odoo" class="o_menu_toggle border-0" t-att-class="{'hasImage': this.currentApp?.webIconData}" accesskey="h" t-ref="menuApps" t-on-click.prevent="this._openAppMenuSidebar">
        <t t-call="web.NavBar.AppsMenu.Sidebar"/>
      </a>
    </t>
    <t t-else="">
      <div t-if="!this.isScopedApp" class="o_navbar_apps_menu">
        <Dropdown>
          <button data-hotkey="h" title="Home Menu" data-available-offline="">
            <i class="oi oi-apps" />
          </button>
          <t t-set-slot="content">
            <DropdownItem
              t-foreach="this.apps"
              t-as="app"
              t-key="this.app.id"
              class="{ 'o_app': true, focus: this.menuService.getCurrentApp() === app, 'o_disabled_offline': !this._isAvailable(app) }"
              onSelected="() => this.onNavBarDropdownItemSelection(app)"
              t-esc="this.app.name"
              attrs="{ href: this.getMenuItemHref(app), 'data-menu-xmlid': app.xmlid, 'data-section': app.id }"
            />
          </t>
        </Dropdown>
      </div>
      <div t-else="" class="mx-2"/>
    </t>
  </t>

  <t t-name="web.NavBar.AppsMenu.Sidebar">
    <i class="fa fa-bars" aria-hidden="true"/>
    <t t-portal="'body'">
      <Transition name="'o-app-menu-sidebar'" visible="this.state.isAppMenuSidebarOpened" leaveDuration="200" t-slot-scope="transition">
        <div class="o_app_menu_sidebar position-fixed top-0 bottom-0 end-100 d-flex flex-column flex-nowrap" t-att-class="transition.className" t-on-touchstart.stop="this._onSwipeStart" t-on-touchend.stop="this._onSwipeEnd">
          <div class="o_sidebar_topbar d-flex align-items-center justify-content-between flex-shrink-0 py-0 fs-4">
              <small class="d-flex align-items-center justify-content-between ms-2">
                  <a href="/odoo" class="btn btn-primary" t-on-click.prevent="this.onAllAppsBtnClick"><i class="oi oi-apps"></i><span class="px-2">All Apps</span></a>
              </small>
              <button class="o_sidebar_close oi oi-close btn d-flex align-items-center h-100 bg-transparent border-0 fs-2 text-reset" aria-label="Close menu" title="Close menu" t-on-click.stop="this._closeAppMenuSidebar" data-available-offline=""/>
          </div>
          <nav class="o_burger_menu_content flex-grow-1 flex-shrink-1 overflow-auto o_burger_menu_app">
                <div t-if="!this.state.isAllAppsMenuOpened and this.currentApp" class="d-flex align-items-center m-3 mb-0">
                  <img style="height: 2em;" t-if="this.currentApp.webIconData" class="o_app_icon me-2" t-attf-src="{{this.currentApp.webIconData}}"/>
                  <i t-elif="this.currentApp.webIcon" t-att-class="`${currentApp.webIconClass} fa-2x me-2`" t-att-style="'color:' + this.currentApp.webIconColor"></i>
                  <span class="fs-4 fw-bolder"><t t-esc="this.currentApp.name"/></span>
                </div>
                <ul class="list-unstyled py-2 ps-0 mb-0">
                    <t t-if="!this.state.isAllAppsMenuOpened">
                      <t t-foreach="this.currentAppSections" t-as="subMenu" t-key="this.subMenu_index">
                        <t t-call="web.SectionMenu">
                            <t t-set="section" t-value="this.subMenu" />
                        </t>
                      </t>
                    </t>

                    <t t-else="">
                      <t t-foreach="this.apps" t-as="app" t-key="this.app_index">
                        <li t-att-data-menu-xmlid="app.xmlid" class="o_app fw-bolder py-2" t-att-class="{'bg-primary-subtle': this.menuService.getCurrentApp() === app, 'o_disabled_offline': !this._isAvailable(app)}" t-on-click="() => {this.onNavBarDropdownItemSelection(app); this._closeAppMenuSidebar();}">
                          <div class="d-flex align-items-center">
                            <img style="height: 3em;" t-if="this.app.webIconData" class="o_app_icon me-2" t-attf-src="{{app.webIconData}}"/>
                            <i t-elif="this.app.webIcon" t-att-class="app.webIcon.split(',')[0] + ' fa-3x me-2'" t-att-style="'color:' + app.webIcon.split(',')[1]"></i>
                            <t t-esc="this.app.name"/>
                          </div>
                        </li>
                      </t>
                    </t>
                </ul>
          </nav>
        </div>
      </Transition>
      <div t-if="this.state.isAppMenuSidebarOpened" class="modal-backdrop show d-block d-md-none" t-on-click.stop="this._closeAppMenuSidebar" t-on-touchstart.stop="this._onSwipeStart" t-on-touchend.stop="this._onSwipeEnd" />
    </t>
  </t>

  <t t-name="web.NavBar.SectionsMenu">
    <div class="o_menu_sections d-flex flex-grow-1 flex-shrink-1 w-0" t-ref="appSubMenus" role="menu">
        <t t-if="!this.env.isSmall">
            <DropdownGroup>
                <t t-foreach="this.sections" t-as="section" t-key="this.section.id">
                    <t
                        t-set="sectionsVisibleCount"
                        t-value="(this.sections.length - this.currentAppSectionsExtra.length)"
                    />

                    <t t-if="this.section_index lt Math.min(10, this.sectionsVisibleCount)">
                        <t t-set="hotkey" t-value="((this.section_index + 1) % 10).toString()" />
                    </t>
                    <t t-else="">
                        <t t-set="hotkey" t-value="undefined" />
                    </t>

                    <t t-if="!this.section.childrenTree.length">
                        <DropdownItem
                            class="{
                                o_nav_entry: true,
                                o_disabled_offline: !this._isAvailable(section)
                            }"
                            onSelected="() => this.onNavBarDropdownItemSelection(section)"
                            t-esc="this.section.name"
                            attrs="{
                                href: this.getMenuItemHref(section),
                                'data-hotkey': hotkey,
                                'data-menu-xmlid': section.xmlid,
                                'data-section': section.id,
                            }"
                        />
                    </t>
                    <t t-else="">
                        <Dropdown>
                            <button t-att-data-hotkey="hotkey" t-att-data-menu-xmlid="section.xmlid" data-available-offline="">
                                <span t-esc="this.section.name" t-att-data-section="section.id" />
                            </button>
                            <t t-set-slot="content">
                                <t t-call="web.NavBar.SectionsMenu.Dropdown.MenuSlot">
                                <t t-set="items" t-value="this.section.childrenTree" />
                                <t t-set="decalage" t-value="20" />
                                </t>
                            </t>
                        </Dropdown>
                    </t>
                </t>

                <t t-if="this.currentAppSectionsExtra.length" t-call="web.NavBar.SectionsMenu.MoreDropdown">
                    <t t-set="sections" t-value="this.currentAppSectionsExtra" />
                    <t t-if="this.sectionsVisibleCount lt 10">
                        <t t-set="hotkey" t-value="(this.sectionsVisibleCount + 1 % 10).toString()" />
                    </t>
                </t>
            </DropdownGroup>
        </t>
    </div>
  </t>

  <t t-name="web.NavBar.DropdownItem" t-inherit="web.DropdownItem" t-inherit-mode="primary">
    <xpath expr="//t[@t-tag]" position="attributes">
      <attribute name="t-att-style">this.props.style</attribute>
    </xpath>
  </t>

  <t t-name="web.NavBar.SectionsMenu.Dropdown.MenuSlot">
    <t t-set="style" t-value="`padding-left: ${decalage}px;`" />
    <t t-foreach="this.items" t-as="item" t-key="this.item.id">
      <DropdownItem
        t-if="!this.item.childrenTree.length"
        class="{
          'dropdown-item': true,
          o_disabled_offline: !this._isAvailable(item),
          o_dropdown_menu_group_entry: decalage gt 20
        }"
        t-esc="this.item.name"
        onSelected="() => this.onNavBarDropdownItemSelection(item)"
        attrs="{ style: style, href: this.getMenuItemHref(item), 'data-menu-xmlid': item.xmlid, 'data-section': item.id }"
      />

      <t t-else="">
        <div class="dropdown-menu_group dropdown-header" t-att-style="style" t-esc="this.item.name" />
        <t t-call="web.NavBar.SectionsMenu.Dropdown.MenuSlot">
          <t t-set="items" t-value="this.item.childrenTree" />
          <t t-set="decalage" t-value="this.decalage + 12" />
        </t>
      </t>
    </t>
  </t>

  <t t-name="web.NavBar.SectionsMenu.MoreDropdown">
    <div class="o_menu_sections_more">
      <Dropdown>
        <button title="More Menu" t-att-data-hotkey="hotkey">
          <i class="fa fa-plus"/>
        </button>

        <t t-set-slot="content">
          <t t-foreach="this.sections" t-as="section" t-key="this.section.id">
            <t t-if="!this.section.childrenTree.length">
              <DropdownItem
                class="{
                  'o_more_dropdown_section': true,
                  o_disabled_offline: !this._isAvailable(this.item)
                }"
                onSelected="() => this.onNavBarDropdownItemSelection(section)"
                t-esc="this.section.name"
                attrs="{ href: this.getMenuItemHref(section), 'data-menu-xmlid': section.xmlid, 'data-section': section.id }"
              />
            </t>
            <t t-else="">
              <div
                class="o_more_dropdown_section o_more_dropdown_section_group dropdown-header bg-100"
                t-esc="this.section.name"
              />
              <t t-call="web.NavBar.SectionsMenu.Dropdown.MenuSlot">
                <t t-set="items" t-value="this.section.childrenTree" />
                <t t-set="decalage" t-value="20" />
              </t>
            </t>
          </t>
        </t>
      </Dropdown>
    </div>
  </t>

</templates>
