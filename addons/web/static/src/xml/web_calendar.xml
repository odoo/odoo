<template>
    <div t-name="web.OwlCalendarView" class="o_calendar_container" owl="1">
        <div class="o_calendar_view" t-on-edit-event="_onEditEvent" t-on-delete-event="_onDeleteEvent">
            <div class="o_calendar_buttons" role="toolbar" aria-label="Calendar toolbar"/>
            <div class="o_calendar_widget" />
        </div>
        <div class="o_calendar_sidebar_container d-none d-md-block">
            <t t-call="Calendar.sidebar"/>
        </div>
    </div>

    <t t-name="Calendar.sidebar" owl="1">
        <div class="o_calendar_sidebar">
            <CalendarMini fc_options="props.fc_options"/>
            <t t-set="filters" t-value="Object.values(props.filters)"/>
            <SidebarFilters
                filters="filters"
                fields="props.fields"
                getColor="getColorBound"
                t-if="!props.fullWidth"
                />
        </div>
    </t>

    <t t-name="Calendar.sidebar.calendarMini" owl="1">
        <div class="o_calendar_mini"/>
    </t>

    <t t-name="Calendar.sidebar.filters" owl="1">
        <div class="o_calendar_sidebar_filters">
            <t t-foreach="props.filters" t-as="filter" t-key="filter.fieldName">
                <SidebarFilter
                    filters="filter.filters"
                    write_field="filter.write_field"
                    write_model="filter.write_model"
                    title="filter.title"
                    fields="props.fields"
                    fieldName="filter.fieldName"
                    avatar_field="filter.avatar_field"
                    avatar_model="filter.avatar_model"
                    label="filter.label"
                    getColor="props.getColor"
                    t-ref="filter_{{filter.fieldName}}"
                    t-if="hasDisplay(filter)"/>
            </t>
        </div>
    </t>

    <t t-name="Calendar.sidebar.filter" owl="1">
        <t t-set="needCollapse" t-value="props.filters.length > 2 and props.title"></t>
        <div class="o_calendar_filter" t-on-field-changed="_onFieldChanged">
            <h5 t-if="needCollapse" type="button" data-toggle="collapse" t-attf-data-target="#o_cw_filter_collapse_{{title}}" class="d-flex justify-content-between align-items-center">
                <t t-esc="props.title"/><i class="o_cw_filter_collapse_icon fa fa-chevron-down"/>
            </h5>

            <h5 t-elif="props.title" t-esc="props.title"/>

            <div t-attf-class="o_calendar_filter_items {{needCollapse ? 'collapse show' : 0}}" aria-expanded="true" t-attf-id="o_cw_filter_collapse_{{title}}">
                <t t-foreach="props.filters" t-as="filter" t-if="filter.display == null || filter.display">
                    <t t-set="idForLabel" t-value="uniqueId('o_calendar_filter_item_')"/>
                    <t t-set="color" t-value="props.getColor(filter.color_index)"/>
                    <t t-set="isColorNumber" t-value="typeof color === 'number'"/>

                    <div t-attf-class="o_calendar_filter_item w-100 position-relative mb-2 {{isColorNumber ? 'o_cw_filter_color_' + color : ''}}"
                         t-att-data-value="filter.value" t-att-data-id="filter.id">

                        <input type="checkbox" t-att-id="idForLabel" name="selection" class="position-absolute" t-att-checked="filter.active ? true : undefined" t-on-click="_onFilterActive"/>

                        <label t-att-for="idForLabel" class="d-flex align-items-center m-0">
                            <span t-attf-class="o_cw_filter_input_bg align-items-center d-flex flex-shrink-0 justify-content-center position-relative mr-1 {{avatar_field ? 'o_beside_avatar' : ''}}"
                                t-att-style="color and !isColorNumber ? 'border-color:'+ color +';background-color:' + color : ''">
                                <i class="fa fa-check position-relative"/>
                            </span>
                            <i t-if="filter.value == 'all'" class="o_cw_filter_avatar fa fa-users fa-fw  flex-shrink-0 mr-1" role="img" aria-label="Avatar" title="Avatar"/>
                            <img t-elif="props.avatar_field and filter.value" t-attf-src="/web/image/{{props.avatar_model}}/{{filter.value}}/{{props.avatar_field}}" class="o_cw_filter_avatar flex-shrink-0 mr-1" alt="Avatar"/>
                            <span class="o_cw_filter_title text-truncate flex-grow" t-esc="filter.label" t-att-title="filter.label"/>
                        </label>

                        <button t-if="filter.id" class="o_remove btn bg-white text-700 py-0 px-2" title="Remove this favorite from the list" role="img" aria-label="Remove this favorite from the list" t-on-click="_onFilterRemove">
                            <i class="fa fa-times"/>
                        </button>
                    </div>
                </t>
            </div>
            <SidebarFilterM2OAdapter Component="SidebarFilterM2O"
                widgetArgs="[props.write_field, m2oRecord, getSidebarM2OOptions()]"
                t-if="props.write_model || props.write_field"
                t-ref="SidebarM2O_{{props.fieldName}}"/>
        </div>
    </t>


    <t t-name="calendar-box" owl="1">
        <div t-att-style="typeof color === 'string' ? ('background-color:' + color) + ';' : ''" t-attf-class="{{record.is_highlighted ? 'o_event_hightlight ' : '' + typeof color === 'number' ? 'o_calendar_color_' + color  : 'o_calendar_color_1'}}">
            <span class="fc-time"/>
            <div class="o_event_title" t-esc="record.display_name"/>
        </div>
    </t>

    <t t-name="CalendarView.event.popover.placeholder" owl="1">
        <div t-attf-class="o_cw_popover popover card shadow {{typeof color === 'number' ? 'o_calendar_color_' + color : ''}}" role="tooltip">
            <div class="arrow"/>
            <div class="card-header d-flex justify-content-between py-2 pr-2">
                <h4 class="popover-header border-0 p-0 pt-1"/>
                <span class="o_cw_popover_close ml-4"><i class="fa fa-close small"/></span>
            </div>
            <div class="o_cw_body">
            </div>
        </div>
    </t>

    <t t-name="CalendarView.event.popover" owl="1">
        <div class="o_cw_body">
            <ul class="list-group list-group-flush">
                <li t-if="!hideDate and eventDate.date" class="list-group-item">
                    <i class="fa fa-fw fa-calendar-o"/>
                    <b class="text-capitalize" t-esc="eventDate.date"/> <small t-if="eventDate.duration"><b>(<t t-esc="eventDate.duration"/>)</b></small>
                </li>
                <li t-if="!hideTime and eventTime.time" class="list-group-item">
                    <i class="fa fa-fw fa-clock-o"/>
                    <b t-esc="eventTime.time"/> <small t-if="eventTime.duration"><b>(<t t-esc="eventTime.duration"/>)</b></small>
                </li>
            </ul>
            <ul class="list-group list-group-flush o_cw_popover_fields_secondary"/>
            <div class="card-footer border-top">
                <a href="#" class="btn btn-primary o_cw_popover_edit" t-on-click.prevent="_onClickPopoverEdit">Edit</a>
                <a t-if="canDelete" href="#" class="btn btn-secondary o_cw_popover_delete ml-2" t-on-click.prevent="_onClickPopoverDelete">Delete</a>
            </div>
        </div>
    </t>

    <t t-name="CalendarView.buttons">
        <div class="o_calendar_buttons">
            <t t-if="!isMobile">
                <button class="o_calendar_button_prev btn btn-primary" aria-label="Previous" title="Previous"><span class="fa fa-arrow-left"/></button>
                <button class="o_calendar_button_today btn btn-primary">Today</button>
                <button class="o_calendar_button_next btn btn-primary" aria-label="Next" title="Next"><span class="fa fa-arrow-right"/></button>
            </t>
            <div class="btn-group">
                <button type="button" class="o_calendar_button_day btn btn-secondary">Day</button>
                <button type="button" class="o_calendar_button_week btn btn-secondary">Week</button>
                <button type="button" class="o_calendar_button_month btn btn-secondary">Month</button>
            </div>
        </div>
    </t>

    <t t-name="CalendarView.TodayButtonMobile">
        <button class="btn btn-sm btn-link">
            <span class="fa-stack o_calendar_button_today">
                <i class="fa fa-calendar-o fa-stack-2x" role="img" aria-label="Today" title="Today"/>
                <strong class="o_calendar_text fa-stack-1x"><t t-esc="moment().date()"/></strong>
            </span>
        </button>
    </t>

    <main t-name="CalendarView.quick_create" class="o_calendar_quick_create">
        <div class="form-group">
            <label for='name' class='col-form-label o_form_label'>Summary:</label>
            <input type='text' name='name' class="o_input o_required_modifier" t-att-value="widget.dataTemplate.name or None"/>
        </div>
    </main>
</template>
