<?xml version="1.0" encoding="UTF-8" ?>
<templates xml:space="preserve">

<t t-name="web.EmojiPicker">
    <div class="o-EmojiPicker bg-100 d-flex flex-column justify-content-center rounded-3" t-att-class="{ 'align-items-center': this.emojis.length === 0, 'h-100': this.props.mobile }" t-attf-class="{{this.props.class}}" t-on-click="this.onClick" t-on-keydown="this.onKeydown">
        <t t-if="this.emojis.length === 0">
            <span class="o-EmojiPicker-empty">üòµ‚Äçüí´</span>
            <span class="fs-5 text-muted">Failed to load emojis...</span>
        </t>
        <t t-else="">
            <div class="o-EmojiPicker-search d-flex align-items-center mx-2 mt-2 rounded">
                <span class="o-EmojiPicker-searchContour d-flex mx-1 w-100 rounded o-active align-items-center justify-content-center border border-secondary bg-view">
                    <t t-call="web.EmojiPicker.searchInput">
                        <t t-if="this.props.state" t-set="localState" t-value="this.props.state"/>
                        <t t-else="" t-set="localState" t-value="this.state"/>
                    </t>
                    <i class="oi oi-search px-2 py-1 fs-7 rounded-start-0 rounded-3 o-active opacity-50" title="Search..." role="img" aria-label="Search..."/>
                </span>
            </div>
            <t t-set="itemIndex" t-value="0"/>
            <t t-set="emojisFromSearch" t-value="this.getEmojisFromSearch()"/>
            <div class="o-EmojiPicker-content overflow-auto d-flex flex-grow-1 w-100 flex-wrap align-items-center user-select-none mt-1" t-att-class="emojisFromSearch.length === 0 ? 'flex-column justify-content-center' : 'align-content-start'" t-ref="emoji-grid" t-on-scroll="this.highlightActiveCategory">
                <t t-if="this.searchTerm and this.emojisFromSearch.length === 0" class="d-flex flex-column">
                    <span class="o-EmojiPicker-empty">üò¢</span>
                    <span class="fs-5 text-muted">No emoji matches your search</span>
                </t>
                <t t-if="this.recentEmojis.length > 0">
                    <t t-if="!this.searchTerm" t-call="web.EmojiPicker.section">
                        <t t-set="category" t-value="this.recentCategory"/>
                    </t>
                    <t t-foreach="this.recentEmojis" t-as="emoji" t-key="'recent_' + this.emoji_index">
                        <t t-call="web.EmojiPicker.emoji">
                            <t t-set="inRecent" t-value="true"/>
                            <t t-set="emoji" t-value="this.emoji"/>
                        </t>
                        <t t-set="itemIndex" t-value="this.itemIndex + 1"/>
                    </t>
                </t>
                <t t-set="current" t-value=""/>
                <t t-foreach="this.getEmojis()" t-as="emoji" t-key="this.emoji_index">
                    <t t-if="!this.searchTerm and this.current !== this.emoji.category">
                        <t t-set="current" t-value="this.emoji.category"/>
                        <t t-set="category" t-value="this.categories.find(c => c.name === this.current)"/>
                        <t t-call="web.EmojiPicker.section">
                            <t t-set="category" t-value="this.category"/>
                        </t>
                    </t>
                    <t t-elif="this.searchTerm" t-set="categorySortId" t-value="null"/>
                    <t t-call="web.EmojiPicker.emoji">
                        <t t-set="emoji" t-value="this.emoji"/>
                    </t>
                    <t t-set="itemIndex" t-value="this.itemIndex + 1"/>
                </t>
            </div>
            <div class="o-EmojiPicker-navbar d-flex flex-shrink-0 w-100 align-items-center justify-content-center overflow-auto px-1 gap-1 border-top border-secondary" t-att-class="{ 'opacity-0': !this.state.emojiNavbarRepr }" t-ref="navbar">
                <t t-if="this.currentNavbarPanel">
                    <t t-set="allCategories" t-value="this.getAllCategories()"/>
                    <t t-foreach="this.currentNavbarPanel" t-as="navbarItemId" t-key="this.navbarItemId">
                        <t t-if="this.navbarItemId === 'next'" t-call="web.EmojiPicker.tabNext"/>
                        <t t-elif="this.navbarItemId === 'previous'" t-call="web.EmojiPicker.tabPrev"/>
                        <t t-elif="typeof this.navbarItemId === 'string' and this.navbarItemId.startsWith('empty')" t-call="web.EmojiPicker.tabEmpty"/>
                        <t t-else="">
                            <t t-set="category" t-value="this.allCategories.find(cat => cat.sortId === this.navbarItemId)"/>
                            <t t-if="this.category" t-call="web.EmojiPicker.tab">
                                <t t-set="category" t-value="this.category"/>
                            </t>
                        </t>
                    </t>
                </t>
            </div>
        </t>
    </div>
</t>

<t t-name="web.EmojiPicker.tab">
    <span class="o-Emoji text-center fs-5 rounded-3 cursor-pointer d-flex align-items-center align-self-stretch" t-att-class="{'o-active': category.sortId === this.state.categoryId}" t-att-title="category.name" t-att-data-id="category.sortId" t-on-click="() => this.selectCategory(category.sortId)">
        <span t-esc="this.category.title"/>
    </span>
</t>

<t t-name="web.EmojiPicker.tabNext">
    <span class="o-Emoji text-center fs-5 rounded-3 cursor-pointer d-flex align-items-center align-self-stretch" title="To previous categories" t-on-click="this.onClickToNextCategories">
        <span class="position-relative">
            <i class="oi oi-chevron-right fa-fw smaller opacity-0"/>
            <i class="oi oi-chevron-right fa-fw smaller position-absolute opacity-75" style="left: 3px; transform: translateY(75%);"/>
            <i class="oi oi-chevron-right fa-fw smaller position-absolute opacity-75" style="left: -3px; transform: translateY(75%);"/>
        </span>
    </span>
</t>

<t t-name="web.EmojiPicker.tabPrev">
    <span class="o-Emoji text-center fs-5 rounded-3 cursor-pointer d-flex align-items-center align-self-stretch" title="To next categories" t-on-click="this.onClickToPreviousCategories">
        <span class="position-relative">
            <i class="oi oi-chevron-left fa-fw smaller opacity-0"/>
            <i class="oi oi-chevron-left fa-fw smaller position-absolute opacity-75" style="left: 3px; transform: translateY(75%);"/>
            <i class="oi oi-chevron-left fa-fw smaller position-absolute opacity-75" style="left: -3px; transform: translateY(75%);"/>
        </span>
    </span>
</t>

<t t-name="web.EmojiPicker.tabEmpty">
    <span class="o-Emoji text-center fs-5 rounded-3 cursor-pointer d-flex align-items-center align-self-stretch opacity-0">
        <span>ü´•</span>
    </span>
</t>

<t t-name="web.EmojiPicker.section">
    <span class="w-100 fs-7 px-2 py-1 position-sticky top-0 bg-100 align-self-stretch" t-att-data-category="category.sortId"><span class="o-EmojiPicker-sectionIcon fs-5 opacity-50" t-esc="this.category.title"/><span class="ms-2 text-muted text-uppercase fs-7 opacity-50" t-esc="this.category.displayName"/></span>
    <span class="o-EmojiPicker-category opacity-100 fs-7 py-2" t-att-data-category="category.sortId"/>
</t>

<t t-name="web.EmojiPicker.emoji">
    <span class="o-Emoji cursor-pointer d-flex justify-content-center rounded-3 align-items-center align-self-stretch" t-att-class="{ 'o-active': this.state.activeEmojiIndex === this.itemIndex, 'fs-2': !this.ui.isSmall, 'fs-1': this.ui.isSmall }" t-att-title="emoji.name" t-att-data-codepoints="emoji.codepoints" t-att-data-index="this.itemIndex" t-att-data-category="inRecent ? this.recentCategory.sortId : this.categories.find(c => c.name === emoji.category).sortId" t-on-click="this.selectEmoji" t-on-mouseenter="(ev) => this.onMouseenterEmoji(ev, emoji)" t-on-mouseleave="(ev) => this.onMouseleaveEmoji(ev, emoji)">
        <span t-esc="this.emoji.codepoints"/>
    </span>
</t>

<t t-name="web.EmojiPicker.searchInput">
    <input class="form-control border-0 flex-grow-1 rounded-3 rounded-end-0 o-active lh-1" t-att-placeholder="this.placeholder" t-model="this.localState.searchTerm" t-ref="autofocus" t-att-model="localState.searchTerm" t-on-input="() => this.state.activeEmojiIndex = 0" t-att-tabindex="this.isMobileOS ? -1 : 0"/>
</t>

</templates>
