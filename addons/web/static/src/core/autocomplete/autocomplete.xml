<?xml version="1.0" encoding="UTF-8"?>
<templates xml:space="preserve">

    <t t-name="web.AutoComplete">
        <div class="o-autocomplete" t-ref="root" t-att-class="props.class">
            <Dropdown
                menuClass="dropdownClass"
                menuRef="menuRef"
                state="dropdown"
                manual="true"
                onOpened.bind="onOpened"
                navigationOptions="navigationOptions"
            >
                <input
                    type="text"
                    t-att-id="props.id"
                    class="o-autocomplete--input o_input pe-3"
                    t-att-autocomplete="props.autocomplete"
                    t-att-placeholder="props.placeholder"
                    role="combobox"
                    t-att-aria-activedescendant="state.activeElId"
                    t-att-aria-expanded="dropdown.isOpen ? 'true' : 'false'"
                    aria-autocomplete="list"
                    aria-haspopup="listbox"
                    t-model="state.value"
                    t-on-blur="onInputBlur"
                    t-on-click="onInputClick"
                    t-on-change="onInputChange"
                    t-on-input="onInput"
                    t-on-keydown="onKeydown"
                    t-on-focus="onInputFocus"
                    t-ref="input"
                />

                <t t-set-slot="content">
                    <t t-foreach="sources" t-as="source" t-key="source.id">
                        <t t-if="source.isLoading">
                            <div
                                class="o_loading o-dropdown-item dropdown-item text-muted"
                                t-att-class="{ 'o-autocomplete--dropdown-item': props.dropdown }"
                                t-att-id="`${this.props.id || 'autocomplete'}_${source_index}_loading`"
                            >
                                <i class="fa fa-spin fa-circle-o-notch me-2"/><t t-esc="source.placeholder"/>
                            </div>
                        </t>
                        <t t-else="">
                            <t t-foreach="source.options" t-as="option" t-key="option.id">
                                <AutoCompleteItem
                                    id="getOptionId(source_index, option_index)"
                                    class="option.cssClass"
                                    unselectable="option.unselectable"
                                    attrs="{
                                        'data-source': source_index,
                                        'data-option': option_index,
                                    }"
                                    onSelected="() => this.onOptionClick(option)"
                                    t-on-pointerdown="() => this.ignoreBlur = true"
                                >
                                    <t t-slot="{{ source.optionSlot }}" label="option.label" data="option.data">
                                        <t t-out="option.label"/>
                                    </t>
                                </AutoCompleteItem>
                            </t>
                        </t>
                    </t>
                </t>
            </Dropdown>
        </div>
    </t>

</templates>