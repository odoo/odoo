<?xml version="1.0" encoding="utf-8"?>
<!-- vim:fdn=3:
-->
<openerp>
    <data>
        <template id="assets_backend" name="im_screenshare assets" inherit_id="web.assets_backend">
            <xpath expr="." position="inside">
                <script type="text/javascript" src="/im_screenshare/static/lib/mutation-summary/mutation-summary.js"></script>
                <script type="text/javascript" src="/im_screenshare/static/lib/mutation-summary/tree-mirror.js"></script>

                <script type="text/javascript" src="/im_screenshare/static/lib/smt2/smt-aux.js"></script>
                <script type="text/javascript" src="/im_screenshare/static/lib/smt2/wz_jsgraphics.js"></script>
                <script type="text/javascript" src="/im_screenshare/static/lib/mouse_track.js"></script>

                <script type="text/javascript" src="/im_screenshare/static/src/js/im_screenshare.js"></script>
            </xpath>
        </template>


        <!-- Template for the external player page -->
        <template id="player_page" name="IM Screensharing Player Page">
            &lt;!DOCTYPE html&gt;
            <html>
                <head>
                    <title>Odoo Screenshare Player</title>
                    <meta content="text/html; charset=utf-8" http-equiv="content-type"/>

                    <link href="/web/css/web.assets_common" rel="stylesheet"/>
                    <script type="text/javascript" src="/web/js/web.assets_common"></script>

                    <link href="/web/css/web.assets_backend" rel="stylesheet"/>
                    <script type="text/javascript" src="/web/js/web.assets_backend"></script>
                    <!--
                    <link rel="stylesheet" href="/web/webclient/css">
                    <link href="/web/static/lib/bootstrap/css/bootstrap.css" rel="stylesheet"/>
                    <script src="/web/webclient/js"></script>
                    <script src="/im_screenshare/static/lib/mutation-summary/tree-mirror.js"></script>
                -->
                    <script src="/im_screenshare/static/lib/smt2/smt-aux.js"></script>
                    <script src="/im_screenshare/static/lib/smt2/wz_jsgraphics.js"></script>
                    <script src="/im_screenshare/static/lib/mouse_track.js"></script>

                    <script>
                        window.addEventListener('DOMContentLoaded', function() {

                            var instance = openerp.init(["web"]);

                            // business : initialize the TreeMirroir, the Player and the Receiver (according the parameters recieved, screen_record replaying will get record_id and db name, im_screensharing will get the uuid of the session).
                            var base;
                            var treeMirror = new TreeMirror(document.body, {
                                createElement: function(tagName) {
                                    if (tagName == 'SCRIPT') {
                                        var node = document.createElement('NO-SCRIPT');
                                        node.style.display = 'none';
                                        return node;
                                    }
                                    if (tagName == 'HEAD') {
                                        var node = document.createElement('HEAD');
                                        node.appendChild(document.createElement('BASE'));
                                        node.firstChild.href = base;
                                        return node;
                                    }
                                }
                            });

                            var cursorMirror = new CursorMirror();

                            var player = new instance.im_screenshare.Player(treeMirror, cursorMirror);

                            var params = <t t-raw="params" />
                            console.log(params);
                            if(params.id &amp;&amp; params.db){
                                console.log("DB reciever");
                                window.receiver = new instance.im_screenshare.DbReceiver(params.id, params.db, player);
                            }else{
                                console.log("screenshare reciever");
                                window.receiver = new instance.im_screenshare.BusListener(params.uuid, player);
                            }
                        });
                    </script>
                </head>
                <body style="height: 100%; margin: 0;">
                </body>
            </html>
        </template>
    </data>
</openerp>