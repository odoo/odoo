<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <record id="view_account_invoice_form_inherit" model="ir.ui.view">
        <field name="name">account.tax.form.inherit</field>
        <field name="model">account.tax</field>
        <field name="inherit_id" ref="account_edi_ubl_cii_tax_extension.view_account_invoice_form_inherit"/>
        <field name="arch" type="xml">
            <!-- Hide tax category fields in existing view. They will be relocated to Electronic Invoicing. -->
            <xpath expr="//field[@name='ubl_cii_tax_category_code']" position="attributes">
                <attribute name="invisible">1</attribute>
            </xpath>
            <xpath expr="//field[@name='ubl_cii_tax_exemption_reason_code']" position="attributes">
                <attribute name="invisible">1</attribute>
            </xpath>
            <xpath expr="//page[@name='advanced_options']" position="after">
                <page string="Electronic Invoicing" name="electronic_invoicing">
                    <group>
                        <field name="ubl_cii_type" widget="radio" string="Type" options="{'horizontal': True}"/>
                        <field name="ubl_cii_tax_category_code" invisible="ubl_cii_type == 'allowance_charge'"/>
                        <field name="ubl_cii_tax_exemption_reason_code"
                               invisible="ubl_cii_type == 'allowance_charge'
                                          or ubl_cii_tax_category_code not in ('AE', 'E', 'G', 'O', 'K')"/>
                        <field name="ubl_cii_allowance_reason_code" invisible="ubl_cii_type == 'tax' or amount >= 0"
                               required="ubl_cii_type == 'allowance_charge' and not amount >= 0"/>
                        <field name="ubl_cii_charge_reason_code" invisible="ubl_cii_type == 'tax' or not amount >= 0"
                               required="ubl_cii_type == 'allowance_charge' and amount >= 0"/>
                        <label for="ubl_cii_allowance_charge_reason" string="Allowance Reason"
                               invisible="ubl_cii_type == 'tax' or amount >= 0"/>
                        <label for="ubl_cii_allowance_charge_reason" string="Charge Reason"
                               invisible="ubl_cii_type == 'tax' or not amount >= 0"/>
                        <field name="ubl_cii_allowance_charge_reason" nolabel="1" invisible="ubl_cii_type == 'tax'"/>
                    </group>
                </page>
            </xpath>
        </field>
    </record>
</odoo>
