<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <template id="ubl_tr_LineDelivery">
        <t xmlns:cac="urn:oasis:names:specification:ubl:schema:xsd:CommonAggregateComponents-2"
            xmlns:cbc="urn:oasis:names:specification:ubl:schema:xsd:CommonBasicComponents-2">
            <cac:Delivery>
                <cac:DeliveryAddress>
                    <t t-set="delivery_address_vals" t-value="vals.get('delivery_address_vals', {})"/>
                    <cbc:StreetName t-out="delivery_address_vals.get('street')"/>
                    <cbc:CitySubdivisionName t-out="delivery_address_vals.get('city')"/>
                    <cbc:CityName t-out="delivery_address_vals.get('state')"/>
                    <cbc:PostalZone t-out="delivery_address_vals.get('zip')"/>
                    <cac:Country>
                        <cbc:Name t-out="delivery_address_vals.get('country')"/>
                    </cac:Country>
                </cac:DeliveryAddress>
                <cac:DeliveryTerms>
                    <cbc:ID schemeID="INCOTERMS" t-out="vals.get('incoterm_code')"/>
                </cac:DeliveryTerms>
                <cac:Shipment>
                    <cbc:ID t-out="vals.get('id')"/>
                    <cac:GoodsItem>
                        <cbc:RequiredCustomsID t-out="vals.get('product_customs_code')"/>
                    </cac:GoodsItem>
                    <cac:ShipmentStage>
                        <cbc:TransportModeCode t-out="vals.get('shipping_method_code')"/>
                    </cac:ShipmentStage>
                </cac:Shipment>
            </cac:Delivery>
        </t>
    </template>

    <template id="ubl_tr_InvoiceLineType" inherit_id="account_edi_ubl_cii.ubl_21_InvoiceLineType" primary="True">
        <xpath expr="//*[local-name()='AllowanceCharge']" position="before">
            <t xmlns:cac="urn:oasis:names:specification:ubl:schema:xsd:CommonAggregateComponents-2">
                <t t-call="{{InvoiceLineDelivery_template}}">
                    <t t-set="vals" t-value="vals.get('line_delivery_vals', {})"/>
                </t>
            </t>
        </xpath>
    </template>

    <template id="ubl_tr_export_InvoiceType" inherit_id="l10n_tr_nilvera_einvoice.ubl_tr_InvoiceType" primary="True">
        <xpath expr="//*[local-name()='AccountingCustomerParty']" position="after">
            <cac:BuyerCustomerParty xmlns:cac="urn:oasis:names:specification:ubl:schema:xsd:CommonAggregateComponents-2"
                xmlns:cbc="urn:oasis:names:specification:ubl:schema:xsd:CommonBasicComponents-2">
                <t t-set="buyer_customer_party_vals" t-value="vals.get('buyer_customer_party_vals', {})"/>
                <cbc:AdditionalAccountID t-out="buyer_customer_party_vals.get('additional_account_id')"/>
                <cac:Party>
                    <t t-call="{{PartyType_template}}">
                        <t t-set="vals" t-value="buyer_customer_party_vals.get('party_vals', {})"/>
                    </t>
                </cac:Party>
            </cac:BuyerCustomerParty>
        </xpath>
    </template>
</odoo>
