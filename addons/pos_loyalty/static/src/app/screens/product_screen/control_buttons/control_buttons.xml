<?xml version="1.0" encoding="UTF-8"?>
<templates id="template" xml:space="preserve">
    <t t-name="pos_loyalty.ControlButtons" t-inherit="point_of_sale.ControlButtons" t-inherit-mode="extension">
        <xpath
            expr="//t[@t-if='props.showRemainingButtons']/div/t[@name='o_pricelist_button']"
            position="before">
            <t t-if="pos.models['loyalty.program'].some((p) => p.program_type == 'ewallet')">
                <t t-set="_orderTotal" t-value="pos.getOrder().priceIncl" />
                <t t-set="_eWalletPrograms" t-value="_getEWalletPrograms()" />
                <t t-set="_eWalletRewards" t-value="_getEWalletRewards(pos.getOrder())" />
                
                <t t-call="point_of_sale.controlButton">
                    <t t-set="iconClasses" t-value="'fa fa-credit-card '"/>
                    <t t-set="btnText">
                        <t t-if="_orderTotal lt 0 and _eWalletPrograms.length">eWallet Refund</t>
                        <t t-elif="_eWalletRewards.length">eWallet Pay</t>
                        <t t-else="">eWallet</t>
                    </t>
                    <t t-set="btnClasses" t-value="'btn-secondary ' + ((_orderTotal lt 0 and _eWalletPrograms.length gte 1) or _eWalletRewards.length gte 1 ? ' highlight text-action': ' disabled')"/>
                    <t t-set="onClick" t-value="onClickWallet"/>
                </t>
            </t>
            <t t-if="pos.models['loyalty.program'].some((p) => ['coupons', 'promotion', 'gift_card', 'promo_code', 'next_order_coupons'].includes(p.program_type))" t-call="point_of_sale.controlButton">
                <t t-set="iconClasses" t-value="'fa fa-percent'"/>
                <t t-set="btnText">Enter Code</t>
                <t t-set="btnClasses" t-value="'btn-secondary '"/>
                <t t-set="onClick" t-value="() => this.clickPromoCode()"/>
            </t>
            <t t-if="pos.models['loyalty.program'].length and this.pos.cashier._role !== 'minimal'" t-call="point_of_sale.controlButton">
                <t t-set="iconClasses" t-value="'fa fa-star'"/>
                <t t-set="btnText">Reward</t>
                <t t-set="btnClasses" t-value="'btn-secondary ' + (state.nbrRewards ? ' highlight' : 'disabled')"/>
                <t t-set="disabled" t-value="!state.nbrRewards"/>
                <t t-set="onClick" t-value="() => this.clickRewards()"/>
            </t>
        </xpath>
        <xpath expr="//t[@t-if='props.showRemainingButtons']/div/t[@name='o_pricelist_button']" position="before">
             <t t-if="pos.models['loyalty.program'].some((p) => ['coupons', 'promotion'].includes(p.program_type)) and this.pos.cashier._role !== 'minimal'" t-call="point_of_sale.controlButton">
                <t t-set="iconClasses" t-value="'fa fa-star'"/>
                <t t-set="btnText">Reset Programs</t>
                <t t-set="btnClasses" t-value="'btn-secondary '"/>
                <t t-set="disabled" t-value="!pos.getOrder().isProgramsResettable()"/>
                <t t-set="onClick" t-value="() => this.pos.resetPrograms()"/>
            </t>
        </xpath>
        <xpath expr="//button[hasclass('more-btn')]" position="attributes">
            <attribute name="t-attf-class">{{ state.nbrRewards ? 'active text-action' : '' }}</attribute>
        </xpath>
    </t>
</templates>
