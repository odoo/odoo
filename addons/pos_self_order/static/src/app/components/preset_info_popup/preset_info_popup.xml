<?xml version="1.0" encoding="UTF-8"?>
<templates id="template" xml:space="preserve">
    <t t-name="pos_self_order.PresetInfoPopup">
        <Dialog header="false"
            contentClass="'h-50 w-100 m-0 position-absolute self_order_pills_selection_popup_dialog'"
            bodyClass="'p-4 pb-3 m-0'"
            title="this.props.title">
            <div class="select_popup_preset_info w-100 d-flex flex-column h-100 overflow-hidden">
                <div class="d-flex justify-content-between align-items-center px-2 mt-2 mb-4">
                    <h2 class="mb-0">We need more info</h2>
                    <button class="btn-close" aria-label="close" t-on-click="close"/>
                </div>
                <div class="d-flex flex-column gap-3 overflow-y-auto overflow-x-hidden flex-grow-1">
                    <!-- <select t-if="preset.needsSlot" class="slot-select form-select form-select-lg" t-model="state.selectedSlot">
                        <option value="">
                            Choose your time
                        </option>
                        <t t-foreach="slots" t-as="slot" t-key="slot_index">
                            <option t-att-value="slot[0]" t-esc="formatDate(slot[0])" disabled="1" />
                            <option t-foreach="Object.values(slot[1])"
                                t-as="s" t-key="s_index"
                                t-if="!s.isFull"
                                t-att-value="s.datetime.toFormat('yyyy-MM-dd HH:mm:ss')"
                                t-esc="s.datetime.toFormat('HH:mm')" />
                        </t>
                    </select> -->
                    <select t-if="preset.needsPartner and existingPartners.length"
                        class="partner-select form-select form-select-lg"
                        t-on-change="selectExistingPartner"
                        t-model="state.selectedPartnerId">
                        <option value="">
                            Select your address
                        </option>
                        <t t-foreach="existingPartners" t-as="partner" t-key="partner.id">
                            <option t-att-value="partner.id" t-esc="partner.name + ' ' + partner.pos_contact_address" />
                        </t>
                    </select>
                    <input t-if="preset.needsName || preset.needsPartner"
                        type="text"
                        class="form-control form-control-lg"
                        placeholder="Name"
                        t-model="state.name"
                        t-att-disabled="partnerIsSelected" />
                    <input t-if="preset.needsEmail || preset.needsPartner"
                        type="text"
                        class="form-control form-control-lg"
                        placeholder="Email"
                        t-model="state.email"
                        t-att-disabled="partnerIsSelected" />
                    <input t-if="preset.needsName || preset.needsPartner"
                        type="text"
                        class="form-control form-control-lg"
                        placeholder="Phone"
                        t-model="state.phone"
                        t-att-disabled="partnerIsSelected"/>
                    <p t-if="!checkPhoneFormat()" class="text-danger">Enter a valid phone number starting with the country code (e.g. +32)</p>
                    <t t-if="preset.needsPartner">
                        <div t-if="state.validationError" class="alert alert-danger d-flex align-items-center justify-content-between">
                            <span t-esc="state.validationError.message" />
                            <button
                                t-if="state.validationError.type === 'delivery' and takeoutPreset"
                                type="button"
                                class="btn btn-light btn-sm"
                                t-on-click="selectTakeoutPreset"
                            >
                                Takeout
                            </button>
                        </div>
                        <div t-att-class="state.validationError?.type === 'delivery' ? 'border border-danger rounded p-2' : ''">
                            <AddressAutoComplete t-props="addressAutoCompleteProps" />
                        </div>
                    </t>
                </div>
                <div class="w-100 d-flex mt-3">
                    <button class="btn btn-secondary flex-grow-1 me-1"
                        t-on-click="props.close">
                        Cancel
                    </button>
                    <button class="btn btn-primary flex-grow-1 ms-1"
                        t-on-click="setInformations"
                        t-att-disabled="!this.validSelection || state.isSubmitting">
                        <t t-if="state.isSubmitting">
                            <span class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true" />
                            Validating...
                        </t>
                        <t t-elif="this.validSelection">
                            Continue
                        </t>
                    </button>
                </div>
            </div>
        </Dialog>
    </t>
</templates>
