<?xml version="1.0" encoding="UTF-8"?>
<templates id="template" xml:space="preserve">

    <t t-name="pos_self_order.ProductList" owl="1">
        <div t-ref="productPage" class="position-relative">
            <header t-ref="header" class="bg-white shadow-sm">
                <NavBar previousPage="'/'"/>
                <div class="o_self_order_searchbar_filter d-flex justify-content-start align-items-center p-0 m-0 border-bottom">
                    <t t-if="privateState.searchIsFocused" t-call="pos_self_order.SearchBox"/>
                    <t t-if="!privateState.searchIsFocused" t-call="pos_self_order.TagPicker" />
                    <t t-if="!privateState.searchIsFocused" t-call="pos_self_order.SearchIcon"/>
                </div>
            </header>
            <!-- the body is set to overflow: hidden and this div is set to overflow-auto
            this way we only scroll on the product list, and not on the whole page, which includes the navbar -->
            <main t-ref="productsList" class="bg-white overflow-auto">
                <div class="d-flex flex-row flex-wrap">
                    <t t-if="this.privateState.searchIsFocused" t-call="pos_self_order.SearchResults"/>
                    <t t-else="" t-call="pos_self_order.ProductListGroupedByTag"/>
                </div>
            </main>
        </div>
    </t>

    <t t-name="pos_self_order.NoProductsMessage" owl="1">
        <p class="mx-auto mt-3 text-center">
            No products found
        </p>
    </t>

    <t t-name="pos_self_order.ProductListGroupedByTag" owl="1">
        <t t-set="tags" t-value="Object.keys(selfOrder.productListGroupedByTag)" />
        <t t-if="!tags?.length" t-call="pos_self_order.NoProductsMessage" />
        <t t-foreach="tags" t-as="tag" t-key="tag">
            <section t-if="selfOrder.productListGroupedByTag[tag].length" t-ref="productsWithTag_{{tag}}" class="w-100 d-flex flex-wrap">
                <h3 class="w-100 m-0 mt-n1 ms-n1 pb-3 pt-4 px-3 bg-light" t-esc="tag" />
                <t t-foreach="selfOrder.productListGroupedByTag[tag]" t-as="product" t-key="product.product_id">
                    <t t-call="pos_self_order.ProductCard"/>
                </t>
            </section>
        </t>
    </t>

    <t t-name="pos_self_order.SearchResults" owl="1">
        <t t-set="filteredProducts" t-value="filteredProducts()"/>
        <t t-if="!filteredProducts?.length" t-call="pos_self_order.NoProductsMessage"/>
        <t t-foreach="filteredProducts" t-as="product" t-key="product.product_id">
            <t t-call="pos_self_order.ProductCard"/>
        </t>
    </t>

    <t t-name="pos_self_order.ProductCard" owl="1">
        <t t-set="product_image_description" t-value="product.has_image or product.description_sale"/>
        <div class="o_self_order_item_card d-flex w-100 w-md-50 w-xl-25 p-2 overflow-hidden" 
            t-on-click="() => this.clickOnProduct(product)"
            t-ref="product_{{product.product_id}}">
            <div t-attf-class="d-flex {{ product_image_description ? 'flex-column' : 'flex-row align-items-center py-2' }} flex-grow-1 p-2 px-1">
                <h3 t-attf-class="mb-0 text-900 fw-bold fs-6" 
                    t-esc="product.name" 
                />
                <p t-attf-class="{{ !product_image_description ? 'ms-auto':'m-0'}} card-text small" 
                    t-esc="formatMonetary(product.list_price, {currencyId: selfOrder.currency_id})" 
                />
                <p t-if="product.description_sale" class="m-0 text-muted small break-line">
                    <t t-esc="product.description_sale" />
                </p>
            </div>
            <t t-if="product.has_image">
                <div class="o_self_order_item_card--image position-relative">
                    <img class="position-absolute h-100 w-100 rounded-3 border border-light bg-light" 
                        t-attf-src="/menu/get-image/{{ product.product_id }}" 
                        alt="Product image" 
                        loading="lazy" />
                </div>
            </t>
        </div>
    </t>
    <t t-name="pos_self_order.SearchBox" owl="1">
        <div class="input-group d-flex align-items-center">
            <input type="text" 
                class="form-control p-3 border-0 shadow-none" 
                t-ref="searchInput" 
                placeholder="Pizza" 
                t-model="privateState.searchInput"/>
            <div class="px-2">
                <button class="btn bg-200 rounded" t-on-click="closeSearch">
                    <i class="fa fa-times"></i>
                </button>
            </div>
        </div>
    </t>
    <t t-name="pos_self_order.SearchIcon" owl="1">
        <button class="btn btn-link text-dark px-3" t-on-click="focusSearch">
            <i class="oi oi-search px-1"></i>
        </button>
    </t>
    <t t-name="pos_self_order.TagPicker" owl="1">
        <ul t-ref="tagList" class="nav nav-pills flex-nowrap flex-grow-1 px-2 border-end overflow-auto">
            <t t-foreach="Array.from(selfOrder.tagList)" t-as="tag" t-key="tag">
                <li class="nav-item mx-1 py-2" 
                    t-on-click="() => this.selectTag(tag)">
                    <span 
                        t-attf-class="user-select-none nav-link py-2 rounded {{privateState.selectedTag === tag ? 'active' : 'text-dark'}}" 
                        t-ref="tag_{{tag}}">
                        <t t-esc="tag"/>
                    </span>
                </li>
            </t>
        </ul>
    </t>
</templates>

