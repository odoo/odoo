<?xml version="1.0" encoding="UTF-8"?>

<templates>

<div t-name="TimelineView.buttons" class="oe_timeline_buttons">
    <t t-if="widget.options.action_buttons !== false">
        <!--<t t-if="">-->
            <button type="button" class="oe_timeline_button_new btn btn-primary btn-sm">
                New message
            </button>
            <t t-if="!widget.options.readonly">
                <span class="oe_alternative">
                    <span class="oe_fade">or</span>
                    <div class="oe_bounce_container">
                        <a class="oe_timeline_share text-info">Write to my followers</a>
                    </div>
                </span>
            </t>
        <!--</t>-->
    </t>
</div>

<div t-name="TimelineWall" class="oe_timeline">
    <div class="oe_timeline-placeholder"> </div>
</div>

<t t-name="ComposeMessage">
    <div t-if="widget.show_composer and !widget.options.readonly" 
         class="oe_tl_msg oe_tl_msg_composer">
        
        <div class="oe_tl_msg_center">
            <div class="oe_tl_msg_content">
                <button class="oe_full" title="Open the full mail composer">
                    <i class='fa fa-pencil-square-o'/>
                </button>
                <t t-call="ThreadListRecipients"/>
                <textarea class="field_text"></textarea>
            </div>
            <div class="oe_tl_msg_footer">
                <div class="oe_tl_msg_attachment_list"></div>
                <div class="btn-group btn-group-sm">
                    <button type="button" class="oe_post btn btn-primary">
                        <t t-if="!widget.is_log">Send</t>
                        <t t-if="widget.is_log">Log</t>
                    </button>
                    <t t-call="ComposeMessage.AddAttachment"/>
                </div>
            </div>
        </div>
    </div>

    <div t-if="widget.show_compact_message and !widget.show_composer and !widget.options.readonly" 
         t-attf-class="oe_tl_msg oe_tl_msg_composer_compact">
        <t t-if="!widget.options.view_inbox">
            <div class="field_text oe_tl_compact oe_tl_compact_record">
                <div class="btn-group btn-group-sm">
                <button type="button" class="oe_tl_compose_post btn btn-primary"
                        t-if="widget.options.compose_placeholder">
                        <t t-raw="widget.options.compose_placeholder"/>
                </button>
                <button type="button" class="oe_tl_compose_post btn btn-primary" 
                        t-if="!widget.options.compose_placeholder and !widget.options.view_inbox"
                        title="Send a message. Followers will be notified.">
                        New message
                </button>
                </div>
                <t t-if="widget.options.display_log_button">
                   <span class="oe_grey oe_tl_sep_word">or</span>
                   <div class="btn-group btn-group-sm">
                   <button class="oe_tl_compose_log btn btn-link btn-small" 
                           title="Log a note. Followers will not be notified.">
                        Log an internal node
                   </button>
                   </div>
                </t>
            </div>
        </t>
    </div>

    <span t-if="!(widget.show_compact_message and !widget.show_composer) and !widget.show_composer" 
          class="oe_placeholder_compose"></span>
</t>

<!--
    ComposeMessage.AddAttachment template
    Small template to be inserted in the composition for add attachments
    -->
<t t-name="ComposeMessage.AddAttachment">
    <span class="oe_attachment_file">
        <span class="oe_add">
            <!-- uploader of file -->
            <button class="oe_attach"><i class="fa fa-paperclip"/></button> 
            <span class='oe_attach_label'>Attach a file</span>
            <t t-call="HiddenInputFile">    
                <t t-set="fileupload_id" t-value="widget.fileupload_id"/>
                <t t-set="fileupload_action" t-translation="off">/web/binary/upload_attachment</t>
                <input type="hidden" name="model" value="mail.compose.message"/>
                <input type="hidden" name="id" value="0"/>
                <input type="hidden" name="session_id" t-att-value="widget.session.session_id"/>
            </t>
        </span>
    </span>
</t>

<!--
    template to the recipients list
    -->
<t t-name="ThreadListRecipients">
    <div class="oe_timeline_list_recipients" t-if="!widget.is_log">
        To:
        <t t-if="!widget.is_private">
            <span class="oe_tl_all_follower">
                <t t-if="widget.parent_thread.parent_message.record_name">
                    Followers of 
                    <t t-raw="'&quot;' + widget.parent_thread.parent_message.record_name + '&quot;'"/>
                </t>
                <t t-if="!widget.parent_thread.parent_message.record_name and widget.options.view_inbox">
                    My Followers </t>
                <t t-if="!widget.parent_thread.parent_message.record_name and !widget.options.view_inbox">
                    Followers of this document </t>
            </span>
        </t>
        <t t-set="inc" t-value="0"/>
        <t t-foreach="widget.partner_ids" t-as="partner">
            <t t-if="widget.is_private or (widget.user_pid != partner[0])">
                <t t-if="!widget.is_private and inc==0"> and </t>
                <span t-attf-class="oe_tl_partner_follower #{inc>=3?'oe_hidden':''}">
                    <t t-if="inc" t-raw="', '"/>
                    <a t-if="widget.options.show_link" 
                       t-attf-href="#model=res.partner&amp;id=#{partner[0]}">
                           <t t-esc="partner[1]"/>
                    </a>
                    <t t-if="!widget.options.show_link" t-esc="partner[1]"/>
                </span>
                <t t-set="inc" t-value="inc+1"/>
            </t>
        </t>

        <t t-if="widget.partner_ids.length > 3">
            <span class="oe_more">
                , <a><t t-esc="widget.partner_ids.length - 3"/> others...</a>
            </span>
            <a class="oe_more_hidden">&lt;&lt;&lt;</a>
        </t>
    
        <div class="oe_tl_recipients" t-if="!widget.is_log">
            <t t-foreach='widget.recipients' t-as='recipient'>
                <label t-attf-title="Add as recipient and follower (reason: #{recipient.reason})">
                    <input type="checkbox" 
                           t-att-checked="recipient.checked ? 'checked' : undefined" 
                           t-att-data="recipient.full_name"/>
                    <t t-esc="recipient.name"/> 
                    <t t-if="recipient.email_address">(<t t-esc="recipient.email_address"/>)</t>
                    <t t-if="!recipient.email_address">(no email address)</t>
                </label>
            </t>
        </div>
    </div>
    <div class="oe_tl_is_log" t-if="widget.is_log">
        <span class="oe_grey">
            Log an internal note which will not be sent to followers. 
            Note that users reading the document can read internal notes.
        </span>
    </div>
</t>

<div t-name="MailThread" class="oe_thread">
    <t t-if="widget.options.view_inbox">
        <div class="oe_tl_thread_parent">
            <t t-raw="widget.content"/>
            <t t-if="!widget.options.is_folded">
                <t t-foreach='widget.messages' t-as='msg'>
                    <t t-raw="msg.content"/>
                </t>
            </t>
        </div>
    </t>
    <t t-if="!widget.options.view_inbox">
        <t t-foreach='widget.messages' t-as='msg'>
            <t t-raw="msg.content"/>
        </t>
    </t>
    <t t-if="!widget.messages.length and !widget.root">
        <t t-call="NoMessage" />
    </t>
</div>

<!--
    mail.thread.message.attachments template
    Template used to display attachments in a mail.message
    -->
<t t-name="ThreadMessageAttachments">
    <t t-foreach='thread.format_attachments(widget.attachment_ids)' t-as='attachment'>
        <t t-if="attachment.file_type_icon !== 'webimage'">
            <div t-attf-class="oe_attachment #{attachment.upload ? 'oe_uploading' : ''}">
                <a t-att-href='attachment.url' target="_blank">
                    <img t-att-src="'/mail/static/src/img/mimetypes/' + attachment.file_type_icon + '.png'"></img>
                    <div class='oe_name'><t t-raw='attachment.name' /></div>
                </a>
                <div class='oe_delete oe_e'>
                    <i class='fa fa-times-circle' title="Delete this attachment" t-att-data-id="attachment.id"/>
                </div>
                <div class='oe_progress_bar'>
                    uploading
                </div>
            </div>
        </t>
        <t t-if="attachment.file_type_icon === 'webimage'">
            <div t-attf-class="oe_attachment oe_preview #{attachment.upload ? 'oe_uploading' : ''}">
                <a t-att-href='attachment.url' target="_blank">
                    <img t-att-src="thread.attachments_resize_image(attachment.id, [100,80])"></img>
                    <div class='oe_name'><t t-raw='attachment.name' /></div>
                </a>
                <div class='oe_delete oe_e'>
                    <i class='fa fa-times-circle' title="Delete this attachment" t-att-data-id="attachment.id"/>
                </div>
                <div class='oe_progress_bar'>
                    uploading
                </div>
            </div>
        </t>
    </t>
</t>

<t t-name="NoMessage">
    <div class="oe_view_nocontent">No message.</div>
</t>

<!--
    ComposeMessage.ButtonTopBar
    render of the button on the user bar for open wizard compose message
    -->
<t t-name="ComposeMessageTopButton">
    <li title='Compose new Message' class="oe_topbar_item oe_topbar_compose_full_email">
        <a href="#">
            <i class="fa fa-envelope-o fa-fw"></i>
        </a>
    </li>
</t>


<div t-name="ThreadParent" class="oe_tl_thread_parent">

    <!--<span class="col-md-2"> 
        <div class="oe_tl_msg_date default">
            <span> 
                <t t-raw="widget.date"/>
            </span>
        </div>
    </span> -->

    <div class="oe_tl_parent_message">
        <div class="oe_tl_msg_icons" t-if="!widget.options.readonly"> 
            <!--<span class='oe_read' t-if="widget.options.show_read">
                <i title="Done" class="fa fa-check"/>
            </span>-->
            <span class='oe_unread' t-if="widget.options.show_unread">
                <i title="Set back to Todo" class="fa fa-inbox"/>
            </span>
        </div>
        <!--<span t-attf-class="oe_tl_parent_subject default 
                            #{widget.model and widget.res_id and widget.options.show_link ? 'oe_tl_small_subject' : ''}">
            <span class="oe_tl_subject">
                <t t-if="widget.record_name and widget.subject">
                    <t t-raw="widget.record_name"/> : <t t-raw="widget.subject"/>
                </t>
                <t t-if="widget.record_name and !widget.subject">
                    <t t-raw="widget.record_name"/> 
                </t>
                <t t-if="!widget.record_name and widget.subject">
                    <t t-raw="widget.subject"/>
                </t>
                <t t-if="!widget.record_name and !widget.subject">
                    No subject
                </t>
            </span>
            (<span class="oe_tl_nb_unread_msg"><t t-raw="widget.nb_messages"/></span>)
        </span>-->
        <!--<span class="oe_tl_go_to_doc" t-if="widget.res_id and widget.model and widget.options.show_link">
            <a t-attf-href="#action=mail.action_mail_redirect&amp;model=#{widget.model}&amp;res_id=#{widget.res_id}">
                <i class="fa fa-arrow-circle-right" title="Go to document"></i>
            </a>
        </span>-->
        <!--<span class="oe_tl_parent_avatar">
            <a t-if="widget.options.show_link" 
               t-attf-href="#model=res.partner&amp;id=#{widget.last_author_id[0]}" 
               t-att-title="widget.last_author_id[1]">
                   <img class="oe_tl_msg_icon" t-att-src="widget.last_avatar"/>
            </a>
            <img t-if="!widget.options.show_link" class="oe_tl_msg_icon" t-att-src="widget.last_avatar"/>
        </span>-->
        <!--<span class="oe_tl_parent_author">
            <a t-if="widget.options.show_link and widget.last_author_id[0]"
               t-attf-href="#model=res.partner&amp;id=#{widget.last_author_id[0]}" 
               t-att-data-partner="widget.last_author_id[0]" class="oe_timeline_action_author"
               title="Last sender">
                 <t t-raw="widget.last_author_id[2]"/>
            </a>
            <a t-if="widget.author_id and (!widget.options.show_link or !widget.last_author_id[0])"
               class="oe_timeline_action_author"
               title="Last sender">
                 <t t-raw="widget.last_author_id[2]"/>
            </a>
        </span>-->
        <!--<span class="oe_tl_msg_icons" t-if="!widget.options.readonly"> 
             <span class='oe_reply' t-if="widget.options.show_reply_button">
                <i title="Reply" class="fa fa-reply"/>
            </span>
        </span>-->
        <!--<span class="oe_tl_parent_followers" t-if="widget.nb_followers > 0">
            <span title="Number of followers"> <t t-raw="widget.nb_followers"/> </span>
            <i class="oe_follwrs fa fa-users"></i>
        </span>-->
    </div>
</div>

</templates>