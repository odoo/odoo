<?xml version="1.0" encoding="UTF-8"?>

<templates>

<div t-name="TimelineWall" class="oe_timeline">
    <div class="oe_timeline-placeholder"> </div>
</div>

<t t-name="MailRoot">
    <div class="oe_timeline container-fluid">
    </div>
</t>

<t t-name="MailThread">
    <div class="oe_thread"/>
</t>

<t t-name="ComposeMessage">
    <div t-if="widget.show_composer and !widget.options.readonly" 
         class="oe_tl_msg oe_tl_msg_composer">
        <div class="oe_tl_msg_left">
            
        </div>
        <div class="oe_tl_msg_center">
            <div class="oe_tl_msg_content">
                <button class="oe_full" title="Open the full mail composer">
                    <span class='oe_e'>&amp;ograve</span>
                </button>
                <t t-call="ThreadListRecipients"/>
                <textarea class="field_text"></textarea>
            </div>
            <div class="oe_tl_msg_footer">
                <div class="oe_tl_msg_attachment_list"></div>
                <div class="btn-group btn-group-sm">
                    <button type="button" class="oe_post btn btn-primary">
                        <t t-if="!widget.is_log">Send</t>
                        <t t-if="widget.is_log">Log</t>
                    </button>
                    <t t-call="ComposeMessage.AddAttachment"/>
                </div>
            </div>
        </div>
    </div>

    <div t-if="widget.show_compact_message and !widget.show_composer and !widget.options.readonly" 
         t-attf-class="oe_tl_msg oe_tl_msg_composer_compact">
        <t t-if="!widget.options.view_mailbox">
            <div class="field_text oe_tl_compact oe_tl_compact_record">
                <div class="btn-group btn-group-sm">
                <button type="button" class="oe_tl_compose_post btn btn-primary"
                        t-if="widget.options.compose_placeholder">
                        <t t-raw="widget.options.compose_placeholder"/>
                </button>
                <button type="button" class="oe_tl_compose_post btn btn-primary" 
                        t-if="!widget.options.compose_placeholder and !widget.options.view_mailbox"
                	    title="Send a message. Followers will be notified.">
                        New message
                </button>
                </div>
                <t t-if="widget.options.display_log_button">
                   <span class="oe_grey oe_tl_sep_word">or</span>
                   <div class="btn-group btn-group-sm">
                   <button class="oe_tl_compose_log btn btn-link btn-small" 
                           title="Log a note. Followers will not be notified.">
                        Log an internal node
                   </button>
                   </div>
                </t>
            </div>
        </t>
    </div>

    <span t-if="!(widget.show_compact_message and !widget.show_composer) and !widget.show_composer" 
          class="oe_placeholder_compose"></span>
</t>

<!--
    ComposeMessage.AddAttachment template
    Small template to be inserted in the composition for add attachments
    -->
<t t-name="ComposeMessage.AddAttachment">
    <span class="oe_attachment_file">
        <span class="oe_add">
            <!-- uploader of file -->
            <button class="oe_attach"><span class="oe_e">'</span></button> 
            <span class='oe_attach_label'>Attach a file</span>
            <t t-call="HiddenInputFile">    
                <t t-set="fileupload_id" t-value="widget.fileupload_id"/>
                <t t-set="fileupload_action" t-translation="off">/web/binary/upload_attachment</t>
                <input type="hidden" name="model" value="mail.compose.message"/>
                <input type="hidden" name="id" value="0"/>
                <input type="hidden" name="session_id" t-att-value="widget.session.session_id"/>
            </t>
        </span>
    </span>
</t>

<!--
    mail.thread.message.attachments template
    Template used to display attachments in a mail.message
    -->
<t t-name="ThreadMessageAttachments">
    <t t-foreach='widget.attachment_ids' t-as='attachment'>
        <t t-if="attachment.file_type_icon !== 'webimage'">
            <div t-attf-class="oe_attachment #{attachment.upload ? 'oe_uploading' : ''}">
                <a t-att-href='attachment.url' target="_blank">
                    <img t-att-src="'/mail/static/src/img/mimetypes/' + attachment.file_type_icon + '.png'"></img>
                    <div class='oe_name'><t t-raw='attachment.name' /></div>
                </a>
                <div class='oe_delete oe_e' title="Delete this attachment" t-att-data-id="attachment.id">[</div>
                <div class='oe_progress_bar'>
                    uploading
                </div>
            </div>
        </t>
        <t t-if="attachment.file_type_icon === 'webimage'">
            <div t-attf-class="oe_attachment oe_preview #{attachment.upload ? 'oe_uploading' : ''}">
                <a t-att-href='attachment.url' target="_blank">
                    <img t-att-src="widget.attachments_resize_image(attachment.id, [100,80])"></img>
                    <div class='oe_name'><t t-raw='attachment.name' /></div>
                </a>
                <div class='oe_delete oe_e' title="Delete this attachment" t-att-data-id="attachment.id">[</div>
                <div class='oe_progress_bar'>
                    uploading
                </div>
            </div>
        </t>
    </t>
</t>

<!--
    template to the recipients list
    -->
<t t-name="ThreadListRecipients">
    <div class="oe_timeline_list_recipients" t-if="!widget.is_log">
        To:
        <t t-if="!widget.is_private">
            <span class="oe_tl_all_follower">
                <t t-if="widget.parent_thread.parent_message.record_name">
                    Followers of 
                    <t t-raw="'&quot;' + widget.parent_thread.parent_message.record_name + '&quot;'"/>
                </t>
                <t t-if="!widget.parent_thread.parent_message.record_name and widget.options.view_inbox">
                    My Followers </t>
                <t t-if="!widget.parent_thread.parent_message.record_name and !widget.options.view_inbox">
                    Followers of this document </t>
            </span>
        </t>
        <t t-set="inc" t-value="0"/>
        <t t-foreach="widget.partner_ids" t-as="partner">
            <t t-if="widget.is_private or (widget.user_pid != partner[0])">
                <t t-if="!widget.is_private and inc==0"> and </t>
                <span t-attf-class="oe_tl_partner_follower #{inc>=3?'oe_hidden':''}">
                    <t t-if="inc" t-raw="', '"/>
                    <a t-if="widget.options.show_link" 
                       t-attf-href="#model=res.partner&amp;id=#{partner[0]}">
                           <t t-esc="partner[1]"/>
                    </a>
                    <t t-if="!widget.options.show_link" t-esc="partner[1]"/>
                </span>
                <t t-set="inc" t-value="inc+1"/>
            </t>
        </t>
        <t t-if="widget.partner_ids.length > 3">
            <span class="oe_more">
                , <a><t t-esc="widget.partner_ids.length - 3"/> others...</a>
            </span>
            <a class="oe_more_hidden">&lt;&lt;&lt;</a>
        </t>
    </div>
    <div class="oe_tl_recipients" t-if="!widget.is_log">
        <t t-foreach='widget.recipients' t-as='recipient'>
            <label t-attf-title="Add as recipient and follower (reason: #{recipient.reason})">
                <input type="checkbox" 
                       t-att-checked="recipient.checked ? 'checked' : undefined" 
                       t-att-data="recipient.full_name"/>
                <t t-esc="recipient.name"/> 
                <t t-if="recipient.email_address">(<t t-esc="recipient.email_address"/>)</t>
                <t t-if="!recipient.email_address">(no email address)</t>
            </label>
        </t>
    </div>
    <div t-if="widget.is_log">
        <span class="oe_grey">
            Log an internal note which will not be sent to followers. 
            Note that users reading the document can read internal notes.
        </span>
    </div>
</t>

<t t-name="ThreadMessage">
    <div> <t t-raw="content"/> </div>
</t>

<t t-name="NoMessage">
    <div class="oe_view_nocontent">No messages.</div>
</t>

<t t-name="ThreadMessage.TrackingValues">
    <t t-foreach='widget.tracking_value_ids' t-as='value'>
        <li>
            <t t-esc="value.changed_field"/>
            <span>:</span>
            <t t-if="value.old_value">
                <span class="oe_tl_tracking_value"> <t t-esc="value.old_value"/> </span>
                <span class="arrow glyphicon glyphicon-arrow-right" aria-hidden="true"></span>
            </t>
            <span class="oe_tl_tracking_value"> <t t-esc="value.new_value"/> </span>
        </li>
    </t>
</t>

<!-- timeline_thread_message_vote
     Template used to display Like/Unlike in a mail.message
-->
<t t-name="ThreadMessage.Vote">
    <span class="oe_timeline_vote_count" t-if='widget.vote_nb > 0'>
        <t t-esc='widget.vote_nb' />
        <i class="fa fa-thumbs-o-up"></i>
    </span>
    <a href='#' class="oe_tl_msg_vote">
        <t t-if="!widget.has_voted">Like</t>
        <t t-if="widget.has_voted">Unlike</t>
    </a>
</t>

<t t-name="ThreadMessage.PartnersList">
    <t t-foreach="widget.partner_ids.slice(0, 3)" t-as="partner">
        <span t-attf-class="oe_tl_partner_follower">
            <a t-if="widget.options.show_link" 
               t-attf-href="#model=res.partner&amp;id=#{partner[0]}" 
               t-att-data-partner="partner[0]" 
               class="oe_timeline_action_author">
                  <t t-esc="partner[1]"/>
            </a>
            <t t-if="!widget.options.show_link" t-esc="partner[1]"/>
        </span>
        <t t-if="!partner_last">,</t>
    </t>
    <t t-if="widget.partner_ids.length > 3">
        <span t-att-title="widget.extra_partners_str">
             and <t t-esc="widget.extra_partners_nbr"/> more
        </span>
    </t>
</t>
 
</templates>

