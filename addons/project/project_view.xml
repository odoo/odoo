<?xml version="1.0" encoding="utf-8"?>
<openerp>
    <data>

        <menuitem
            icon="terp-project" id="base.menu_main_pm"
            name="Project" sequence="10"
            groups="group_project_manager,group_project_user"
            web_icon="images/project.png"
            web_icon_hover="images/project-hover.png"/>

        <menuitem id="menu_project_management" name="Project" parent="base.menu_main_pm" sequence="1"/>
        <menuitem id="menu_definitions" name="Configuration" parent="base.menu_main_pm" sequence="60"/>
        
        <act_window
            context="{'search_default_project_id': [active_id], 'default_project_id': active_id}"
            id="act_project_project_2_project_task_all"
            name="Tasks"
            res_model="project.task"
            src_model="project.project"
            view_mode="kanban,tree,form,calendar,graph"
            view_type="form"/>

        <!-- Project -->
        <record id="edit_project" model="ir.ui.view">
            <field name="name">project.project.form</field>
            <field name="model">project.project</field>
            <field name="type">form</field>
            <field name="arch" type="xml">
                <form string="Project" layout="manual">
                <div class="oe_form_topbar">
                    <button name="set_done" string="Done" type="object" states="open,pending"/>
                    <button name="set_open" string="Re-open project" type="object" states="pending,cancelled,close"/>
                    <button name="set_pending" string="Pending" type="object" states="open"/>
                    <button name="set_template" string="Set as Template" type="object" states="open"/>
                    <button string="New Project Based on Template" name="duplicate_template"  type="object" states="template" context="{'parent_id':parent_id}"/>
                    <button name="reset_project" string="Reset as Project" type="object" states="template"/>
                    <button name="set_cancel" string="Cancel" type="object" states="open,pending"/>
                    <div class="oe_right">
                        <field name="state" nolabel="1" widget="statusbar" statusbar_visible="open,close" statusbar_colors='{"pending":"blue"}' select="1" readonly="1"/>
                    </div>
                    <div class="oe_clear"/>
                </div>
                <sheet string="Project" layout="auto">
                    <group col="4" colspan="4">
                        <group col="2" colspan="2" class="oe_form_group_label_border">
                            <field name="name" string="Project Name" select="1"/>
                            <field name="partner_id" on_change="onchange_partner_id(partner_id)" select="1"/>
                            <field name="user_id" string="Project Manager" select="1" attrs="{'readonly':[('state','in',['close', 'cancelled'])]}"/>
                            <field name="analytic_account_id" invisible="1" required="0"/>
                            <field name="parent_id" invisible="1" string="Parent" domain="[('id','!=',analytic_account_id)]" context="{'current_model': 'project.project'}"/>
                            <!--<field name="date_start" string="Start Date" attrs="{'readonly':[('state','in',['close', 'cancelled'])]}"/>-->
                            <!--<field name="date" string="End Date" attrs="{'readonly':[('state','in',['close', 'cancelled'])]}"/>-->
                            <!--<field name="progress_rate" widget="progressbar"/>-->
                        </group>
                        <group col="2" colspan="2" class="oe_form_group_label_border">
                            <table border="0">
                                <tr name="use_tasks_row">
                                    <th style="border-right:1px solid #DDD;" width="140px">Tasks Management</th>
                                    <td><field name="use_tasks" nolabel="1"/></td>
                                    <td style="text-align:right;" width="110px"><button class="oe_btn_width" name="%(act_project_project_2_project_task_all)d" string="Tasks" type="action" attrs="{'invisible':[('use_tasks','=', 0)]}"/></td>
                                </tr>
                            </table>
                        </group>
                    </group>
                    <notebook colspan="4">
                        <page string="Administration">
                            <group col="2" colspan="2">
                                <separator colspan="4" string="Performance"/>
                                <field name="planned_hours" widget="float_time"/>
                                <field name="effective_hours" widget="float_time" />
                                <field name="resource_calendar_id"/>
                            </group>
                            <newline/>
                            <group col="2" colspan="2" name="misc">
                                <separator colspan="4" string="Miscellaneous"/>
                                <field name="company_id" select="1" groups="base.group_multi_company" widget="selection" required="1"/>
                                <field name="warn_manager"/>
                                <field name="priority"/>
                                <field name="active" attrs="{'invisible':[('state','in',['open', 'pending', 'template'])]}"/>
                            </group>
                        </page>
                        <page string="Members">
                            <field colspan="4" name="members" nolabel="1" help="Project's members are users who can have an access to the tasks related to this project.">

                                <tree string="Members">
                                    <field name="name"/>
                                    <field name="user_email"/>
                                </tree>
                            </field>
                        </page>
                        <page string="Billing" groups="account.group_account_invoice">
                            <!--<field colspan="4" name="partner_id" on_change="onchange_partner_id(partner_id)" select="1" string="Customer"/>-->
                            <field name="warn_customer"/>
                            <field name="currency_id" select="1" groups="base.group_multi_company" required="1"/>
                            <newline/>
                            <group colspan="4" col="4">
                                <separator colspan="2" string="Mail Header"/>
                                <separator colspan="2" string="Mail Footer"/>
                                <field name="warn_header" nolabel="1" colspan="2"/>
                                <field name="warn_footer" nolabel="1" colspan="2"/>
                            </group>
                            <group col="3" colspan="4">
                                <separator string="Automatic variables for headers and footer. Use exactly the same notation." colspan="4"/>
                                <label string="Task: %%(name)s"/>
                                <label string="User: %%(user_id)s"/>
                                <label string="ID: %%(task_id)s"/>
                                <label string="Status: %%(state)s"/>
                                <label string="Date Start: %%(date_start)s"/>
                                <label string="Date Stop: %%(date)s"/>
                            </group>
                        </page>
                        <page string="Tasks Stages">
                           <field nolabel="1" name="type_ids" colspan="4"/>
                        </page>
                        <page string="Notes">
                            <field colspan="4" name="description" nolabel="1"/>
                        </page>
                    </notebook>
                    <newline/>
                </sheet>
                <div class="oe_form_bottom">
                    <field name="message_ids_social" colspan="4" widget="ThreadView" nolabel="1"/>
                </div>
                </form>
            </field>
        </record>

       <record id="view_project_project_filter" model="ir.ui.view">
            <field name="name">project.project.select</field>
            <field name="model">project.project</field>
            <field name="type">search</field>
            <field name="arch" type="xml">
                <search string="Search Project">
                   <group>
                       <filter icon="terp-check" string="Open" name="Current" domain="[('state', '=','open')]" help="Open Projects"/>
                       <filter icon="gtk-media-pause" string="Pending" name="Pending" domain="[('state', '=','pending')]" help="Pending Projects"/>
                       <filter icon="gtk-media-pause" string="Template"
                            name="Template" domain="[('state', '=','template')]" help="Templates of Projects"/>
                       <separator orientation="vertical"/>
                       <filter icon="terp-personal+" string="Member" domain="['|',('user_id', '=', uid),('members', '=', uid)]" help="Projects in which I am a member."/>
                       <separator orientation="vertical"/>
                       <field name="name" string="Project Name"/>
                       <field name="user_id" string="Project Manager">
                            <filter domain="[('user_id','=',uid)]" help="Projects in which I am a manager" icon="terp-personal"/>
                       </field>
                       <field name="partner_id" string="Partner"/>
                   </group>
                   <newline />
                    <group expand="0" string="Group By...">
                        <filter string="Manager" name="Manager"  icon="terp-personal" domain = "[]" context="{'group_by':'user_id'}"/>
                        <filter string="Partner" name="Partner" icon="terp-partner" domain = "[]" context="{'group_by':'partner_id'}"/>
                         <separator orientation="vertical"/>
                        <filter string="Parent" name="Parent"  help="Parent" icon="terp-folder-blue" domain = "[]" context="{'group_by':'parent_id'}"/>
                    </group>
               </search>
            </field>
        </record>

        <record id="view_project" model="ir.ui.view">
            <field name="name">project.project.tree</field>
            <field name="model">project.project</field>
            <field name="type">tree</field>
            <field name="field_parent">child_ids</field>
            <field name="arch" type="xml">
                <tree fonts="bold:needaction_pending==True" colors="red:date and (date&lt;current_date) and (state == 'open');blue:state in ('draft','pending');grey: state in ('close','cancelled')" string="Projects">
                    <field name="sequence" invisible="1"/>
                    <field name="needaction_pending" invisible="1"/>
                    <field name="date" invisible="1"/>
                    <field name="name" string="Project Name"/>
                    <field name="user_id" string="Project Manager"/>
                    <field name="partner_id" string="Partner"/>
                    <field name="parent_id" string="Parent" invisible="1"/>
                    <field name="planned_hours" widget="float_time"/>
                    <field name="total_hours" widget="float_time"/>
                    <field name="effective_hours" widget="float_time"/>
                    <field name="progress_rate" widget="progressbar"/>
                    <field name="state"/>
                </tree>
            </field>
        </record>
        
        <record model="ir.ui.view" id="view_project_kanban">
            <field name="name">project.project.kanban</field>
            <field name="model">project.project</field>
            <field name="type">kanban</field>
            <field name="arch" type="xml">
                <kanban>
                    <field name="effective_hours"/>
                    <field name="planned_hours"/>
                    <field name="name"/>
                    <field name="members"/>
                    <field name="use_tasks"/>
                    <field name="user_id"/>
                    <field name="date"/>
                    <field name="color"/>
                    <field name="task_count"/>
                    <templates>
                        <t t-name="kanban-box">
                            <div t-attf-class="oe_kanban_color_#{kanban_getcolor(record.color.raw_value)} oe_kanban_card oe_kanban_project oe_kanban_auto_height">
                                <a class="oe_kanban_menuaction oe_i">B</a>
                                <ul class="oe_kanban_menu">
                                    <li><a type="edit">Edit...</a></li>
                                    <li><a type="delete">Delete</a></li>
                                    <li><ul class="oe_kanban_colorpicker" data-field="color"/></li>
                                </ul>
                                <div class="oe_kanban_content">
                                    <h3 class="oe_kanban_ellipsis"><field name="name"/></h3>

                                    <div class="oe_kanban_project_list">
                                        <a t-if="record.use_tasks.raw_value"
                                            name="%(act_project_project_2_project_task_all)d" type="action">
                                            Tasks(<field name="task_count"/>)</a>
                                    </div>

                                    <div class="oe_kanban_project_fields oe_kanban_project_deadline" t-if="record.date.raw_value">
                                        <div>Deadline</div>
                                        <div><field name="date"/></div>
                                    </div>

                                    <div class="oe_kanban_project_fields oe_kanban_project_progress">
                                        <div>Progress</div>
                                        <div><t t-esc="Math.round(record.effective_hours.raw_value)"/> / <t t-esc="Math.round(record.planned_hours.raw_value)"/> <field name="company_uom_id"/></div>
                                    </div>

                                    <div class="oe_kanban_project_avatars">
                                        <t t-foreach="record.members.raw_value" t-as="member">
                                            <img t-att-src="kanban_image('res.users', 'avatar', member)" t-att-data-member_id="member"/>
                                        </t>
                                    </div>
                                </div>
                            </div>
                        </t>
                    </templates>
                </kanban>
            </field>
        </record>

       <record id="view_project_project_gantt" model="ir.ui.view">
            <field name="name">project.project.gantt</field>
            <field name="model">project.project</field>
            <field name="type">gantt</field>
            <field name="arch" type="xml">
                <gantt date_delay="planned_hours" date_start="date_start" string="Projects">
                </gantt>
            </field>
        </record>

        <record id="open_view_project_all" model="ir.actions.act_window">
            <field name="name">Projects</field>
            <field name="res_model">project.project</field>
            <field name="view_type">form</field>
            <field name="domain">[]</field>
            <field name="view_mode">kanban,tree,form,gantt</field>
            <field name="view_id" ref="view_project_kanban"/>
            <field name="search_view_id" ref="view_project_project_filter"/>
            <field name="context">{}</field>
            <field name="help" type="xml">
                <p>Click <i>'Create'</i> to <b>start a new project</b>.</p>
                <p>Projects are used to organize your activities; plan tasks,
                track issues, invoice timesheets. You can define internal
                projects (R&amp;D, Improve Sales Process), private projects (My
                Todos) or customer ones.</p>
                <p>
                    You will be able collaborate with internal users on
                    projects or invite customers to share your activities.
                </p>
            </field>
        </record>

        <record id="open_view_template_project" model="ir.actions.act_window">
            <field name="name">Templates of Projects</field>
            <field name="res_model">project.project</field>
            <field name="view_type">form</field>
            <field name="domain">[('state','=','template')]</field>
            <field name="view_id" ref="view_project"/>
        </record>

        <record id="view_task_work_form" model="ir.ui.view">
            <field name="name">project.task.work.form</field>
            <field name="model">project.task.work</field>
            <field name="type">form</field>
            <field name="arch" type="xml">
                <form string="Task Work">
                    <field colspan="4" name="name" select="1"/>
                    <field name="hours" select="1" widget="float_time"/>
                    <field name="date" select="1"/>
                    <field name="user_id" select="1"/>
                    <field name="company_id" groups="base.group_multi_company" widget="selection"/>
                </form>
            </field>
        </record>

        <record id="view_task_work_tree" model="ir.ui.view">
            <field name="name">project.task.work.tree</field>
            <field name="model">project.task.work</field>
            <field name="type">tree</field>
            <field name="arch" type="xml">
                <tree editable="top" string="Task Work">
                    <field name="date"/>
                    <field name="name"/>
                    <field name="hours" widget="float_time"/>
                    <field name="user_id"/>
                </tree>
            </field>
        </record>

        <!-- Task -->
        <record id="view_task_form2" model="ir.ui.view">
            <field name="name">project.task.form</field>
            <field name="model">project.task</field>
            <field name="type">form</field>
            <field eval="2" name="priority"/>
            <field name="arch" type="xml">
                <form string="Project" layout="manual">
                    <div class="oe_form_topbar">
                        <button name="action_close" states="pending,open" string="Done" type="object"/>
                        <button name="do_open" states="pending,draft" string="Start Task" type="object"/>
                        <button name="%(action_project_task_reevaluate)d" states="done,cancelled" string="Reactivate" type="action" context="{'button_reactivate':True}" />
                        <button name="do_pending" states="open" string="Pending" type="object"/>
                        <button name="do_draft" states="open" string="Draft" type="object"/>
                        <button name="%(action_project_task_delegate)d" states="pending,open,draft" string="Delegate" type="action"/>
                        <button name="do_cancel" states="draft,open,pending" string="Cancel" type="object"/>
                        <div class="oe_right">
                            <field name="state" nolabel="1" widget="statusbar" statusbar_visible="draft,open,done" statusbar_colors='{"pending":"blue"}' select="1"/>
                        </div>
                        <div class="oe_clear"/>
                    </div>
                    <sheet string="Task edition" layout="auto">
                    <group colspan="6" col="6">
                        <field name="name" select="1"/>
                        <field name="project_id" select="1"  on_change="onchange_project(project_id)"/>
                        <field name="total_hours" widget="float_time" groups="project.group_tasks_work_on_tasks"/>
                        <field name="date_deadline" attrs="{'readonly':[('state','in',['done', 'cancelled'])]}"/>
                        <field name="user_id" select="1" attrs="{'readonly':[('state','in',['done', 'cancelled'])]}"/>
                        <field name="progress" widget="progressbar" groups="project.group_tasks_work_on_tasks"/>
                    </group>
                    <notebook colspan="4">
                        <page string="Information">
                            <group col="2" colspan="2">
                                <field
                                    name="planned_hours"
                                    widget="float_time"
                                    attrs="{'readonly':[('state','!=','draft')]}"
                                    groups="project.group_time_work_estimation_tasks"									
                                    on_change="onchange_planned(planned_hours, effective_hours)"/>
                                <field
                                    name="effective_hours"
                                    widget="float_time" invisible="1" groups="project.group_tasks_work_on_tasks"/>
                            </group>
                            <group col="3" colspan="2">
                                <field name="remaining_hours" widget="float_time" attrs="{'readonly':[('state','!=','draft')]}" colspan="2" groups="project.group_time_work_estimation_tasks"/>
                                <button name="%(action_project_task_reevaluate)d" string="Reevaluate" type="action" colspan="1" target="new" states="open,pending" icon="gtk-edit"/>
                            </group>

                            <field colspan="4" name="description" nolabel="1"  attrs="{'readonly':[('state','=','done')]}"/>
                            <field colspan="4" name="work_ids" nolabel="1" attrs="{'readonly':[('state','in',['done','draft'])]}" groups="project.group_tasks_work_on_tasks">
                                <tree string="Task Work" editable="top">
                                    <field name="name" />
                                    <field name="hours" widget="float_time" sum="Spent Hours"/>
                                    <field name="user_id" />
                                    <field name="date" />
                                </tree>
                            </field>
                        </page>
                        <page string="Delegations History">
                            <separator string="Parent Tasks" colspan="4"/>
                            <field colspan="4" height="150" name="parent_ids" nolabel="1"/>
                            <separator string="Delegated tasks" colspan="4"/>
                            <field colspan="4" height="150" name="child_ids" nolabel="1">
                                <tree string="Delegated tasks">
                                    <field name="name"/>
                                    <field name="user_id"/>
                                    <field name="state"/>
                                    <field name="effective_hours" widget="float_time"/>
                                    <field name="progress" widget="progressbar"/>
                                    <field name="remaining_hours" widget="float_time"/>
                                    <field name="date_deadline"/>
                                </tree>
                            </field>
                        </page>

                        <page string="Extra Info" attrs="{'readonly':[('state','=','done')]}">
                            <group colspan="2" col="2">
                                <separator string="Planning" colspan="2"/>
                                <field name="priority"/>
                                <field name="sequence"/>
                            </group>

                            <separator string="Miscellaneous" colspan="4"/>
                            <field name="partner_id" />
                            <field name="company_id" select="1" groups="base.group_multi_company" widget="selection"/>
                            <group col="4" colspan="2">
                                <field name="type_id" widget="selection" readonly="1"/>
                                <button name="prev_type" string="Previous" type="object" icon="gtk-go-back" help="Change to Previous Stage"/>
                                <button name="next_type" string="Next" type="object" icon="gtk-go-forward" help="Change to Next Stage"/>
                            </group>
                            <separator colspan="4" string="Notes"/>
                            <field colspan="4" name="notes" nolabel="1"/>
                        </page>
                    </notebook>
                    </sheet>
                    <div class="oe_form_bottom">
                        <field name="message_ids_social" colspan="4" widget="ThreadView" nolabel="1"/>
                    </div>
                </form>
            </field>
        </record>
        
        <!-- Project Task Kanban View  -->
        <record model="ir.ui.view" id="view_task_kanban">
            <field name="name">project.task.kanban</field>
            <field name="model">project.task</field>
            <field name="type">kanban</field>
            <field name="arch" type="xml">
                <kanban default_group_by="type_id" >
                    <field name="color"/>
                    <field name="priority"/>
                    <field name="type_id"/>
                    <field name="user_id"/>
                    <field name="user_email"/>
                    <field name="description"/>
                    <field name="sequence"/>
                    <field name="state"/>
                    <field name="kanban_state"/>
                    <field name="remaining_hours" sum="Remaining Time" groups="project.group_time_work_estimation_tasks"/>
                    <field name="date_deadline"/>
                    <templates>
                        <t t-name="task_details">
                            <ul class="oe_kanban_tooltip" t-if="record.project_id.raw_value">
                                <li><b>Project:</b> <field name="project_id"/></li>
                            </ul>
                        </t>
                        <t t-name="kanban-box">
                            <t t-set="pad_url">http://pad.openerp.com/<t t-raw="_.str.underscored(_.str.trim(record.name.raw_value))"/></t>
                            <t t-if="record.kanban_state.raw_value === 'blocked'" t-set="border">oe_kanban_color_red</t>
                            <t t-if="record.kanban_state.raw_value === 'done'" t-set="border">oe_kanban_color_green</t>
                            <div t-attf-class="#{kanban_color(record.color.raw_value)} #{border || ''}">
                                <div class="oe_kanban_box oe_kanban_color_border">
                                    <table class="oe_kanban_table oe_kanban_box_header oe_kanban_color_bgdark oe_kanban_color_border oe_kanban_draghandle">
                                    <tr>
                                        <td align="left" valign="middle" width="16">
                                            <a t-if="record.priority.raw_value == 1" icon="star-on" type="object" name="set_normal_priority"/>
                                            <a t-if="record.priority.raw_value != 1" icon="star-off" type="object" name="set_high_priority" style="opacity:0.6; filter:alpha(opacity=60);"/>
                                        </td>
                                        <td align="left" valign="middle" class="oe_kanban_title" tooltip="task_details">
                                            <field name="name"/>
                                        </td>
                                        <td valign="top" width="22">
                                            <img t-att-src="kanban_image('res.users', 'avatar', record.user_id.raw_value[0])"  t-att-title="record.user_id.value"
                                            width="22" height="22" class="oe_kanban_gravatar"/>
                                        </td>
                                    </tr>
                                    </table>
                                    <div class="oe_kanban_box_content oe_kanban_color_bglight oe_kanban_box_show_onclick_trigger">
                                        <div class="oe_kanban_description">
                                            <t t-esc="kanban_text_ellipsis(record.description.value, 160)"/>
                                            <i t-if="record.date_deadline.raw_value">
                                                <t t-if="record.description.raw_value">, </t>
                                                <field name="date_deadline"/>
                                            </i>
                                            <span class="oe_kanban_project_times" style="white-space: nowrap; padding-left: 5px;">
                                                <t t-set="hours" t-value="record.remaining_hours.raw_value"/>
                                                <t t-set="times" t-value="[
                                                     [1, (hours gte 1 and hours lt 2)]
                                                    ,[2, (hours gte 2 and hours lt 5)]
                                                    ,[5, (hours gte 5 and hours lt 10)]
                                                    ,[10, (hours gte 10)]
                                                ]"/>
                                                <t t-foreach="times" t-as="time"
                                                    ><a t-if="!time[1]" t-attf-data-name="set_remaining_time_#{time[0]}"
                                                        type="object" class="oe_kanban_button"><t t-esc="time[0]"/></a
                                                    ><b t-if="time[1]" class="oe_kanban_button oe_kanban_button_active"><t t-esc="Math.round(hours)"/></b
                                                ></t>
                                                <a name="do_open" states="draft" string="Validate planned time and open task" type="object" class="oe_kanban_button oe_kanban_button_active">!</a>
                                            </span>
                                        </div>
                                        <div class="oe_kanban_clear"/>
                                    </div>
                                    <div class="oe_kanban_buttons_set oe_kanban_color_border oe_kanban_color_bglight oe_kanban_box_show_onclick">
                                        <div class="oe_kanban_left">
                                            <a string="Edit" icon="gtk-edit" type="edit"/>
                                            <a string="Change Color" icon="color-picker" type="color" name="color"/>
                                            <a name="%(action_project_task_delegate)d" states="pending,open,draft" string="Delegate" type="action" icon="terp-personal"/>
                                            <a name="action_close" states="draft,pending,open" string="Done" type="object" icon="terp-dialog-close"/>
                                        </div>
                                        <div class="oe_kanban_right">
                                            <a name="set_kanban_state_blocked" string="Mark as Blocked" kanban_states="normal,done" type="object" icon="kanban-stop"/>
                                            <a name="set_kanban_state_normal" string="Normal" kanban_states="blocked,done" type="object" icon="gtk-media-play"/>
                                            <a name="set_kanban_state_done" string="Done" kanban_states="blocked,normal" type="object" icon="kanban-apply"/>
                                        </div>
                                        <div class="oe_kanban_clear"/>
                                    </div>
                                </div>
                            </div>
                        </t>
                    </templates>
                </kanban>
            </field>
         </record>

        <record id="view_task_tree2" model="ir.ui.view">
            <field name="name">project.task.tree</field>
            <field name="model">project.task</field>
            <field name="type">tree</field>
            <field eval="2" name="priority"/>
            <field name="arch" type="xml">
                <tree fonts="bold:needaction_pending==True" colors="grey:state in ('cancelled','done');blue:state == 'pending';red:date_deadline and (date_deadline&lt;current_date) and (state in ('draft','pending','open'))" string="Tasks">
                    <field name="needaction_pending" invisible="1"/>
                    <field name="sequence" invisible="not context.get('seq_visible', False)"/>
                    <field name="name"/>
                    <field name="project_id" icon="gtk-indent" invisible="context.get('user_invisible', False)"/>
                    <field name="user_id" invisible="context.get('user_invisible', False)"/>
                    <field name="delegated_user_id" invisible="context.get('show_delegated', True)"/>
                    <field name="total_hours" invisible="1"/>
                    <field name="planned_hours" invisible="context.get('set_visible',False)" groups="project.group_time_work_estimation_tasks"/>
                    <field name="effective_hours" widget="float_time" sum="Spent Hours" invisible="1"/>
                    <field name="remaining_hours" widget="float_time" sum="Remaining Hours" on_change="onchange_remaining(remaining_hours,planned_hours)" invisible="context.get('set_visible',False)" groups="project.group_time_work_estimation_tasks"/>
                    <field name="date_deadline" invisible="context.get('deadline_visible',True)"/>
                    <field name="type_id" invisible="context.get('set_visible',False)"/>
                    <button name="next_type" invisible="context.get('set_visible',False)"
                        states="draft,open,pending"
                        string="Change Stage"
                        type="object"
                        icon="gtk-go-forward"
                        help="Change Type"/>
                    <field name="date_start" invisible="1" groups="base.group_no_one"/>
                    <field name="date_end" invisible="1" groups="base.group_no_one"/>
                    <field name="progress" widget="progressbar" invisible="context.get('set_visible',False)"/>
                    <field name="state" invisible="context.get('set_visible',False)"/>
                    <button name="do_open" states="pending,draft,done,cancelled" string="Start Task" type="object" icon="gtk-media-play" help="For changing to open state" invisible="context.get('set_visible',False)"/>
                    <button name="%(action_project_task_delegate)d" states="pending,open,draft" string="Delegate" type="action" icon="terp-personal" help="For changing to delegate state"/>
                    <button name="action_close" states="draft,pending,open" string="Done" type="object" icon="terp-dialog-close" help="For changing to done state"/>
                </tree>
            </field>
        </record>

        <record id="view_task_calendar" model="ir.ui.view">
            <field name="name">project.task.calendar</field>
            <field name="model">project.task</field>
            <field name="type">calendar</field>
            <field eval="2" name="priority"/>
            <field name="arch" type="xml">
                <calendar color="user_id" date_start="date_deadline" string="Tasks">
                    <field name="name"/>
                    <field name="project_id"/>
                </calendar>
            </field>
        </record>

        <record id="view_task_gantt" model="ir.ui.view">
            <field name="name">project.task.gantt</field>
            <field name="model">project.task</field>
            <field name="type">gantt</field>
            <field eval="2" name="priority"/>
            <field name="arch" type="xml">
                <gantt date_start="date_start" date_stop="date_end" string="Tasks" default_group_by="project_id">
                </gantt>
            </field>
        </record>

        <record id="view_project_task_graph" model="ir.ui.view">
            <field name="name">project.task.graph</field>
            <field name="model">project.task</field>
            <field name="type">graph</field>
            <field name="arch" type="xml">
                <graph string="Project Tasks" type="bar">
                    <field name="project_id"/>
                    <field name="planned_hours" operator="+"/>
                    <field name="delay_hours" operator="+"/>
                </graph>
            </field>
        </record>

        <record id="view_task_search_form" model="ir.ui.view">
            <field name="name">project.task.search.form</field>
            <field name="model">project.task</field>
            <field name="type">search</field>
            <field name="arch" type="xml">
               <search string="Tasks">
                    <group>
                        <filter name="draft" string="New" domain="[('state','=','draft')]" help="New Tasks" icon="terp-check"/>
                        <filter name="open" string="In Progress" domain="[('state','=','open')]" help="In Progress Tasks" icon="terp-camera_test"/>
                        <filter string="Pending" domain="[('state','=','pending')]" context="{'show_delegated':False}" help="Pending Tasks" icon="terp-gtk-media-pause"/>
                        <separator orientation="vertical"/>
                        <filter string="Deadlines" context="{'deadline_visible': False}" domain="[('date_deadline','&lt;&gt;',False)]" help="Show only tasks having a deadline" icon="terp-gnome-cpu-frequency-applet+"/>
                        <separator orientation="vertical"/>
                        <field name="name"/>
                        <field name="project_id" invisible="1"/>
                        <filter name="project" string="Project" domain="[('project_id.user_id','=',uid)]" help="My Projects" icon="terp-check"/>
                        <field name="user_id">
                            <filter string="My Tasks" domain="[('user_id','=',uid)]"  help="My Tasks" icon="terp-personal" />
                            <filter string="Unassigned Tasks" domain="[('user_id','=',False)]"  help="Unassigned Tasks" icon="terp-personal-" />
                        </field>
                    </group>
                    <newline/>
                    <group expand="0" string="Group By...">
                        <filter string="Users" name="group_user_id" icon="terp-personal" domain="[]"  context="{'group_by':'user_id'}"/>
                        <separator orientation="vertical"/>
                        <filter string="Project" name="group_project_id" icon="terp-folder-violet" domain="[]" context="{'group_by':'project_id'}"/>
                        <separator orientation="vertical"/>
                        <filter string="Stage" name="group_stage_id" icon="terp-stage" domain="[]" context="{'group_by':'type_id'}"/>
                        <filter string="Status" name="group_state" icon="terp-stock_effects-object-colorize" domain="[]" context="{'group_by':'state'}"/>
                        <separator orientation="vertical"/>
                        <filter string="Deadline" icon="terp-gnome-cpu-frequency-applet+" domain="[]" context="{'group_by':'date_deadline'}"/>
                        <separator orientation="vertical" groups="base.group_no_one"/>
                        <filter string="Start Date" icon="terp-go-month" domain="[]" context="{'group_by':'date_start'}" groups="base.group_no_one"/>
                        <filter string="End Date" icon="terp-go-month" domain="[]" context="{'group_by':'date_end'}" groups="base.group_no_one"/>
                    </group>
                </search>
            </field>
        </record>
        
        <record id="analytic_account_inherited_form" model="ir.ui.view">
            <field name="name">account.analytic.account.form.inherit</field>
            <field name="model">account.analytic.account</field>
            <field name="type">form</field>
            <field name="inherit_id" ref="analytic.view_account_analytic_account_form"/>
            <field eval="18" name="priority"/>
            <field name="arch" type="xml">
                <xpath expr='//separator[@name="project_sep"]' position='replace'>
                    <separator colspan="2" string="Project" name="project_sep"/>
                </xpath>
                <xpath expr='//separator[@name="description"]' position='before'>
                    <field name="members" colspan="4" nolabel="1"/>
                </xpath>
            	<xpath expr='//group[@name="project"]' position='inside'>
                    <field name="use_tasks" />
                </xpath>
            </field>
        </record>

        <record id="action_view_task" model="ir.actions.act_window">
            <field name="name">Tasks</field>
            <field name="res_model">project.task</field>
            <field name="view_type">form</field>
            <field name="view_mode">kanban,tree,form,calendar,gantt,graph</field>
            <field eval="False" name="filter"/>
            <field name="view_id" eval="False"/>
            <field name="context">{}</field>
            <field name="search_view_id" ref="view_task_search_form"/>
            <field name="help">Tasks allow you to organize your work into a project. Click on button "Create" to create a new task.</field>
        </record>
        <record id="open_view_task_list_kanban" model="ir.actions.act_window.view">
            <field name="sequence" eval="0"/>
            <field name="view_mode">kanban</field>
            <field name="act_window_id" ref="action_view_task"/>
        </record>
        <record id="open_view_task_list_tree" model="ir.actions.act_window.view">
            <field name="sequence" eval="1"/>
            <field name="view_mode">tree</field>
            <field name="act_window_id" ref="action_view_task"/>
        </record>

        <menuitem action="action_view_task" id="menu_action_view_task" parent="project.menu_project_management" sequence="5"/>

        <record id="action_view_task_overpassed_draft" model="ir.actions.act_window">
            <field name="name">Overpassed Tasks</field>
            <field name="res_model">project.task</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form,calendar,graph,kanban</field>
            <field name="domain">[('date_deadline','&lt;',time.strftime('%Y-%m-%d')),('state','in',('draft','pending','open'))]</field>
            <field name="filter" eval="True"/>
            <field name="search_view_id" ref="view_task_search_form"/>
        </record>

        <!-- Opening task when double clicking on project -->
        <record id="dblc_proj" model="ir.actions.act_window">
            <field name="res_model">project.task</field>
            <field name="name">Project's tasks</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form,calendar,graph,gantt,kanban</field>
            <field name="domain">[('project_id', 'child_of', [active_id])]</field>
            <field name="context">{'project_id':active_id, 'active_test':False}</field>
        </record>

        <record id="ir_project_task_open" model="ir.values">
            <field eval=" 'tree_but_open'" name="key2"/>
            <field eval="'project.project'" name="model"/>
            <field name="name">View project's tasks</field>
            <field eval="'ir.actions.act_window,'+str(dblc_proj)" name="value"/>
        </record>

        <!-- Task types -->
        <record id="task_type_search" model="ir.ui.view">
            <field name="name">project.task.type.search</field>
            <field name="model">project.task.type</field>
            <field name="type">search</field>
            <field name="arch" type="xml">
                <search string="Tasks Stages">
                   <group>
                       <filter icon="terp-check" string="Common" name="common" domain="[('project_default', '=', 1)]" help="Stages common to all projects"/>
                       <separator orientation="vertical"/>
                       <field name="name"/>
                   </group>
                </search>
            </field>
        </record>

        <record id="task_type_edit" model="ir.ui.view">
            <field name="name">project.task.type.form</field>
            <field name="model">project.task.type</field>
            <field name="type">form</field>
            <field name="arch" type="xml">
                <form string="Task Stage">
                    <group colspan="4" col="6">
                    <field name="name"/>
                    <field name="project_default"/>
                    <field name="sequence"/>
                    </group>
                    <separator string="Description" colspan="4"/>
                    <field colspan="4" name="description" nolabel="1"/>
                </form>
            </field>
        </record>

        <record id="task_type_tree" model="ir.ui.view">
            <field name="name">project.task.type.tree</field>
            <field name="model">project.task.type</field>
            <field name="type">tree</field>
            <field name="arch" type="xml">
                <tree string="Task Stage">
                    <field name="sequence"/>
                    <field name="name"/>
                </tree>
            </field>
        </record>

        <record id="open_task_type_form" model="ir.actions.act_window">
            <field name="name">Stages</field>
            <field name="res_model">project.task.type</field>
            <field name="view_type">form</field>
            <field name="view_id" ref="task_type_tree"/>
            <field name="help">Define the steps that will be used in the project from the creation of the task, up to the closing of the task or issue. You will use these stages in order to track the progress in solving a task or an issue.</field>
        </record>

        <menuitem id="menu_tasks_config" name="GTD" parent="project.menu_definitions" sequence="1"/>

        <menuitem id="menu_project_config_project" name="Stages" parent="menu_definitions" sequence="1"/>

        <menuitem action="open_task_type_form" id="menu_task_types_view" parent="menu_project_config_project" sequence="2" groups="base.group_no_one"/>
        <menuitem action="open_view_project_all" id="menu_projects" name="Projects" parent="menu_project_management" sequence="1"/>

        <act_window context="{'search_default_user_id': [active_id], 'default_user_id': active_id}" id="act_res_users_2_project_project" name="User's projects" res_model="project.project" src_model="res.users" view_mode="tree,form" view_type="form"/>

         <record id="task_company" model="ir.ui.view">
            <field name="name">res.company.task.config</field>
            <field name="model">res.company</field>
            <field name="type">form</field>
            <field name="inherit_id" ref="base.view_company_form"/>
            <field name="arch" type="xml">
                <page string="Configuration" position="inside">
                    <separator string="Project Management" colspan="4"/>
                    <field name="project_time_mode_id" domain="[('category_id','=','Working Time')]"/>
                    <newline/>
                </page>
            </field>
        </record>

      <!--     User Form-->
        <act_window context="{'search_default_user_id': [active_id], 'default_user_id': active_id}" domain="[('state', '&lt;&gt;', 'cancelled'),('state', '&lt;&gt;', 'done')]" id="act_res_users_2_project_task_opened" name="Assigned Tasks" res_model="project.task" src_model="res.users" view_mode="tree,form,gantt,calendar,graph" view_type="form"/>
    </data>
</openerp>
