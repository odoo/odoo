<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- Calendar Timeslot : Views and Actions  -->
    <record id="calendar_bis_timeslot_tree" model="ir.ui.view">
        <field name="name">calendar_bis.calendar.timeslot.tree</field>
        <field name="model">calendar.timeslot</field>
        <field name="arch" type="xml">
            <tree string="Meetings" sample="1">
                <field name="can_write" invisible="1"/>
                <field name="name" string="Subject" decoration-bf="1" readonly="not can_write"/>
                <field name="start" string="Start Date" readonly="not can_write"/>
                <field name="stop" string="End Date" readonly="not can_write"/>
                <field name="duration" string="Duration" widget="float_time" optional="hide" readonly="not can_write"/>
                <field name="partner_id" widget="many2one_avatar_user" readonly="not can_write" optional="hide"/>
                <field name="attendee_ids" widget="many2many_tags" readonly="not can_write" optional="show"/>
                <field name="is_public" optional="hide" readonly="not can_write"/>
            </tree>
        </field>
    </record>

    <record id="calendar_bis_timeslot_form" model="ir.ui.view">
        <field name="name">calendar_bis.calendar.timeslot.form</field>
        <field name="model">calendar.timeslot</field>
        <field name="arch" type="xml">
            <form string="Meetings" js_class="calendar_form">
                <div invisible="not id or not is_recurring" class="alert alert-info oe_edit_only" role="status">
                    <p>Edit recurring event</p>
                    <field name="edit" widget="radio"/>
                </div>
                <sheet>
                    <field name="can_write" invisible="1"/>
                    <field name="can_read_private" invisible="1"/>
                    <field name="event_id" invisible="1"/>
                    <h1><field name="name" string="Subject" decoration-bf="1" readonly="not can_write" placeholder="Subject"/></h1>
                    <field name="tag_ids" widget="many2many_tags" options="{'color_field': 'color'}" placeholder="Tags"/>
                    <group>
                        <group string="Public">
                            <field name="partner_id" required="1" domain="[('user_id', '=', uid)]" readonly="not can_write"/>
                            <field name="start" string="Start Date" required="1" readonly="not can_write"/>
                            <field name="stop" string="End Date" required="1" readonly="not can_write"/>
                            <field name="duration" string="Duration (H)" widget="float_time" readonly="not can_write"/>
                            <field name="allday" widget="boolean_toggle" readonly="not can_write"/>
                            <field name="is_shown" widget="boolean_toggle" readonly="not can_write"/>
                            <field name="is_public" widget="boolean_toggle" readonly="not can_write" invisible="not is_shown"/>
                            <field name="is_recurring" widget="boolean_toggle" readonly="not can_write"/>
                        </group>
                        <group string="Private" readonly="not can_write" invisible="not can_read_private">
                            <field name="alarm_ids" widget="many2many_tags" readonly="not can_write"/>
                            <field name="partner_ids" widget="many2many_tags" readonly="not can_write"/>
                            <field name="description" readonly="not can_write"/>
                            <field name="location" readonly="not can_write"/>
                        </group>
                    </group>
                    <notebook invisible="not can_read_private">
                        <page string="Recurrence" invisible="not is_recurring">
                            <group>
                                <field name="freq" readonly="not can_write" required="not is_recurring"/>
                                <label string="Repeat on" for="freq" invisible="freq != 'weekly'"/><widget name="calendar_week_days" invisible="freq != 'weekly'"/>
                                <field name="monthday" readonly="not can_write" invisible="freq != 'monthly'"/>
                                <field name="monthweekday_n" readonly="not can_write" invisible="freq != 'monthly'"/>
                                <field name="monthweekday_day" readonly="not can_write" invisible="freq != 'monthly'"/>
                                <field name="until" readonly="not can_write"/>
                                <field name="count" readonly="not can_write"/>
                                <field name="interval" readonly="not can_write"/>
                            </group>
                        </page>
                        <page string="Attendees Status">
                            <field name="attendee_ids">
                                <tree editable="top" create="0">
                                    <field name="partner_id"/>
                                    <field name="email"/>
                                    <field name="state"/>
                                </tree>
                            </field>
                        </page>
                    </notebook>
                </sheet>
            </form>
        </field>
    </record>

    <record id="calendar_bis_timeslot_form_quick_create" model="ir.ui.view">
        <field name="name">calendar_bis.calendar.timeslot.form.quick.create</field>
        <field name="model">calendar.timeslot</field>
        <field name="arch" type="xml">
            <form string="Meetings" js_class="calendar_bis_quick_create_form_view">
                <sheet>
                    <field name="can_write" invisible="1"/>
                    <field name="can_read_private" invisible="1"/>
                    <field name="event_id" invisible="1"/>
                    <h1><field name="name" string="Subject" decoration-bf="1" readonly="not can_write" placeholder="Subject"/></h1>
                    <field name="tag_ids" widget="many2many_tags" options="{'color_field': 'color'}" placeholder="Tags"/>
                    <group>
                        <group string="Public" readonly="not can_write">
                            <field name="partner_id" required="1" domain="[('user_id', '=', uid)]"/>
                            <field name="allday" widget="boolean_toggle"/>
                            <field name="start" string="Start Date" required="1"/>
                            <field name="stop" string="End Date" required="1"/>
                            <field name="duration" string="Duration (H)" widget="float_time" invisible="allday"/>
                            <field name="is_shown" widget="boolean_toggle"/>
                            <field name="is_public" widget="boolean_toggle" invisible="not is_shown"/>
                        </group>
                        <group string="Private" readonly="not can_write" invisible="not can_read_private">
                            <field name="description"/>
                            <field name="partner_ids" widget="many2many_tags"/>
                            <field name="location"/>
                        </group>
                    </group>
                </sheet>
            </form>
        </field>
    </record>

    <record id="calendar_bis_timeslot_calendar" model="ir.ui.view">
        <field name="name">calendar_bis.calendar.timeslot.calendar</field>
        <field name="model">calendar.timeslot</field>
        <field name="arch" type="xml">
            <calendar js_class="calendar_bis"
                      string="Meetings" mode="week"
                      date_start="start" date_stop="stop" date_delay="duration"
                      color="partner_id" all_day="allday"
                      quick_create="1" quick_create_view_id="%(calendar_bis_timeslot_form_quick_create)d">
                    <field name="name" string="Subject" decoration-bf="1" readonly="1"/>
                    <field name="location" invisible="not location" options="{'icon': 'fa fa-map-marker'}"/>
                    <field name="partner_id" widget="many2one_avatar_user" readonly="1"/>
                    <field name="attendee_ids" widget="many2many_tags" readonly="1"/>
                    <field name="tag_ids" invisible="not tag_ids" options="{'icon': 'fa fa-tag', 'color_field': 'color'}"/>
                    <field name="is_recurring" invisible="1"/>
            </calendar>
        </field>
    </record>

    <record id="calendar_bis_timeslot_search" model="ir.ui.view">
        <field name="name">calendar_bis.calendar.timeslot.search</field>
        <field name="model">calendar.timeslot</field>
        <field name="arch" type="xml">
            <search string="Search Meetings">
                <field name="name" string="Subject"/>
                <field name="partner_id" string="Calendar"/>
                <field name="is_public" string="Public"/>
                <field name="attendee_ids" string="Attendees"/>
                <filter name="calendar" string="My Calendar" domain="['|', ('attendee_ids.partner_id.user_id', 'in', [uid]), ('user_id', '=', uid)]"/>
                <filter name="my_events" string="My Events" domain="[('user_id', '=', uid)]"/>
            </search>
        </field>
    </record>

    <record id="action_calendar_timeslot" model="ir.actions.act_window">
        <field name="name">Meetings</field>
        <field name="res_model">calendar.timeslot</field>
        <field name="view_mode">calendar,tree,form</field>
        <field name="view_id" ref="calendar_bis_timeslot_calendar"/>
        <field name="search_view_id" ref="calendar_bis_timeslot_search"/>
        <field name="context">
            {'search_default_calendar': True}
        </field>
        <field name="help" type="html">
          <p class="o_view_nocontent_smiling_face">
            No meetings found. Let's schedule one!
          </p><p>
            The calendar is shared between employees and fully integrated with
            other applications such as the employee leaves or the business
            opportunities.
          </p>
        </field>
    </record>

    <record id="action_calendar_timeslot_calendar" model="ir.actions.act_window.view">
        <field name="act_window_id" ref="action_calendar_timeslot"/>
        <field name="sequence" eval="1"/>
        <field name="view_mode">calendar</field>
        <field name="view_id" ref="calendar_bis_timeslot_calendar"/>
    </record>

    <record id="action_calendar_timeslot_tree" model="ir.actions.act_window.view">
        <field name="act_window_id" ref="action_calendar_timeslot"/>
        <field name="sequence" eval="2"/>
        <field name="view_mode">tree</field>
        <field name="view_id" ref="calendar_bis_timeslot_tree"/>
    </record>

    <record id="action_calendar_timeslot_form" model="ir.actions.act_window.view">
        <field name="act_window_id" ref="action_calendar_timeslot"/>
        <field name="sequence" eval="3"/>
        <field name="view_mode">form</field>
        <field name="view_id" ref="calendar_bis_timeslot_form"/>
    </record>
</odoo>
