<?xml version="1.0"?>
<openerp>
    <data>
	# ------------------------------------------------------
    # Meetings Categories
    # ------------------------------------------------------

    <record id="crm_meeting_categ_action" model="ir.actions.act_window">
        <field name="name">Meeting Categories</field>
        <field name="res_model">crm.case.categ</field>
        <field name="view_type">form</field>
        <field name="view_id"  ref="crm.crm_case_categ_tree-view"/>
		<field name="domain">[('object_id.model', '=', 'crm.meeting')]</field>
		<field name="context">{'object_id':'crm.meeting'}</field>
    </record>
     <menuitem action="crm_meeting_categ_action" id="menu_crm_case_meeting-act" parent="crm.menu_crm_case_categ"/>

    # ------------------------------------------------------
    # Meetings
    # ------------------------------------------------------

    <record model="ir.ui.view" id="crm_case_form_view_meet">
        <field name="name">CRM - Meetings Form</field>
        <field name="model">crm.meeting</field>
        <field name="type">form</field>
        <field name="arch" type="xml">
            <form string="Meetings Form">            	
            	<group col="6" colspan="4">
                    <field name="name" select="1" string="Summary"
            			colspan="4" />
                    <field name="location" />
            		<field name="date" string="Start Date" required="1" />
            		<field name="duration" widget="float_time" />
            		<field name="date_deadline" string="End Date" required="1" />
            		
            		<field name="categ_id"/>
                    <field name="alarm_id" string="Reminder" widget="selection" />
            		<group colspan="2" col="3" attrs="{'readonly':[('recurrent_uid','!=',False)]}">
                            <field name="rrule_type" string="Recurrency"
                            	on_change="onchange_rrule_type(rrule_type)"
                            	colspan="1" />
                            <button string="Custom"
            					name="%(caldav.action_calendar_custom_rrule_wizard)d"
            					icon="gtk-save-as" type="action" context="{'model' : 'crm.meeting'}"
                                attrs="{'readonly': [('rrule_type','!=','custom')]}"
                                />
                    </group>

            	</group>
            	<notebook colspan="4">
            		<page string="Description">
            			<separator string="Description" colspan="4" />
            			<field name="description" nolabel="1" colspan="4" />
            		</page>
            		<page string="Attendee Detail">
            			<button string="Invite People"
            				name="%(caldav.action_view_calendar_invite_attendee_wizard)d"
            				icon="terp-partner" type="action"
            				context="{'model' : 'crm.meeting', 'attendee_field':'attendee_ids'}" colspan="2"/>
            			<field name="attendee_ids" colspan="4"
            				nolabel="1" widget="one2many" mode="tree,form">
            				<tree string="Atendee details" editable="top">
            					<field name="email" />
            					<field name="role" select="1" />
            					<field name="state" />
            				</tree>
            				<form string="Atendee details">
            					<notebook colspan="4">
            						<page string="Details">
            							<field name="email" />
            							<field name="rsvp" select="1" />
            							<field name="cutype" select="1" />
            							<field name="role" select="1" />
            							<separator colspan="4" string="" />
            							<field name="state" />
            						</page>
            						<page string="Other">
            							<field name="user_id"/>
            							<field name="partner_address_id" select="1" />
            							<newline />
            						</page>
            					</notebook>
            				</form>
            			</field>
            		</page>
            		<page string="Other Information">
            			<field name="priority"/>
            			<field name="show_as"/>            			
            			<field name="class"/>
            			<field name="user_id"/>
                        <field name="section_id" widget="selection"
            			/>
            			<field name="vtimezone"/>
            			<field name="recurrent_id" invisible="1" />
            			<field name="recurrent_uid" invisible="1" />
            			<field name="rrule" invisible="1" />
            		</page>
            	</notebook>
            	<group col="3" colspan="4" attrs="{'invisible':[('rrule_type','in', ('none', False))]}">
            		<label string="" />
            		<button string="Modify this Occurrence"
            			name="%(base_calendar.wizard_edit_this_event)d" icon="gtk-save"
            			type="action" context="{'model' : 'crm.meeting', 'date': date, 'date_deadline': date_deadline}" />
            	</group>
            </form>
        </field>
    </record>

    <record model="ir.ui.view" id="crm_case_tree_view_meet">
        <field name="name">CRM - Meetings Tree</field>
        <field name="model">crm.meeting</field>
        <field name="type">tree</field>
        <field name="arch" type="xml">
            <tree string="Meetings Tree"  colors="red:state=='open';black:state in ('draft', 'cancel','done','pending')">
                <field name="id" widget="char"/>
                <field name="name" string="Title"/>
                <field name="date" string="Meeting Date"/>
                <field name="section_id" />
                <field name="priority"/>
                <field name="categ_id"/>
                <field name="user_id"/>
                <field name="state"/>
                <button name="case_open" string="Confirm Meeting" states="draft,cancel,pending" type="object" icon="terp-crm"/>
                <button name="case_cancel" string="Cancel Meeting" states="draft,open,pending" type="object" icon="gtk-cancel"/>
                <button name="case_reset" string="Reset to Unconfirmed" states="done,open,cancel" type="object" icon="gtk-convert"/>
            </tree>
        </field>
    </record>
    <record model="ir.ui.view" id="crm_case_calendar_view_meet">
        <field name="name">CRM - Meetings Calendar</field>
        <field name="model">crm.meeting</field>
        <field name="type">calendar</field>
        <field name="priority" eval="2"/>
        <field name="arch" type="xml">
            <calendar string="Meetings" date_start="date" color="user_id" date_delay="duration">
                <field name="name"/>
                <field name="partner_id"/>
                <field name="section_id" widget="selection"/>
            </calendar>
        </field>
    </record>

    <record id="crm_case_gantt_view_meet" model="ir.ui.view">
        <field name="name">CRM - Meetings Gantt</field>
        <field name="model">crm.meeting</field>
        <field name="type">gantt</field>
        <field name="arch" type="xml">
            <gantt color="user_id" date_delay="duration" date_start="date" string="Meetings">
               <level object="crm.meeting" link="id" domain="[]">
                   <field name="name"/>
                   <field name="partner_id"/>
                </level>
            </gantt>
        </field>
    </record>
    <record id="view_crm_case_meetings_filter" model="ir.ui.view">
        <field name="name">CRM - Meetings Search</field>
        <field name="model">crm.meeting</field>
        <field name="type">search</field>
        <field name="arch" type="xml">
            	<search string="Search Meetings">
               		<group col="12" colspan="4">
               			<filter icon="terp-crm" string="My Meetings" domain="[('user_id','=',uid)]" help="My Meetings"/>
	               		<filter icon="terp-crm" string="Current" domain="[('state','in',('draft', 'open'))]" default="1" help="Current Meetings"/>
	                    <filter icon="terp-crm" string="Confirmed" domain="[('state','=','done')]" help="Confirmed Meetings"/>
	               		<separator orientation="vertical"/>
	               		<field name="name" select="1" string="Subject"/>
	               		<field name="partner_id" select="1"/>
	               		<field name="section_id" default="context.get('section_id', False)" select="1" widget="selection">
							<filter icon="terp-crm"
                               domain="[('section_id','=',context.get('section_id',False))]"
                               help="My section"
                           />
						 </field>
	               		<field name="user_id" select="1" widget="selection"/>
	               	</group>
                </search>
        	</field>
    	</record>
	</data>
</openerp>
