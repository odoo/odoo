<?xml version="1.0" encoding="UTF-8"?>
<templates xml:space="preserve">
<t t-name="mail.ActivityViewHeader">
    <thead>
        <tr>
            <th></th>
            <th t-foreach="this.activeColumns" t-as="type" t-key="this.type.id"
                class="o_activity_type_cell p-3" t-attf-class="{{ this.activeFilter.activityTypeId === type.id ? 'o_activity_filter_' + this.activeFilter.progressValue.active : '' }}"
                t-attf-width="{{100/this.activeColumns.length}}%">
                <div>
                    <span t-esc="this.type.name"/>
                    <span t-if="this.type.template_ids.length > 0" class="dropdown float-end">
                        <i class="oi oi-ellipsis-v oi-fw" data-bs-toggle="dropdown"/>
                        <div class="dropdown-menu">
                            <t t-foreach="this.type.template_ids" t-as="template" t-key="this.template.id">
                                <div data-tooltip="This action will send an email."
                                     class="o_template_element o_send_mail_template cursor-pointer"
                                     t-on-click="() => this.props.onSendMailTemplate(template.id, type.id)">
                                    <i class="fa fa-envelope fa-fw"/> <t t-esc="this.template.name"/>
                                </div>
                            </t>
                        </div>
                    </span>
                </div>
                <div class="o_activity_counter d-flex align-items-center justify-content-between mb-3 h-0 mt24">
                    <t t-set="group" t-value="this.getGroupInfo(this.type)"/>
                    <ColumnProgress t-if="this.group.data.count" group="group.data" aggregate="group.aggregate" aggregateOn="group.aggregateOn" progressBar="group.data.progressBar" onBarClicked.bind="group.data.filterProgressValue" />
                </div>
            </th>
            <th class="align-middle" style="width: 32px; min-width: 32px">
                <div class="o_optional_columns_dropdown text-center border-top-0">
                    <Dropdown position="'bottom-end'">
                        <button class="btn p-0" tabindex="-1">
                            <i class="o_optional_columns_dropdown_toggle oi oi-fw oi-settings-adjust"/>
                        </button>

                        <t t-set-slot="content">
                            <t t-foreach="this.props.activityTypes" t-as="type" t-key="this.type_index">
                                <DropdownItem closingMode="'none'" onSelected="() => this.toggleDisplayColumn(type.id)">
                                    <CheckBox
                                        onChange="() => this.toggleDisplayColumn(type.id)"
                                        value="this.storageActiveColumns[type.id]"
                                        name="type.name"
                                    >
                                        <t t-esc="this.type.name"/>
                                    </CheckBox>
                                </DropdownItem>
                            </t>
                        </t>
                    </Dropdown>
                </div>
            </th>
        </tr>
    </thead>
</t>

<t t-name="mail.ActivityViewBody">
    <tbody>
        <t t-foreach="this.props.activityResIds" t-as="resId" t-key="this.resId">
            <t t-call="mail.ActivityViewRow"/>
        </t>
    </tbody>
</t>

<t t-name="mail.ActivityViewRow">
    <t t-set="record" t-value="this.getRecord(this.resId)"/>
    <t t-if="this.record">
        <tr class="o_data_row h-100" t-attf-class="{{ this.activeFilter.resIds.has(this.resId) ? 'o_activity_filter_' + this.activeFilter.progressValue.active : '' }}">
                <ActivityRecord archInfo="this.props.archInfo" record="record" openRecord="this.props.openRecord" />
                <t t-foreach="this.activeColumns" t-as="type" t-key="this.type.id">
                    <t t-call="mail.ActivityViewCell"/>
                </t>
            <td/>
        </tr>
    </t>
</t>

<t t-name="mail.ActivityViewCell">
    <t t-set="activityGroup" t-value="this.props.groupedActivities[this.resId] and this.props.groupedActivities[this.resId][this.type.id] or {count: 0, ids: [], state: false}"/>
    <t t-set="isCellHidden" t-value="!this.activeFilter.resIds.has(this.resId) and this.activeFilter.activityTypeId === this.type.id"/>
    <td t-if="this.activityGroup.state and !this.isCellHidden"
        t-attf-class="o_activity_summary_cell p-0 h-100 {{activityGroup.state}} {{ this.activeFilter.resIds.has(this.resId) ? 'o_activity_filter_' + this.activeFilter.progressValue.active : '' }}">
        <ActivityCell activityIds="activityGroup.ids" activityTypeId="this.type.id"
                      attachmentsInfo="activityGroup.attachments_info"
                      reportingDate="activityGroup.reporting_date"
                      countByState="activityGroup.count_by_state"
                      summaries="activityGroup.summaries"
                      reloadFunc="this.props.onReloadData"
                      resId="this.record.resId" resModel="this.record.resModel"
                      userAssignedIds="activityGroup.user_assigned_ids"
        />
    </td>
    <td t-else=""
        class="o_activity_summary_cell o_activity_empty_cell cursor-pointer"
        t-attf-class="{{ this.activeFilter.resIds.has(this.resId) ? 'o_activity_filter_' + this.activeFilter.progressValue.active : '' }}"
        t-on-click.prevent.stop="() => this.props.onEmptyCell(this.resId, this.type.id)">
        <i data-tooltip="Create" class="text-center fa fa-plus mt-2 align-items-center justify-content-center h-100"/>
    </td>
</t>

<t t-name="mail.ActivityViewFooter">
    <tfoot class="o_activity_view_table_footer">
        <tr class="o_data_row">
            <td class="p-3" colspan="100">
                <span class="btn btn-link o_record_selector cursor-pointer"
                      t-on-click.prevent.stop="this.props.scheduleActivity">
                    <i class="fa fa-plus pe-2"/> Schedule activity
                </span>
            </td>
        </tr>
    </tfoot>
</t>

<div t-name="mail.ActivityRenderer" class="o_activity_view h-100">
    <t t-if="!this.props.activityTypes.length" t-call="web.NoContentHelper"/>
    <table t-else="" class="table table-bordered mb-5 bg-view o_activity_view_table"
        t-attf-style="max-width: {{this.activeColumns.length &gt; 4 ? 100 : 20 * (this.activeColumns.length + 1) }}%; min-width: 600px;">
        <t t-call="mail.ActivityViewHeader"/>
        <t t-call="mail.ActivityViewBody"/>
        <t t-call="mail.ActivityViewFooter"/>
    </table>
</div>

</templates>
