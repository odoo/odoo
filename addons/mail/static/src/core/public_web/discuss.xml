<?xml version="1.0" encoding="UTF-8" ?>
<templates xml:space="preserve">

<t t-name="mail.Discuss">
    <t t-set="partitionedActions" t-value="threadActions.partition"/>
    <div class="o-mail-Discuss d-flex h-100 flex-grow-1" t-att-class="{ 'flex-column align-items-center': ui.isSmall }" t-att-data-active="store.discuss.isActive" t-ref="root">
        <div t-if="!(ui.isSmall and store.discuss.activeTab !== 'main')" class="o-mail-Discuss-content d-flex flex-column h-100 w-100 overflow-auto o-scrollbar-thin position-relative" t-ref="content">
            <div class="o-mail-Discuss-header mt-2 px-2 d-flex flex-shrink-0 align-items-start flex-grow-0 bg-transparent position-absolute top-0 w-100 pe-none" t-ref="header">
                <t t-if="thread">
                    <div class="ms-1 flex-grow-1"/>
                    <div class="o-mail-Discuss-headerThreadContainer d-flex align-items-center flex-grow-1 rounded-pill border border-secondary o-mail-DiscussPanel-bgColor o-shadow-soft ps-3 pe-2 o-py-0_5 mt-1 pe-auto position-absolute top-0" t-att-class="{ 'o-mobile start-0': ui.isSmall, 'end-50': !ui.isSmall }">
                        <div t-if="['channel', 'group', 'chat'].includes(thread.channel_type)" class="o-mail-Discuss-threadAvatar position-relative align-self-center align-items-center m-1 bg-inherit shadow-sm">
                            <img class="o-rounded-bubble o_object_fit_cover" t-att-src="thread.parent_channel_id?.avatarUrl ?? thread.avatarUrl" alt="Thread Image"/>
                            <FileUploader t-if="!thread.parent_channel_id and thread.is_editable and thread.channel_type !== 'chat'" acceptedFileExtensions="'.bmp, .jpg, .jpeg, .png, .svg'" showUploadingText="false" multiUpload="false" onUploaded.bind="(data) => this.onFileUploaded(data)">
                                <t t-set-slot="toggler">
                                    <a href="#" class="position-absolute z-1 h-100 w-100 rounded-3 start-0 bottom-0" title="Upload Avatar">
                                        <i class="position-absolute top-50 start-50 fa fa-sm fa-pencil text-white"/>
                                    </a>
                                </t>
                            </FileUploader>
                            <ImStatus t-if="thread.channel_type === 'chat' and thread.correspondent" className="'o-mail-Discuss-headerImStatus position-absolute bg-white'" member="thread.correspondent"/>
                        </div>
                        <t t-else="">
                            <ThreadIcon className="'mx-2 align-self-center fs-2 my-2 opacity-75'" size="'large'" thread="thread"/>
                        </t>
                        <CountryFlag t-if="thread.showCorrespondentCountry" country="thread.correspondentCountry" class="'o-mail-Discuss-headerCountry border shadow-sm'"/>
                        <div class="d-flex flex-column flex-grow-1 align-self-center align-items-start h-100 py-1">
                            <div t-if="thread.parent_channel_id" class="d-flex align-items-center gap-1 ms-1">
                                <span class="fw-bolder cursor-pointer opacity-75 opacity-100-hover o-hover-text-underline" t-esc="thread.parent_channel_id.displayName" t-on-click="() => this.thread.parent_channel_id.open({ focus: true })"/>
                                <i class="oi oi-chevron-right o-xsmaller mx-1"/>
                            </div>
                            <AutoresizeInput
                                className="'o-mail-Discuss-threadName fw-bolder flex-shrink-1 text-dark py-0 fs-2'"
                                enabled="thread.is_editable or thread.channel_type === 'chat'"
                                onValidate.bind="renameThread"
                                value="thread.displayName"
                            />
                            <t t-if="thread.allowDescription and (thread.is_editable or (!thread.is_editable and thread.description))">
                                <t t-set="autogrowDescriptionPlaceholder">Add a description</t>
                                <AutoresizeInput
                                    className="'o-mail-Discuss-threadDescription flex-shrink-1 text-muted small lh-1'"
                                    enabled="thread.is_editable"
                                    onValidate.bind="updateThreadDescription"
                                    placeholder="thread.is_editable ? autogrowDescriptionPlaceholder : ''"
                                    value="thread.description or ''"
                                />
                            </t>
                        </div>
                    </div>
                    <div class="ms-1 flex-grow-1"/>
                    <div class="mt-1 pe-auto">
                        <t t-call="mail.DiscussActions">
                            <t t-set="inline" t-value="true"/>
                            <t t-set="quick" t-value="partitionedActions.quick"/>
                            <t t-set="group" t-value="partitionedActions.group"/>
                            <t t-set="other" t-value="partitionedActions.other"/>
                        </t>
                    </div>
                    <div t-if="store.inPublicPage and !ui.isSmall" class="d-flex align-items-center pe-auto">
                        <img class="o-mail-Discuss-selfAvatar ms-3 me-1 rounded-3 o_object_fit_cover flex-shrink-0 smaller" alt="Avatar" t-att-src="store.self.avatarUrl"/>
                        <div class="fw-bold flex-shrink-1 text-dark">
                            <t t-if="store.self.type === 'partner'" t-esc="store.self.name"/>
                            <t t-else="">
                                <AutoresizeInput
                                    className="'py-1'"
                                    onValidate.bind="renameGuest"
                                    value="store.self.name"
                                />
                            </t>
                        </div>
                    </div>
                </t>
            </div>
            <div class="o-mail-Discuss-main d-flex overflow-hidden flex-grow-1" t-ref="main">
                <t t-if="ui.isSmall" t-call="mail.Discuss.loading"/>
                <div class="o-mail-Discuss-core overflow-auto o-scrollbar-thin d-flex flex-grow-1 w-100 mt-3" t-ref="core">
                    <DiscussSidebar t-if="!ui.isSmall and props.hasSidebar"/>
                    <t name="core-content">
                        <t t-if="thread">
                            <div class="o-mail-Discuss-threadContainer d-flex flex-column flex-grow-1 bg-inherit">
                                <t name="thread"><Thread thread="thread" t-key="thread.localId" jumpPresent="state.jumpThreadPresent" paddingCompensation="threadPaddingCompensation.asContributee"/></t>
                                <Composer t-if="thread.model !== 'mail.box' or thread.composer.replyToMessage" t-key="thread.localId" composer="thread.composer" autofocus="true" onDiscardCallback="() => (thread.composer.replyToMessage = undefined)" onPostCallback.bind="() => this.state.jumpThreadPresent++" dropzoneRef="contentRef" type="thread.composer.replyToMessage ? (thread.composer.replyToMessage.isNote ? 'note' : 'message') : undefined" paddingCompensation="threadPaddingCompensation.asBottomContributor"/>
                            </div>
                            <div t-if="threadActions.activeAction?.componentCondition" t-attf-class="{{ threadActions.activeAction.panelOuterClass }}" class="o-mail-Discuss-panelContainer o-mail-DiscussPanel-bgColor mx-2 mt-0 mb-3 ms-0 border border-secondary o-shadow-soft flex-shrink-0 rounded-4">
                                <t t-component="threadActions.activeAction.component" thread="thread" t-props="threadActions.activeAction.componentProps"/>
                            </div>
                        </t>
                        <div t-elif="(!ui.isSmall or store.discuss.activeTab === 'main') and store.discuss.hasRestoredThread" class="d-flex flex-grow-1 align-items-center justify-content-center w-100">
                            <h4 class="text-muted"><b><i>No conversation selected.</i></b></h4>
                        </div>
                    </t>
                </div>
            </div>
        </div>
        <MessagingMenu t-if="ui.isSmall"/>
    </div>
</t>

<t t-name="mail.MobileMailbox">
    <button class="btn btn-secondary flex-grow-1 p-2"
        t-att-class="{
            'active o-active shadow-none': mailbox.eq(store.discuss.thread),
        }" t-on-click="mailbox.setAsDiscussThread" t-esc="mailbox.display_name"
    />
</t>

<t t-name="mail.Discuss.loading">
    <div t-if="store.channels.status === 'fetching'" class="d-flex flex-grow-1 align-items-center justify-content-center h-100 w-100 o-pointer-events-none">
        <h4 class="text-muted opacity-50 o-visible-short-delay"><b><i class="o-mail-Discuss-mobileLoading fa fa-circle-o-notch fa-spin"/></b></h4>
    </div>
</t>

</templates>
