<?xml version="1.0" encoding="UTF-8" ?>
<templates xml:space="preserve">

<t t-name="mail.DiscussContent">
    <t t-set="partitionedActions" t-value="this.threadActions.partition"/>
    <div class="o-mail-DiscussContent d-flex flex-column h-100 w-100 overflow-auto o-scrollbar-thin" t-ref="root">
        <div class="o-mail-DiscussContent-header ps-3 d-flex flex-shrink-0 align-items-center border-bottom border-dark o-border-opacity-15 gap-1 z-1 flex-grow-0" t-ref="header" t-att-class="{ 'py-1': !this.state.correspondentLocalDateTimeFormatted }">
            <t t-if="this.thread">
                <div t-if="this.showThreadAvatar" class="o-mail-DiscussContent-threadAvatar position-relative align-self-center align-items-center bg-inherit">
                    <DiscussAvatar thread="this.thread" size="26"/>
                    <FileUploader t-if="this.isThreadAvatarEditable" acceptedFileExtensions="'.bmp, .jpg, .jpeg, .png, .svg'" showUploadingText="false" multiUpload="false" onUploaded.bind="(data) => this.onFileUploaded(data)">
                        <t t-set-slot="toggler">
                            <a href="#" class="position-absolute z-1 h-100 w-100 rounded-2 start-0 bottom-0" title="Upload Avatar">
                                <i class="position-absolute top-50 start-50 fa fa-sm fa-pencil text-white"/>
                            </a>
                        </t>
                    </FileUploader>
                </div>
                <t t-else="">
                    <ThreadIcon className="'align-self-center fs-3 my-2 opacity-75'" size="'large'" thread="this.thread"/>
                </t>
                <div class="flex-grow-1 align-self-center align-items-center h-100 py-1" t-att-class="{ 'lh-sm': this.showsChatLocalDateTime }">
                    <div class="d-flex">
                        <div t-if="this.thread.channel?.parent_channel_id" class="d-flex align-items-center gap-1 ms-1">
                            <span class="fw-bolder cursor-pointer opacity-75 opacity-100-hover o-hover-text-underline" t-esc="this.thread.channel.parent_channel_id.displayName" t-on-click="() => this.thread?.channel?.parent_channel_id?.open({ focus: true })"/>
                            <i class="oi oi-chevron-right o-xsmaller mx-1"/>
                        </div>
                        <AutoresizeInput
                            className="'o-mail-DiscussContent-threadName fw-bold flex-shrink-1 py-0 ' + (this.showsChatLocalDateTime ? 'fs-5' : 'fs-4')"
                            enabled="this.thread.channel?.isAllowedToRename"
                            onValidate.bind="this.renameThread"
                            value="this.thread.displayName || ''"
                        />
                        <t t-if="this.thread.channel?.allowDescription and (this.thread.is_editable or (!this.thread.is_editable and this.thread.description))">
                            <div class="flex-shrink-0 mx-1 py-2 border-start"/>
                            <t t-set="autogrowDescriptionPlaceholder">Add a description</t>
                            <AutoresizeInput
                                className="this.attClassObjectToString(this.threadDescriptionAttClass)"
                                enabled="this.thread.is_editable"
                                onValidate.bind="this.updateThreadDescription"
                                placeholder="this.thread.is_editable ? autogrowDescriptionPlaceholder : ''"
                                value="this.thread.description or ''"
                            />
                        </t>
                    </div>
                    <div t-if="this.showsChatLocalDateTime" class="text-muted smaller ms-1" t-out="this.state.correspondentLocalDateTimeFormatted"/>
                </div>
                <div class="pe-3">
                    <ActionList actions="[partitionedActions.quick, partitionedActions.other, ...partitionedActions.group.slice().reverse()]" inline="true" odooControlPanelSwitchStyle="true"/>
                </div>
                <div t-if="this.store.inPublicPage and !this.ui.isSmall" class="d-flex align-items-center">
                    <img class="o-mail-DiscussContent-selfAvatar ms-3 me-1 rounded-3 object-fit-cover flex-shrink-0 smaller" alt="Avatar" t-att-src="this.store.self.avatarUrl"/>
                    <div class="fw-bold flex-shrink-1 text-dark">
                        <t t-if="this.store.self_user" t-esc="this.store.self_user.name"/>
                        <t t-else="">
                            <AutoresizeInput
                                className="'py-1'"
                                onValidate.bind="this.renameGuest"
                                value="this.store.self_guest.name"
                            />
                        </t>
                    </div>
                </div>
            </t>
        </div>
        <div class="o-mail-DiscussContent-main d-flex overflow-hidden flex-grow-1" t-ref="main">
            <t t-if="this.ui.isSmall" t-call="mail.Discuss.loading"/>
            <div class="o-mail-DiscussContent-core overflow-auto o-scrollbar-thin d-flex flex-grow-1 w-100" t-ref="core">
                <t name="core-content">
                    <t t-if="this.thread">
                        <div t-if="!this.ui.isSmall or !this.threadActions.activeAction?.actionPanelComponentCondition" class="d-flex flex-column flex-grow-1 bg-inherit">
                            <t name="thread"><Thread thread="this.thread" t-key="this.thread.localId" jumpPresent="this.state.jumpThreadPresent"/></t>
                            <Composer t-if="this.thread.model !== 'mail.box' or this.thread.composer.replyToMessage" t-key="this.thread.localId" composer="this.thread.composer" autofocus="true" onDiscardCallback="() => (this.thread.composer.replyToMessage = undefined)" onPostCallback.bind="() => this.state.jumpThreadPresent++" dropzoneRef="this.root" type="this.thread.composer.replyToMessage ? (this.thread.composer.replyToMessage.isNote ? 'note' : 'message') : undefined"/>
                        </div>
                        <div t-if="this.threadActions.activeAction?.actionPanelComponentCondition" t-attf-class="{{ this.threadActions.activeAction.actionPanelOuterClass }}" class="o-mail-DiscussContent-panelContainer o-mail-discussSidebarBgColor h-100 border-start border-dark o-border-opacity-15 flex-shrink-0" t-att-class="{ 'w-100': this.ui.isSmall }">
                            <t t-component="this.threadActions.activeAction.actionPanelComponent" t-props="this.threadActions.activeAction.actionPanelComponentProps"/>
                        </div>
                    </t>
                    <div t-elif="(!this.ui.isSmall or this.store.discuss.activeTab === 'notification') and this.store.discuss.hasRestoredThread" class="d-flex flex-grow-1 align-items-center justify-content-center w-100">
                        <h4 class="text-muted"><b><i>No conversation selected.</i></b></h4>
                    </div>
                </t>
            </div>
        </div>
    </div>
</t>

</templates>
