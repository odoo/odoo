.o-mail-Composer {
    grid-template-areas:
        "sidebar-header core-header"
        "sidebar-main core-main"
        "sidebar-footer core-footer";
    grid-template-columns: auto 1fr;
    grid-template-rows: auto 1fr auto;

    &.o-floating {
        --border-opacity: 0;
        z-index: $o-mail-NavigableList-zIndex - 1;
    }

    &.o-hasSelfAvatar {
        grid-template-columns: $o-mail-Message-sidebarWidth 1fr;
    }

    .o-mail-Composer-sidebarMain {
        &.o-extended {
            padding-top: 0.3125rem; // avatar centered with composer text input: 32px (avatar) + 2*5px (this value) = 20px + 2 * { 10px (padding) + 1px (border) }
        }
        &:not(.o-extended) {
            padding-top: 0.125rem; // avatar centered with composer text input: 32px (avatar) + 2*2px (this value) = 20px + 2 * { 7px (padding) + 1px (border) }
        }
        width: $o-mail-Message-sidebarWidth;
    }

    .o-mail-Composer-coreHeader {
        grid-area: core-header;
    }

    .o-mail-Composer-coreMain {
        grid-area: core-main;
    }

    .o-mail-Composer-sidebarMain {
        grid-area: sidebar-main;
    }

    .o-mail-Composer-footer {
        grid-area: core-footer;
    }

    &.o-extended .o-mail-Composer-mainActions {
        margin-top: map-get($spacers, 1);
    }

    &:not(.o-extended) .o-mail-Composer-mainActions {
        margin-top: map-get($spacers, 1) / 4;
    }

    &:not(.o-focused) {
        .o-mail-Composer-input::placeholder {
            opacity: 50%;
        }

        .o-mail-Composer-actions button:not(:hover):not(.o-active):not(.show) {
            opacity: 25%;
        }
    }
}

.o-mail-Composer-actions {

    button {
        &.o-small {
            margin: 0 !important;
            padding: map-get($spacers, 1) !important;
        }
        &.o-large {
            margin: 0 !important;
            padding: map-get($spacers, 2) !important;
        }
        &:disabled {
            opacity: 25% !important;
        }
        &:enabled {
            opacity: 35%;
        }
        .o-mail-Composer.o-focused & {
            opacity: 50%;
        }
        &[name='more-actions'] {
            opacity: 25%;
            .o-mail-Composer.o-focused & {
                opacity: 40%;
            }
        }
        &.rounded-circle {
            aspect-ratio: 1;
        }
        &.o-sendMessageActive {
            background-color: saturate(rgba($o-action, .65), 100);
            opacity: 100% !important;
            outline: 1px solid saturate(rgba($o-action, .75), 100);
            &:focus-visible {
                outline: darken($o-action, 15%) solid 1px;
            }
        }
        i.fa-paper-plane-o {
            transform: translate(-1px);
            scale: .85;
        }
        &:hover, &:focus {
            opacity: 100% !important;
            color: var(--mail-Composer-actionHoverColor, black);
            backdrop-filter: invert(.025);
        }
        &:disabled {
            --btn-active-color: var(--btn-disabled-color);
            --btn-hover-color: var(--btn-disabled-color);
            opacity: 25%;
        }
        &.o-mail-Composer-send.btn-link:not(:disabled) {
            background-color: rgba($o-action, .75);
            opacity: 100% !important;
            &:focus-visible {
                outline: darken($o-action, 15%) solid 1px;
            }
            i.fa-paper-plane-o {
                color: #FFF;
                transform: translate(-1px);
                scale: .85;
            }
        }
        &.rounded-circle {
            aspect-ratio: 1;
        }
    }
}

.o-mail-Composer-inputStyle {
    padding-top: 10px; // carefully crafted to have the text in the middle in chat window
    padding-bottom: 10px;
    padding-left: map-get($spacers, 1);
    padding-right: map-get($spacers, 1);
    background-color: transparent !important;

    line-height: 1.42857143 !important; // so that input is rounded to 20px = 14px (base font) * 1.42857143 (line-height)

    .o-mail-Composer.o-editing & {
        padding-left: map-get($spacers, 2);
        padding-right: map-get($spacers, 2);
    }

    .o-mail-Composer.o-extended & {
        padding-left: map-get($spacers, 2) + map-get($spacers, 1);
        padding-right: map-get($spacers, 2);
    }

    .o-mail-Composer:not(.o-extended) & {
        padding-top: 7px;
        padding-bottom: 7px;
        padding-left: map-get($spacers, 1) / 2;
        padding-right: map-get($spacers, 1) / 2;
    }

    .o-mail-Composer.o-isUiSmall & {
        padding-top: 10px;
        padding-bottom: 10px;
    }
}

.o-mail-Composer-input {
    max-height: Min(400px, 60vh);
    resize: none;

    .o-mail-Composer.o-chatWindow & {
        @media (min-height: 325px) {
            max-height: Min(350px, 70vh);
        }
    }
    .o-mail-Composer.o-chatWindowBig & {
        @media (min-height: 325px) {
            max-height: Min(550px, 70vh);
        }
    }

    .o-mail-Composer.o-discussApp & {
        @media (min-height: 425px) {
            max-height: 50vh;
        }
    }

    .o-mail-Composer.o-extended & {
        max-height: Min(400px, 30vh);
    }

    &::placeholder {
        opacity: 40%;

        .o-mail-Composer.o-focused & {
            opacity: 75%;
        }
        @include text-truncate();
    }
}

.o-mail-Composer-avatar {
    --Avatar-size: #{$o-mail-Avatar-size};
}

.o-mail-Composer-fake {
    height: 0;
    left: -10000px;
    top: -10000px;
    visibility: hidden;
}

@function o-mail-Composer-inputContainerBackdropFilterUnfocused() {
    @return blur(3.5px) contrast(1.15);
}

@mixin o-mail-Composer-inputContainerMixin() {
    --border-opacity: .75;
    background-color: mail-DiscussPanel-bgColor(.25);
    backdrop-filter: o-mail-Composer-inputContainerBackdropFilterUnfocused() !important;

    &.o-focused {
        background-color: mail-DiscussPanel-bgColor(.75);
        backdrop-filter: blur(4px)!important;
    }

    &:not(.o-focused) .o-mail-Composer-input {
        color: rgba($body-color, .25) !important;
    }

    &.o-iosPwa:not(:focus-within) {
        margin-bottom: map-get($spacers, 3) !important;
    }

    &:has(textarea:focus) {
        outline: 3px solid rgba($o-action, .15);
        outline-offset: -1px;
        // --border-opacity: .25;
        // border-color: rgba($o-action, var(--border-opacity)) !important;
    }
}

.o-mail-Composer-inputContainer {
    @include o-mail-Composer-inputContainerMixin;
}

.o-mail-Composer-pickerContainer.o-active {
    height: 50vh;
}
