<?xml version="1.0" encoding="UTF-8" ?>
<templates xml:space="preserve">

<t t-name="mail.ChatHub">
    <div class="o-mail-ChatHub d-print-none" t-att-class="{'o-dragged': this.position.dragged}" t-ref="root">
        <t t-set="visibleChatWindows" t-value="this.chatHub.compact ? this.chatHub.opened.filter(({ bypassCompact }) => bypassCompact) : this.chatHub.opened "/>
        <t t-foreach="this.visibleChatWindows" t-as="cw" t-key="this.cw.localId">
            <ChatWindow chatWindow="cw" t-if="this.cw.canShow" right="this.chatHub.BUBBLE_START + this.chatHub.BUBBLE + (this.chatHub.BUBBLE_OUTER*2) + (visibleChatWindows.length - cw_index - 1) * (this.chatHub.WINDOW + this.chatHub.WINDOW_INBETWEEN * 2)"/>
        </t>
        <div class="o-mail-ChatHub-bubbles position-fixed d-flex flex-column align-content-start justify-content-end align-items-center" t-attf-style="top: {{this.position.top}}; left: {{this.position.left}}; right: {{this.position.right}}; --mail-ChatHub-bubbles-bottom: {{this.position.bottom}}" t-att-class="{ 'o-liftUp': this.busMonitoring.hasConnectionIssues, 'o-mobile': this.isMobileOS }" t-ref="bubbles">
            <div class="d-flex flex-column align-content-start justify-content-end align-items-center o-gap-1_5">
                <Dropdown t-if="this.optionActions.length" state="this.options" position="'top-end'" menuClass="'m-0 mb-1 ' + this.store.discussDropdownMenuClass(this)">
                    <button class="o-mail-ChatHub-bubbleBtn btn o-mail-ChatHub-optionsBtn bg-100 mt-1" t-att-class="{ 'opacity-0': !this.bubblesHover.isHover and !this.position.dragged and !this.options.isOpen and !this.isMobileOS, 'o-bubblesHover': (this.bubblesHover.isHover or this.position.dragged) and !this.isMobileOS, 'o-active': this.bubblesHover.isHover or this.options.isOpen }" title="Chat Options"><i class="oi oi-ellipsis-h"/></button>
                    <t t-set-slot="content">
                        <ActionList actions="this.optionActions" dropdown="true"/>
                    </t>
                </Dropdown>
                <t t-if="this.store.chatHub.compact and this.chatHub.showConversations" t-call="mail.ChatHub.compactButton"/>
                <t t-else="">
                    <t t-foreach="this.chatHub.folded.slice(0, this.chatHub.maxFolded)" t-as="cw" t-key="this.cw.localId">
                        <ChatBubble t-if="this.cw.canShow" chatWindow="cw"/>
                    </t>
                    <t name="extra-actions"/>
                    <t t-if="this.chatHub.showConversations and this.chatHub.folded.length > this.chatHub.maxFolded" t-call="mail.ChatHub.hiddenButton"/>
                </t>
            </div>
        </div>
    </div>
</t>

<t t-name="mail.ChatHub.compactButton">
    <!-- In dropdown to keep same layout as other items-->
    <Dropdown manual="true">
        <div class="o-mail-ChatHub-bubbleBtn o-mail-ChatHub-compact o-mail-ChatBubble justify-content-center">
            <div t-if="this.compactCounter > 0" class="o-mail-ChatHub-hiddenBtnCounter position-absolute badge rounded-pill fw-bold o-discuss-badge shadow">
                <t t-out="this.compactCounter"/>
            </div>
            <button class="o-mail-ChatHub-bubbleBtn btn fs-2 shadow" t-on-click="this.expand">
                <i class="o-mail-ChatHub-hiddenBtnIcon d-flex justify-content-center align-items-center btn rounded-circle shadow-sm fa fa-comments"/>
            </button>
        </div>
    </Dropdown>
</t>

<t t-name="mail.ChatHub.hiddenButton">
    <Dropdown t-if="this.chatHub.folded.length > this.chatHub.maxFolded" state="this.more" position="'left-middle'" menuClass="'o-mail-ChatHub-hiddenMenu mx-1 my-0 bg-100 ' + this.store.discussDropdownMenuClass(this)" manual="true">
        <div class="o-mail-ChatBubble o-mail-ChatHub-hiddenBtn justify-content-center" t-att-class="{ 'o-active': this.more.isOpen }" t-on-click="() => this.store.chatHub.compact = true" t-ref="more-button">
            <div t-if="this.hiddenCounter > 0" class="o-mail-ChatHub-hiddenBtnCounter position-absolute badge rounded-pill fw-bold o-discuss-badge shadow">
                <t t-out="this.hiddenCounter"/>
            </div>
            <button class="o-mail-ChatHub-bubbleBtn btn outline-0 shadow">
                <span class="o-mail-ChatHub-hiddenBtnIcon d-flex justify-content-center align-items-center btn rounded-circle shadow-sm fs-2" t-att-class="{ 'o-active': this.more.isOpen }">+<t t-esc="this.chatHub.folded.slice(this.chatHub.maxFolded).length"/></span>
            </button>
        </div>
        <t t-set-slot="content">
            <ul class="m-0 p-0 overflow-auto o-scrollbar-thin bg-100" role="menu" t-ref="more-menu">
                <t t-foreach="this.chatHub.folded.slice(this.chatHub.maxFolded)" t-as="chatWindow" t-key="this.chatWindow.localId">
                    <li class="o-mail-ChatHub-hiddenItem gap-2 px-2 py-1" role="menuitem" t-att-name="chatWindow.channel.displayName" t-on-click="() => chatWindow.open({ focus: true })">
                        <img class="o-mail-ChatHub-hiddenAvatar rounded-circle object-fit-cover" t-att-src="chatWindow.channel.avatarUrl" alt="Channel image" draggable="false"/>
                        <p class="text-truncate fw-bold mb-0" t-esc="this.chatWindow.channel.displayName"/>
                        <div t-if="this.chatWindow.channel.importantCounter > 0" class="o-mail-ChatHub-hiddenCounter badge rounded-pill fw-bold o-discuss-badge" style="padding: 3px 6px">
                            <t t-out="this.chatWindow.channel.importantCounter"/>
                        </div>
                        <button class="o-mail-ChatHub-hiddenClose o-mail-ChatBubble-close d-flex align-items-center rounded" t-on-click.stop="() => chatWindow.close()">
                            <i class="oi oi-close"/>
                        </button>
                    </li>
                </t>
            </ul>
        </t>
    </Dropdown>
</t>

</templates>
