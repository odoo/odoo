<?xml version="1.0" encoding="UTF-8" ?>
<templates xml:space="preserve">

<t t-name="mail.messaging_menu" owl="1">
    <Dropdown beforeOpen.bind="loadPreviews" position="'bottom-end'" menuClass="'p-0'">
        <t t-set-slot="toggler">
            <i class="fa fa-lg fa-comments" role="img" aria-label="Messages"></i>
            <span class="badge"><t t-esc="messaging.state.menu.counter"/></span>
        </t>
        <t t-set-slot="default">
            <div class="o-mail-messaging-menu">
                <div class="o-mail-messaging-menu-topbar border-bottom d-flex flex-shrink-0" t-on-click="activateTab">
                    <button class="btn btn-link" t-att-class="state.filter === 'all' ? 'fw-bolder' : 'text-500'" type="button" role="tab" data-tab-id="all">All</button>
                    <button class="btn btn-link" t-att-class="state.filter === 'chats' ? 'fw-bolder' : 'text-500'" type="button" role="tab" data-tab-id="chats">Chats</button>
                    <button class="btn btn-link" t-att-class="state.filter === 'channels' ? 'fw-bolder' : 'text-500'" type="button" role="tab" data-tab-id="channels">Channels</button>
                </div>
                <div class="d-flex flex-column overflow-auto">
                    <div class="d-flex justify-content-center py-4 px-2 text-muted" t-if="displayedPreviews.length === 0">
                        No conversation yet...
                    </div>
                    <t t-else="" t-foreach="displayedPreviews" t-as="preview" t-key="preview.id">
                        <t t-call="mail.messaging_menu.preview">
                            <t t-set="isLastItem" t-value="preview_last"/>
                        </t>
                    </t>
                </div>
            </div>
        </t>
    </Dropdown>
</t>

<t t-name="mail.messaging_menu.preview" owl="1">
    <t t-set="thread" t-value="messaging.state.threads[preview.id]"/>
    <div class="o-mail-notification-item d-flex cursor-pointer align-items-center" t-att-class="{ 'border-bottom': !isLastItem }" t-on-click="() => this.openDiscussion(thread.id)">
        <div class="position-relative o-mail-background-inherit m-1" style="width:40px;height:40px;">
            <img class="w-100 h-100 rounded-circle" alt="Thread Image" t-att-src="thread.imgUrl" />
            <PartnerImStatus t-if="thread.type === 'chat'" className="'position-absolute bottom-0 end-0'" partner="messaging.state.partners[thread.chatPartnerId]"/>
        </div>
        <div class="d-flex flex-column flex-grow-1 align-self-start m-2 overflow-auto">
            <div class="d-flex">
                <span class="fw-bold text-600 text-truncate"><t t-esc="thread.name"/></span>
                <span class="flex-grow-1"/>
                <small class="text-muted opacity-50 ms-2">
                    <RelativeTime datetime="preview.last_message.date" />
                </small>

            </div>
            <div class="text-truncate">
                <t t-if="isAuthor(preview)">
                    <i class="fa fa-mail-reply me-1"/>You
                </t>
                <t t-else="">
                    <t t-esc="getPreviewAuthor(preview.last_message.author.id)"/>: 
                </t>:
                <t t-esc="preview.last_message.body"/>
            </div>
        </div>
    </div>
</t>

</templates>
