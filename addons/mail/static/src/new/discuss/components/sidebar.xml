<?xml version="1.0" encoding="UTF-8" ?>
<templates xml:space="preserve">

<t t-name="mail.discuss_sidebar" owl="1">
    <div class="o-mail-discuss-sidebar d-flex flex-column overflow-auto flex-shrink-0 h-100 pt-3 border-end bg-light">
        <div class="d-flex justify-content-center">
            <button class="btn btn-primary rounded" title="Start a meeting">
                Start a meeting
            </button>
        </div>
        <hr class="w-100 border-top"/>
        <div class="d-flex flex-column flex-grow-0">
            <t t-call="mail.discuss_mailbox">
                <t t-set="mailbox" t-value="messaging.state.discuss.inbox" />
            </t>
            <t t-call="mail.discuss_mailbox">
                <t t-set="mailbox" t-value="messaging.state.discuss.starred" />
            </t>
            <t t-call="mail.discuss_mailbox">
                <t t-set="mailbox" t-value="messaging.state.discuss.history" />
            </t>
        </div>
        <hr class="w-100 border-top"/>
        <t t-call="mail.discuss_category">
            <t t-set="category" t-value="messaging.state.discuss.channels" />
        </t>
        <t t-call="mail.discuss_category">
            <t t-set="category" t-value="messaging.state.discuss.chats" />
        </t>
    </div>
</t>

<t t-name="mail.discuss_mailbox" owl="1">
    <button class="btn d-flex align-items-center py-1 px-0 border-0 rounded-0 fw-normal text-dark"
        t-att-class="{
            'bg-100': mailbox.id !== messaging.state.discuss.threadId,
            'o-active bg-200': mailbox.id === messaging.state.discuss.threadId,
            'o-starred-box': mailbox.id === 'starred',
        }"
        t-on-click="() => this.openThread(mailbox.id)"
    >
        <ThreadIcon className="'ms-4 me-2'" thread="mailbox"/>
        <div class="me-2 text-truncate">
            <t t-esc="mailbox.name"/>
        </div>
        <div t-attf-class="flex-grow-1 {{ mailbox.counter === 0 ? 'me-3': '' }}"/>
        <t t-if="mailbox.counter > 0">
            <div t-attf-class="badge rounded-pill {{ mailbox.id === 'starred' ? 'bg-400 text-light' : 'text-bg-primary' }} ms-1 me-3">
                <t t-esc="mailbox.counter"/>
            </div>
        </t>
    </button>
</t>

<t t-name="mail.discuss_category" owl="1">
    <t t-set="hover_class" t-value="'btn p-0 text-start text-700 opacity-100-hover opacity-75'"/>
    <div class="o-mail-category d-flex align-items-center my-1" t-att-class="category.extraClass">
        <div t-attf-class="d-flex align-items-baseline mx-1 {{ hover_class }}" t-on-click="() => this.toggleCategory(category)">
            <i class="o-mail-category-icon small" t-att-class="category.isOpen ? 'fa fa-chevron-down' : 'fa fa-chevron-right'"/>
            <span class="btn-sm p-0 text-uppercase fw-bolder"><t t-esc="category.name"/></span>
        </div>
        <div class="flex-grow-1"/>
        <div class="d-flex me-3">
            <t t-if="category.canView">
                <i t-attf-class="fa fa-cog {{ hover_class }}" title="View or join channels" t-on-click="() => this.openCategory(category)" role="img"/>
            </t>
            <t t-if="category.canAdd and category.isOpen">
                <i class="o-mail-category-add-button" t-attf-class="fa fa-plus {{ hover_class }} ms-1" t-on-click="() => this.addToCategory(category)" t-att-title="category.addTitle" role="img"/>
            </t>
        </div>
        <t t-if="!category.isOpen and category.counter > 0">
            <div class="badge rounded-pill text-bg-primary me-3">
                <t t-esc="category.counter"/>
            </div>
        </t>
    </div>
    <t t-if="category.isOpen">
        <t t-if="state.editing === category.id">
            <div class="mb-2" t-ref="selector">
                <ChannelSelector category="category" onSelect.bind="stopEditing" />
            </div>
        </t>
        <t t-foreach="category.threads" t-as="threadId" t-key="threadId">
            <t t-call="mail.discuss_category_item">
                <t t-set="thread" t-value="messaging.state.threads[threadId]"/>
            </t>
        </t>
    </t>
    <t t-else="">
        <t t-if="category.threads.includes(messaging.state.discuss.threadId)">
            <t t-call="mail.discuss_category_item">
                <t t-set="threadId" t-value="messaging.state.discuss.threadId"/>
                <t t-set="thread" t-value="messaging.state.threads[threadId]"/>
            </t>
        </t>
    </t>
</t>

<t t-name="mail.discuss_category_item" owl="1">
    <button class="o-mail-category-item btn d-flex align-items-center w-100 px-0 py-2 border-0 text-reset"
        t-att-class="{
            'bg-100': threadId !== messaging.state.discuss.threadId,
            'o-active bg-200': threadId === messaging.state.discuss.threadId,
            'o-unread': thread.isUnread,
        }"
        t-on-click="() => this.openThread(threadId)"
    >
        <div class="o-mail-background-inherit position-relative d-flex ms-4" style="width:30px;height:30px">
            <img class="w-100 h-100 rounded-circle" t-att-src="thread.imgUrl" alt="Thread Image"/>
            <PartnerImStatus t-if="thread.type === 'chat'" className="'o-mail-category-im-status position-absolute bottom-0 end-0'" partner="messaging.state.partners[thread.chatPartnerId]"/>
        </div>
        <span class="ms-3 me-2 text-truncate" t-att-class="{ 'o-item-unread fw-bolder': thread.isUnread }">
            <t t-esc="thread.chatPartnerId ? messaging.state.partners[thread.chatPartnerId].name : thread.name"/>
        </span>
        <div class="flex-grow-1"/>
        <div class="o-mail-commands d-none ms-1 me-3">
            <t t-if="thread.type === 'channel'">
                <i t-attf-class="fa fa-cog {{ hover_class }}" title="Channel settings" t-on-click.stop="() => this.openSettings(thread)" role="img"/>
            </t>
            <t t-if="thread.canLeave">
                <div class="fa fa-times ms-1" t-attf-class="{{ hover_class }}" 
                    t-on-click.stop="() => this.leaveChannel(thread)" title="Leave this channel" role="img"/>
            </t>
        </div>
    </button>
</t>
</templates>