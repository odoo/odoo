<?xml version="1.0" encoding="UTF-8"?>
<templates xml:space="preserve">

    <t t-name="mail.CallParticipantCardView" owl="1">
        <t t-if="callParticipantCardView">
            <div class="o_CallParticipantCardView position-relative cursor-pointer d-flex flex-column align-items-center justify-content-center mh-100 mw-100 p-1 rounded-1"
                t-att-class="{
                    'o-isTalking': !callParticipantCardView.isMinimized and callParticipantCardView.isTalking,
                    'o-isInvitation opacity-50': !callParticipantCardView.rtcSession,
                }"
                t-att-title="callParticipantCardView.channelMember.persona.name"
                t-att-aria-label="callParticipantCardView.channelMember.persona.name"
                t-attf-class="{{ className }}"
                t-on-click="callParticipantCardView.onClick"
                t-on-contextmenu="callParticipantCardView.onContextMenu"
                t-ref="root"
            >
                <!-- card -->
                <t t-if="callParticipantCardView.callParticipantVideoView">
                    <CallParticipantVideoView record="callParticipantCardView.callParticipantVideoView"/>
                </t>
                <t t-else="">
                    <div class="o_CallParticipantCardView_avatarFrame d-flex align-items-center justify-content-center h-100 w-100 rounded-1" t-att-class="{ 'o-isMinimized': callParticipantCardView.isMinimized }" draggable="false">
                        <img alt="Avatar"
                             t-att-class="{
                                'o-isTalking': callParticipantCardView.isTalking,
                                'o-isInvitation': !callParticipantCardView.rtcSession,
                             }"
                             class="o_CallParticipantCardView_avatarImage h-100 rounded-circle border-5 o_object_fit_cover"
                             t-att-src="callParticipantCardView.channelMember.avatarUrl"
                             draggable="false"
                        />
                    </div>
                </t>

                <t t-if="callParticipantCardView.rtcSession">
                    <!-- overlay -->
                    <span class="o_CallParticipantCardView_overlay o_CallParticipantCardView_overlayBottom position-absolute bottom-0 start-0 d-flex overflow-hidden">
                        <t t-if="!callParticipantCardView.isMinimized">
                            <span class="o_CallParticipantCardView_name p-1 rounded-1 bg-black-75 text-truncate" t-esc="callParticipantCardView.channelMember.persona.name"/>
                        </t>
                        <t t-if="callParticipantCardView.rtcSession.isScreenSharingOn and callParticipantCardView.isMinimized and !callParticipantCardView.rtcSession.channel.rtc">
                            <small class="o_CallParticipantCardView_liveIndicator o-isMinimized rounded-pill text-bg-danger d-flex align-items-center fw-bolder" title="live" aria-label="live">
                                LIVE
                            </small>
                        </t>
                    </span>
                    <div class="o_CallParticipantCardView_overlay o_CallParticipantCardView_overlayTop position-absolute top-0 end-0 d-flex flex-row-reverse">
                        <t t-if="callParticipantCardView.rtcSession.isSelfMuted and !callParticipantCardView.rtcSession.isDeaf">
                            <span class="o_CallParticipantCardView_overlayTopElement d-flex flex-column justify-content-center me-1 rounded-circle bg-900" t-att-class="{'o-isMinimized p-1': callParticipantCardView.isMinimized, 'p-2': !callParticipantCardView.isMinimized }" title="muted" aria-label="muted">
                                <i class="fa fa-microphone-slash"/>
                            </span>
                        </t>
                        <t t-if="callParticipantCardView.rtcSession.isDeaf">
                            <span class="o_CallParticipantCardView_overlayTopElement d-flex flex-column justify-content-center me-1 rounded-circle bg-900" t-att-class="{'o-isMinimized p-1': callParticipantCardView.isMinimized, 'p-2': !callParticipantCardView.isMinimized }" title="deaf" aria-label="deaf">
                                <i class="fa fa-deaf"/>
                            </span>
                        </t>
                        <t t-if="callParticipantCardView.rtcSession.channel.rtc and callParticipantCardView.rtcSession.isAudioInError">
                            <span class="o_CallParticipantCardView_overlayTopElement d-flex flex-column justify-content-center me-1 p-2 rounded-circle bg-900 text-danger" title="Issue with audio">
                                <i class="fa fa-exclamation-triangle"/>
                            </span>
                        </t>
                        <t t-if="callParticipantCardView.rtcSession.channel.rtc and !callParticipantCardView.rtcSession.rtcAsCurrentSession and !['connected', 'completed'].includes(callParticipantCardView.rtcSession.connectionState)">
                            <span class="o_CallParticipantCardView_overlayTopElement d-flex flex-column justify-content-center me-1 p-2 rounded-circle bg-900" t-att-title="callParticipantCardView.rtcSession.connectionState">
                                <i class="fa fa-exclamation-triangle o_CallParticipantCardView_connectionState text-warning"/>
                            </span>
                        </t>
                        <t t-if="callParticipantCardView.rtcSession.isScreenSharingOn and !callParticipantCardView.isMinimized and !callParticipantCardView.rtcSession.channel.rtc">
                            <span class="o_CallParticipantCardView_liveIndicator rounded-pill text-bg-danger d-flex align-items-center me-1 fw-bolder" title="live" aria-label="live">
                                LIVE
                            </span>
                        </t>
                    </div>

                    <!-- volume popover -->
                    <t t-if="!callParticipantCardView.rtcSession.isOwnSession">
                        <i class="o_CallParticipantCardView_volumeMenuAnchor position-absolute bottom-0 start-50" t-on-click="callParticipantCardView.onClickVolumeAnchor" t-ref="volumeMenuAnchor"/>
                    </t>
                </t>
            </div>
        </t>
    </t>

</templates>
