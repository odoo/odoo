<?xml version="1.0" encoding="UTF-8" ?>
<templates xml:space="preserve">

<t t-name="mail.message" owl="1">
    <div class="o-mail-message py-1 mt-1 px-3 d-flex" t-att-class="{'o-mail-is-author': message.isAuthor}" t-ref="ref">
        <div class="o-mail-message-sidebar d-flex flex-shrink-0 justify-content-center">
            <div t-if="!props.squashed" class="o-mail-avatar-container position-relative">
                <img class="w-100 h-100 rounded-circle o_object_fit_cover o_redirect" t-att-class="{ 'cursor-pointer': props.hasActions }"
                    t-attf-src="/mail/channel/1/partner/{{message.authorId}}/avatar_128"/>
            </div>
        </div>
        <div t-att-class="{ 'flex-grow-1': state.isEditing }">
            <div t-if="!props.squashed" class="o-mail-msg-header d-flex flex-wrap align-items-baseline">
                <span class="o-mail-own-name">
                    <strong class="o_redirect me-1 text-truncate" t-att-class="{ 'cursor-pointer': props.hasActions}">
                    <t t-esc="author.name"/>
                    </strong> -
                </span>
                <small class="text-muted opacity-50 ms-2" t-att-title="message.dateTimeStr">
                    <RelativeTime datetime="message.dateTime" />
                </small>
                <t t-if="!env.inChatter and message.recordName and message.resModel !== 'mail.channel'">
                    <small t-on-click.prevent="openRecord" class="ms-1 text-500">
                        on <a t-att-href="message.url"><t t-esc="message.recordName"/></a>
                    </small>
                </t>
            </div>
            <div t-if="!state.isEditing" class="o-mail-message-content d-flex">
                <t t-if="message.type === 'notification'">
                    <t t-if="message.subtype_description">
                        <p class="mb-0"><t t-esc="message.subtype_description"/></p>
                    </t>
                    <t t-if="message.trackingValues.length">
                        <t t-call="mail.tracking_values"/>
                    </t>
                    <div t-if="message.body" class="o-mail-message-body text-break mb-0 px-3 bg-view">
                        <t t-out="message.body"/>
                    </div>
                </t>
                <t t-if="message.type !== 'notification'">
                    <div t-att-class="{
                        'p-1': message.isNote,
                        'o-mail-message-body text-break mb-0 rounded-end-3 rounded-bottom-3 border p-3': !message.isNote,
                        'flex-grow-1': state.isEditing,
                    }">
                        <t t-out="message.body"/>
                    </div>
                </t>
                <div t-if="props.hasActions" class="o-mail-message-actions invisible">
                    <div class="rounded-1 shadow-sm">
                        <i class="cursor-pointer px-1 py-2 fa fa-lg"
                            t-att-class="message.isStarred ? 'fa-star' : 'fa-star-o'"
                            t-on-click="toggleStar"
                            role="button" tabindex="0" title="Mark as Todo" aria-label="Mark as Todo"/>
                        <i class="cursor-pointer px-1 py-2 fa fa-lg fa-trash" t-if="canBeDeleted" t-on-click="onClickDelete"
                            role="button" tabindex="0" title="Delete" aria-label="Delete"/>
                        <i class="cursor-pointer px-1 py-2 fa fa-lg fa-pencil" t-if="canBeEdited" t-on-click="() => state.isEditing = true"
                            role="button" tabindex="1" title="Edit" aria-label="Edit"/>
                    </div>
                </div>
            </div>
            <div t-else="" class="o-mail-message-editable-content flex-grow-1" t-att-class="{
                'p-1': message.isNote,
                'o-mail-message-body text-break mb-0 rounded-end-3 rounded-bottom-3 border p-3': !message.isNote,
            }">
                <Composer autofocus="true" message="message" onDiscardCallback="() => state.isEditing = false" onPostCallback="() => state.isEditing = false" mode="'compact'" />
            </div>
        </div>
    </div>
</t>

<t t-name="mail.tracking_values" owl="1">
    <ul class="mb-0 ps-4">
        <t t-foreach="message.trackingValues" t-as="trackingValue" t-key="trackingValue.id">
            <li>
                <span class="fw-bold" t-esc="trackingValue.oldValue.value"/>
                <i class="fa fa-long-arrow-right mx-1 text-600" />
                <span class="text-info fw-bold" t-esc="trackingValue.newValue.value"/> (<t t-esc="trackingValue.changedField"/>)
            </li>
        </t>
    </ul>
</t>
</templates>

