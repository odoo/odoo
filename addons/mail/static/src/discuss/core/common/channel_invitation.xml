<?xml version="1.0" encoding="UTF-8"?>
<templates xml:space="preserve">

    <t t-name="discuss.ChannelInvitation">
        <ActionPanel t-if="this.props.channel" title.translate="Invite people" resizable="!!this.env.inMeetingView" minWidth="this.env.inMeetingView ? 300 : undefined" initialWidth="this.env.inMeetingView ? 400 : undefined" icon="'oi oi-user-plus'">
            <t t-call="discuss.ChannelInvitation.main"/>
        </ActionPanel>
        <t t-else="" t-call="discuss.ChannelInvitation.main"/>
    </t>

    <t t-name="discuss.ChannelInvitation.main">
        <div class="d-flex flex-column flex-grow-1 bg-inherit o-min-height-0" t-att-class="{ 'o-mail-Discuss-threadActionPopover w-100': this.props.hasSizeConstraints, 'px-1': !this.props.channel }">
            <t t-if="this.store.self_user">
                <div class="position-relative">
                    <input class="o-discuss-ChannelInvitation-search form-control lh-1 px-2 bg-view" t-att-value="this.searchStr" t-ref="input" t-att-placeholder="this.searchPlaceholder" t-on-input="this.onInput"/>
                    <div t-if="this.props.channel?.allow_invite_by_email" class="o-discuss-ChannelInvitation-iconContainer position-absolute top-50 end-0 translate-middle-y me-2 smaller opacity-50" data-tooltip="Type email to invite">
                        <i class="fa fa-envelope-o fa-lg"/>
                        <i class="fa fa-plus-circle o-discuss-ChannelInvitation-iconPlus position-absolute bg-white rounded-circle"/>
                    </div>
                </div>
                <ul class="d-flex flex-column mx-0 pt-1 pb-0 overflow-auto o-scrollbar-thin list-group border-0 flex-grow-1" t-att-class="{ 'align-items-center justify-content-center': this.selectablePartners.length === 0 and this.state.selectableEmails.length === 0 }">
                    <div t-if="this.selectablePartners.length === 0 and this.state.selectableEmails.length === 0" class="smaller text-muted mx-1 opacity-50">
                        <t t-if="this.props.channel">No people found to invite.</t>
                        <t t-else="">No user found.</t>
                    </div>
                    <div t-if="this.state.searchResultCount > this.selectablePartners.length" class="smaller text-muted mx-1 mb-1 fst-italic" t-esc="this.showingResultNarrowText"/>
                    <t t-foreach="this.selectablePartners" t-as="selectablePartner" t-key="this.selectablePartner.id">
                        <t t-call="discuss.ChannelInvitation-selectableItem">
                            <t t-set="selectableItemIndex" t-value="this.selectablePartner_index"/>
                        </t>
                    </t>
                    <t t-foreach="this.state.selectableEmails" t-as="selectableEmailAddress" t-key="this.selectableEmailAddress">
                        <t t-call="discuss.ChannelInvitation-selectableItem">
                            <t t-set="selectableEmailAddress" t-value="this.selectableEmailAddress"/>
                            <t t-set="selectableItemIndex" t-value="this.selectablePartners.length + this.selectableEmailAddress_index"/>
                        </t>
                    </t>
                </ul>
            </t>
            <div class="o-discuss-ChannelInvitation-invitationBox pt-0 pb-1 bg-inherit">
                <t t-if="this.store.self_user" >
                    <div t-if="this.selectedPartners.length > 0 or this.state.selectedEmails.length > 0" class="pt-2">
                        <div class="o-discuss-ChannelInvitation-selectedList d-flex flex-wrap overflow-auto o-scrollbar-thin">
                            <t t-foreach="this.selectedPartners" t-as="selectedPartner" t-key="this.selectedPartner.id">
                                <button class="btn btn-light fw-bolder smaller pe-1" title="Unselect person" t-on-click="() => this.onClickSelectedPartner(selectedPartner)">
                                    <t t-esc="this.selectedPartner.name"/> <i class="oi oi-close border border-dark-subtle ms-1"/>
                                </button>
                            </t>
                            <t t-foreach="this.state.selectedEmails" t-as="selectedEmail" t-key="this.selectedEmail">
                                <button class="btn btn-light fw-bolder smaller pe-1" title="Unselect person" t-on-click="() => this.onClickSelectedEmail(selectedEmail)">
                                    <t t-esc="this.selectedEmail"/> <i class="oi oi-close border border-dark-subtle ms-1"/>
                                </button>
                            </t>
                        </div>
                    </div>
                    <button t-if="this.props.channel and (this.selectedPartners.length > 0 or this.state.selectedEmails.length > 0)" class="btn btn-primary w-100 my-2" t-att-title="this.invitationButtonText" t-on-click="this.onClickInvite">
                        <t t-esc="this.invitationButtonText"/>
                    </button>
                </t>
                <hr t-if="this.props.channel?.invitationLink" class="border-dark-subtle"/>
                <div t-if="this.props.channel?.invitationLink" class="input-group">
                    <input class="border border-secondary form-control lh-1 rounded-start border-0 smaller" type="text" t-att-value="this.props.channel.invitationLink" readonly="" disabled="" t-on-focus="this.onFocusInvitationLinkInput"/>
                    <button class="btn btn-primary px-2 o-py-0_5" t-on-click="this.onClickCopy">
                        <i class="fa fa-copy"/>
                    </button>
                </div>
                <div t-if="this.props.channel?.accessRestrictedToGroupText" class="mt-2 text-muted smaller mx-1" t-esc="this.props.channel.accessRestrictedToGroupText"/>
            </div>
        </div>
    </t>
    <t t-name="discuss.ChannelInvitation-selectableItem">
        <t t-set="isSelected" t-value="this.selectablePartner ? this.selectablePartner.in(this.selectedPartners) : this.state.selectedEmails.includes(this.selectableEmailAddress)"/>
        <li class="o-discuss-ChannelInvitation-selectable object-fit-cover d-flex align-items-start px-1 py-0 btn list-group-item border-0 rounded-0 w-100"
            t-att-class="{ 'o-odd': selectableItemIndex % 2 === 1, 'o-selected': isSelected, 'align-items-center': selectableEmailAddress }"
            t-on-click="() => this.selectablePartner ? this.onClickSelectablePartner(this.selectablePartner) : this.onClickSelectableEmail(selectableEmailAddress) "
        >
            <div class="d-flex align-items-center p-1 bg-inherit">
                <div class="position-relative d-flex flex-shrink-0 bg-inherit">
                    <DiscussAvatar t-if="this.selectablePartner" persona="this.selectablePartner"/>
                    <div t-else="" class="w-100 h-100 d-flex align-items-center justify-content-center rounded-3 bg-primary text-white">
                        <i class="fa fa-envelope"/>
                    </div>
                </div>
            </div>
            <div class="d-flex flex-column mx-2 flex-grow-1 overflow-hidden o-mt-0_5">
                <t t-if="this.selectablePartner">
                    <div class="d-flex overflow-hidden align-items-baseline" name="selectablePartnerName">
                        <span class="text-truncate" t-esc="this.selectablePartner.name"/>
                    </div>
                    <div class="d-flex flex-column flex-grow-1 gap-1" name="selectablePartnerDetail">
                        <span t-if="this.selectablePartner.email" t-esc="this.selectablePartner.email" class="text-truncate text-start smaller text-600 fw-normal lh-1"/>
                    </div>
                </t>
                <div t-else="" class="overflow-hidden d-flex flex-column align-items-baseline">
                    <span class="text-truncate text-start w-100" t-esc="this.selectableEmailAddress"/>
                    <span t-if="this.state.sentEmails.has(this.selectableEmailAddress)" class="text-truncate text-start smaller text-600 fw-normal lh-1 w-100">Invitation already sent to this address</span>
                </div>
            </div>
            <input class="form-check-input flex-shrink-0 me-1" type="checkbox" t-att-checked="isSelected ? 'checked' : undefined"/>
        </li>
    </t>
</templates>
