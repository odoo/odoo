<?xml version="1.0" encoding="UTF-8"?>
<templates xml:space="preserve">

    <t t-name="discuss.Call">
        <PttAdBanner/>
        <div class="o-discuss-Call user-select-none position-relative shadow-sm" t-att-class="{
            'o-fullSize': this.isFullSize,
            'o-compact': this.props.compact and !this.isMobileOs,
            'o-minimized': this.minimized,
            'position-relative o-mx-0_5 o-mt-0_5 p-1': !this.rtc.isFullscreen and !this.props.isPip,
            'rounded-2': !this.rtc.isFullscreen and !this.props.isPip and this.isActiveCall,
            'o-hasVideo': this.channel.videoCount > 0,
            'o-selfInCall': this.isActiveCall,
            'border-bottom': !this.isActiveCall,
        }" t-ref="root">
            <div class="o-discuss-Call-main d-flex flex-column align-items-center justify-content-center position-relative overflow-auto o-scrollbar-thin" t-on-mouseleave="this.onMouseleaveMain">
                <BlurPerformanceWarning t-if="this.store.settings.blurPerformanceWarning"/>
                <div
                    class="o-discuss-Call-mainCards d-flex align-items-center overflow-hidden h-100 w-100 flex-wrap justify-content-center"
                    t-att-class="{'mt-1': this.minimized}"
                    t-attf-style="--height:{{this.state.tileHeight}}px; --width:{{this.state.tileWidth}}px;"
                    t-on-click="() => this.showOverlay()"
                    t-on-mousemove="this.onMousemoveMain"
                    t-ref="grid"
                >
                    <CallParticipantCard t-foreach="this.visibleMainCards.slice(0,6)" t-as="cardData" t-key="cardData.key"
                        cardData="cardData"
                        className="'o-discuss-Call-mainCardStyle'"
                        minimized="this.minimized"
                        compact="this.props.compact"
                        channel="this.channel"
                    />
                    <span t-if="this.env.inChatWindow and this.visibleMainCards.length > 6" class="oi oi-ellipsis-h ps-1 pe-1"/>
                    <CallParticipantCard t-if="!this.env.inChatWindow" t-foreach="this.visibleMainCards.slice(6)" t-as="cardData" t-key="cardData.key"
                        cardData="cardData"
                        className="'o-discuss-Call-mainCardStyle p-1'"
                        minimized="this.minimized"
                        compact="this.props.compact"
                        channel="this.channel"
                    />
                </div>

                <!-- Buttons -->
                <t t-if="this.hasSidebarButton">
                    <i t-if="this.state.sidebar" class="o-discuss-Call-sidebarToggler p-2 fs-5 cursor-pointer position-absolute oi oi-arrow-right" title="Hide sidebar" t-on-click="() => this.state.sidebar = false"/>
                    <i t-else="" class="o-discuss-Call-sidebarToggler p-2 fs-5 cursor-pointer position-absolute oi oi-arrow-left" title="Show sidebar" t-on-click="() => this.state.sidebar = true"/>
                </t>
                <div t-if="this.props.hasOverlay and (this.state.overlay or !this.isControllerFloating)" class="o-discuss-Call-overlay d-flex justify-content-center w-100 pb-1" t-att-class="{ 'o-isFloating position-absolute z-2 bottom-0 pb-2': this.isControllerFloating }">
                    <div t-on-mousemove="this.onMousemoveOverlay">
                        <CallActionList channel="this.channel" compact="this.props.compact or this.props.isPip"/>
                    </div>
                </div>
                <div t-if="this.hasCallNotifications" class="position-absolute d-flex flex-column-reverse start-0 bottom-0" t-att-class="{ 'ps-5 pb-5': this.rtc.isFullscreen, 'ps-2 pb-2': !this.rtc.isFullscreen }">
                    <span class="o-discuss-Call-notification text-bg-800 shadow-lg rounded-1 m-1" t-att-class="{ 'p-4 fs-4': this.rtc.isFullscreen, 'p-2': !this.rtc.isFullscreen }" t-foreach="this.rtc.notifications.values()" t-as="notification" t-key="notification.id" t-esc="notification.text"/>
                </div>
                <div t-if="!this.env.inMeetingView" class="o-discuss-Call-layoutActions position-absolute z-2 bottom-0 end-0">
                    <ActionList actions="this.layoutActions" inline="true"/>
                </div>
            </div>
            <div t-if="this.state.sidebar and this.channel.activeRtcSession" class="o-discuss-Call-sidebar d-flex align-items-center h-100 flex-column">
                <CallParticipantCard t-foreach="this.sidebarCards" t-as="cardData" t-key="cardData.key"
                    cardData="cardData"
                    className="'o-discuss-Call-sidebarCard w-100 p-1'"
                    channel="this.channel"
                    isSidebarItem="true"
                />
            </div>
            <CallParticipantCard
                t-if="this.channel.videoCount > 0 and this.state.insetCard and !this.state.sidebar"
                cardData="this.state.insetCard"
                className="'o-discuss-Call-mainCardStyle o-bg-black'"
                channel="this.channel"
                inset.bind="this.setInset"
            />
        </div>
    </t>

</templates>
