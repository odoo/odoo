<?xml version="1.0" encoding="UTF-8" ?>
<templates xml:space="preserve">
    <t t-name="location_selector.location_selector_component">

        <!-- Mobile view -->
        <t t-if="this.state.isSmall">
            <!-- Search bar -->
            <t t-if="this.props.searchbar" t-call="location_selector.location_selector_component.searchbar"/>

            <!-- "List view / Map view" navigation -->
            <div class="nav nav-tabs">
                <button
                    class="o_location_selector_mobile_tab btn flex-grow-1 border-0 border-bottom rounded-0 py-3 bg-transparent"
                    t-att-class="{'active': this.state.viewMode === 'list'}"
                    t-on-click="() => this.state.viewMode = 'list'"
                    t-out="listViewButtonLabel"
                />
                <button
                    class="o_location_selector_mobile_tab btn flex-grow-1 border-0 border-bottom rounded-0 py-3 bg-transparent"
                    t-att-class="{'active' : this.state.viewMode === 'map'}"
                    t-on-click="() => this.state.viewMode = 'map'"
                    t-out="mapViewButtonLabel"
                />
            </div>

            <!-- Component -->
            <div t-att-class="{'store-locator-description-area': this.props.details == 'area', 'store-locator-description-tooltip': this.props.details == 'tooltip'}" class="flex-grow-1 overflow-x-auto">
                <t
                    t-if="this.state.locations.length"
                    t-component="mobileComponent"
                    locations="this.state.locations"
                    selectedLocationId="this.state.selectedLocationId.toString()"
                    setSelectedLocation.bind="setSelectedLocation"
                />
                <t t-else="">
                    <p t-if="this.state.error" class="p-3 fw-bold" t-out="errorMessage"/>
                    <div t-else="" class="position-absolute start-50 top-50 translate-middle">
                        <div class="spinner-border" role="status">
                            <span class="visually-hidden" t-out="loadingMessage"/>
                        </div>
                    </div>
                </t>
            </div>
        </t>

        <!-- Desktop view -->
        <div t-else="" t-att-class="{'flex-row-reverse': this.props.sidebarLocation == 'right'}" class="o_location_selector d-flex h-100 mx-0 mx-md-n3 overflow-hidden">

            <!-- List view -->
            <section t-if="this.props.sidebar" class="o_location_selector_view col-md-3 d-flex flex-grow-1 flex-column">

                <!-- Search bar -->
                <t t-if="this.props.searchbar" t-call="location_selector.location_selector_component.searchbar">
                    <t t-set="wrapClass" t-value="'d-flex'"/>
                </t>

                <!-- List group -->
                <LocationList
                    t-if="this.state.locations.length"
                    locations="this.state.locations"
                    selectedLocationId="this.state.selectedLocationId.toString()"
                    setSelectedLocation.bind="setSelectedLocation"
                    hiddenLocations="this.state.hiddenLocations"
                />
                <t t-else="">
                    <p t-if="this.state.error" class="p-3 fw-bold" t-out="errorMessage"/>
                    <div t-else="" class="position-absolute start-50 top-50 translate-middle">
                        <div class="spinner-border" role="status">
                            <span class="visually-hidden" t-out="loadingMessage"/>
                        </div>
                    </div>
                </t>
            </section>

            <!-- Map view -->
            <section
                t-att-class="{'store-locator-description-area': this.props.details == 'area', 'store-locator-description-tooltip': this.props.details == 'tooltip'}"
                class="o_location_selector_view col-md-9 d-flex flex-grow-1 border-start pe-2">
                <MapContainer
                    locations="this.state.locations"
                    selectedLocationId="this.state.selectedLocationId.toString()"
                    setSelectedLocation.bind="setSelectedLocation"
                    setHiddenLocations.bind="setHiddenLocations"
                />
            </section>
        </div>

        <!-- Validation button in mobile view -->
        <t t-if="this.state.isSmall" t-set-slot="footer">
            <div class="w-100 m-0 border-top p-3">
                <button
                    type="button"
                    id="submit_location_small"
                    class="btn btn-primary w-100"
                    t-att-disabled="!this.state.selectedLocationId"
                    t-on-click="validateSelection"
                    t-out="validationButtonLabel"
                />
            </div>
        </t>
    </t>

    <t t-name="location_selector.location_selector_component.searchbar">
        <div role="search" class="input-group p-3 border-bottom" t-att-class="wrapClass">
            <input
                class="search-query form-control oe_search_box border-0 text-bg-light"
                t-model.lazy="this.state.zipCode"
                t-att-placeholder="postalCodePlaceholder"
            />
            <button
                t-on-click="() => this.debouncedSearchButton(this.state.zipCode)"
                aria-label="Search"
                title="Search"
                class="btn btn-light"
            >
                <i class="oi oi-search"/>
            </button>
        </div>
    </t>
</templates>
