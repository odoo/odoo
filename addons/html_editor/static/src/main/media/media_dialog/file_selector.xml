<templates id="template" xml:space="preserve">
<t t-name="html_editor.FileSelectorControlPanel">
    <div class="o_we_file_selector_control_panel sticky-top d-flex flex-wrap gap-2 mb-1 p-3 align-items-end">
        <SearchMedia searchPlaceholder="this.props.searchPlaceholder" needle="this.props.needle" search="this.props.search"/>
        <div class="d-flex gap-3 justify-content-start align-items-center">
            <div t-if="this.props.showOptimizedOption" class="flex-shrink-0 form-check form-switch align-items-center" t-on-change="this.props.changeShowOptimized">
                <input class="o_we_show_optimized form-check-input" type="checkbox" t-att-checked="this.props.showOptimized" id="o_we_show_optimized_switch"/>
                <label class="form-check-label" for="o_we_show_optimized_switch">
                    Show optimized images
                </label>
            </div>
            <select t-if="this.showSearchServiceSelect" class="o_input o_we_search_select form-select pe-5" t-on-change="ev => this.props.changeSearchService(ev.target.value)">
                <option t-att-selected="this.props.searchService === 'all'" value="all">All</option>
                <option t-att-selected="this.props.searchService === 'database'" value="database">My Images</option>
                <option t-if="this.props.useMediaLibrary" t-att-selected="this.props.searchService === 'media-library'" value="media-library">Illustrations</option>
            </select>
        </div>
        <div class="col justify-content-end flex-nowrap input-group has-validation">
            <input type="text" class="form-control o_input o_we_url_input o_we_transition_ease flex-grow-0" t-att-class="{ o_we_horizontal_collapse: !this.state.showUrlInput, 'w-auto': this.state.showUrlInput }" name="url" t-att-placeholder="this.props.urlPlaceholder" t-model="this.state.urlInput" t-on-input="this.onUrlInput" t-if="this.state.showUrlInput" t-ref="urlInput"/>
            <button type="button" class="btn o_upload_media_url_button text-nowrap" t-att-class="{ 'btn-primary': this.state.urlInput, 'btn-secondary': !this.state.urlInput}" t-on-click="this.onUrlUploadClick" t-att-disabled="!this.enableUrlUploadClick">
                    <t t-esc="this.props.addText"/>
            </button>
            <div class="d-flex align-items-center">
                <span t-if="this.state.urlInput and this.state.isValidatingUrl" class="o_we_url_loading mx-2 fa fa-lg fa-circle-o-notch fa-spin" title="Loading..."/>
                <span t-elif="this.state.urlInput and this.state.isValidUrl and this.state.isValidFileFormat" class="o_we_url_success text-success mx-2 fa fa-lg fa-check" title="The URL seems valid."/>
                <span t-elif="this.state.urlInput and !this.state.isValidUrl" class="o_we_url_error text-danger mx-2 oi oi-large oi-close" title="The URL does not seem to work."/>
                <span t-elif="this.props.urlWarningTitle and this.state.urlInput and this.state.isValidUrl and !this.state.isValidFileFormat" class="o_we_url_warning text-warning mx-2 fa fa-lg fa-warning" t-att-title="this.props.urlWarningTitle"/>
            </div>
        </div>
        <input type="file" class="d-none o_file_input" t-on-change="this.onChangeFileInput" t-ref="file-input" t-att-accept="this.props.accept" t-att-multiple="this.props.multiSelect and 'multiple'"/>
        <div class="col-auto btn-group">
            <button type="button" class="btn btn-secondary o_upload_media_button" t-on-click="this.onClickUpload">
                <t t-esc="this.props.uploadText"/>
            </button>
        </div>
    </div>
</t>

<t t-name="html_editor.FileSelector">
    <div>
        <FileSelectorControlPanel uploadText="this.uploadText"
            accept="this.fileMimetypes"
            urlPlaceholder="this.urlPlaceholder"
            addText="this.addText"
            searchPlaceholder="this.searchPlaceholder"
            urlWarningTitle="this.urlWarningTitle"
            uploadUrl="(url) => this.uploadUrl(url)"
            uploadFiles="(files) => this.uploadFiles(files)"
            showOptimizedOption="this.showOptimizedOption"
            showOptimized="this.state.showOptimized"
            changeShowOptimized="showOptimized => this.state.showOptimized = !this.state.showOptimized"
            changeSearchService="service => this.state.searchService = service"
            searchService="this.state.searchService"
            needle="this.state.needle"
            search="(needle) => this.handleSearch(needle)"
            useMediaLibrary="this.props.useMediaLibrary"
            validateUrl="this.validateUrl"
            multiSelect="this.props.multiSelect"/>
        <t t-call="{{ this.constructor.attachmentsListTemplate }}"/>
        <div name="load_more_attachments"
            class="pt-3 pb-1 text-center mx-auto o_we_load_more"
            t-ref="load-more-button">
            <button t-if="this.canLoadMore"
                class="btn btn-primary o_load_more"
                type="button"
                t-on-click="this.handleLoadMore">
                Load more...
            </button>
            <div t-elif="this.hasContent" class="mt-2 o_load_done_msg">
                <span><i t-esc="this.allLoadedText"/></span>
            </div>
        </div>
        <div t-if="this.state.canScrollAttachments"
            class="position-sticky d-flex align-items-center mx-auto btn btn-primary rounded-circle oi oi-chevron-down o_scroll_attachments"
            t-on-click="this.handleScrollAttachments"/>
    </div>
</t>
</templates>
