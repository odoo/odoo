<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <!-- Reception Report Labels -->
    <template id="report_reception_report_label">
        <t t-if="quantity" t-set="qtys" t-value="[int(q) for q in quantity.split(',')]"/>
        <t t-else="" t-set="qtys" t-value="[1 for q in range(len(docs))]"/>
        <t t-call="web.basic_layout">
            <div class="page">
                <t t-foreach="range(len(docs))" t-as="index">
                    <t t-set="move" t-value="docs[index]"/>
                    <t t-set="qty" t-value="qtys[index]"/>
                    <t t-set="source" t-value="move._get_source_document()"/>
                    <t t-foreach="range(qty)" t-as="j">
                        <div class="o_label_page o_label_dymo">
                            <span t-out="move.product_id.display_name">Product Display Name</span> <br/>
                            <span t-if="source" t-out="source.name">Source Name</span>
                            <div class="address"
                                t-if="move.picking_id and move.picking_id.partner_id"
                                t-field="move.picking_id.partner_id"
                                t-options='{"widget": "contact", "fields": ["address", "name", "phone"], "no_marker": True}'/>
                        </div>
                    </t>
                </t>
            </div>
        </t>
    </template>

    <!-- Reception Report -->
    <record id="stock_reception_report_action" model="ir.actions.report">
        <field name="name">Reception Report</field>
        <field name="model">stock.picking</field>
        <field name="report_type">qweb-pdf</field>
        <field name="report_name">stock.report_reception</field>
    </record>

    <record id="stock_reception_action" model="ir.actions.client">
        <field name="name">Reception Report</field>
        <field name="tag">reception_report</field>
        <field name="res_model">report.stock.report_reception</field>
    </record>

    <template id="report_reception_body">
        <div class="o_report_reception justify-content-between">
            <div class="o_report_reception_header my-5">
                <h3>
                    <t t-if="docs">
                        <t t-foreach="docs" t-as="doc">
                            <div class="p-2">
                                <a href="#" t-att-res-model="doc_model" view-type="form" t-att-res-id="doc.id">
                                    <span t-out="doc.display_name">Demo Display Name</span>
                                </a>
                                <span t-field="doc.display_name" t-options="{'widget': 'barcode', 'width': 300, 'height': 50}">Display Name</span>
                                <span t-field="doc.state" t-attf-class="badge rounded-pill bg-opacity-50 #{'bg-success' if doc.state == 'done' else 'bg-info'}">Andrwep</span>
                            </div>
                        </t>
                    </t>
                    <t t-else="">
                        <span t-out="reason">Reason</span>
                    </t>
                </h3>
            </div>
            <t t-set="has_assigned_lines" t-value="any(line.get('is_assigned', False) for lines in product_lines.values() for line in lines)"/>
            <table t-if="has_assigned_lines" class="o_report_reception_table table table-sm text-start">
                <thead>
                    <tr>
                        <th>Product</th>
                        <th>quantity</th>
                        <th class="text-center">Source</th>
                        <th>Expected Delivery</th>
                    </tr>
                </thead>
                <t t-foreach="product_lines" t-as="product">
                    <tbody>
                        <t t-set="possible_moves" t-value="product_lines[product]"/>
                        <t t-set="first_line" t-value="True"/>
                        <t t-foreach="possible_moves" t-as="line">
                            <!-- don't print non-assigned lines when printing pdf -->
                            <tr t-if="line['is_assigned']">
                                <td t-if="first_line" t-att-rowspan="len(possible_moves)">
                                    <span t-out="line['product']['display_name']">DEMO_PRODUCT_DISPLAY_NAME</span>
                                    <t t-set="first_line" t-value="False"/>
                                </td>
                                <td>
                                    <span t-out="line['quantity']">DEMO_QUANTITY</span>
                                    <span groups="uom.group_uom" t-out="line['uom']">DEMO_UOM</span>
                                </td>
                                <td>
                                    <t t-set="source" t-value="line['source'][0]"/>
                                    <span t-out="source['name']" t-options="{'widget': 'barcode', 'width': 200, 'height': 30}">Display Name</span>
                                    <i t-if="source['priority'] == '1'" class="o_priority o_priority_star fa fa-star"/>
                                    <a name="source_link" href="#" t-att-res-model="source['model']" view-type="form" t-att-res-id="source['id']">
                                        <span t-out="source['name']">DEMO_SOURCE_DISPLAY_NAME</span>
                                    </a>
                                    <span t-if="len(line['source']) > 1">
                                        <t t-set="source_origin" t-value="line['source'][1]"/>
                                        <a name="origin_link" href="#" t-att-res-model="source_origin['model']" view-type="form" t-att-res-id="source_origin['id']">
                                            <span t-out="source_origin['name']">DEMO_ORIGIN_DISPLAY_NAME</span>
                                        </a>
                                    </span>
                                    <span t-if="source['model'] == 'stock.picking' and source['partner_name']">
                                        <a name="source_link" href="#" t-att-res-model="'res.partner'" t-att-res-id="source['partner_id']" view-type="form">
                                            <span t-out="source['partner_name']">DEMO_PARTNER_NAME</span>
                                        </a>
                                    </span>
                                </td>
                                <td>
                                    <span t-out="line['date']">DEMO_DATE</span>
                                </td>
                            </tr>
                        </t>
                    </tbody>
                </t>
            </table>
            <p t-else="">
                No allocation need found.
            </p>
        </div>
    </template>

    <template id="report_reception">
        <t t-call="web.html_container">
            <t t-call="web.internal_layout">
                <t t-call="stock.report_reception_body"/>
            </t>
        </t>
    </template>
</odoo>
