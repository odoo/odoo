<?xml version="1.0" encoding="utf-8"?>
<odoo>
<data>
    <template id="user_input_session" name="Survey User Input Session" inherit_id="web.frontend_layout" primary="True">
        <xpath expr="//head/t[@t-call-assets][last()]" position="after">
            <t t-call-assets="survey.survey_user_input_session_assets" lazy_load="True"/>
            <t t-call-assets="survey.survey_assets" lazy_load="True"/>
        </xpath>
        <xpath expr="//header" position="before">
            <t t-set="no_header" t-value="True"/>
            <t t-set="no_footer" t-value="True"/>
        </xpath>
        <xpath expr="//header" position="after">
            <div id="wrap" class="oe_structure oe_empty"/>
        </xpath>
    </template>

    <template id="user_input_session_open" name="Survey: Open Session">
        <t t-call="survey.user_input_session">
            <div t-att-data-survey-access-token="survey.access_token"
                class="wrap py-3 min-vh-100 align-items-center justify-content-center o_survey_session_open o_survey_session_manage">
                <div class="w-75 p-4 o_survey_session_manage_container">
                    <div class="mb-5 text-center">
                        <h1 t-field="survey.title" />
                        <div t-field="survey.description" />
                    </div>
                    <div class="row">
                        <div class="col-lg-12 text-center mb-2" t-if="survey.access_mode == 'public'">
                            <h3>
                                <a t-att-href="survey_url" t-esc="survey_url" target="_blank" />
                                <i class="fa fa-copy font-weight-normal ml-3 o_survey_session_copy" />
                            </h3>
                            <input class="o_survey_session_copy_url d-none" type="text" t-att-value="survey_url" />
                        </div>
                        <div class="col-lg-6 text-right mr-3 font-weight-light" t-if="session.is_questions_time_limited">
                            Time per question <span class="ml-1 font-weight-bold" t-field="session.questions_time_limit" t-options="{'widget': 'duration', 'unit': 'second'}" />
                        </div>
                        <div class="col-lg-4 ml-3 font-weight-light" t-if="session.is_questions_time_limited">
                            Participants <span class="ml-1 font-weight-bold" t-esc="session.answer_ids_count" />
                        </div>
                    </div>
                    <div class="text-center mt-5">
                        <a role="button" class="btn btn-primary font-weight-bold o_survey_session_start" href="#">
                            Start Session
                        </a>
                    </div>
                </div>
            </div>
        </t>
    </template>

    <template id="user_input_session_manage" name="Survey: Manage Session">
        <t t-call="survey.user_input_session">
            <t t-call="survey.user_input_session_manage_content" />
        </t>
    </template>

    <template id="user_input_session_manage_content" name="Survey User Input Session Manage">
        <div class="wrap py-3 min-vh-100 align-items-center justify-content-center o_survey_session_manage flex-column"
            t-att-style="'display: none;' if is_transitioned else ''"
            t-att-data-is-transitioned="is_transitioned"
            t-att-data-survey-id="survey.id"
            t-att-data-survey-access-token="survey.access_token"
            t-att-data-input-session-id="session.id"
            t-att-data-timer="session.current_question_start_time.isoformat()"
            t-att-data-time-limit-minutes="session.questions_time_limit / 60">
            <div class="w-75 p-4 o_survey_session_manage_container">
                <div>
                    <fieldset disabled="disabled">
                        <div class="row mb-4">
                            <div class="col-lg-8"><h1 t-esc="survey.title"></h1></div>
                            <div t-if="session.is_questions_time_limited" class="o_survey_timer col-lg-4">
                                <h1 class="timer text-right"></h1>
                            </div>
                        </div>
                        <t t-set="question" t-value="session.current_question_id" />
                        <t t-set="answer_lines" t-value="env['survey.user_input.line']" />
                        <t t-call="survey.question_container" />
                    </fieldset>
                    <div class="text-right mb-5">
                        <div class="font-weight-bold my-2">
                            Received answers:
                            <t t-esc="session.current_question_answer_count" />
                                / 
                                <t t-esc="session.answer_ids_count" />
                        </div>
                    </div>
                    <div class="text-center">
                        <a t-if="is_last_question" role="button" class="btn btn-primary font-weight-bold o_survey_session_end" href="#">
                            End Session
                        </a>
                        <a t-else="" role="button" class="btn btn-primary font-weight-bold o_survey_session_next" href="#">
                            Next Question
                        </a>
                    </div>
                </div>
            </div>
            <br/>
            <div class="w-75 px-4 py-2 o_survey_session_manage_container o_survey_session_results">
                <div class="row m-0 d-flex align-items-center">
                    <div class="col-lg-10 m-0 p-0">
                        <h3 class="m-0">Results</h3>
                    </div>
                    <div class="col-lg-2 m-0 p-0 text-right">
                        <h5 class="m-0">
                            <i class="fa fa-sync o_survey_session_refresh_results mr-4 d-none" />
                            <i class="fa fa-angle-double-down o_survey_session_toggle_results" />
                        </h5>
                    </div>
                </div>
                <div class="o_survey_result">
                </div>
            </div>
            <br/>
            <div t-if="session.competitive_mode" class="w-75 px-4 py-2 o_survey_session_manage_container o_survey_session_ranking">
                <div class="row m-0 d-flex align-items-center">
                    <div class="col-lg-10 m-0 p-0">
                        <h3 class="m-0">Ranking</h3>
                    </div>
                    <div class="col-lg-2 m-0 p-0 text-right">
                        <h5 class="m-0">
                            <i class="fa fa-sync o_survey_session_refresh_ranking mr-4 d-none" />
                            <i class="fa fa-angle-double-down o_survey_session_toggle_ranking" />
                        </h5>
                    </div>
                </div>
                <div class="o_survey_session_ranking_container">
                </div>
            </div>
        </div>
    </template>

    <template id="user_input_session_ranking" name="Survey User Input Ranking">
        <div>
            <t t-if="ranking" t-set="max_score" t-value="ranking[0]['score'] or 1" />
            <t t-foreach="ranking" t-as="ranking_item">
                <div class="o_survey_session_ranking_item mb-1">
                    <div t-esc="'%d.' % (ranking_item_index + 1)" class="o_survey_session_ranking_index d-inline-block font-weight-bold"></div>
                    <!-- We keep "10rem" of space to display the points.
                    Then, the length of the bar is a percentage of the attendee's score compared to the max_score. -->
                    <div class="o_survey_session_ranking_bar mr-1 pr-2 align-top d-inline-block text-right font-weight-bold mb-1"
                        t-esc="ranking_item['nickname']" t-attf-style="width: calc(calc(100% - 10rem) * #{(ranking_item['score'] / max_score)});"></div>
                    <div class="o_survey_session_ranking_name font-weight-bold align-top d-inline-block">
                        <span t-esc="'%.0f ' % ranking_item['score']" />
                        <span>points</span>
                    </div>
                </div>
            </t>
        </div>
    </template>
</data>
</odoo>
