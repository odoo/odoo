<?xml version="1.0" encoding="utf-8"?>
<odoo>
<data>
    <!-- Forbidden error messages-->
    <template id="403">
        <t t-call="survey.layout">
            <div id="wrap">
                <div class="container">
                    <h1 class="mt32">403: Forbidden</h1>
                    <p>The page you were looking for could not be authorized.</p>
                    <p>Maybe you were looking for
                        <a t-attf-href="/web#view_type=form&amp;model=survey.survey&amp;id=#{survey.id}&amp;action=survey.action_survey_form">this page</a> ?
                    </p>
                </div>
            </div>
        </t>
    </template>

   <!-- "Thank you" message when the survey is completed -->
    <template id="sfinished" name="Survey Finished">
        <t t-call="survey.layout">
            <div class="wrap">
                <div class="container">
                    <t t-if="answer.test_entry" t-call="survey.back" />
                    <div class="jumbotron mt-5">
                        <h1>Thank you!</h1>
                        <div t-field="survey.thank_you_message" class="oe_no_empty" />
                        <t t-if="survey.scoring_type != 'no_scoring'">
                            <p>You scored <span t-attf-class=" font-weight-bold #{'text-success' if answer.quizz_passed else 'text-danger'}"><t t-esc="answer.quizz_score" />%</span></p>
                            <t t-if="answer.quizz_passed">
                                <div>Congratulations, you have passed the test!</div>
                                <div class="col-6 text-center" t-if="survey.certification_give_badge">
                                    <img t-att-src="'/web/image/gamification.badge/%s/image_128' % survey.certification_badge_id.id"/>
                                    <div>You received the badge <span class="font-weight-bold" t-esc="survey.certification_badge_id.name"/>!</div>
                                </div>
                                <div t-if="survey.certificate" class="mt16 mb16">
                                    <a role="button"
                                        class="btn btn-primary btn-lg"
                                        t-att-href="'/survey/%s/get_certification' % survey.id">
                                        <i class="fa fa-fw fa-trophy" role="img" aria-label="Download certification" title="Download certification"/>
                                        Download certification
                                    </a>
                                </div>
                            </t>
                            <t t-else="">
                                <p>Unfortunately, you have failed the test.</p>
                            </t>
                        </t>
                        <t t-call="survey.retake_survey_button"/>
                        <p t-if="survey.scoring_type != 'scoring_without_answers'">
                            If you wish, you can <a t-att-href="'/survey/print/%s?answer_token=%s&amp;review=True' % (survey.access_token, answer.token)">review your answers</a>.
                        </p>
                    </div>
                </div>
            </div>
        </t>
    </template>

    <template id="retake_survey_button" name="Retake Survey Button">
        <div>
            <t t-if="not answer.quizz_passed">
                <t t-if="survey.is_attempts_limited">
                    <t t-set="attempts_left" t-value="survey._get_number_of_attempts_lefts(answer.partner_id, answer.email, answer.invite_token)" />
                    <t t-if="attempts_left > 0">
                        <p><span>Number of attemps left</span>: <span t-esc="attempts_left"></span></p>
                        <p><a role="button" class="btn btn-primary btn-lg" t-att-href="'/survey/retry/%s/%s' % (survey.access_token, answer.token)">
                        Retry</a></p>
                    </t>
                </t>
                <t t-else="">
                    <p><a role="button" class="btn btn-primary btn-lg" t-att-href="'/survey/retry/%s/%s' % (survey.access_token, answer.token)">
                        Retry</a></p>
                </t>
            </t>
        </div>
    </template>

    <!-- Message when the survey is not open  -->
    <template id="survey_expired" name="Survey Expired">
        <t t-call="survey.layout">
            <div class="wrap">
                <div class="container">
                    <div class="jumbotron">
                        <h1><span t-field="survey.title"/> survey expired</h1>
                        <p>This survey is now closed. Thank you for your interest !</p>
                    </div>
                </div>
            </div>
        </t>
    </template>

    <!-- Message when a login is required  -->
    <template id="auth_required" name="Login required for this survey">
        <t t-call="survey.layout">
            <div class="wrap">
                <div class="container">
                    <div class="jumbotron">
                        <h1>Login required</h1>
                        <p>This survey is open only to registered people. Please
                            <a t-att-href="redirect_url">log in</a>.
                        </p>
                    </div>
                </div>
            </div>
        </t>
    </template>

    <!-- Message when the survey has no pages  -->
    <template id="survey_void" name="Survey has no pages">
        <t t-call="survey.layout">
            <div class="wrap">
                <div class="container">
                    <t t-if="answer.test_entry" t-call="survey.back" />
                    <div class="jumbotron">
                        <h1><span t-field="survey.title"/> survey is void</h1>
                        <p>Please make sure you have at least one question in your survey. You also need at least one section if you chose the "Page per section" layout.<br />
                            <a t-att-href="'/web#view_type=form&amp;model=survey.survey&amp;id=%s&amp;action=survey.action_survey_form' % survey.id"
                                class="btn btn-secondary"
                                groups="survey.group_survey_manager">Edit in backend</a>
                        </p>
                    </div>
                </div>
            </div>
        </t>
    </template>

    <!-- Back Button to redirect in form view of survey -->
    <template id="back" name="Back">
        <div groups="survey.group_survey_manager" t-ignore="true" class="alert alert-info alert-dismissible rounded-0 mt16 fade show d-print-none css_editable_mode_hidden">
            <div t-ignore="true" class="text-center">
                <a t-attf-href="/web#view_type=form&amp;model=survey.survey&amp;id=#{survey.id}&amp;action=survey.action_survey_form"><i class="fa fa-fw fa-arrow-right"/><span t-if="answer and answer.test_entry">This is a test survey. </span>Edit Survey.</a>
            </div>
            <button type="button" class="close" data-dismiss="alert" aria-label="Close"> &#215; </button>
        </div>
    </template>

    <!-- new layout for survey -->
    <template id="survey.layout" name="Survey Layout" inherit_id="web.frontend_layout" primary="True">
        <xpath expr="//head/t[@t-call-assets][last()]" position="after">
            <t t-call-assets="survey.survey_assets" lazy_load="True"/>
        </xpath>
        <xpath expr="//header" position="before">
            <t t-set="no_header" t-value="no_header or survey.certificate"/>
            <t t-set="no_footer" t-value="no_footer or survey.certificate"/>
        </xpath>
        <xpath expr="//header" position="after">
            <div id="wrap" class="oe_structure oe_empty"/>
        </xpath>
    </template>

    <!-- First page of a survey -->
    <template id="survey_init" name="Survey">
        <t t-call="survey.layout">
            <div class="wrap">
                <div class="oe_structure" id="oe_structure_survey_init_1"/>
                <div class="container">
                    <t t-if="answer.test_entry" t-call="survey.back" />
                    <div class='jumbotron'>
                        <h1 t-field='survey.title' />
                        <span t-field='survey.description' class="oe_no_empty text-muted"/>
                        <div t-if="survey.is_time_limited" class="mb-4">
                                <span>Time limit for this survey: </span>
                                <span class="font-weight-bold text-danger" t-field="survey.time_limit" t-options="{'widget': 'duration', 'unit': 'minute'}"></span>
                        </div>
                        <a role="button" class="btn btn-primary btn-lg" t-att-href="'/survey/fill/%s/%s' % (survey.access_token, answer.token)">
                            <t t-if="survey.certificate">
                                Start Certification
                            </t>
                            <t t-else="">
                                Start Survey
                            </t>
                        </a>
                    </div>
                </div>
                <div class="oe_structure" id="oe_structure_survey_init_2"/>
            </div>
        </t>
    </template>

    <!-- A survey -->
    <template id="survey" name="Survey">
        <t t-call="survey.layout">
            <div class="wrap">
                <div class="oe_structure" id="oe_structure_survey_survey_1"/>
                <div class="container">
                    <t t-if="answer.test_entry" t-call="survey.back" />
                    <t t-call="survey.survey_header" />
                    <t t-call="survey.page" />
                </div>
                <div class="oe_structure" id="oe_structure_survey_survey_2"/>
            </div>
        </t>
    </template>

    <!-- The survey header -->
    <template id="survey_header" name="Header">
        <div t-attf-class="mt-3 #{'py-4 border-bottom mb-4' if survey.questions_layout != 'page_per_section' else ''} ">
                <div class="row">
                    <div class="col-lg-8"><h1 t-esc="survey.title"></h1></div>
                    <div
                        t-if="survey.is_time_limited"
                        class="js_survey_timer col-lg-4"
                        t-att-data-timer="answer.start_datetime.isoformat()"
                        t-att-data-time_limit_minutes="survey.time_limit">
                        <h1 class="timer text-right">00:00</h1>
                    </div>
                </div>
            <ol t-if="survey.questions_layout == 'page_per_section'" class="breadcrumb mt-3 justify-content-end">
                <t t-set="can_go_back" t-value="survey.users_can_go_back" />
                <t t-foreach='survey.page_ids' t-as='breadcrumb_page'>
                    <li t-attf-class="breadcrumb-item #{'active' if breadcrumb_page == page else ''}">
                        <t t-if="page == breadcrumb_page">
                            <!-- Users can only go back and not forward -->
                            <!-- As soon as we reach the current page, set "can_go_back" to False -->
                            <t t-set="can_go_back" t-value="False" />
                        </t>
                        <t t-if="can_go_back">
                            <a t-att-href="'/survey/page/%s/%s/%s' % (survey.access_token, answer.token, breadcrumb_page.id)">
                                <span t-field='breadcrumb_page.title' />
                            </a>
                        </t>
                        <t t-else="">
                            <span t-field='breadcrumb_page.title' />
                        </t>
                    </li>
                </t>
            </ol>
        </div>
    </template>

    <!-- A page -->
    <template id="page" name="Page">
        <t t-if="survey.questions_layout == 'one_page'" t-set="page_or_question_id" t-value="None" />
        <t t-if="survey.questions_layout == 'page_per_section'" t-set="page_or_question_id" t-value="page.id" />
        <t t-if="survey.questions_layout == 'page_per_question'" t-set="page_or_question_id" t-value="question.id" />

        <form role="form" method="post" t-attf-class="js_surveyform  mb-3" t-att-name="survey.id"
                t-att-action="'/survey/fill/%s/%s' % (survey.access_token, answer.token)"
                t-att-data-prefill="'/survey/prefill/%s/%s?page_or_question_id=%s' % (survey.access_token, answer.token, page_or_question_id)"
                t-att-data-validate="'/survey/validate/%s/%s' % (survey.access_token, answer.token)"
                t-att-data-submit="'/survey/submit/%s/%s' % (survey.access_token, answer.token)">
            <input type="hidden" name="csrf_token" t-att-value="request.csrf_token()"/>
            <input type="hidden" name="token" t-att-value="answer.token" />

            <t t-if="survey.questions_layout == 'one_page'">
                <t t-foreach='survey.question_and_page_ids' t-as='question'>
                    <div t-if="question.is_page" class="mt-5 mb-4 p-3 o_survey_section">
                        <h2 t-field='question.title' />
                        <span t-if="question.description" t-field='question.description' class="oe_no_empty text-muted"/>
                    </div>
                        <t t-if="not question.is_page and question in answer.question_ids" t-call="survey.question" />
                </t>

                <div class="text-center mb-5">
                    <button type="submit" class="btn btn-primary" name="button_submit" value="finish">Submit Survey</button>
                </div>
            </t>

            <t t-if="survey.questions_layout == 'page_per_section'">
                <div class="mb-4 p-3 o_survey_section">
                    <h2 t-field='page.title' />
                    <span t-field='page.description' class="oe_no_empty text-muted"/>
                </div>

                <input type="hidden" name="page_id" t-att-value="page.id" />
                <t t-foreach='page.question_ids' t-as='question'>
                    <t t-if="question in answer.question_ids" t-call="survey.question" />
                </t>

                <div class="text-center mb-5">
                    <button t-if="survey.users_can_go_back and page != survey.page_ids[0]" type="submit" class="btn btn-secondary" name="button_submit" value="previous">Previous page</button>
                    <button t-if="not last" type="submit" class="btn btn-primary" name="button_submit" value="next">Next page</button>
                    <button t-if="last" type="submit" class="btn btn-primary" name="button_submit" value="finish">Submit Survey</button>
                </div>
            </t>

            <t t-if="survey.questions_layout == 'page_per_question'">
                <input type="hidden" name="question_id" t-att-value="question.id" />
                <t t-call="survey.question" />

                <div class="text-center mb-5">
                    <button t-if="survey.users_can_go_back and question != answer.question_ids[0]" type="submit" class="btn btn-secondary" name="button_submit" value="previous">Previous question</button>
                    <button t-if="not last" type="submit" class="btn btn-primary" name="button_submit" value="next">Next question</button>
                    <button t-if="last" type="submit" class="btn btn-primary" name="button_submit" value="finish">Submit Survey</button>
                </div>
            </t>
        </form>

        <!-- Modal used to display error message, i.c.o. ajax error -->
        <div role="dialog" class="modal fade" id="AJAXErrorModal" >
            <div class="modal-dialog">
                <div class="modal-content">
                    <header class="modal-header">
                        <h4 class="modal-title">A problem has occured</h4>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">&amp;times;</button>
                    </header>
                    <main class="modal-body"><p>Something went wrong while contacting survey server. <strong class="text-danger">Your answers have probably not been recorded.</strong> Try refreshing.</p></main>
                    <footer class="modal-footer"><button type="button" class="btn btn-primary" data-dismiss="modal">Close</button></footer>
                </div>
            </div>
        </div>
    </template>

    <template id="question" name="Question">
        <t t-set="prefix" t-value="'%s_%s' % (survey.id, question.id)" />
        <div t-attf-class="js_question-wrapper form-group mb-3 pt-2" t-att-id="prefix">

                    <label t-field='question.question' class="font-weight-bold"/><span t-if="question.constr_mandatory" class="text-danger">*</span>
                    <span t-if="question.description" t-field='question.description' class="text-muted oe_no_empty"/>


                <t t-if="question.question_type == 'free_text'"><t t-call="survey.free_text"/></t>
                <t t-if="question.question_type == 'textbox'"><t t-call="survey.textbox"/></t>
                <t t-if="question.question_type == 'numerical_box'"><t t-call="survey.numerical_box"/></t>
                <t t-if="question.question_type == 'date'"><t t-call="survey.date"/></t>
                <t t-if="question.question_type == 'datetime'"><t t-call="survey.datetime"/></t>
                <t t-if="question.question_type == 'simple_choice'"><t t-call="survey.simple_choice"/></t>
                <t t-if="question.question_type == 'multiple_choice'"><t t-call="survey.multiple_choice"/></t>
                <t t-if="question.question_type == 'matrix'"><t t-call="survey.matrix"/></t>
                <div class="js_errzone alert alert-danger mt-2" style="display:none;" role="alert"></div>
        </div>
    </template>

    <!-- Question widgets -->
    <template id="free_text" name="Free text box">
        <textarea class="form-control" rows="3" t-att-name="prefix"></textarea>
    </template>

    <template id="textbox" name="Text box">
        <input type="text" class="form-control" t-att-name="prefix"/>
    </template>

    <template id="numerical_box" name="Numerical box">
        <div class="row">
            <div class="col-lg-4">
                <input type="number" step="any" class="form-control" t-att-name="prefix"/>
            </div>
        </div>
    </template>

    <template id="date" name="Date box">
        <div class="row">
            <div class="input-group date col-lg-4" t-attf-id="datetimepicker_#{question.id}" data-target-input="nearest" t-att-data-mindate="question.validation_min_date" t-att-data-maxdate="question.validation_max_date">
                <input type="text" class="form-control datetimepicker-input" t-attf-data-target="#datetimepicker_#{question.id}" t-att-name="prefix"/>
                <div class="input-group-append" t-attf-data-target="#datetimepicker_#{question.id}" data-toggle="datetimepicker">
                    <div class="input-group-text"><i class="fa fa-calendar"></i></div>
                </div>
            </div>
        </div>
    </template>

    <template id="datetime" name="DateTime box">
        <div class="row">
            <div class="input-group date col-lg-4" t-attf-id="datetimepicker_#{question.id}" data-target-input="nearest"
                    t-att-data-mindate="question.validation_min_datetime"
                    t-att-data-maxdate="question.validation_max_datetime"
                    t-att-data-questiontype="question.question_type">
                <input type="text" class="form-control datetimepicker-input" t-attf-data-target="#datetimepicker_#{question.id}" t-att-name="prefix"/>
                <div class="input-group-append" t-attf-data-target="#datetimepicker_#{question.id}" data-toggle="datetimepicker">
                    <div class="input-group-text"><i class="fa fa-calendar"></i></div>
                </div>
            </div>
        </div>
    </template>

    <template id="simple_choice" name="Simple choice">
        <div t-if="question.display_mode == 'dropdown' and answer.token" class="js_drop row">
            <div class="col-lg-4">
                <select class="form-control" t-att-name="prefix">
                    <option disabled="1" selected="1" value="">Choose...</option>
                    <t t-foreach='question.labels_ids' t-as='label'>
                        <option t-att-value='label.id'><t t-esc='label.value'/></option>
                    </t>
                    <t t-if='question.comments_allowed and question.comment_count_as_answer'>
                        <option class="js_other_option" value="-1"><span t-esc="question.comments_message" /></option>
                    </t>

                </select>
            </div>
            <div class="col">
                <textarea t-if='question.comments_allowed and question.comment_count_as_answer'  type="text" class="form-control" rows="1" t-att-name="'%s_%s' % (prefix, 'comment')" data-oe-survey-othert="1"/>
            </div>
            <div t-if='question.comments_allowed and not question.comment_count_as_answer' class="mt-2 row">
                <div class="col">
                    <label t-field="question.comments_message"/>
                    <textarea type="text" class="form-control" rows="1" t-att-name="'%s_%s' % (prefix, 'comment')"/>
                </div>
            </div>
        </div>
        <div t-if="question.display_mode == 'columns' or not answer.token" class="js_radio  ">
            <div t-foreach='question.labels_ids' t-as='label' t-attf-class="col-lg-#{question.column_nb} form-check">
                <label>
                    <input type="radio" t-att-name="prefix" t-att-value='label.id' class="form-check-input"/>
                    <span t-field='label.value' class="form-check-label"/>
                    <span t-if="quizz_correction and label.answer_score > 0" class="fa fa-check text-success"/>
                </label>
            </div>
            <div t-if='question.comments_allowed and question.comment_count_as_answer' class="js_comments col" >
                <label>
                    <input type="radio" t-att-name="prefix" value="-1" class="form-check-input"/>
                    <span t-field="question.comments_message" />
                </label>
                <textarea type="text" class="form-control" rows="1" t-att-name="'%s_%s' % (prefix, 'comment')"/>
            </div>
            <div t-if='question.comments_allowed and not question.comment_count_as_answer' class="mt-2 row">
                <div class="col">
                    <label t-field="question.comments_message"/>
                    <textarea type="text" class="form-control" rows="1" t-att-name="'%s_%s' % (prefix, 'comment')" data-oe-survey-othert="1"/>
                </div>
            </div>
        </div>
    </template>

    <template id="multiple_choice" name="Multiple choice">
        <div class="container">
            <div>
                <div t-foreach='question.labels_ids' t-as='label' t-attf-class="col-lg-#{question.column_nb} form-check">
                    <label>
                        <input type="checkbox" t-att-name="'%s_%s' % (prefix, label.id)" t-att-value='label.id' class="form-check-input"/>
                        <span class="form-check-label" t-field='label.value'/>
                       <span t-if="quizz_correction and label.answer_score > 0.0" class="fa fa-check text-success"/>
                    </label>
                </div>
            </div>
        </div>
            <div t-if='question.comments_allowed and question.comment_count_as_answer' class="js_ck_comments col form-check" >
                <label>
                    <input type="checkbox" t-att-name="'%s_%s' % (prefix, -1)" value="-1" class="form-check-input"/>
                    <span t-field="question.comments_message" />
                </label>
                <textarea type="text" class="form-control" rows="1" t-att-name="'%s_%s' % (prefix, 'comment')"/>
            </div>
            <div t-if='question.comments_allowed and not question.comment_count_as_answer' class="mt-2 row">
                <div class="col">
                    <label t-field="question.comments_message"/>
                    <textarea type="text" class="form-control" rows="1" t-att-name="'%s_%s' % (prefix, 'comment')" data-oe-survey-othert="1"/>
                </div>
            </div>
    </template>

    <template id="matrix" name="Matrix">
        <table class="table border table-hover">
            <thead>
                <tr>
                    <th> </th>
                    <th t-foreach="question.labels_ids" t-as="col_label"><span t-field="col_label.value" /></th>
                </tr>
            </thead>
            <tbody>
                <tr t-foreach="question.labels_ids_2" t-as="row_label">
                    <th><span t-field="row_label.value" /></th>
                    <td t-foreach="question.labels_ids" t-as="col_label">
                        <input t-if="question.matrix_subtype == 'simple'" type="radio" t-att-name="'%s_%s' % (prefix, row_label.id)" t-att-value='col_label.id' />
                        <input t-if="question.matrix_subtype == 'multiple'" type="checkbox" t-att-name="'%s_%s_%s' % (prefix, row_label.id, col_label.id)" t-att-value='col_label.id' />
                    </td>
                </tr>
            </tbody>
        </table>
        <div t-if='question.comments_allowed' class="row">
            <div class="col">
                <label t-field="question.comments_message"/>
                <textarea class="form-control" rows="1" t-att-name="'%s_%s' % (prefix, 'comment')" />
            </div>
        </div>
    </template>

    <!-- Printable view of a survey (all pages) -->
    <template id="survey_print" name="Survey">
        <t t-call="survey.layout">
            <div class="wrap">
                <div class="container">
                    <t t-if="answer.test_entry" t-call="survey.back" />
                    <div class='mt-4 p-3 border rounded'>
                        <h1 t-field='survey.title'/>
                        <t t-if="survey.description"><span t-field='survey.description' class="oe_no_empty text-muted"/></t>
                        <t t-if="review" t-call="survey.retake_survey_button"/>
                    </div>
                    <div role="form" class="js_surveyform mb-3" t-att-name="'%s' % (survey.id)" t-att-data-prefill="'/survey/prefill/%s/%s' % (survey.access_token, answer.token)">
                        <t t-foreach='survey.question_and_page_ids' t-as='question'>
                            <div t-if="question.is_page" t-attf-class="pt-4 #{'border-top mt-4' if question.is_page and question != survey.page_ids[0] else ''} mb-4">
                                <h1 t-field='question.title' />
                                <span t-if="question.description" t-field='question.description' class="oe_no_empty text-muted"/>
                                <hr/>
                            </div>
                            <t t-if="not question.is_page and answer or (question in answer.question_ids)" >
                                <t t-set="prefix" t-value="'%s_%s' % (survey.id, question.id)" />
                                <div t-attf-class="js_question-wrapper form-group mb-3 pt-2" t-att-id="prefix">
                                        <label t-field='question.question' class="font-weight-bold"/>
                                        <span t-if="question.constr_mandatory" class="text-danger">*</span>
                                        <span t-if="quizz_correction" class="badge badge-pill" t-att-data-score-question="question.id"></span>
                                    <t t-if="question.description"><span class="text-muted oe_no_empty" t-field='question.description'/></t>
                                    <t t-if="question.question_type == 'free_text'"><t t-call="survey.free_text"/></t>
                                    <t t-if="question.question_type == 'textbox'"><t t-call="survey.textbox"/></t>
                                    <t t-if="question.question_type == 'numerical_box'"><t t-call="survey.numerical_box"/></t>
                                    <t t-if="question.question_type == 'date'"><t t-call="survey.date"/></t>
                                    <t t-if="question.question_type == 'datetime'"><t t-call="survey.datetime"/></t>
                                    <t t-if="question.question_type == 'simple_choice'"><t t-call="survey.simple_choice"/></t>
                                    <t t-if="question.question_type == 'multiple_choice'"><t t-call="survey.multiple_choice"/></t>
                                    <t t-if="question.question_type == 'matrix'"><t t-call="survey.matrix"/></t>
                                    <div class="js_errzone alert alert-danger mt-2" style="display:none;" role="alert"></div>
                                </div>
                            </t>
                        </t>
                    </div>
                </div>
            </div>
        </t>
    </template>

    <template id="result" name="Survey Result">
        <t t-call="survey.layout">
            <div class="oe_structure" id="oe_structure_survey_result_1"/>
            <div class="container js_surveyresult mb-4">
                <t t-call="survey.back" />
                <div class="p-3 mb-4 border rounded">
                    <h1>Results for : <span t-field="survey.title" />
                    <!-- <span style="font-size:1.5em;" t-attf-class="fa fa-bar-chart-o #{'fa-bar-chart-o' if survey.scoring_type == 'no_scoring' else 'fa-trophy' if survey.certificate else 'fa-question-circle-o'} float-right " role="img" aria-label="Chart" title="Chart"/> --></h1>
                    <span t-field="survey.description" class="oe_no_empty text-muted" />
                    <p class="text-danger" t-if="not answers">
                        Sorry, no one has answered this survey yet.
                    </p>
                </div>
                <div t-if="answers" class="d-print-none">
                    <div class="border-bottom pb-2 mb-3">
                        <span class="fa fa-filter"></span>  Filters <span t-if="filter_display_data" class="float-right text-primary clear_survey_filter"><i class="fa fa-times"></i> Clear All Filters</span>
                    </div>
                    <div class="">
                        <div t-if="filter_finish == True">
                            <span class="btn border mr-2 filter-all">All surveys</span><span class="btn btn-primary ml-2 filter-finished">Finished surveys</span>
                        </div>
                        <div t-if="filter_finish == False">
                            <span class="btn btn-primary mr-2 filter-all">All surveys</span><span class="btn border ml-2 filter-finished">Finished surveys</span>
                        </div>
                        <div t-foreach="filter_display_data" t-as="filter_data">
                            <span class="btn btn-primary mr-2"><i class="fa fa-filter" role="img" aria-label="Filter" title="Filter"></i></span><span class="btn btn-primary no_radius" t-esc="filter_data['question_text']"></span><span class="btn btn-success ml-2" t-esc="' > '.join(filter_data['labels'])"></span>
                        </div>
                    </div>
                </div>
                <div t-if="survey.scoring_type in ['scoring_with_answers', 'scoring_without_answers']">
                    <h1 class="mt16">Results Overview</h1>
                    <div>Success rate: <mark class="font-weight-bold"><t t-esc="survey_dict['success_rate']"></t>%</mark></div>
                    <div id="scoring_results_chart" t-att-data-graph_data="survey_dict['scoring_graph_data']">
                        <!-- canvas element for drawing pie chart -->
                        <canvas class="mt-3 mb-3"/>
                    </div>
                    <hr/>
                </div>
                <div t-if="answers" t-foreach="survey_dict['page_ids']" t-as='page_ids'>
                    <t t-set="page" t-value="page_ids['page']"/>
                    <div class="mt-5">
                        <h1 class="" t-field='page.title'></h1>
                        <span t-field="page.description" class="oe_no_empty text-muted" />
                    </div>
                    <hr/>
                    <div t-foreach="page_ids['question_ids']" t-as='question_ids' class="mt-3 card">
                        <t t-set="input_summary" t-value="question_ids['input_summary']"/>
                        <t t-set="question" t-value="question_ids['question']"/>
                        <t t-set="graph_data" t-value="question_ids['graph_data']"/>
                        <t t-set="prepare_result" t-value="question_ids['prepare_result']"/>
                        <t t-set="question_with_correct_answers" t-value="survey.scoring_type in ['scoring_with_answers', 'scoring_without_answers'] and question.question_type in ['simple_choice', 'multiple_choice']" />
                        <h4 class="card-header">
                            Question :
                            <label t-field='question.question' class="font-weight-bold"/>
                            <span class="float-right">
                                <span class="badge badge-pill badge-success"><span t-esc="input_summary['answered']"></span> Answered</span>
                                <span class="badge badge-pill badge-warning"><span t-esc="input_summary['skipped']"></span> Skipped</span>
                            </span>
                            <t t-if="question.question_type == 'matrix'">
                                <br/><small><span class="badge badge-pill badge-secondary">Matrix: <span t-field='question.matrix_subtype'/></span></small>
                            </t>
                            <t t-if="question.question_type in ['simple_choice', 'multiple_choice']">
                                <br/><small><span t-field='question.question_type' class="badge badge-pill badge-secondary"></span></small>
                            </t>
                        </h4>
                        <t t-if="question_with_correct_answers">
                            <t t-set="correct_answers" t-value="question.get_correct_answer_ids()" />
                            <div t-if="correct_answers" class="p-3">
                                <t t-if="question.question_type == 'simple_choice'">
                                    <h6 class="font-weight-bold">Correct answer :</h6>
                                    <p class="p-3 border-top" t-esc="correct_answers[0].value"/>
                                </t>
                                <t t-if="question.question_type == 'multiple_choice'">
                                    <h6 class="font-weight-bold">Correct answers :</h6>
                                    <ul class="list-group list-group-flush">
                                        <li t-foreach="correct_answers" class="list-group-item" t-as="correct_answer">
                                            <t t-esc="correct_answer.value" />
                                        </li>
                                    </ul>
                                </t>
                            </div>
                        </t>
                        <t t-if="input_summary['answered'] != 0">
                            <t t-if="question.description">
                                <span class="text-muted oe_no_empty" t-field="question.description" />
                            </t>
                            <t t-if="question.question_type in ['textbox', 'free_text', 'date', 'datetime']">
                                <t t-call="survey.result_text"></t>
                            </t>
                            <t t-if="question.question_type in ['simple_choice', 'multiple_choice']">
                                <t t-call="survey.result_choice"></t>
                            </t>
                            <t t-if="question.question_type == 'matrix'">
                                <t t-call="survey.result_matrix"></t>
                            </t>
                            <t t-if="question.question_type == 'numerical_box'">
                                <t t-call="survey.result_number"></t>
                            </t>
                        </t>
                        <t t-if="input_summary['answered'] == 0">
                            <h2 style="padding-top:30px;padding-bottom:30px;text-align:center;" class="text-muted">Sorry, No one answered this question.</h2>
                        </t>
                    </div>
                </div>
            </div>
            <div class="oe_structure" id="oe_structure_survey_result_2"/>
        </t>
    </template>

    <!-- Result for free_text,textbox and date -->
    <template id="result_text" name="Text Result">
        <table class="table table-hover" t-att-id="'table_question_%d' % question.id">
            <thead class="thead-light">
                <tr>
                    <th>#</th>
                    <th>User Responses</th>
                </tr>
            </thead>
            <tbody>
                <t t-set="text_result" t-value="prepare_result"/>
                <tr t-foreach="text_result" t-as="user_input">
                    <td>
                        <a t-att-href="'/survey/print/%s?answer_token=%s' % (user_input.survey_id.access_token, user_input.user_input_id.token)">
                            <t t-esc="user_input_index + 1"></t>
                        </a>
                    </td>
                    <t t-if="question.question_type == 'free_text'">
                        <td>
                            <span t-field="user_input.value_free_text"/>
                            <br/>
                        </td>
                    </t>
                    <t t-if="question.question_type == 'textbox'">
                        <td>
                            <span t-field="user_input.value_text"/>
                            <br/>
                        </td>
                    </t>
                    <t t-if="question.question_type == 'date'">
                        <td>
                            <span t-field="user_input.value_date"/>
                            <br/>
                        </td>
                    </t>
                    <t t-if="question.question_type == 'datetime'">
                        <td>
                            <span t-field="user_input.value_datetime"/>
                            <br/>
                        </td>
                    </t>
                </tr>
            </tbody>
        </table>
        <t t-call="survey.pagination" />
    </template>

    <!-- Result for comments -->
    <template id="result_comments" name="Text Result">
        <!-- a 'comments' variable must be set an must contain a list of browse records of user input lines -->
        <table class="table table-hover" t-att-id="'table_question_%d' % question.id">
            <thead class="thead-light">
                <tr>
                    <th>#</th>
                    <th>Comment</th>
                </tr>
            </thead>
            <tbody>
                <tr t-foreach="comments" t-as="user_input">
                    <td><a t-att-href="'/survey/print/%s?answer_token=%s' % (user_input.survey_id.access_token, user_input.user_input_id.token)"><t t-esc="user_input_index + 1"></t></a></td>
                        <td>
                            <span t-field="user_input.value_text"></span><br/>
                        </td>
                </tr>
            </tbody>
        </table>
    </template>

    <!-- Result for simple_choice and multiple_choice -->
    <template id="result_choice" name="Choice Result">
        <div>
            <!-- Tabs -->
            <ul class="nav nav-tabs d-print-none" role="tablist">
                <li class="nav-item" t-if="question.question_type != 'simple_choice'">
                    <a t-att-href="'#graph_question_%d' % question.id" t-att-aria-controls="'graph_question_%d' % question.id" class="nav-link active" data-toggle="tab" role="tab">
                        <i class="fa fa-bar-chart-o"></i> Graph
                    </a>
                </li>
                <li class="nav-item" t-if="question.question_type == 'simple_choice'">
                    <a t-att-href="'#graph_question_%d' % question.id" t-att-aria-controls="'graph_question_%d' % question.id" class="nav-link active" data-toggle="tab" role="tab">
                        <i class="fa fa-bar-chart-o"></i> Pie Chart
                    </a>
                </li>
                <li class="nav-item">
                    <a t-att-href="'#data_question_%d' % question.id" t-att-aria-controls="'data_question_%d' % question.id" class="nav-link" data-toggle="tab" role="tab">
                        <i class="fa fa-list-alt"></i> Data
                    </a>
                </li>
            </ul>
            <div class="tab-content">
                <div role="tabpanel" class="tab-pane active survey_graph" t-if="question.question_type != 'simple_choice'" t-att-id="'graph_question_%d' % question.id" t-att-data-question_id="question.id" data-graph_type="bar" t-att-graph-data="graph_data">
                    <!-- canvas element for drawing bar chart -->
                    <canvas class="mt-3 mb-3"/>
                </div>
                <div role="tabpanel" class="tab-pane active survey_graph" t-if="question.question_type == 'simple_choice'" t-att-id="'graph_question_%d' % question.id" t-att-data-question_id="question.id" data-graph_type="pie" t-att-graph-data="graph_data">
                    <!-- canvas element for drawing pie chart -->
                    <canvas class="mt-3 mb-3"/>
                </div>
                <div role="tabpanel" class="tab-pane" t-att-id="'data_question_%d' % question.id">
                    <table class="table table-hover">
                        <thead class="thead-light">
                            <tr>
                                <th>Answer Choices</th>
                                <th>User Responses</th>
                                <th t-if="question_with_correct_answers">Answer Score</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr t-foreach="prepare_result['answers']" t-as="user_input">
                                <td>
                                    <p t-esc="user_input['text']"></p>
                                </td>
                                <td class="survey_answer">
                                    <span t-esc="round(user_input['count']*100.0/(input_summary['answered'] or 1),2)"></span> %
                                    <span t-esc="user_input['count']" class="badge badge-primary">Vote</span>
                                    <i class="fa fa-filter text-primary invisible survey_filter" t-att-data-question_id="question.id" t-att-data-answer_id="user_input['answer_id']" role="img" aria-label="Filter question" title="Filter question"/>
                                </td>
                                <td t-if="question_with_correct_answers" t-esc="user_input['answer_score']">
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            <!-- handle comments -->
            <div>
                <t t-set="comments" t-value="prepare_result['comments']" />
                <t t-if="comments">
                    <t t-call="survey.result_comments" />
                </t>
            </div>

        </div>
    </template>

    <!-- Result for matrix -->
    <template id="result_matrix" name="Matrix Result">
        <t t-set="matrix_result" t-value="prepare_result"/>
        <!-- Tabs -->
        <ul class="nav nav-tabs d-print-none" role="tablist">
            <li class="nav-item">
                <a t-att-href="'#graph_question_%d' % question.id" t-att-aria-controls="'graph_question_%d' % question.id" class="nav-link active" data-toggle="tab" role="tab">
                    <i class="fa fa-bar-chart"></i>
                    Graph
                </a>
            </li>
            <li class="nav-item">
                <a t-att-href="'#data_question_%d' % question.id" t-att-aria-controls="'data_question_%d' % question.id" class="nav-link" data-toggle="tab" role="tab">
                    <i class="fa fa-list-alt"></i>
                    Data
                </a>
            </li>
        </ul>
        <div class="tab-content">
            <div role="tabpanel" class="tab-pane active with-3d-shadow with-transitions survey_graph" t-att-id="'graph_question_%d' % question.id" t-att-data-question_id= "question.id" data-graph_type= "multi_bar" t-att-graph-data="graph_data">
                <!-- canvas element for drawing Multibar chart -->
                <canvas class="mt-3 mb-3"/>
            </div>
            <div role="tabpanel" class="tab-pane" t-att-id="'data_question_%d' % question.id">
                <table class="table table-hover">
                    <thead class="thead-light">
                        <tr>
                            <th></th>
                            <th t-foreach="matrix_result['answers']" t-as="answer_id">
                                <span t-esc="matrix_result['answers'][answer_id]"></span>
                            </th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr t-foreach="matrix_result['rows']" t-as="row_id">
                            <th>
                                <span t-esc="matrix_result['rows'][row_id]"></span>
                            </th>
                            <td class="survey_answer" t-foreach="matrix_result['answers']" t-as="answer_id">
                                <span t-esc="round(matrix_result['result'][(row_id,answer_id)]*100.0/(input_summary['answered'] or 1),2)"></span> %
                                <span class="badge badge-primary" t-esc="matrix_result['result'][(row_id,answer_id)]"></span><i class="fa fa-filter text-primary invisible survey_filter" t-att-data-question_id="question.id" t-att-data-row_id="row_id" t-att-data-answer_id="answer_id" role="img" aria-label="Survey filter" title="Survey filter"></i>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <!-- handle comments to matrix -->
            <div>
                <t t-set="comments" t-value="matrix_result['comments']" />
                <t t-if="comments">
                    <t t-call="survey.result_comments" />
                </t>
            </div>
        </div>
    </template>

    <!-- Result for Numeric Data -->
    <template id="result_number" name="Number Result">
        <t t-set="number_result" t-value="prepare_result"/>
        <t t-set="text_result" t-value="number_result['input_lines']" />
        <span class="float-right p-3">
            <span class="badge badge-secondary only_left_radius">Sum </span> <span class="badge badge-info only_right_radius" t-esc="number_result['sum']"></span>
            <span class="badge badge-secondary only_left_radius">Maximum </span> <span class="badge badge-success only_right_radius" t-esc="number_result['max']"></span>
            <span class="badge badge-secondary only_left_radius">Minimum </span> <span class="badge badge-danger only_right_radius" t-esc="number_result['min']"></span>
            <span class="badge badge-secondary only_left_radius">Average </span> <span class="badge badge-warning only_right_radius" t-esc="number_result['average']"></span>
        </span>
        <ul class="nav nav-tabs d-print-none" role="tablist">
            <li class="nav-item">
                <a t-att-href="'#most_common_%d' % question.id" t-att-aria-controls="'most_common_%d' % question.id" class="nav-link active" data-toggle="tab" role="tab">
                    <i class="fa fa-list-ol"></i>
                    Most Common <span t-esc="len(number_result['most_common'])"></span>
                </a>
            </li>
            <li class="nav-item">
                <a t-att-href="'#data_question_%d' % question.id" t-att-aria-controls="'data_question_%d' % question.id" class="nav-link" data-toggle="tab" role="tab">
                    <i class="fa fa-list-alt"></i>
                    All Data
                </a>
            </li>
        </ul>
        <div class="tab-content">
            <div role="tabpanel" class="tab-pane active with-3d-shadow with-transitions" t-att-id="'most_common_%d' % question.id">
                <table class="table table-hover">
                     <thead class="thead-light">
                         <tr>
                             <th>User Responses</th>
                             <th>Occurence</th>
                         </tr>
                     </thead>
                     <tbody>
                         <tr t-foreach="number_result['most_common']" t-as="row">
                             <td>
                                 <span t-esc="row[0]"></span>
                             </td>
                             <td>
                                 <span t-esc="row[1]"></span>
                             </td>
                         </tr>
                     </tbody>
                </table>
            </div>
            <div role="tabpanel" class="tab-pane" t-att-id="'data_question_%d' % question.id">
                <table class="table table-hover" t-att-id="'table_question_%d' % question.id">
                    <thead class="thead-light">
                        <tr>
                            <th>#</th>
                            <th>User Responses</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr class="d-none" t-foreach="number_result['input_lines']" t-as="user_input">
                            <td><a t-att-href="'/survey/print/%s?answer_token=%s' % (user_input.survey_id.access_token, user_input.user_input_id.token)"><t t-esc="user_input_index + 1"></t></a></td>
                            <td><span t-field="user_input.value_number"></span><br/></td>
                        </tr>
                    </tbody>
                </table>
               <t t-call="survey.pagination"/>
            </div>
        </div>
    </template>
    <!-- Pagination Element -->
    <template id="pagination" name="Survey Result">
        <t t-set="record_limit" t-value="10"/><!-- Change This record_limit to change number of record  per page-->
        <ul t-att-id="'pagination_%d' % question.id" class="pagination" t-att-data-question_id="question.id" t-att-data-record_limit="record_limit">
            <t t-if="len(text_result) > record_limit">
                <li t-foreach="page_range(len(text_result), record_limit)" t-as="num" class="page-item">
                    <a href="#" class="page-link" t-esc="num"></a>
                </li>
            </t>
        </ul>
    </template>
</data>
</odoo>
