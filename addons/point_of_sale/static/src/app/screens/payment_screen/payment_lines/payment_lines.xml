<?xml version="1.0" encoding="UTF-8"?>
<templates id="template" xml:space="preserve">

    <t t-name="point_of_sale.PaymentScreenPaymentLines">
        <div t-if="props.paymentLines.length" class="paymentlines flex-grow-1 d-flex flex-column overflow-y-auto gap-2" t-att-class="{'mb-3': !this.ui.isSmall}">
            <t t-foreach="props.paymentLines" t-as="line" t-key="line.uuid">
                <div class="paymentline d-flex align-items-center rounded-3" t-att-class="{ 'selected': line.isSelected() }">
                    <!-- Show QR Code -->
                    <t t-if="line.useQr">
                        <button class="paymentline_show_qr_code btn btn-link ms-2 ps-3" t-on-click="() => this.showQrCode(line)" t-att-disabled="!line.qr_code || !line.isProcessing()" aria-label="Show QR Code" title="Show QR Code">
                            <i class="fa fa-qrcode" role="img" />
                        </button>
                    </t>

                    <!-- Payment Info -->
                    <div class="payment-infos d-flex align-items-center justify-content-between flex-grow-1 px-3 py-3 text-truncate cursor-pointer fs-2" t-on-click="() => this.selectLine(line)">
                        <span class="payment-name" t-esc="line.payment_method_id.name"/>
                        <div class="payment-amount px-3">
                            <PriceFormatter price="env.utils.formatCurrency(line.getAmount())" />
                        </div>
                    </div>

                    <!-- Delete or Spinner -->
                    <div t-if="(!line.isSelected() and line.isProcessing())"
                        class="payment-spinner mx-2 px-3">
                        <i class="fa fa-circle-o-notch fa-spin" role="img" />
                    </div>
                    <button t-elif="(!line.isDone() or !line.payment_status)"
                            class="delete-button btn btn-link mx-2 px-3"
                            t-on-click="() => this.props.deleteLine(line.uuid)"
                            aria-label="Delete"
                            title="Delete">
                        <i class="oi oi-close text-danger" />
                    </button>
                </div>

                <!-- Payment Status -->
                <div t-if="line?.isSelected()" class="paymentline_status bg-body-secondary rounded-3">
                    <t t-set="state" t-value="this.getPaymentActionState(line)" />
                    <t t-if="state.id !== 'unknown'">
                        <div class="paymentline_status_title d-flex justify-content-between align-items-center gap-2 py-3 px-4 fs-4" t-attf-class="paymentline_status_title_{{state.id}}">
                            <span class="text-truncate" t-esc="state.title" />
                            <t t-if="state.icon">
                                <i t-att-class="state.icon" role="img" />
                            </t>
                        </div>
                        <div class="paymentline_status_actions btn-group d-flex w-100" role="group">
                            <button t-foreach="state.actions" t-as="button" t-key="button.id"
                                    t-if="button.show === undefined || button.show"
                                    t-attf-class="paymentline_status_actions_button paymentline_status_actions_button_{{button.id}} ms-0 p-3 fs-4 btn btn-{{button.severity}}"
                                    t-att-title="button.title || button.label"
                                    t-on-click="button.action"
                                    t-esc="button.label" />
                        </div>
                    </t>
                </div>
            </t>
        </div>
    </t>

</templates>
