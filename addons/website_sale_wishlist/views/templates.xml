<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <!-- Inject the wishlist button into the products cards template -->
    <template
        id="website_sale_wishlist.add_to_wishlist"
        inherit_id="website_sale.shop_product_buttons"
        name="Wishlist Button"
        priority="20"
        active="True"
    >
        <t name="buttons_container" position="inside">
            <t t-set="isWishlistAvailable" t-value="products_in_wishlist is not None"/>

            <t t-if="isWishlistAvailable" t-call="website_sale.product_tile_element_visibility"
                visible_element_class.f="o_wsale_products_opt_has_wishlist">

                <t t-set="in_wish" t-value="product in products_in_wishlist"/>
                <t t-set="btnTitle">Add to wishlist</t>
                <t t-set="btnTitleActive">Handle your wishlist from the menu icon.</t>
                <t
                    t-set="product_variant_id"
                    t-value="in_wish or product._get_first_possible_variant_id()"
                />
                <button
                    t-if="product_variant_id"
                    t-attf-class="btn o_add_wishlist #{in_wish and 'o_in_wishlist'}"
                    t-att-disabled="in_wish"
                    t-att-data-product-id="product_variant_id"
                    t-att-data-product-template-id="product.id"
                    t-att-title="in_wish and btnTitleActive or btnTitle"
                >
                    <span
                        t-attf-class="fa o_not-animable #{in_wish and 'fa-heart' or 'fa-heart-o'}"
                        role="presentation"
                    />
                    <span t-if="not in_wish" class="o_label small ms-2">Add to wishlist</span>
                    <span t-else="" class="o_label small ms-2">In your wishlist</span>
                </button>
            </t>
        </t>
    </template>

    <template
        id="website_sale_wishlist.product_cart_lines"
        inherit_id="website_sale.cart_lines"
        active="True"
    >
        <xpath expr="//div[@name='o_wsale_cart_line_button_container']/button" position="after">
            <t t-if="line._is_sellable()">
                <span class="text-300">|</span>
                <button
                    class="o_add_wishlist js_delete_product btn btn-link btn-sm p-0"
                    t-att-data-product-id="line.product_id.id"
                    t-att-data-product-template-id="line.product_id.product_tmpl_id.id"
                >
                    Save for Later
                </button>
            </t>
        </xpath>

        <xpath expr="//div[@name='o_wsale_cart_line_button_container_mobile']/button" position="before">
            <button
                t-if="line._is_sellable()"
                class="o_add_wishlist js_delete_product btn btn-link d-inline-block d-md-none px-2"
                t-att-data-product-id="line.product_id.id"
                t-att-data-product-template-id="line.product_id.product_tmpl_id.id"
                title="Wishlist"
            >
                <i class="fa fa-fw fa-heart-o"/>
            </button>
        </xpath>
    </template>

    <template
        id="website_sale_wishlist.product_add_to_wishlist"
        inherit_id="website_sale.cta_wrapper"
        name="Wishlist Button"
        priority="20"
    >
        <xpath expr="//div[@id='product_option_block']" position="inside">
            <t t-set="product_variant" t-value="product_variant or product._create_first_product_variant()"/>
            <t t-set="in_wish" t-value="product_variant and product_variant._is_in_wishlist()"/>
            <t
                t-set="_button_classes"
                t-valuef="o_add_wishlist_dyn btn btn-outline-primary text-nowrap"
            />
            <t
                t-if="website.product_page_image_width == '50_pc' and not (is_view_active('website_sale.cta_wrapper_boxed') or is_view_active('website_sale.cta_wrapper_large'))"
                t-set="_button_classes"
                t-value="_button_classes + ' flex-grow-1 flex-sm-grow-0'"
            />
            <t
                t-else=""
                t-set="_button_classes"
                t-value="_button_classes + ' flex-grow-1'"
            />
            <t
                t-if="is_view_active('website_sale.cta_wrapper_large')"
                t-set="_button_classes"
                t-value="_button_classes + ' btn-lg px-lg-0'"
            />
            <button
                t-if="product_variant"
                t-att-class="_button_classes"
                t-att-disabled="in_wish"
                t-att-data-product-id="product_variant.id"
                t-att-data-product-template-id="product.id"
                title="Add to wishlist"
            >
                <i class="fa fa-heart-o me-2 me-lg-0" role="img" aria-label="Add to wishlist"/>
                <t
                    t-set="_span_classes"
                    t-valuef="d-inline"
                />
                <t
                    t-if="website.product_page_image_width == '50_pc' and not (is_view_active('website_sale.cta_wrapper_boxed') or is_view_active('website_sale.cta_wrapper_large'))"
                    t-set="_span_classes"
                    t-value="_span_classes + ' d-lg-none'"
                />
                <span t-att-class="_span_classes">Add to wishlist</span>
            </button>
        </xpath>
    </template>

    <template id="website_sale_wishlist.header_wishlist_link" name="Header Wishlist Link">
        <t t-set="wishcount" t-value="len(request.env['product.wishlist'].current())"/>
        <t t-set="show_wishes" t-value="website.has_ecommerce_access()"/>
        <li t-attf-class="o_wsale_my_wish #{not show_wishes and 'd-none'} #{_item_class}">
            <a href="/shop/wishlist" t-attf-class="#{_link_class}">
                <div t-attf-class="#{_icon_wrap_class}">
                    <i t-if="_icon" class="fa fa-1x fa-heart fa-stack"/>
                    <sup
                        t-out="wishcount"
                        t-attf-class="my_wish_quantity o_animate_blink badge bg-primary #{_badge_class} #{'d-none' if (wishcount == 0) else ''}"
                    />
                </div>
                <span t-if="_text" t-attf-class="#{_text_class}">Wishlist</span>
            </a>
        </li>
    </template>

    <template id="website_sale_wishlist.header_hide_empty_wishlist_link" inherit_id="website_sale_wishlist.header_wishlist_link">
        <xpath expr="//t[@t-set='show_wishes']" position="after">
            <t t-set="show_wishes" t-value="show_wishes and wishcount > 0"/>
        </xpath>
        <xpath expr="//li[contains(@t-attf-class, 'o_wsale_my_wish')]" position="attributes">
            <attribute name="t-attf-class" add="o_wsale_my_wish_hide_empty" separator=" "/>
        </xpath>
    </template>

    <template id="website_sale_wishlist.template_header_mobile" inherit_id="website_sale.template_header_mobile">
        <xpath expr="//t[@t-call='website_sale.header_cart_link']" position="after">
            <t t-call="website_sale_wishlist.header_wishlist_link"
                _icon="True"
                _link_class.f="o_navlink_background_hover btn position-relative rounded-circle border-0 p-1 text-reset"
                _badge_class.f="position-absolute top-0 end-0 mt-n1 me-n1"/>
        </xpath>
    </template>

    <template id="website_sale_wishlist.template_header_default" inherit_id="website_sale.template_header_default">
        <xpath expr="//t[@t-call='website_sale.header_cart_link']" position="after">
            <t t-call="website_sale_wishlist.header_wishlist_link"
                _icon="True"
                _link_class.f="o_navlink_background btn position-relative rounded-circle p-1 text-center text-reset"
                _badge_class.f="position-absolute top-0 end-0 mt-n1 me-n1 rounded-pill"/>
        </xpath>
    </template>

    <template id="website_sale_wishlist.template_header_hamburger" inherit_id="website_sale.template_header_hamburger">
        <xpath expr="//t[@t-call='website_sale.header_cart_link']" position="after">
            <t t-call="website_sale_wishlist.header_wishlist_link"
                _icon="True"
                _link_class.f="o_navlink_background btn position-relative rounded-pill p-1 text-reset"
                _badge_class.f="position-absolute top-0 end-0 mt-n1 me-n1 rounded"/>
        </xpath>
    </template>

    <template id="website_sale_wishlist.template_header_stretch" inherit_id="website_sale.template_header_stretch">
        <xpath expr="//t[@t-call='website_sale.header_cart_link']" position="after">
            <t t-call="website_sale_wishlist.header_wishlist_link"
                _icon="True"
                _item_class.f="border-start o_border_contrast"
                _link_class.f="o_navlink_background_hover btn position-relative d-flex align-items-center h-100 rounded-0 p-2 text-reset"
                _badge_class.f="rounded"/>
        </xpath>
    </template>

    <template id="website_sale_wishlist.template_header_vertical" inherit_id="website_sale.template_header_vertical">
        <xpath expr="//t[@t-call='website_sale.header_cart_link']" position="after">
            <t t-call="website_sale_wishlist.header_wishlist_link"
                _icon="True"
                _link_class.f="o_navlink_background btn position-relative rounded-circle p-1 text-reset"
                _badge_class.f="position-absolute top-0 end-0 mt-n1 me-n1 rounded-pill"/>
        </xpath>
    </template>

    <template id="website_sale_wishlist.template_header_search" inherit_id="website_sale.template_header_search">
        <xpath expr="//t[@t-call='website_sale.header_cart_link']" position="after">
            <t t-call="website_sale_wishlist.header_wishlist_link"
                _text="True"
                _item_class.f="border-start o_border_contrast"
                _link_class.f="o_navlink_background_hover btn btn-sm d-flex align-items-center gap-1 h-100 rounded-0 p-2 text-reset"
                _badge_class.f="rounded"/>
        </xpath>
    </template>

    <template id="website_sale_wishlist.template_header_sales_one" inherit_id="website_sale.template_header_sales_one">
        <xpath expr="//t[@t-call='website_sale.header_cart_link']" position="after">
            <t t-call="website_sale_wishlist.header_wishlist_link"
                _icon="True"
                _link_class.f="o_navlink_background btn position-relative rounded-circle p-1 text-reset"
                _badge_class.f="position-absolute top-0 end-0 mt-n1 me-n1 rounded-pill"/>
        </xpath>
    </template>

    <template id="website_sale_wishlist.template_header_sales_two" inherit_id="website_sale.template_header_sales_two">
        <xpath expr="//t[@t-call='website_sale.header_cart_link']" position="after">
            <t t-call="website_sale_wishlist.header_wishlist_link"
                _icon="True"
                _text="True"
                _icon_wrap_class.f="o_navlink_background position-relative me-2 rounded-circle p-2 transition-base"
                _link_class.f="o_navlink_trigger_hover btn d-flex align-items-center fw-bold text-reset"
                _badge_class.f="position-absolute top-0 end-0 mt-n1 me-n1 rounded-pill"
                _text_class.f="small"/>
        </xpath>
    </template>

    <template id="website_sale_wishlist.template_header_sales_three" inherit_id="website_sale.template_header_sales_three">
        <xpath expr="//t[@t-call='website_sale.header_cart_link']" position="after">
            <t t-call="website_sale_wishlist.header_wishlist_link"
                _text="True"
                _item_class.f="position-relative"
                _link_class.f="nav-link d-flex flex-row-reverse align-items-center text-uppercase fw-bold"
                _icon_wrap_class.f="d-contains"
                _badge_class.f="top-0 d-block ms-2"/>
        </xpath>
    </template>

    <template id="website_sale_wishlist.template_header_sales_four" inherit_id="website_sale.template_header_sales_four">
        <xpath expr="//t[@t-call='website_sale.header_cart_link']" position="after">
            <t t-call="website_sale_wishlist.header_wishlist_link"
                _icon="True"
                _link_class.f="o_navlink_background btn position-relative rounded-pill p-1 text-reset"
                _badge_class.f="position-absolute top-0 end-0 mt-n1 me-n1 rounded-pill"/>
        </xpath>
    </template>

    <template id="website_sale_wishlist.template_header_sidebar" inherit_id="website_sale.template_header_sidebar">
        <xpath expr="//t[@t-call='website_sale.header_cart_link']" position="after">
            <t t-call="website_sale_wishlist.header_wishlist_link"
                _icon="True"
                _link_class.f="o_navlink_background btn position-relative p-1 rounded-circle text-reset"
                _badge_class.f="position-absolute top-0 end-0 mt-n1 me-n1 rounded-pill"/>
        </xpath>
    </template>

    <template id="website_sale_wishlist.template_header_boxed" inherit_id="website_sale.template_header_boxed">
        <xpath expr="//t[@t-call='website_sale.header_cart_link']" position="after">
            <t t-call="website_sale_wishlist.header_wishlist_link"
                _icon="True"
                _link_class.f="o_navlink_background btn position-relative rounded-circle p-1 text-center text-reset"
                _badge_class.f="position-absolute top-0 end-0 mt-n1 me-n1 rounded-pill"/>
        </xpath>
    </template>

</odoo>
