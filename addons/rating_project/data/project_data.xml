<?xml version="1.0" encoding="utf-8"?>
<openerp>
    <data>
        <record id="ir_cron_rating_project" model="ir.cron">
            <field name="name">Send Customer Rating Forms</field>
            <field name="interval_type">days</field>
            <field name="numbercall">-1</field>
            <field name="model">project.project</field>
            <field name="function">_send_rating_all</field>
        </record>

        <record id="mt_task_rating" model="mail.message.subtype">
            <field name="name">Task Rating</field>
            <field name="res_model">project.task</field>
            <field name="default" eval="True"/>
            <field name="description">Ratings</field>
        </record>

        <record id="mt_project_task_rating" model="mail.message.subtype">
            <field name="name">Task Rating</field>
            <field name="sequence">14</field>
            <field name="res_model">project.project</field>
            <field name="default" eval="True"/>
            <field name="parent_id" eval="ref('mt_task_rating')"/>
            <field name="relation_field">project_id</field>
        </record>

        <record id="rating_project_request_email_template" model="mail.template">
            <field name="name">Rating Project Request</field>
            <field name="email_from">${object.rated_partner_id.email or ''}</field>
            <field name="subject">
                % set resource = object.env[object.res_model].sudo().browse(object.res_id)
                ${resource.project_id.company_id.name}: Service Rating Request
            </field>
            <field name="model_id" ref="rating.model_rating_token"/>
            <field name="email_to" >${object.partner_id.email}</field>
            <field name="auto_delete" eval="True"/>
            <field name="body_html"><![CDATA[
            % set resource = object.env[object.res_model].sudo().browse(object.res_id)
            % set resource_type = object.res_model == 'project.task' and 'task' or 'issue'
            <div style="background:#F0F0F0;color:#515166;padding:10px 0px;font-family:Arial,Helvetica,sans-serif;font-size:14px;">
                <table style="width:600px;margin:5px auto;">
                    <tbody>
                        <tr>
                            <td>
                                <a href="/">
                                    <img src="/web/binary/company_logo" style="vertical-align:baseline;max-width:100px;" />
                                </a>
                            </td>
                            <td style="text-align:right;vertical-align:middle;">
                                Satisfaction Survey
                            </td>
                        </tr>
                    </tbody>
                </table>
                <table style="width:600px;margin:0px auto;background:white;border:1px solid #e1e1e1;">
                    <tbody>
                        <tr>
                            <td style="padding:15px 20px 10px 20px;">
                                <p>Hello,</p>
                                <p>
                                    Please take a moment to rate our services, related to the ${resource_type} "<strong>${resource.name}</strong>" assigned to <strong>${object.rated_partner_id.name}</strong>.
                                </p>
                                <p>
                                    We appreciate your feeback back. it helps us to improve continuously.
                                </p>
                            </td>
                        </tr>
                        <tr>
                            <td style="padding:10px 20px">
                                <table style="width:100%;border-top:1px solid #e1e1e1;">
                                    <tr>
                                        <td style="text-align:center;">
                                            <h2 style="font-weight:300;font-size:18px;">
                                                Tell us how you feel about our service:
                                            </h2>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td style="padding:10px 10px;">
                                            <table style="width:100%;text-align:center;">
                                                <tr>
                                                    <td>
                                                        <a href="/rating/${object.access_token}/10">
                                                            <img alt="Great" src="/rating/static/src/img/rating_10.png" title="It was great"/>
                                                        </a>
                                                    </td>
                                                    <td>
                                                        <a href="/rating/${object.access_token}/5">
                                                            <img alt="Okay" src="/rating/static/src/img/rating_5.png" title="It was okay"/>
                                                        </a>
                                                    </td>
                                                    <td>
                                                        <a href="/rating/${object.access_token}/1">
                                                            <img alt="Bad" src="/rating/static/src/img/rating_1.png" title="It wasn't good"/>
                                                        </a>
                                                    </td>
                                                </tr>
                                            </table>
                                        </td>
                                    </tr>
                                </table>
                            </td>
                        </tr>
                        <tr>
                            <td style="padding:10px 20px;>
                                ${resource.user_id.signature | safe}
                            </td>
                        </tr>
                    </tbody>
                </table>
                <table style="width:600px;margin:auto;text-align:center;font-size:12px;">
                    <tbody>
                        <tr>
                            <td style="padding-top:10px;color:#afafaf;">
                                % if resource.project_id.rating_status == 'stage':
                                    <p>This customer survey has been sent because your ${resource_type} has been moved to the stage <b>${resource.stage_id.name}</b></p>
                                % endif
                                % if resource.project_id.rating_status == 'periodic':
                                    <p>This customer survey has been sent <b>${resource.project_id.rating_status_period}</b> as long as the ${resource_type} is in the <b>${resource.stage_id.name}</b> stage.
                                % endif
                                <p>Email automatically sent by <a href="https://www.odoo.com/page/project-management" style="color:#a24689;text-decoration:none;">Odoo Project</a> for <a href="${resource.project_id.company_id.website}" style="color:#a24689;text-decoration:none;">${resource.project_id.company_id.name}</a></p>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
            ]]>
            </field>
        </record>
    </data>
</openerp>
