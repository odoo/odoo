<?xml version="1.0" encoding="utf-8"?>
<odoo>

<!--  Checks -->
    <record model="ir.ui.view" id="view_account_check_tree">
        <field name="name">account.check.tree</field>
        <field name="model">account.check</field>
        <field name="priority">100</field>
        <field name="groups_id" eval="[(4, ref('account.group_account_manager'))]"/>
        <field name="arch" type="xml">
            <tree decoration-info="state == 'draft'" decoration-bf="state == 'handed'" decoration-danger="state == 'hrejected'" decoration-muted="state == 'cancel'" string="Checks">
                <field name="checkbook_id" invisible="context.get('default_type',False) != 'own_check'"/>
                <field name="journal_id" invisible="1"/>
                <field name="name"/>
                <field name="issue_date"/>
                <field name="payment_date"/>
                <field name="first_partner_id" optional="show"/>
                <field name="partner_id" optional="show"/>
                <field name="type" invisible="1"/>
                <field name="bank_id" invisible="context.get('default_type',False) != 'third_check'"/>
                <field name="amount" sum="Total Amount"/>
                <field name="company_id" groups="base.group_multi_company"/>
                <field name="state"/>
                <field name="issuer_name" invisible="context.get('default_type',False) != 'third_check'"/>
                <field name="currency_id" invisible="1"/>
            </tree>
        </field>
    </record>

    <record model="ir.ui.view" id="view_account_check_form">
        <field name="name">account.check.form</field>
        <field name="model">account.check</field>
        <field name="arch" type="xml">
            <form string="Checks">
                <field name="id" invisible="1"/>
                <field name="type" invisible="1"/>
                <field name="journal_id" invisible="1"/>
                <field name="currency_id" invisible="1"/>
                <field name="company_currency_id" invisible="1"/>
                <header>
                    <field name="state" widget="statusbar"/>
                </header>
                <sheet string="Checks">
                    <h1>
                        <field name="name"/>
                    </h1>
                    <group>
                        <group>
                            <!-- <field name="number"/> -->
                            <field name="amount"/>
                            <field name="amount_company_currency" groups="base.group_multi_currency"/>
                            <field name="bank_id" attrs="{'invisible': [('type', '!=', 'third_check')], 'required': [('type', '=', 'third_check')]}"/>
                            <field name="journal_id" readonly="context.get('from_payment')" force_save="1" domain="[('type', 'in', ['bank', 'cash']), type == 'own_check' and ('outbound_payment_method_ids.code', '=', 'new_own_checks') or ('inbound_payment_method_ids.code', '=', 'in_own_checks')]"/>
                            <field name="checkbook_id" attrs="{'invisible':[('type','!=','own_check')], 'required':[('type','=','own_check')]}" domain="[('journal_id', '=', journal_id)]"/>
                        </group>
                        <group>
                            <field name="issuer_vat" attrs="{'invisible':[('type','!=','third_check')],'required':[('type','=','third_check')]}"/>
                            <field name="issuer_name" attrs="{'invisible':[('type','!=','third_check')],'required':[('type','=','third_check')]}"/>
                            <field name="issue_date"/>
                            <field name="payment_date"/>
                            <field name="company_id" groups="base.group_multi_company" widget="selection"/>
                        </group>
                    </group>
                    <group string="Operations" attrs="{'invisible': [('id', '=', False)]}">
                        <field name="operation_ids" nolabel="1">
                            <tree>
                                <field name="date"/>
                                <field name="operation"/>
                                <field name="move_line_id"/>
                                <field name="partner_id"/>
                            </tree>
                        </field>
                    </group>
                </sheet>
                <div class="oe_chatter">
                    <field name="message_follower_ids" widget="mail_followers"/>
                    <field name="activity_ids" widget="mail_activity"/>
                    <field name="message_ids" widget="mail_thread"/>
                </div>
            </form>
        </field>
    </record>

    <record model="ir.ui.view" id="view_checks_search">
        <field name="name">check.search</field>
        <field name="model">account.check</field>
        <field name="arch" type="xml">
            <search string="Checks">
                <field name="name"/>
                <field name="first_partner_id"/>
                <field name="partner_id"/>
                <field name="journal_id"/>
                <field name="company_id" groups="base.group_multi_company"/>
                <field name="state"/>
                <field name="issuer_name"/>
                <field name="issuer_vat"/>
                <field name="payment_date"/>
                <!-- no estaria funcionando en v9 -->
                <!-- invisible="context.get('default_type',False) != 'third_check'"  -->
                <filter name="to_cash" string="Ready to Cash" domain="[['state', '=', 'holding'], ['payment_date', '&lt;=', context_today().strftime('%Y-%m-%d')]]"/>
                <filter name="to_expire" string="Soon to Expire" domain="[['state', '=', 'holding'], ['payment_date', '&lt;=', (context_today()-datetime.timedelta(days=15)).strftime('%Y-%m-%d')]]"/>
                <group expand="0" string="Group By...">
                    <filter name="groupby_issue_date" string="Issue Date" context="{'group_by':'issue_date'}"/>
                    <filter name="groupby_payment_date" string="Payment Date" context="{'group_by':'payment_date'}"/>
                    <filter name="groupby_journal_id" string="Journal" context="{'group_by':'journal_id'}"/>
                    <filter name="groupy_state" string="State" context="{'group_by':'state'}"/>
                    <filter name="groupby_first_partner_id" string="First operation partner" context="{'group_by':'first_partner_id'}"/>
                    <filter name="groupby_last_partner_id" string="Last operation partner" context="{'group_by':'partner_id'}"/>
                </group>
            </search>
        </field>
    </record>

    <record model="ir.ui.view" id="view_account_check_calendar">
        <field name="name">account.check.calendar</field>
        <field name="model">account.check</field>
        <field name="arch" type="xml">
            <calendar string="Checks"
                    mode="month"
                    date_start="payment_date"
                    color="bank_id">
                <field name="amount"/>
            </calendar>
        </field>
    </record>

    <record model="ir.ui.view" id="view_account_check_graph">
        <field name="name">account.check.graph</field>
        <field name="model">account.check</field>
        <field name="arch" type="xml">
            <graph string="Check" type="bar">
                <field name="payment_date" type="row"/>
                <field name="amount" type="measure"/>
            </graph>
        </field>
    </record>

    <record model="ir.ui.view" id="view_account_check_pivot">
        <field name="name">account.check.calendar</field>
        <field name="model">account.check</field>
        <field name="arch" type="xml">
            <pivot string="Check">
                <field name="payment_date" type="row" interval="month"/>
                <field name="payment_date" type="row" interval="week"/>
               <field name="amount" type="measure"/>
            </pivot>
        </field>
    </record>

    <!-- Third Check Menu -->
    <record model="ir.actions.act_window" id="action_third_check">
        <field name="name">Third Checks</field>
        <field name="res_model">account.check</field>
        <field name="view_mode">tree,form,calendar,graph,pivot</field>
        <field name="domain">[('type','=','third_check')]</field>
        <field name="context">{'search_default_state':'holding','default_type':'third_check', 'search_default_groupby_journal_id': 1}</field>
    </record>

    <menuitem
        action="action_third_check"
        id="menu_third_check"
        sequence="40"
        parent="account.menu_finance_receivables"/>

    <!-- Issued Check Menu -->
    <record model="ir.actions.act_window" id="action_own_check">
        <field name="name">Own Checks</field>
        <field name="res_model">account.check</field>
        <field name="view_mode">tree,form,calendar,graph,pivot</field>
        <field name="domain">[('type','=','own_check')]</field>
        <field name="context">{'search_default_state':'handed','default_type':'own_check'}</field>
    </record>

    <menuitem
        action="action_own_check"
        id="menu_own_check"
        sequence="50"
        parent="account.menu_finance_payables"/>

</odoo>
