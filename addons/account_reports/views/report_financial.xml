<?xml version="1.0" encoding="utf-8"?>
<openerp>
<data>

<template id="report_financial_footnote_sup">
    <t t-if="column in a['footnotes']">
        <sup t-if="mode != 'print'">
            <b class="oe-account-footnote-sup"><a t-att-href="'#footnote' + str(a['footnotes'][column])"><t t-esc="a['footnotes'][column]"/></a></b>
        </sup>
        <sup t-if="mode == 'print'">
            <t t-esc="a['footnotes'][column]"/>
        </sup>
    </t>
</template>

<template id="report_financial_line">
    <t t-if="(a.get('level') == 1 or a.get('level') == 0) and a['type'] == 'line'">
        <tr class='oe-account-empty-line'>
            <td height="22"></td>
            <t t-foreach="context.get_columns_names()" t-as="column_name">
                <td></td>
            </t>
        </tr>
    </t>
    <t t-set="trclass" t-value="'defaultStyle'"/>
    <t t-set="style" t-value="'margin-left: ' + str(40 + ((a.get('level', 3) - 3) * 10)) + 'px'"/>
    <t t-if="a.get('level') == 0 and a['type'] == 'line'"><t t-set="trclass" t-value="'oe-account-level0'"/></t>
    <t t-if="a.get('level') == 1 and a['type'] == 'line'"><t t-set="trclass" t-value="'oe-account-level1'"/></t>
    <t t-if="a.get('level') == 2 and a['type'] == 'line'"><t t-set="style" t-value="'font-weight: bold; margin-left: 20px;'"/><t t-set="trclass" t-value="'oe-account-level2'"/></t>
    <t t-if="not a.get('level') &gt; 1"><t t-set="style" t-value="'font-weight: bold;'"/></t>
    <t t-set="domainClass" t-value="'oe-account-domain-line-2'"/>
    <t t-if="a['type'] != 'line'">
        <t t-set="style" t-value="'font-style: italic;'"/>
        <t t-if="a.get('level', False)">
            <t t-if="a['level'] == 1">
                <t t-set="domainClass" t-value="'oe-account-domain-line-1'"/>
            </t>
            <t t-if="a['level'] == 3">
                <t t-set="domainClass" t-value="'oe-account-domain-line-3'"/>
            </t>
        </t>
    </t>
    <t t-set="column" t-value="0" />
    <tr t-att-data-type="a['type']" t-att-data-id="a['id']" t-att-class="trclass + ' ' + a['type']" id='tr-line'>
        <t t-set="tdclass" t-value="''" />
        <t t-if="a.get('unfoldable') and a.get('unfolded')"><t t-set="tdclass" t-value="'oe-account-foldable'" /></t>
        <t t-if="a.get('unfoldable') and not a.get('unfolded')"><t t-set="tdclass" t-value="'oe-account-unfoldable'" /></t>
        <td t-att-data-id="a.get('id')" t-att-class="tdclass" t-att-colspan="a.get('colspan', 1)">
            <t t-if="mode != 'print'">
                <t t-if="a.get('unfoldable') and a.get('unfolded')">
                    <span t-att-data-id="a['id']" t-att-class="' '.join(['oe-account-foldable', 'oe-account-caret-icon'])"><i class="fa fa-fw fa-caret-down"></i></span>
                </t>
                <t t-if="a.get('unfoldable') and not a.get('unfolded')">
                    <span t-att-data-id="a['id']" t-att-class="' '.join(['oe-account-unfoldable', 'oe-account-caret-icon'])"><i class="fa fa-fw fa-caret-right"></i></span>
                </t>
            </t>
            <t t-if="mode == 'print' and a['type'] != 'line'"><span t-att-data-id="a.get('id')" t-att-class="a.get('type') + ' ' + domainClass"><t t-esc="a.get('name')"/></span><t t-call="account_reports.report_financial_footnote_sup" /></t>
            <t t-if="a['type'] not in ['account_id', 'line', 'tax_id', 'unreconciled_aml', 'bank_statement_id', 'partner_id', 'move_line_id', 'too_many', 'payment'] and mode != 'print'"><span t-att-data-id="a.get('id')" t-att-class="a.get('type') + ' ' + domainClass"><span style="color: black;"><i class="fa fa-fw fa-pencil-square"></i></span><t t-esc="a.get('name')"/><t t-call="account_reports.report_financial_footnote_sup" /></span></t>
            <a t-if="a['type'] == 'partner_id' and mode != 'print' and report.get_title() != 'Aged Payable'">
                <span t-att-data-active-id="a.get('id')" data-action-name="account_reports.action_account_followup" t-att-class="'oe-account-web-action ' + domainClass"><span style="color: black;"><i class="fa fa-fw fa-pencil-square"></i></span><t t-esc="a.get('name')"/><t t-call="account_reports.report_financial_footnote_sup" /></span>
            </a>
            <a t-if="a['type'] == 'too_many' and mode != 'print'">
                <span t-att-data-active-id="a.get('id')" data-action-name="account.action_move_line_select" t-att-class="'oe-account-web-action ' + domainClass"><t t-esc="a.get('name')"/></span>
            </a>
            <span t-if="a['type'] == 'partner_id' and mode != 'print' and report.get_title() == 'Aged Payable'" t-att-class="domainClass">
                <span style="color: black;"><i class="fa fa-fw fa-pencil-square"></i></span><t t-esc="a.get('name')"/><t t-call="account_reports.report_financial_footnote_sup" />
            </span>
            <div class="dropdown" t-if="(a['type'] in ['account_id', 'tax_id', 'bank_statement_id', 'move_line_id']) and mode != 'print'">
                <a data-toggle="dropdown">
                    <span t-att-data-id="a.get('id')" t-att-class="' '.join([a['type'], domainClass])">
                        <t t-esc="a.get('name')"/>
                    </span>
                    <span class="caret"></span>
                </a>
                <t t-call="account_reports.report_financial_footnote_sup" />
                <ul class="dropdown-menu oe-account-domain-dropdown" role="menu" aria-labelledby="dLabel">
                    <li role="presentation" t-if="a['type'] == 'account_id'"><a role="menuitem" tabindex="-1"  t-att-data-active-id="a.get('id')" data-action-name="account_reports.action_account_general_ledger_force_account" data-force-context='true' class="oe-account-web-action">General Ledger</a></li>
                    <li role="presentation" t-if="a['type'] == 'account_id' and a.get('account_type') == 'receivable'"><a class='oe-account-web-action' data-action-name='account_reports.action_account_report_ar' data-force-context='true' role="menuitem" tabindex="-1">Aged Receivable</a></li>
                    <li role="presentation" t-if="a['type'] == 'account_id' and a.get('account_type') == 'payable'"><a class='oe-account-web-action' data-action-name='account_reports.action_account_report_ap' data-force-context='true' role="menuitem" tabindex="-1">Aged Payable</a></li>
                    <li role="presentation" t-if="a['type'] == 'tax_id'"><a role="menuitem" tabindex="-1" t-att-data-active-id="a.get('id')" t-att-data-action-name="'account.act_account_tax_net' if context.all_entries else 'account.act_account_tax_net_posted'" class="oe-account-web-action">See net move lines</a></li>
                    <li role="presentation" t-if="a['type'] == 'tax_id'"><a role="menuitem" tabindex="-1" t-att-data-active-id="a.get('id')" t-att-data-action-name="'account.act_account_tax_tax' if context.all_entries else 'account.act_account_tax_tax_posted'" class="oe-account-web-action">See tax move lines</a></li>
                    <li role="presentation" t-if="a['type'] == 'bank_statement_id'"><a role="menuitem" tabindex="-1" data-res-model="account.bank.statement" t-att-data-active-id="a.get('statement_id')" class="oe-account-web-action">See bank statement</a></li>           
                    <li role="presentation" t-if="a['type'] == 'move_line_id'"><a role="menuitem" tabindex="-1" t-att-data-active-id="a.get('action')[1]" t-att-data-res-model="a.get('action')[0]" class="oe-account-web-action"><t t-esc="a.get('action')[2]" /></a></li>           
                    <li role="presentation" t-if="a['type'] == 'move_line_id' and a.get('action')[0] != 'account.move'"><a role="menuitem" tabindex="-1" t-att-data-active-id="a.get('move_id')" data-res-model="account.move" class="oe-account-web-action">View Journal Entry</a></li>           
                    <li role="presentation"><a role="menuitem" tabindex="-1" class="oe-account-add-footnote">Annotate</a></li>
                </ul>
            </div>
            <t t-if="a['type'] == 'line'">
                <span t-att-style="style" >
                    <span style="color: black;"><i class="fa fa-fw fa-pencil-square"></i></span>
                    <a t-if="a.get('action_id')" data-force-context='true' t-att-data-action-id="a.get('action_id')" class="oe-account-web-action">
                        <t t-esc="a.get('name')"/>
                    </a>
                    <t t-if="'action_id' not in a">
                        <t t-esc="a.get('name')"/>
                    </t>
                    <t t-call="account_reports.report_financial_footnote_sup" />
                </span>
            </t>
        </td>
        <t t-set="base_style" t-value="style" />
        <t t-foreach="a['columns']" t-as="c">
            <t t-set="column" t-value="column + 1" />
            <td t-if="not (context.get_report_obj().get_name() == 'general_ledger' and a['type'] == 'line' and column &lt; 4)" t-att-class="context.get_columns_types()[column - 1] == 'number' and  'text-right' or context.get_columns_types()[column - 1] == 'text' and  'text-left' or 'text-center'" style="white-space: nowrap;">
                <t t-if="isinstance(c, tuple)"><t t-set="style" t-value="c[1] + base_style" /><t t-set="c" t-value="c[0]" /></t>
                <span class="annotable" t-att-style="style">
                    <span style="color: black;" t-if="c and c != ''"><i class="fa fa-fw fa-pencil-square"></i></span>
                    <t t-raw="c" /><t t-call="account_reports.report_financial_footnote_sup" />
                </span>
                <t t-if="style != base_style"><t t-set="style" t-value="base_style" /></t>
            </td>
        </t>
    </tr>
</template>
<template id="report_financial_body">
    <div t-att-data-report-name="str(report.get_name())" t-att-data-context="str(context.id)" t-att-class="' '.join(['page', 'oe_account_report_widgets'])">
        <h2 t-esc="report.get_title()"/>
        <div t-if="mode != 'print' and context.summary == ''" class="oe-account-summary">
            <div class="addSummary" role="alert">
                <span><input type='text' class="form-control" name='summary' placeholder='Click to add a summary' /></span>
            </div>
        </div>
        <div t-if="mode != 'print' and context.summary != ''" class="oe-account-summary mt32">
            <i style="font-size: 16px; margin-left: -19px; position: absolute;" class="fa fa-fw fa-pencil"></i> 
            <div class="oe-account-saved-summary" role="alert" style='padding-left: 5px;'>
                <span><t t-raw="context.summary" /></span>
            </div>
        </div>
        <div t-if="mode == 'print' and context.summary != ''" class="oe-account-saved-summary" id='print-summary' role="alert">
            <span><t t-raw="context.summary" /></span>
        </div>
        <div t-att-class="mode != 'print' and 'table-responsive' or ''" style='margin-bottom: 25px;'>
            <table width='100%' style='white-space: nowrap;'>
                <thead>
                    <tr>
                        <th></th>
                        <t t-foreach="context.get_columns_names()" t-as="column_name">
                            <th class="text-center" t-raw="column_name" width='1%' style='padding-left: 15px;'/>
                        </t>
                    </tr>
                </thead>
                <tbody>
                    <t t-foreach="lines" t-as="a">
                        <t t-call="account_reports.report_financial_line" />
                    </t>
                </tbody>
            </table>
        </div>
        <t t-foreach="context.footnotes" t-as="footnote">
            <p class="footnote" t-att-id="'footnote' + str(footnote.number)">
                <span class='text'><t t-raw="str(footnote.number) + '. ' + footnote.text"/></span>
                <span class='footnoteIcons'><i class="fa fa-fw fa-pencil-square"></i><i class="fa fa-fw fa-trash-o"></i></span>
            </p>
        </t>
    </div>
</template>
<template id="report_financial">
    <t t-call="report.html_container">
        <span class="oe_account_report_widgets">
            <t t-call-assets="web.assets_common" t-css="false" />
            <t t-call-assets="web.assets_backend" t-css="false" />
            <script type="text/javascript" src="/account_reports/static/src/js/account_report_widgets.js"></script>
            <script type="text/javascript" id='oe-account-inline-script'>
                odoo.define('account.FinancialReport', function (require) {
                    'use strict';
                    
                    var ReportWidget = require('account.ReportWidget');
                    
                    $(document).ready(function() {
                        var report_widget = new ReportWidget();
                        report_widget.setElement($('.oe_account_report_widgets'));
                        report_widget.start();
                    });
                });
            </script>
            <link rel="stylesheet" href="/account_reports/static/src/css/account_financial_report.css" />
            <link href="/web/static/lib/bootstrap/css/bootstrap.css" rel="stylesheet"/>
            <link href="/website/static/src/css/website.css" rel="stylesheet"/>
            <link href="/web/static/lib/fontawesome/css/font-awesome.css" rel="stylesheet"/>
            <link rel="stylesheet" href="/web/static/lib/bootstrap-datetimepicker/css/bootstrap-datetimepicker.css"/>


            <t t-call='account_reports.report_financial_body' />


            <!-- Modal -->
            <div class="modal" id="report_error" tabindex="-1" data-backdrop="static" role="dialog" aria-hidden="true" style="z-index:9999;">
                <div class="modal-dialog modal-sm">
                    <div class="modal-content">
                        <div class="modal-header">
                            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                            <h3 class="modal-title">Error</h3>
                        </div>
                        <div class="modal-body">
                            <p>An error has occured!</p>
                        </div>
                    </div>
                </div>
            </div>
            <div t-if="mode != 'print'" class="modal fade" id="footnoteModal" tabindex="-1" role="dialog" aria-labelledby="footnoteLabel" aria-hidden="true">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&amp;times;</span><span class="sr-only">Close</span></button>
                            <h4 class="modal-title" id="footnoteLabel">Annotate</h4>
                        </div>
                        <div class="modal-body">
                            <form role="form">
                                <textarea name="note" id="note" rows='4' class="form-control" placeholder="Insert foot note here"></textarea>
                                <input type='hidden' id='type' />
                                <input type='hidden' id='target_id' />
                                <input type='hidden' id='column' />
                            </form>
                        </div>
                        <div class="modal-footer" style='text-align: left'>
                            <button type="button" class="btn btn-primary" id="saveFootNote">Save changes</button> or <a data-dismiss="modal">Cancel</a>
                        </div>
                    </div>
                </div>
            </div>
        </span>
    </t>
</template>
<template id="report_financial_letter">
    <t t-raw="'&lt;base href=%s&gt;' % base_url"/>
    <t t-call="account_reports.report_financial" />
</template>
</data>
</openerp>
