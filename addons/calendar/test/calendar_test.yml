-
  In Order to test calendar, I will first create One Simple Event with real data
-
    !record {model: crm.meeting, id: crm_meeting_technicalpresentation0}:
        class: private
        date: '2011-04-30 16:00:00'
        date_deadline: '2011-04-30 18:30:00'
        description: The Technical Presentation will cover following topics:\n* Creating OpenERP
          class\n* Views\n* Wizards\n* Workflows
        duration: 2.5
        location: OpenERP S.A.
        name: Technical Presentation
-
  Now I will set recurrence for this event to occur monday and friday of week
-
    !python {model: crm.meeting}: |
     data = {'fr': 1, 'mo': 1, 'interval': 1, 'rrule_type': 'weekly', 'end_type': 'end_date', 'end_date': '2011-05-31 00:00:00', 'recurrency' : True}
     self.write(cr, uid, [ref("crm_meeting_technicalpresentation0")], data)
-
  In order to check that recurrent events are views successfully in calendar view, I will open calendar view of events
-
    !python {model: crm.meeting}: |
     self.fields_view_get(cr, uid, False, 'calendar', context)
-
  In order to check that recurrent events are views successfully in calendar view, I will search for one of the recurrent event and count the number of events
-
    !python {model: crm.meeting}: |
     ids = self.search(cr, uid, [('date', '>=', '2011-04-30 16:00:00'), ('date', '<=', '2011-05-31 00:00:00')], context={'virtual_id': True} )
     assert len(ids) == 9, 'Wrong number of events found'
-
  Now I move a virtual event, to see that a real event is well created and depending from the native recurrence
-
    !python {model: crm.meeting}: |
     ids = self.search(cr, uid, [('date', '>=', '2011-04-30 16:00:00'), ('date', '<=', '2011-05-31 00:00:00')], context={'virtual_id': True} )
     before = self.search(cr, uid, [('date', '>=', '2011-04-30 16:00:00'), ('date', '<=', '2011-05-31 00:00:00')], context={'virtual_id': False})
     self.write(cr, uid,[ids[1]], {'name':'New Name','recurrency' : True}, context={'virtual_id': True})     
     after = self.search(cr, uid, [('date', '>=', '2011-04-30 16:00:00'), ('date', '<=', '2011-05-31 00:00:00')], context={'virtual_id': False})
     assert len(after) == len(before)+1, 'Wrong number of events found, after to have moved a virtual event'
     new_id = list(set(after)-set(before))[0]    
     new_event = self.browse(cr,uid,new_id,context=context)
     assert new_event.recurrent_id == before[0], 'Recurrent_id not correctly passed to the new event'          
-
  Now I will make All day event and test it
-
    !record {model: crm.meeting, id: crm_meeting_alldaytestevent0}:
        allday: 1
        class: confidential
        date: '2011-04-30 00:00:00'
        date_deadline: '2011-04-30 00:00:00'
        description: 'All day technical test '
        location: School
        name: All day test event
-
  In order to check reminder I will first create reminder
-
  !record {model: calendar.alarm, id: res_alarm_daybeforeeventstarts0}:
    name: 1 Day before event starts
    duration: 1
    interval: days
    type: notification
        
-
  Now I will assign this reminder to all day event
-
    !python {model: crm.meeting}: |
     self.write(cr, uid, [ref("crm_meeting_alldaytestevent0")], {'alarm_ids': [(6,0,[ref("res_alarm_daybeforeeventstarts0")])]})
