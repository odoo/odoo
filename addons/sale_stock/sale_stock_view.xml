<?xml version="1.0"?>
<openerp>
    <data>
        
        <!-- <record id="view_shop_form_inherit" model="ir.ui.view">
            <field name="name">sale.shop.sale.stock</field>
            <field name="model">sale.shop</field>
            <field name="inherit_id" ref="sale.view_shop_form"/>
            <field name="type">form</field>
            <field name="arch" type="xml">
                <xpath expr="/form/label/h1/group[@name='shop']" position="before">
                 
                    <label for="warehouse_id" class="oe_edit_only"/>
                    <h2><field name="warehouse_id" required="1"/></h2>
                </xpath>
            </field>
        </record> -->

         <record id="view_shop_tree_inherit" model="ir.ui.view">
             <field name="name">sale.shop.sale.stock</field>
             <field name="model">sale.shop</field>
             <field name="inherit_id" ref="sale.view_shop_tree"/>
             <field name="type">tree</field>
             <field name="arch" type="xml">
                 <field name="name" position="after">
                     <field name="warehouse_id"/>
                 </field>
             </field>
         </record>


         <record id="view_order_tree_sale_stock_inherit" model="ir.ui.view">
             <field name="name">sale.order.tree.sale.stock</field>
             <field name="model">sale.order</field>
             <field name="inherit_id" ref="sale.view_order_tree"/>
             <field name="type">tree</field>
             <field name="arch" type="xml">
                 <field name="user_id" position="after">
                     <field name="picked_rate" widget="progressbar"/>
                 </field>
             </field>
         </record>

        <record id="view_order_form_inherit" model="ir.ui.view">
            <field name="name">sale.order.form.sale.stock</field>
            <field name="model">sale.order</field>
            <field name="inherit_id" ref="sale.view_order_form"/>
            <field name="type">form</field>
            <field name="arch" type="xml">
                <data>
                   <xpath expr="/form/header/span/button[@name='invoice_corrected']" position="after">
                       <button name="ship_recreate" states="shipping_except" string="Recreate Delivery Order"/>
                       <button name="ship_corrected" states="shipping_except" string="Ignore Exception"/>
                   </xpath>
                   <xpath expr="/form/header/span/button[@name='action_view_invoice']" position="replace">
                       <button name="action_view_invoice" string="Open Invoice" type="object" class="oe_highlight"
                            attrs="{'invisible': ['|','|',('state', '!=','progress'), ('invoiced', '=', True),('order_policy','=','picking')]}"/>
                   </xpath>
                    <xpath expr="/form/header/span/button[@name='action_view_invoice']" position="after">
                       <button name="action_view_delivery" string="Open Delivery Order" type="object" class="oe_highlight"
                                 attrs="{'invisible': ['|','|','|',('picking_ids','=',False),('picking_ids','=',[]), ('state', 'not in', ('progress','manual')),('shipped','=',True)]}"/>
                   </xpath>                   
                    <xpath expr="/form/header/span/button[@name='action_cancel']" position="after">
                        <button name="ship_cancel" states="shipping_except" string="Cancel"/>
                    </xpath>
                    <xpath expr="/form/header/span/button[@name='action_view_delivery']" position="after">
                        <button name="%(action_view_sale_advance_payment_inv)d" string="Create Invoice" type="action" states="manual"/>
                    </xpath>
                    <field name="state" position="replace">
                        <field name="state" widget="statusbar" statusbar_visible="draft,sent,progress,invoiced,done" statusbar_colors='{"shipping_except":"red","invoice_except":"red","waiting_date":"blue"}'/>
                    </field>
                   <field name="product_id" position="replace">
                       <field name="product_id"
                       context="{'partner_id':parent.partner_id, 'quantity':product_uom_qty, 'pricelist':parent.pricelist_id, 'shop':parent.shop_id, 'uom':product_uom}"
                       groups="base.group_user" 
                       on_change="product_id_change(parent.pricelist_id,product_id,product_uom_qty,product_uom,product_uos_qty,product_uos,name,parent.partner_id, False, False, parent.date_order, product_packaging, parent.fiscal_position, True, context)"/>
                   </field>
                   <field name="product_uom_qty" position="replace">
                       <field context="{'partner_id':parent.partner_id, 'quantity':product_uom_qty, 'pricelist':parent.pricelist_id, 'shop':parent.shop_id, 'uom':product_uom}"
                             name="product_uom_qty" class="oe_inline"
                           on_change="product_id_change(parent.pricelist_id,product_id,product_uom_qty,product_uom,product_uos_qty,product_uos,name,parent.partner_id, False, False, parent.date_order, product_packaging, parent.fiscal_position, True, context)"/>
                   </field>
                   <field name="shop_id" position="replace">
                       <field name="shop_id" on_change="onchange_shop_id(shop_id)" widget="selection" groups="stock.group_locations"/>
                   </field>

                   <field name="order_policy" position="before">
                       <field name="incoterm" widget="selection" groups="base.group_user"/>
                   </field>
                   <field name="incoterm" position="after">
                       <field name="picking_policy" required="True"/>
                   </field>
                   <xpath expr="//page[@string='Other Information']/group/group/field[@name='invoiced']" position="after">
                       <field name="shipped"/>
                   </xpath>
                   <field name="invoice_ids" position="after">
                       <separator string="Delivery Orders"/>
                       <field name="picking_ids" context="{'default_type': 'out'}">
                           <tree colors="blue:state == 'draft';grey:state == 'cancel';red:state not in ('cancel', 'done') and min_date &lt; current_date" string="Delivery Orders">
                               <field name="name"/>
                               <field name="partner_id" string="Customer"/>
                               <field name="min_date"/>
                               <field name="state"/>
                               <button name="action_process" states="assigned" string="Deliver" type="object" icon="gtk-go-forward" context="{'default_type': 'out'}"/>
                           </tree>
                       </field>
                   </field>
                   <field name="th_weight" position="before">
                       <label for="delay"/>
                       <div>
                           <field name="delay" class="oe_inline"/> days
                       </div>
                       <field name="type"/>
                   </field>
                   <field name="address_allotment_id" position="after">
                       <field name="property_ids" widget="many2many_tags"
                            groups="sale.group_mrp_properties"/>
                   </field>
                   <field name="tax_id" position="before">
                       <field name="product_packaging" context="{'partner_id':parent.partner_id, 'quantity':product_uom_qty, 'pricelist':parent.pricelist_id, 'shop':parent.shop_id, 'uom':product_uom}" on_change="product_packaging_change(parent.pricelist_id, product_id, product_uom_qty, product_uom, parent.partner_id, product_packaging, True, context)" domain="[('product_id','=',product_id)]" groups="product.group_stock_packaging" colspan="3"/>
                   </field>
                   <field name="invoice_lines" position="after">
                       <label for="move_ids"/>
                       <field name="move_ids" widget="many2many"/>
                   </field>
                   <xpath expr="//page[@string='Order Lines']/field[@name='order_line']/tree[@string='Sales Order Lines']/field[@name='sequence']" position="after">
                       <field name="delay" invisible="1"/>
                       
                   </xpath>
                   <xpath expr="//page[@string='Order Lines']/field[@name='order_line']/tree[@string='Sales Order Lines']/field[@name='tax_id']" position="after">
                       <field name="type" invisible="1"/>
                   </xpath>
                   <xpath expr="//page[@string='Order Lines']/field[@name='order_line']/tree[@string='Sales Order Lines']/field[@name='th_weight']" position="after">
                       <field name="product_packaging" invisible="1"/>
                   </xpath>
                   <xpath expr="//page[@string='Other Information']/field[@name='order_line']/group/group[@name='logistics']/field[@name='order_policy']" position="before">
                       <field name="incoterm" widget="selection" groups="base.group_user"/>
                       <field name="picking_policy" required="True"/>
                   </xpath>
                   <xpath expr="//page[@string='Other Information']/field[@name='order_line']/group/group/field[@name='invoiced']" position="after">
                       <field name="shipped"/>
                   </xpath>
                </data>
           </field>
        </record>
        
        <menuitem action="sale.action_shop_form" id="sale.menu_action_shop_form" parent="base.menu_base_config" sequence="35" groups="stock.group_locations"/>

    </data>
</openerp>
