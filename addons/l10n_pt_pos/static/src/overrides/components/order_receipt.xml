<?xml version="1.0" encoding="UTF-8"?>
<templates id="template" xml:space="preserve">
    <t t-name="l10n_pt_pos.OrderReceipt" t-inherit="point_of_sale.OrderReceipt" t-inherit-mode="extension">
        <!-- Add tax exemption reason codes to each line with an exempt tax -->
        <xpath expr="//Orderline" position="inside">
            <t t-if="line.taxExemptionReasons" t-out="line.taxExemptionReasons"/>
        </xpath>
        <!-- Add summary of tax exemption reasons below order total -->
        <xpath expr="//div[hasclass('paymentlines')]" position="after">
            <t t-set="pt_tax_exemption_reasons" t-value="props.data.taxExemptionReasons"/>
            <t t-if="props.data.isCountryPortugal and pt_tax_exemption_reasons.length > 0">
                <span class="pos-receipt-center-align">
                    <div>--------------------------------</div>
                </span>
                <div class=" rounded-3 bg-white overflow-hidden pb-2">
                    <span class="fw-bolder text-nowrap mw-100">Motivos de isenção de IVA:</span>
                    <t t-foreach="pt_tax_exemption_reasons" t-as="reason" t-key="reason_index">
                        <div><t t-out="reason"/></div>
                    </t>
                </div>
            </t>
        </xpath>
        <!-- Add Portuguese disclaimers and information mandatory for the certification (software number, QR code, ATCUD) -->
        <xpath expr="//div[hasclass('before-footer')]" position="inside">
            <div t-if="props.data.isCountryPortugal" class="pos-receipt-center-align mt-2">
                <t t-if="props.data.isReprint">
                    <div class="pos-receipt-order-data">2ª Via</div>
                </t>
                <t t-else="">
                    <div class="pos-receipt-order-data">Original</div>
                </t>
                <div t-if="props.data.l10nPtTrainingMode" class="pos-receipt-order-data">
                    Documento emitido para fins de Formação
                </div>
                <t t-if="!props.data.l10nPtPosInalterableHashShort">
                    <div class="pos-receipt-order-data">
                        Este documento não serve de fatura
                    </div>
                    <div class="pos-receipt-order-data">
                        Emitido por programa certificado n.º <t t-out="props.data.l10nPtCertificationNumber"/>/AT
                    </div>
                </t>
                <t t-else="">
                    <div class="pos-receipt-order-data">
                        ATCUD: <t t-esc="props.data.l10nPtPosAtcud"/>
                    </div>
                    <img id="pos_pt_qrcode" t-att-src="props.data.l10nPtPosQrCodeStr" class="pos-receipt-logo"/>
                    <div class="pos-receipt-order-data">
                        <t t-out="props.data.l10nPtPosInalterableHashShort"/> - Processado por programa certificado n.º <t t-out="props.data.l10nPtCertificationNumber"/>/AT
                    </div>
                </t>
            </div>
        </xpath>
        <!-- Add Portuguese document number -->
        <xpath expr="//div[@id='order-date']" position="before">
            <t t-if="props.data.isCountryPortugal and props.data.l10nPtPosIdentifier">
                <div>
                    Document Number: <t t-out="props.data.l10nPtPosIdentifier"/>
                </div>
            </t>
        </xpath>
    </t>
</templates>
