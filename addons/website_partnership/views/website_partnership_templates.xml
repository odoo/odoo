<?xml version="1.0" encoding="utf-8"?>
<odoo>

<!-- Page -->
<template id="index_layout" name="Find Partners">
    <t t-call="website.layout">
        <t t-set="additional_title">Partners</t>
        <div id="wrap">
            <div class="oe_structure oe_empty" id="oe_structure_website_partnership_layout_1"
                data-editor-message.translate="DROP BUILDING BLOCKS HERE TO MAKE THEM AVAILABLE ACROSS PARTNERS"/>
            <div class="container mb-3">
                <t t-call="website_partnership.index"/>
            </div>
            <div class="oe_structure oe_empty" id="oe_structure_website_partnership_layout_2"
                data-editor-message.translate="DROP BUILDING BLOCKS HERE TO MAKE THEM AVAILABLE ACROSS PARTNERS"/>
        </div>
    </t>
</template>

<template id="index" name="Find Partners">
    <div class="container" id="partners_page_top_menu">
        <section id="page_top_section" class="o_wcrm_filters_top d-flex d-print-none align-items-center justify-content-lg-end flex-wrap gap-2 mt-4 mb-3">
            <h1 id="page_title" class="me-auto mb-0 h4">Find a partner</h1>
            <t t-set='all_categories_label'>All Categories</t>        
            <div id="top_section_button_middle_pos"/>
        </section>
    </div>
    <!-- Off canvas filters on mobile-->
    <div id="o_wcrm_offcanvas" class="o_website_offcanvas offcanvas offcanvas-end d-lg-none p-0 overflow-visible">
        <div class="offcanvas-header">
            <h5 class="offcanvas-title">Filters</h5>
            <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"/>
        </div>
        <div class="offcanvas-body p-0">
            <div class="accordion accordion-flush">
                <div class="accordion-item">
                    <h2 class="accordion-header">
                        <button class="accordion-button collapsed"
                            type="button"
                            data-bs-toggle="collapse"
                            data-bs-target=".o_wcrm_offcanvas_grade"
                            aria-expanded="false"
                            aria-controls="o_wcrm_offcanvas_grade">
                            Filter by category
                        </button>
                    </h2>
                    <div class="o_wcrm_offcanvas_grade accordion-collapse collapse">
                        <div class="accordion-body pt-0">
                            <ul class="list-group list-group-flush">
                                <t t-foreach="grades" t-as="grade">
                                    <li class="list-group-item d-flex justify-content-between align-items-center ps-0 pb-0 border-0">
                                        <a id="filter_category_link" t-attf-href="/partners#{ grade['grade_id'][0] and '/grade/%s' % slug(grade['grade_id']) or '' }#{ '?' + (search_path or '') }"
                                        class="text-reset" aria-label="See categories filters">
                                            <div class="form-check">
                                                <input class="form-check-input pe-none" type="radio" t-attf-name="#{grade}" t-att-checked="bool(grade['active'])"/>
                                                <label class="form-check-label" t-attf-for="#{grade}" t-out="grade"/>
                                            </div>
                                        </a>
                                    </li>
                                </t>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="row mb-4">
        <div class="my-5 py-5 text-center" t-if="not partners and not searches.get('search', '')">
            <h3>We're expanding our partner network.</h3>
            <p class="lead">Please check back soon.</p>
        </div>
        <div class="my-5 py-5 text-center" t-elif="not partners">
            <h5>No results found for "<span t-out="searches.get('search', '')"/>"</h5>
            <a href="/partners">See all partners</a>
        </div>
        <t t-set="last_grade" t-value="None"/>
        <t id="partners_cards" t-foreach="partners.sorted(lambda p: p.grade_id.id)" t-as="partner">
            <t t-if="last_grade != partner.grade_id.id">
                <h5 class="mt-3 mb-2 col-12">
                    <span t-out="partner.grade_id.name"/>
                    <t t-call="website.publish_management">
                        <t t-set="object" t-value="partner.grade_id"/>
                        <t t-set="publish_edit" t-value="True"/>
                    </t>
                </h5>
                <t t-set="last_grade" t-value="partner.grade_id.id"/>
            </t>
            <div class="col-md-4 col-xl-3 col-12 mb-4">
                <div class="card h-100 text-decoration-none">
                    <a id="partner_link_card" class="text-decoration-none" aria-label="Go to partner">
                        <div t-field="partner.avatar_1920"
                            class="card-img-top border-bottom"
                            t-options='{"widget": "image", "qweb_img_responsive": False, "class": "img img-fluid h-100 w-100 mw-100", "style": "max-height: 208px; min-height: 208px; object-fit: cover"}'
                            />
                        <div class="card-body">
                            <h5 class="card-title m-0" t-attf-href="/partners/#{slug(partner)}?#{current_grade and 'grade_id=%s&amp;' % current_grade.id}" t-field="partner.display_name"/>
                            <small id="o_wcrm_partners_address"/>
                            <small class="o_wcrm_short_description text-muted overflow-hidden">
                                <span t-field="partner.website_short_description"/>
                            </small>
                            <small t-if="not partner.website_short_description" class="css_editable_mode_hidden text-muted fst-italic" groups="website.group_website_restricted_editor">
                                Edit to add a short description
                            </small>
                        </div>
                    </a>
                </div>
            </div>
        </t>
        <div class="navbar">
            <t t-call="website.pager">
                <t t-set="classname" t-valuef="mx-auto"/>
            </t>
        </div>
    </div>
</template>

<template id="partner_page" name="Partner Page">
    <t t-call="website.layout">
        <div id="wrap">
            <div class="oe_structure oe_empty" id="oe_structure_website_partnership_partner_1" data-editor-message.translate="DROP BUILDING BLOCKS HERE TO MAKE THEM AVAILABLE ACROSS ALL PARTNERS"/>
            <div class="container">
                <div class="row">
                    <t t-call="website_partnership.partner_detail"/>
                </div>
            </div>
            <div class="oe_structure oe_empty" id="oe_structure_website_partnership_partner_2" data-editor-message.translate="DROP BUILDING BLOCKS HERE TO MAKE THEM AVAILABLE ACROSS ALL PARTNERS"/>
        </div>
    </t>
</template>

<template id="partner_detail" inherit_id="website_partner.partner_detail" name="Partner Details">
    <xpath expr="//div" position="before">
        <t t-set="contact_details" t-value="False"/>
        <div t-if="not edit_page" class="mt-4 mb-3">
            <a id="link_back_to_partners" t-attf-href="/partners#{current_grade and 'grade_id=%s&amp;' % current_grade.id}" aria-label="Back to partners list"><i class="oi oi-chevron-left me-2"/>Back</a>
        </div>
    </xpath>

    <xpath expr="//*[@id='partner_name']" position="before">
        <span class="col-lg-12 text-muted" t-if="partner.grade_id and partner.grade_id.website_published">
            <span t-field="partner.grade_id"/>
        </span>
    </xpath>
</template>

<template id="search_setting" inherit_id="website_partnership.index" name="Search">
    <xpath expr="//section[@id='page_top_section']" position="inside">
        <div class="o_wcrm_search d-flex w-100 w-lg-25">
            <form class="flex-grow-1" action="" method="get">
                <div id="search_input_group" class="input-group" role="search">
                    <input id="search_input_text" type="text" name="search" class="search-query form-control border-0 bg-light" placeholder="Search" t-att-value="searches.get('search', '')"/>
                    <button type="submit" aria-label="Search" title="Search" class="oe_search_button btn btn-light">
                        <i class="oi oi-search"/>
                    </button>
                </div>
            </form>
            <button class="btn btn-light position-relative ms-2 d-lg-none"
                data-bs-toggle="offcanvas"
                data-bs-target="#o_wcrm_offcanvas">
                <i class="fa fa-sliders"/>
            </button>
        </div>
    </xpath>
</template>

<template id="categories_setting" inherit_id="website_partnership.index" name="Categories">
    <xpath expr="//div[@id='top_section_button_middle_pos']" position="before">
        <div id="dropdown_grades_selection" class="dropdown d-none d-lg-block">
            <button type="button" class="dropdown-toggle btn btn-light" data-bs-toggle="dropdown" title="Filter by category" aria-label="Filter by category" aria-expanded="false">
                <t t-foreach="grades" t-as="grade">
                    <span t-if="grade['active']" t-out="grade['grade_id'][1] if grade['grade_id'][0] != 0 else all_categories_label"/>
                </t>
            </button>
            <div class="dropdown-menu">
                <t t-foreach="grades" t-as="grade">
                    <a t-attf-href="/partners#{ grade['grade_id'][0] and '/grade/%s' % slug(grade['grade_id']) or '' }?#{ keep_query('search') }"
                    class="dropdown-item d-flex justify-content-between">
                        <t t-out="grade['grade_id'][1] if grade['grade_id'][0] != 0 else all_categories_label" />&amp;nbsp;&amp;nbsp;
                        <span class="badge text-white bg-secondary rounded-pill px-2 py-1" t-out="grade['grade_id_count']"/>
                    </a>
                </t>
            </div>
        </div>
    </xpath>
</template>

<template id="o_wcrm_partner_address" inherit_id="index" name="Address">
    <xpath expr="//small[@id='o_wcrm_partners_address']" position="inside">
        <div t-field="partner.self"
            t-options="{
                'widget': 'contact',
                'fields': ['country_id']
            }"
            class="py-2"
        />
    </xpath>
</template>

<template id="contact_details" inherit_id="website_partnership.partner_detail" name="Contact Details">
    <xpath expr="//t[@t-set='contact_details']" position="replace">
        <t t-set="contact_details" t-value="True"/>
    </xpath>
</template>

<template id="companies_only_setting" inherit_id="website_partnership.index" name="Companies only" active="False">
    <xpath expr="//t[@id='partners_cards']" position="before">
        <t t-set="partners" t-value="partners.filtered('is_company')"/>
    </xpath>
</template>

<template id="linked_partner_page_setting" inherit_id="website_partnership.index" name="Partner page">
    <xpath expr="//a[@id='partner_link_card']" position="attributes">
        <attribute name="t-attf-href">/partners/#{slug(partner)}?#{current_grade and 'grade_id=%s&amp;' % current_grade.id}</attribute>
    </xpath>
</template>

<template id="image_one_one_partner_page" inherit_id="website_partnership.index" name="Partner page">
    <xpath expr="//div[hasclass('card-img-top')]" position="attributes">
        <attribute name="t-options">{"widget": "image", "qweb_img_responsive": False, "class": "img img-fluid h-100 w-100 mw-100", "style": "max-height: 300px; min-height: 300px; object-fit: cover"}</attribute>
    </xpath>
</template>

<template id="image_six_five_partner_page" inherit_id="website_partnership.index" name="Partner page">
    <xpath expr="//div[hasclass('card-img-top')]" position="attributes">
        <attribute name="t-options">{"widget": "image", "qweb_img_responsive": False, "class": "img img-fluid h-100 w-100 mw-100", "style": "max-height: 250px; min-height: 250px; object-fit: cover"}</attribute>
    </xpath>
</template>

<template id="image_four_five_partner_page" inherit_id="website_partnership.index" name="Partner page">
    <xpath expr="//div[hasclass('card-img-top')]" position="attributes">
        <attribute name="t-options">{"widget": "image", "qweb_img_responsive": False, "class": "img img-fluid h-100 w-100 mw-100", "style": "max-height: 375px; min-height: 375px; object-fit: cover"}</attribute>
    </xpath>
</template>

</odoo>
