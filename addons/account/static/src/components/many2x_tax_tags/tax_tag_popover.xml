<?xml version="1.0" encoding="UTF-8"?>
<templates xml:space="preserve">

    <t t-name="account.tax_tag_popover_template">
        <div class="bg-view rounded-0 mw-100">

            <div class="p-2 border-bottom bg-light d-flex justify-content-between align-items-center">
                <span class="fw-bold">Tax Distribution</span>
                <button type="button" class="btn-close" t-on-click="props.close" tabindex="-1"/>
            </div>

            <div class="p-3 o_invoice_tax_summary">

                <t t-if="props.description">
                    <span class="text-capitalize d-block mb-3 fs-6">
                        <t t-esc="props.description"/>
                    </span>
                </t>

                <div t-if="props.invoiceLines.length > 0" class="mb-2 fs-6">
                    <div class="d-flex align-items-start">
                        <div class="fw-bold me-2">Invoice :</div>

                        <div class="d-flex flex-wrap align-items-center">
                            <t t-foreach="props.invoiceLines" t-as="group" t-key="group.type">
                                <t t-if="group.lines.map(line => line.tag_names).flat().length">
                                    <div class="d-flex align-items-center me-2 mb-2">
                                        <span class="text-capitalize me-2">
                                            <t t-esc="group.type"/>
                                        </span>

                                        <t t-foreach="group.lines" t-as="line" t-key="line_index">
                                            <t t-foreach="line.tag_names" t-as="tname" t-key="tname_index">
                                                <span class="o_tag o_tag_color_0 badge rounded-pill me-1 text-dark border">
                                                    <t t-esc="tname"/>
                                                    <t t-if="group.type!='base' and line.factor_percent">
                                                        (<t t-esc="line.factor_percent"/>%)
                                                    </t>
                                                </span>
                                            </t>
                                        </t>
                                    </div>
                                </t>
                            </t>
                        </div>
                    </div>
                </div>

                <div t-if="props.refundLines.length" class="mb-2 fs-6">
                    <div class="d-flex align-items-start">
                        <div class="fw-bold me-2">Credit Note :</div>

                        <div class="d-flex flex-wrap align-items-center">
                            <t t-foreach="props.refundLines" t-as="group" t-key="group.type">
                                <t t-if="group.lines.map(line => line.tag_names).flat().length">
                                    <div class="d-flex align-items-center me-2 mb-2">
                                        <span class="text-capitalize me-2">
                                            <t t-esc="group.type"/>
                                        </span>

                                        <t t-foreach="group.lines" t-as="line" t-key="line_index">
                                            <t t-foreach="line.tag_names" t-as="tname" t-key="tname_index">
                                                <span class="o_tag o_tag_color_0 badge rounded-pill me-1 text-dark border">
                                                    <t t-esc="tname"/>
                                                    <t t-if="group.type!='base' and line.factor_percent">
                                                        (<t t-esc="line.factor_percent"/>%)
                                                    </t>
                                                </span>
                                            </t>
                                        </t>
                                    </div>
                                </t>
                            </t>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </t>

</templates>
