<odoo>
    <template id="totp_portal_hook" name="TOTP Portal hook" inherit_id="portal.portal_my_security">
        <xpath expr="//section[@name='portal_change_password']" position="after">
            <!--
                portal users don't have access to non-qweb views anymore, so
                embed the target view as a *data island* of sorts, a JSON embed
                of the fields_view_get could have been nice but at 14k it'd be a
                bit ridiculous
            -->
            <div class="d-none" id="totp_wizard_view">
                <t t-out="env.ref('auth_totp.view_totp_wizard').sudo().get_combined_arch()"/>
            </div>
            <section>
                <h2 class="h4">Two-factor authentication</h2>
                <p class="text-muted small">Two-factor authentication adds an extra layer of security by requiring a special code
                    each time you log in.
                    <a title="Read More about Two-factor authentication" href="https://www.odoo.com/documentation/latest/applications/general/auth/2fa.html" target="_blank">
                        Read more
                    </a>
                </p>
                <t t-if="not user_id.totp_enabled">
                    <div class="alert alert-warning" role="status">
                        <i class="fa fa-warning text-warning-emphasis" aria-hidden="true"/>
                        Two-factor authentication not enabled
                    </div>
                    <button type="button" class="btn btn-light" id="auth_totp_portal_enable">
                        Enable two-factor authentication
                    </button>
                </t>
                <t t-else="">
                    <div class="d-flex flex-wrap align-items-center border rounded p-2 px-lg-3 gap-2" role="status">
                        <div class="d-flex align-items-center">
                            <i class="fa fa-check-circle text-success fa-2x me-2" aria-hidden="true"/>
                            <span>2FA authentication Enabled</span>
                        </div>
                        <button type="button" class="btn btn-warning ms-auto" id="auth_totp_portal_disable">
                            Disable
                        </button>
                    </div>
                    <t t-if="len(user_id.totp_trusted_device_ids)">
                        <table class="table o_main_table">
                            <thead>
                                <tr>
                                    <th><strong>Trusted Device</strong></th>
                                    <th><strong>Added On</strong></th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr t-foreach="user_id.totp_trusted_device_ids" t-as="td">
                                    <td>
                                        <span t-field="td.name"/>
                                    </td>
                                    <td>
                                        <span t-field="td.create_date"/>
                                    </td>
                                    <td>
                                        <i class="fa fa-trash text-danger" type="button" t-att-id="td.id"/>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                        <button class="btn btn-primary" type="button" id="auth_totp_portal_revoke_all_devices">
                            Revoke All
                        </button>
                    </t>
                </t>
            </section>
        </xpath>
    </template>
</odoo>
