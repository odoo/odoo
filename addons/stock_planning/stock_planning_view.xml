<?xml version="1.0" encoding="utf-8"?>
<openerp>
<data>
        <menuitem id="menu_stock_period_main" 
                  name="Stock and Sales Periods" 
                  parent="base.menu_base_config"/>

<!-- Creating periods section -->

    <record id="view_stock_period_createlines_form" model="ir.ui.view">
            <field name="name">stock.period.createlines.form</field>
            <field name="model">stock.period.createlines</field>
            <field name="type">form</field>
            <field name="arch" type="xml">
                <form string="Stock and Sales Periods">
                    <separator colspan="4" string="Create periods for Stock and Sales Planning"/>
                    <field name="date_start"/>
                    <field name="date_stop"/>                             
                    <separator colspan="4" string=""/>        
                    <group col="3" colspan="4">
                        <button name="create_period" string="Create Daily Periods" type="object"/>
                        <button name="create_period_weekly" string="Create Weekly Periods" type="object"/>
                        <button name="create_period_monthly" string="Create Monthly Periods" type="object"/>
                    </group> 
                </form>
            </field>
        </record>      

        <record id="action_stock_period_createlines_form" model="ir.actions.act_window">
            <field name="name">Stock and Sales Planning Periods</field>
            <field name="res_model">stock.period.createlines</field>
            <field name="view_type">form</field>
            <field name="view_mode">form</field>
            <field name="view_id" ref="view_stock_period_createlines_form"/>
            <field name="target">new</field>
        </record>

        <menuitem id="menu_stock_period_creatlines" 
                  name="Create Stock and Sales Periods" 
                  parent="menu_stock_period_main" 
                  action="action_stock_period_createlines_form"
                  sequence = "5"/>

<!-- Periods tree and form section -->

        <record id="view_stock_period_form" model="ir.ui.view">
            <field name="name">stock.period.form</field>
            <field name="model">stock.period</field>
            <field name="type">form</field>
            <field name="arch" type="xml">
                <form string="Stock and Sales Periods">
                    <field name="name"/>
                    <field name="date_start"/>
                    <field name="state" select="1"/>
                    <field name="date_stop"/>
                </form>
            </field>
        </record>
        
        <record id="view_stock_period_tree" model="ir.ui.view">
            <field name="name">stock.period.tree</field>
            <field name="model">stock.period</field>
            <field name="type">tree</field>
            <field name="arch" type="xml">
                <tree string="Stock and Sales Period" editable="bottom">
                    <field name="name"/>
                    <field name="date_start"/>
                    <field name="date_stop"/>
                    <field name="state" select="1"/>
                </tree>
            </field>
        </record>

        <record id="action_stock_period_form" model="ir.actions.act_window">
            <field name="name">Stock and Sales Periods</field>
            <field name="res_model">stock.period</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form</field>
        </record>

        
        <menuitem
            id="menu_stock_period"
            parent="menu_stock_period_main"
            action="action_stock_period_form"
            sequence = "10"/>

<!--   Create Forecast section   -->

        <record id="view_stock_sale_forecast_createlines_form" model="ir.ui.view">
            <field name="name">stock.sale.forecast.createlines</field>
            <field name="model">stock.sale.forecast.createlines</field>
            <field name="type">form</field>
            <field name="arch" type="xml">
                <form string="Stock and Sales Forecasts">
                    <field name="company_id" groups="base.group_multi_company" widget="selection"/>
                    <newline/>
                    <field name="period_id1" widget="selection"/>
                    <newline/>
                    <field name="warehouse_id1" domain = "[('company_id','=',company_id)] "/>
                    <newline/>
                    <field name="product_categ_id1" widget="selection"/>
                    <newline/>
                    <field name="copy_forecast"/>
                    <separator colspan ="4" string="Forecast lines creation"/>
                    <label  colspan ="4" string="Creates forecast lines for selected warehouse and period. Doesn't duplicate existing lines created by you."/>
                    <group colspan="4">
                        <button icon="gtk-cancel" special="cancel" string="Cancel"/>
                        <button icon="gtk-execute" name="create_forecast" string="Create Forecasts" type="object" />
                    </group>         
                </form>
            </field>
        </record>      

        <record id="action_stock_sale_forecast_createlines_form" model="ir.actions.act_window">
            <field name="name">Create Stock and Sales Forecasts</field>
            <field name="res_model">stock.sale.forecast.createlines</field>
            <field name="view_type">form</field>
            <field name="view_mode">form</field>
            <field name="view_id" ref="view_stock_sale_forecast_createlines_form"/>
            <field name="target">new</field>
        </record>
        
        <menuitem id="menu_stock_sale_forecast" name="Stock and Sales Forecasts" parent="base.menu_base_partner"/>
        
        <menuitem id="menu_stock_sale_forecast_createlines" name="Create Stock and Sales Forecasts" parent="menu_stock_sale_forecast" action="action_stock_sale_forecast_createlines_form" sequence = "5"/>

        <record id="view_stock_sale_forecast_form" model="ir.ui.view">
            <field name="name">stock.sale.forecast.form</field>
            <field name="model">stock.sale.forecast</field>
            <field name="type">form</field>
            <field name="arch" type="xml">
                <form string="Stock and Sales Forecast">
                    <group colspan = "4" col = "4">
		        <group colspan = "2" col="2" >
                            <field name="company_id" select="1" 
                                        groups="base.group_multi_company" 
                                        widget="selection" 
                                        on_change="onchange_company(company_id)"/>
                            <field name="warehouse_id" domain = "[('company_id','=',company_id)] "/>
                            <field name="period_id" />
                            <field name="product_id" on_change="product_id_change(product_id)" />
			    <field name="product_uom_categ"  invisible = "True"/>
			    <field name="product_uos_categ"  invisible = "True"/>
                            <field name="product_uom"  
                                         domain = "[('category_id','in',[product_uom_categ,product_uos_categ])]"
                                         on_change = "onchange_uom(product_uom, product_qty, active_uom)"/>
                            <field name="active_uom" invisible = "True" />  
		         </group>
		         <group colspan = "2" col="2" >
                            <field name="user_id"/>
                            <field name="product_amt" on_change="product_amt_change( product_amt, product_uom)" />
                            <field name="product_qty"  />
                            <field name="state"/>
                            <button name="action_validate" string="Validate" states="draft" type="object" colspan = "2"/>
		        </group>
                    </group>
                    <separator colspan ="4" string="Sales history"/>
                    <group colspan = "4" col = "5"> 
                        <label string = " "/>
                        <label string = "Per User :"/>
                        <label string = "Per Department :"/>
                        <label string = "Per Warehouse :"/>
                        <label string = "Per Company :"/>
                        <label string = "Periods :"/>
                        <field name="analyzed_user_id" nolabel = "1" domain = "[('company_id','=',company_id)] "/>
                        <field name="analyzed_dept_id" nolabel = "1" domain = "[('company_id','=',company_id)] " />
                        <field name="analyzed_warehouse_id" nolabel = "1" domain = "[('company_id','=',company_id)] " />
                        <group colspan = "1" col = "2"> 
                            <field name = "analyze_company"/>
                        </group>
                        <field name = "analyzed_period1_id" nolabel = "1"  />
                        <field name = "analyzed_period1_per_user" nolabel = "1" />
                        <field name = "analyzed_period1_per_dept" nolabel = "1" />
                        <field name = "analyzed_period1_per_warehouse" nolabel = "1" />
                        <field name = "analyzed_period1_per_company" nolabel = "1"/>
                        <field name = "analyzed_period2_id" nolabel = "1" />
                        <field name = "analyzed_period2_per_user" nolabel = "1" />
                        <field name = "analyzed_period2_per_dept" nolabel = "1" />
                        <field name = "analyzed_period2_per_warehouse" nolabel = "1" />
                        <field name = "analyzed_period2_per_company" nolabel = "1" />
                        <field name = "analyzed_period3_id" nolabel = "1"/>
                        <field name = "analyzed_period3_per_user" nolabel = "1" />
                        <field name = "analyzed_period3_per_dept" nolabel = "1" />
                        <field name = "analyzed_period3_per_warehouse" nolabel = "1" />
                        <field name = "analyzed_period3_per_company" nolabel = "1" />
                        <field name = "analyzed_period4_id" nolabel = "1" />
                        <field name = "analyzed_period4_per_user" nolabel = "1" />
                        <field name = "analyzed_period4_per_dept" nolabel = "1" />
                        <field name = "analyzed_period4_per_warehouse" nolabel = "1" />
                        <field name = "analyzed_period4_per_company" nolabel = "1" />
                        <field name = "analyzed_period5_id" nolabel = "1" />
                        <field name = "analyzed_period5_per_user" nolabel = "1" />
                        <field name = "analyzed_period5_per_dept" nolabel = "1" />
                        <field name = "analyzed_period5_per_warehouse" nolabel = "1" />
                        <field name = "analyzed_period5_per_company" nolabel = "1" />
                        <button name="calculate_sales_history" icon="gtk-execute" 
                                string="Calculate Sales History" type="object" colspan = "1" states="draft" />
                    </group>

                </form>
            </field>
        </record>
        
        <record id="view_stock_sale_forecast_tree" model="ir.ui.view">
             <field name="name">stock.sale.forecast.tree</field>
            <field name="model">stock.sale.forecast</field>
            <field name="type">tree</field>
            <field name="arch" type="xml">
                <tree string="Stock and Sales Forecasts" editable="bottom">
                    <field name="warehouse_id"/>
                    <field name="user_id"/>
                    <field name="period_id"/>
                    <field name="product_id" on_change="product_id_change(product_id)" />
                    <field name="product_qty"/>
                    <field name="product_uom" />
                </tree>
            </field>
        </record>
        
       <record id="view_stock_sale_forecast_graph" model="ir.ui.view">
             <field name="name">stock.sale.forecast.graph</field>
            <field name="model">stock.sale.forecast</field>
            <field name="type">graph</field>
            <field name="arch" type="xml">
                <graph string="Stock and Sales Forecast" type = "bar">
                    <field name="period_id"/>
                    <field name="product_qty"/>
                    <field name="product_id"/>
                </graph>
            </field>
        </record>


       <record id="view_stock_sale_forecast_filter" model="ir.ui.view">
            <field name="name">stock.sale.forecast.list.select</field>
            <field name="model">stock.sale.forecast</field>
            <field name="type">search</field>
            <field name="arch" type="xml">
                <search string="Search Stock and Sales Forecast">
                 <group col='10' colspan='4'>
                    <filter icon="terp-purchase" string="Validated" domain="[('state','=','validated')]" separator="1"/>
                    <field name="company_id" select="1" widget="selection"/>
                    <field name="warehouse_id" select="1" widget="selection"/>
                    <field name="period_id" select="1" widget="selection"/>
                    <field name="product_id" select="1" widget="selection"/>
                    <field name="create_uid" select="1" widget="selection">
                        <filter icon="terp-purchase" domain="[('create_uid','=',uid)]" help="My Forecasts"/>
                    </field>
                </group>
              </search>
            </field>
        </record>

        
        <record id="action_view_stock_sale_forecast_form" model="ir.actions.act_window">
            <field name="name">Stock and Sales Forecast</field>
            <field name="res_model">stock.sale.forecast</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form,graph</field>
            <field name="search_view_id" ref="view_stock_sale_forecast_filter"/>
        </record>
        
        <menuitem id="menu_stock_sale_forecast_all" 
                  name="Stock and Sales Forecasts" 
                  parent="menu_stock_sale_forecast" 
                  action="action_view_stock_sale_forecast_form"/>
        
<!-- Create Planning section -->

        <menuitem id="menu_stock_planning_main" name="Stock Planning" parent="stock.menu_stock_root"/>

       <record id="view_stock_planning_createlines_form" model="ir.ui.view">
            <field name="name">stock.planning.createlines.form</field>
            <field name="model">stock.planning.createlines</field>
            <field name="type">form</field>
            <field name="arch" type="xml">
                <form string="Stock Planning">                            
		    <field name="company_id" widget= "selection" on_change="onchange_company(company_id)" groups="base.group_multi_company"/>
                    <newline/>
                    <field name="period_id2" widget="selection"/>
                    <newline/>
                    <field name="warehouse_id2" domain = "[('company_id','=',company_id)] "/>
                    <newline/>
                    <field name="forecasted_products"/>
                    <newline/>
                    <field name="product_categ_id2" attrs="{'required':[('forecasted_products','=',0)]}" widget="selection"/>
                    <separator colspan ="4" string="Stock planning lines creation"/>
                    <label  colspan ="4" string="Creates planning lines for selected period and warehouse. Doesn't duplicate existing lines created by you."/>
                    <group colspan="4">
                        <button icon="gtk-cancel" special="cancel" string="Cancel"/>
                        <button icon="gtk-ok" name="create_planning" string="Create Stock Planning" type="object"/>
                    </group>         
                </form>
            </field>
        </record>      

        <record id="action_stock_planning_createlines_form" model="ir.actions.act_window">
            <field name="name">Create Stock Planning Lines</field>
            <field name="res_model">stock.planning.createlines</field>
            <field name="view_type">form</field>
            <field name="view_mode">form</field>
            <field name="view_id" ref="view_stock_planning_createlines_form"/>
            <field name="target">new</field>
        </record>

        <menuitem
            id="menu_stock_planning_createlines" 
            parent="menu_stock_planning_main"
            action="action_stock_planning_createlines_form" sequence = "5"/>

<!-- Planning section -->

        <record id="view_stock_planning_form" model="ir.ui.view">
            <field name="name">stock.planning.form</field>
            <field name="model">stock.planning</field>
            <field name="type">form</field>
            <field name="priority">50</field>
            <field name="arch" type="xml">
                <form string="Stock Planning">
                    <group colspan="4" col="7">
                        <group colspan ="3" col="2">
                            <separator colspan ="2" string = "General Info"/>

                            <field name="company_id" select = "1" widget= "selection" 
                                         on_change="onchange_company(company_id)" groups="base.group_multi_company"/>
                            <field name="warehouse_id" domain = "[('company_id','=',company_id)] " />
                            <field name="period_id" />
                            <field name="product_id" on_change="product_id_change(product_id)"  />
			    <field name="product_uom_categ"  invisible = "True"/>
			    <field name="product_uos_categ"  invisible = "True"/>
                            <field name="product_uom"  
                                         domain = "[('category_id','in',[product_uom_categ,product_uos_categ])]"
                                         on_change = "onchange_uom(product_uom)"/>
<!--                            <field name="state"/>    -->
                            <separator colspan ="2" string = "Forecasts"/>
                            <field name="warehouse_forecast"/>
                            <field name="company_forecast"/>
                            <field name="confirmed_forecasts_only"/>


                        </group>
                        <group colspan ="2" col="2">
                            <separator colspan ="2" string = "Current Period Situation"/>
                            <field name="stock_start"/>
                            <field name="already_out"/>
                            <field name="already_in"/>
                            <separator colspan ="2" string = "Planning and Situation for Calculated Period"/>
                            <field name="planned_outgoing"/>
                            <field name="outgoing"/>
                            <field name="outgoing_left"/>
                            <field name="to_procure"/>
                            <field name="incoming"/>
                            <field name="incoming_left"/>
                            <button name="calculate_planning" string="Calculate Planning" type="object" colspan="2"/>
                            <field name="stock_only"/> 
                        </group>
                        <group colspan ="2" col="2">
                            <separator colspan ="2" string = "Minimum Stock Rule Indicators"/>
                            <field name="minimum_op"/>
                            <field name="maximum_op"/>
                            <separator colspan ="2" string = "Calculated Period Simulation"/>
                            <field name="outgoing_before"/>
                            <field name="incoming_before"/>
                            <field name="stock_simulation"/> 
                            <button name="procure_incomming_left" string="Procure Incoming Left" type="object" colspan="2"/>
                            <field name="procure_to_stock"/> 
                            <separator colspan ="2" string = "Internal Supply"/>
			    <button name="internal_supply" string="Supply from Another Warehouse" type="object" colspan="2"/>
                            <field name="supply_warehouse_id" domain = "[('company_id','=',company_id)] "/> 
                            <field name="stock_supply_location"/> 
                        </group>
                    </group>
                    <separator colspan ="4" string = "Requisition history"/>
                    <field name = "history" colspan = "2" nolabel = "1"/>
                </form>
            </field>
        </record>

       <record id="view_stock_planning_filter" model="ir.ui.view">
            <field name="name">stock.planning.list.select</field>
            <field name="model">stock.planning</field>
            <field name="type">search</field>
            <field name="arch" type="xml">
                <search string="Search Stock Planning">
                 <group col='10' colspan='4'>
<!--  Doesn't work !       <filter icon="terp-purchase" string="Current" domain="[('line_time','=','Future')]" separator="1"/>  -->
                    <filter icon="terp-purchase" string="No Requisition" domain="[('history','=',False)]" separator="1"/>
                    <field name="company_id" widget="selection"/>
                    <field name="warehouse_id" widget="selection"/>
                    <field name="period_id" widget="selection"/>
                    <field name="product_id" widget="selection"/>
                 </group>
              </search>
            </field>
        </record>


        <record id="view_stock_planning_tree" model="ir.ui.view">
             <field name="name">stock.planning.tree</field>
            <field name="model">stock.planning</field>
            <field name="type">tree</field>
            <field name="arch" type="xml">
                <tree string="Master Procurement Schedule" colors ="blue:line_time=='Past';black:line_time=='Future'">
                    <field name="warehouse_id" domain = "[('company_id','=',company_id)] " />
                    <field name="period_id"/>
                    <field name="product_id" on_change="product_id_change(product_id)" />
                    <field name="product_uom"/>
                    <field name="warehouse_forecast" string="Forecast"/>
                    <field name="planned_outgoing"/>
                    <field name="to_procure"/>
                    <field name="stock_simulation" string="Stock"/>   <!-- previously stock_start -->
                </tree>
            </field>
        </record>

        <record id="action_view_stock_planning_form" model="ir.actions.act_window">
            <field name="name">Master Procurement Schedule</field>
            <field name="res_model">stock.planning</field>
            <field name="type">ir.actions.act_window</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form</field>
            <field name="search_view_id" ref="view_stock_planning_filter"/>
        </record>

        <menuitem
            id="menu_stock_planning" 
            parent="menu_stock_planning_main"
            action="action_view_stock_planning_form"/>
        
</data>
</openerp>
