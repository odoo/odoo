<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>
        <template id="report_ewaybill">
            <t t-call="web.html_container">
               <t t-foreach="docs" t-as="doc">
                    <t t-call="web.external_layout">
                        <div class="page">
                        <style>
                            span{
                            font-weight: bold;
                            }
                            hr {
                            border-top: 2px solid black;
                            opacity: 1;
                            }
                            table {
                            border-collapse: collapse;
                            border:1px solid black;
                            width:100%;
                            }
                            tr{
                            border-top: 1px solid black;
                            }
                            th,td{
                                padding: 5px;
                            }
                        </style>
                        <div class="row">
                            <div class="col-4">
                                <img t-att-src="image_data_uri(doc.company_id.logo)" class="img-fluid" style="width: 100px; height: 100px;" alt="Company Logo"/>
                            </div>
                            <div class="col-4 text-center">
                                <h3>e-Way Bill</h3>
                            </div>
                            <div class="col-4 d-flex justify-content-end">
                                <t t-if="doc.ewaybill_number != False">
                                    <img t-att-src="'/report/barcode/QR/' + str(doc.ewaybill_number) + '/' + str(doc.company_id.vat) + '/' + str(doc.date)" style="width: 100px; height: 100px;" alt="Barcode"/>
                                </t>
                            </div>
                        </div>
                        <hr/>
                        <t t-set="generate_json" t-value="doc._l10n_in_ewaybill_generate_json(doc)"/>
                        <t t-set="response_json" t-value="doc._get_l10n_in_edi_ewaybill_response_json()"/>
                        <t t-set="seller_buyer" t-value="doc._get_l10n_in_edi_saler_buyer_party(doc)"/>

                            <h4>1. E-WAY BILL Details</h4>
                            <div class="row">
                                <div class="col-3">
                                    <p>eWay Bill No: <span t-esc="doc.ewaybill_number"/></p>
                                </div>
                                <div class="col-3">
                                    <p>Generated Date: <span t-esc="doc.date"/></p>
                                </div>
                                <div class="col-3">
                                    <p>Generated By: <span t-esc="doc.company_id.vat"/></p>
                                </div>
                                <t t-if="doc.ewaybill_number != False">
                                    <div class="col-3">
                                            <p>Valid Upto: <span t-esc="response_json['validUpto']"/>
                                        <t t-if="doc.mode == '1'">
                                            (Vehicle Type is <span t-esc="dict(doc._fields['vehicle_type'].selection).get(doc.vehicle_type)" /> )                                        
                                        </t>
                                        </p>
                                    </div>
                                </t>
                            </div>
                            <div class="row">
                                <div class="col-3">
                                    <p>Mode: <span t-esc="dict(doc._fields['mode'].selection).get(doc.mode)"/></p>
                                </div>
                                <div class="col-3">
                                    <p>Approx Distance: <span t-esc="doc.distance"/></p>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-3">
                                    <p>Type:
                                        <t t-if="generate_json['supplyType'] == 'O'">
                                            <span>Outward</span>
                                        </t>
                                        <t t-else="">
                                            <span>Inward</span>
                                        </t> 
                                    </p>
                                </div>
                                <div class="col-6">
                                    <p>Document Details: <t><span t-esc="doc.type_id.name"/> - <span t-esc="doc.stock_picking_id.name"/> - <span t-esc="doc.date"/></t></p> 
                                </div>
                                <div class="col-3">
                                    <p>Transaction Type: 
                                        <t t-if="generate_json['transactionType'] == 1">
                                            <span>Regular</span>
                                        </t>
                                        <t t-elif="generate_json['transactionType'] == 2">
                                            <span>Bill To - Ship To</span>
                                        </t>
                                        <t t-elif="generate_json['transactionType'] == 3">
                                            <span>Bill From - Dispatch From</span>
                                        </t>
                                        <t t-elif="generate_json['transactionType'] == 4">
                                            <span>Combination of 2 and 3</span>
                                        </t>
                                        <t t-else="">
                                            <span></span>
                                        </t>
                                    </p>
                                </div>
                            </div>
                            <hr/>

                            <h4>2. Address Details</h4>
                            <div class="row">
                                <div class="col-5 ms-4">
                                    <span>From</span>
                                    <div class="border border-dark border-2 p-2">
                                        <p>GSTIN: <t t-esc="generate_json['fromGstin']"/></p>
                                        <p t-esc="generate_json['fromTrdName'] + ', ' + seller_buyer['seller_details'].state_id.name"/>
                                        <span>::Dispatch From::</span>
                                        <p t-esc="generate_json['fromAddr1'] + ', ' + generate_json['fromAddr2'] + ', ' + generate_json['fromPlace'] + ', ' + seller_buyer['dispatch_details'].state_id.name + '-' + str(generate_json['fromPincode'])"/>
                                    </div>
                                </div>
                                <div class="col-5 ms-4">
                                    <span>To</span>
                                    <div class="border border-dark border-2 p-2">
                                        <p>GSTIN: <t t-esc="generate_json['toGstin']"/></p>
                                        <p t-esc="generate_json['toTrdName'] + ', ' + seller_buyer['buyer_details'].state_id.name"/>
                                        <span>::Ship To::</span>
                                        <p t-esc="generate_json['toAddr1'] + ', ' + generate_json['toAddr2'] + ', ' + generate_json['toPlace'] + ', ' + seller_buyer['ship_to_details'].state_id.name + '-' + str(generate_json['toPincode'])"/>
                                    </div>
                                </div>
                            </div>
                            <hr/>
                    
                            <h4>3. Goods Details</h4>
                            <t t-call="l10n_in_ewaybill_stock.report_ewaybill_goods"/><br/>
                            <div class="row">
                                <div class="col-3">
                                    <p>Total Taxable Amount ₹ <span t-esc="doc.amount_untaxed"/></p>
                                </div>
                                <div class="col-3">
                                    <p>CGST Amount ₹ <span t-esc="generate_json['cgstValue']"/></p>
                                </div>
                                <div class="col-3">
                                    <p>SGST Amount ₹ <span t-esc="generate_json['sgstValue']"/></p>
                                </div>
                                <div class="col-3">
                                    <p>IGST Amount ₹ <span t-esc="generate_json['igstValue']"/></p>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-3">
                                    <p>CESS Amount ₹ <span t-esc="generate_json['cessValue']"/></p>
                                </div>
                                <div class="col-3">
                                    <p>CESS Non.Advol Amt ₹ <span t-esc="generate_json['cessNonAdvolValue']"/></p>
                                </div>
                                <div class="col-3">
                                    <p>Other Amt ₹ <span t-esc="generate_json['otherValue']"/></p>
                                </div>
                                <div class="col-3">
                                    <p>Total Inv. Amt ₹ <span t-esc="doc.amount_total"/></p>
                                </div>
                            </div>
                            <hr/>

                            <h4>4. Transportation Details</h4>
                            <div class="row">
                                <div class="col-6">
                                    <p>Transporter ID and Name: <span t-esc="doc.transporter_id.vat"/> and <span t-esc="doc.transporter_id.name"/></p>
                                </div>
                                <div class="col-6">
                                    <p>Transporter Doc and Date: <span t-esc="doc.transportation_doc_no"/> and <span t-esc="doc.transportation_doc_date"/></p>
                                </div>
                            </div>
                            <hr/>

                            <h4>5. Vehicle Details</h4>
                            <t t-call="l10n_in_ewaybill_stock.report_ewaybill_vehicles"/><br/>
                            <div style="text-align: center;">
                                <div>
                                    <t t-if="doc.ewaybill_number != False">
                                        <img t-att-src="'/report/barcode/Code128/' + doc.ewaybill_number" style="width:250px;height:35px;" alt="Barcode"/>
                                    </t>
                                </div>
                                <div>
                                    <span t-esc="doc.ewaybill_number"/>
                                </div>
                            </div>
                            <hr/>
                        </div>
                    </t>
               </t> 
            </t>
        </template>

        <template id="report_ewaybill_goods">
            <table>
                <thead style="border-bottom:1px solid black;">
                    <tr>
                        <th>HSN Code</th>
                        <th>Product Description</th>
                        <th>Quantity</th>
                        <th>Taxable Amount Rs.</th>
                        <th>Tax Rate (C+S+I+Cess+Cess Non Advol)</th>
                    </tr>
                </thead>
                <tbody>
                    <t t-set="items" t-value="doc.mapped('ewaybill_line_ids')"/>
                    <tr t-foreach="items" t-as="item">
                        <td>
                            <p t-esc="item.product_id.l10n_in_hsn_code"/>
                        </td>
                        <td>
                            <p t-esc="item.product_id.l10n_in_hsn_description"/>
                        </td>
                        <td>    
                            <p t-esc="item.quantity"/>
                        </td>
                        <td>    
                            <p t-esc="item.price_unit"/>
                        </td>
                        <td>
                            <t t-set="tax" t-value="(str(round(item.cgst_amount, 2)) if item.cgst_amount else 'NE') + '+' + (str(round(item.sgst_amount, 2)) if item.sgst_amount else 'NE') + '+' + (str(round(item.igst_amount, 2)) if item.igst_amount else 'NE') + '+' + (str(round(item.cess_amount, 2)) if item.cess_amount else 'NE') + '+' + (str(round(item.cess_non_advol_amount, 2)) if item.cess_non_advol_amount else 'NE')"/>
                            <p t-esc="tax"/>
                        </td>
                    </tr>
                </tbody>
            </table>
        </template>

        <template id="report_ewaybill_vehicles">
            <table>
                <thead style="border-bottom:1px solid black;">
                    <tr>
                        <th>Mode</th>
                        <th>Vehicle / Trans Doc No and Dt.</th>
                        <th>From</th>
                        <th>Entered Date</th>
                        <th>Entered By</th>
                        <th>CEWB No.(if any)</th>
                        <th>Multi Veh.Info(if any)</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>
                            <p t-esc="dict(doc._fields['mode'].selection).get(doc.mode)"/>
                        </td>
                        <td>
                            <t t-if="doc.mode == '1'">
                                <p t-esc="doc.vehicle_no"/>
                            </t>
                            <t t-else="">
                                <p>
                                    <t t-esc="doc.transportation_doc_no"/> (<t t-esc="doc.transportation_doc_date"/>)
                                </p>
                            </t>
                        </td>
                        <td>    
                            <p t-esc="generate_json['fromPlace']"/>
                        </td>
                        <td>    
                            <p t-esc="doc.date"/>
                        </td>
                        <td>
                            <p t-esc="doc.company_id.vat"/>
                        </td>
                        <td>
                        </td>
                        <td>
                        </td>
                    </tr>
                </tbody>
            </table>
        </template>

    </data>
</odoo>
