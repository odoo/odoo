<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <template id="page_mailing_unsubscribe" name="Unsubscribe">
        <t t-call="mass_mailing.layout">
            <t t-call="mass_mailing.unsubscribe_form"/>
        </t>
    </template>

    <template id="unsubscribe_form">
        <div id="o_mailing_portal_subscription"
             class="container o_mailing_portal_body"
             t-att-data-blocklist-enabled="blocklist_enabled"
             t-att-data-blocklist-possible="blocklist_possible"
             t-att-data-document-id="document_id"
             t-att-data-hash-token="hash_token"
             t-att-data-email="email"
             t-att-data-email-valid="email_valid"
             t-att-data-is-blocklisted="is_blocklisted"
             t-att-data-mailing-id="mailing_id">
            <div class="row">
                <div class="col-lg-6 offset-lg-3 mt-4">
                    <div id="o_mailing_subscription_info"
                         class="alert alert-success" role="status">
                        <div id="o_mailing_subscription_info_state">
                            <t t-if="unsubscribed_list">
                                You have been <strong>successfully unsubscribed from <t t-out="unsubscribed_list"/></strong>.
                            </t>
                            <t t-else="">
                                You have been <strong>successfully unsubscribed</strong>.
                            </t>
                        </div>
                        <div id="o_mailing_subscription_feedback">
                            <form action="/mail/mailing/feedback" method="POST">
                                <input type="hidden" name="csrf_token" t-att-value="request.csrf_token()"/>
                                <p>
                                    We would appreciate if you provide feedback about why you updated<br/>your subscriptions.
                                </p>
                                <textarea class="form-control" name="feedback" cols="60" rows="3"></textarea>
                                <br/>
                                <div class="btn btn-primary text-start" id="button_feedback">Send</div>
                            </form>
                        </div>
                    </div>

                    <div id="o_mailing_subscription_form" t-if="contacts">
                        <form action="/mailing/list/update" method="POST">
                            <h1 class="o_page_header">Mailing Subscriptions</h1>
                            <input type="hidden" name="csrf_token" t-att-value="request.csrf_token()"/>
                            <p>Choose your mailing subscriptions</p>
                            <ul id="o_mailing_subscription_form_lists" class="list-group">
                                <li t-foreach="list_ids"
                                    t-as="list_id"
                                    t-if="list_id.is_public == True"
                                    class="list-group-item">
                                    <input type="checkbox"
                                           name="mailing_list_ids"
                                           t-att-disabled="'disabled' if is_blocklisted else None"
                                           t-att-value="list_id['id']"
                                           t-att-checked="None if list_id['id'] in opt_out_list_ids else 'checked'"/>
                                    <t t-esc="list_id.name"/>
                                    <span t-if="list_id['id'] in opt_out_list_ids"
                                          class="o_mailing_list_unsubscribed">
                                        Unsubscribed
                                    </span>
                                </li>
                            </ul>

                            <div id="o_mailing_subscription_blocklist"
                                 class="mb64 pt-3">
                                <div class="btn btn-link float-end pe-0 text-uppercase d-none"
                                     t-if="blocklist_enabled and blocklist_possible"
                                     id="button_blocklist_add">Exclude Me</div>
                                <div class="btn btn-link float-end pe-0 text-uppercase d-none"
                                     id="button_blocklist_remove">Come Back</div>
                                <button type="submit" id="button_form_send"
                                        t-att-disabled="'disabled' if is_blocklisted else None"
                                        class="btn btn-primary">
                                    Update my subscriptions
                                </button>
                            </div>
                        </form>
                    </div>
                    <div t-else="" class="alert alert-info text-center" role="status">
                        <p>You are not subscribed to any of our mailing list.</p>
                    </div>
                </div>
            </div>
        </div>
    </template>

    <template id="page_mailing_unsubscribe_done" name="Unsubscribed">
        <t t-call="mass_mailing.layout">
            <t t-call="mass_mailing.unsubscribe_done"/>
        </t>
    </template>

    <template id="unsubscribe_done">
        <div id="o_mailing_portal_subscription"
             class="container o_mailing_portal_body"
             t-att-data-blocklist-enabled="blocklist_enabled"
             t-att-data-blocklist-possible="blocklist_possible"
             t-att-data-document-id="document_id"
             t-att-data-hash-token="hash_token"
             t-att-data-email="email"
             t-att-data-email-valid="email_valid"
             t-att-data-is-blocklisted="is_blocklisted"
             t-att-data-mailing-id="mailing_id">
            <div class="row">
                <input type="hidden" name="email" t-att-value="email"/>
                <input type="hidden" name="mailing_id" t-att-value="mailing_id"/>
                <input type="hidden" name="res_id" t-att-value="res_id"/>
                <div class="col-lg-6 offset-lg-3">
                    <h1 class="o_page_header">Mailing Subscriptions</h1>

                    <div id="o_mailing_subscription_info"
                         class="alert alert-success" role="status">
                        <div id="o_mailing_subscription_info_state">
                            You have been successfully <strong>unsubscribed</strong>!
                        </div>
                    </div>

                    <div t-if="list_ids" class="alert alert-warning">
                        <p class="text-center">You were still subscribed to those newsletters. You will not receive any news from them anymore:</p>
                        <ul class="list-group mb-4">
                            <t t-foreach="list_ids" t-as="list_id">
                                <t t-if="list_id.is_public == True">
                                    <li class="list-group-item bg-transparent">
                                        <strong><t t-esc="list_id.name"/></strong>
                                    </li>
                                </t>
                            </t>
                        </ul>
                    </div>

                    <div id="o_mailing_subscription_blocklist"
                         class="mb64 pt-3">
                        <div class="btn btn-link float-end pe-0 text-uppercase d-none"
                             t-if="blocklist_enabled and blocklist_possible"
                             id="button_blocklist_add">Exclude Me</div>
                        <div class="btn btn-link float-end pe-0 text-uppercase d-none"
                             id="button_blocklist_remove">Come Back</div>
                    </div>
                </div>
            </div>
        </div>
    </template>
</odoo>
