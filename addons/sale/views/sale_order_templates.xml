<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <template id="assets_frontend" inherit_id="web.assets_frontend" name="Sale frontend assets">
        <xpath expr="." position="inside">
            <script type="text/javascript" src="/sale/static/src/js/sale_portal_sidebar.js"></script>
        </xpath>
    </template>

    <template id="assets_backend" name="project assets" inherit_id="web.assets_backend">
        <xpath expr="." position="inside">
            <script type="text/javascript" src="/sale/static/src/js/tour.js"></script>
        </xpath>
    </template>

    <template id="assets_editor" inherit_id="web_editor.assets_editor" name="Website Quote Editor assets">
        <xpath expr="." position="inside">
            <link rel="stylesheet" type="text/scss" href="/sale/static/src/scss/sale.scss"/>
        </xpath>
    </template>

  <template id="pricing" name="Price">
      <section id="quote">
          <h1 class="page-header">Pricing</h1>

          <t t-set="display_taxamount" t-value="any([line.tax_id for line in quotation.order_line])"/>
          <t t-set="display_discount" t-value="True in [line.discount > 0 for line in quotation.order_line]"/>

        <div style="overflow-x:auto;">
          <table class="table" id="sales_order_table">
            <thead>
              <tr>
                  <t t-set="colspan" t-value="6"/>
                  <th></th>
                  <th>Products</th>
                  <th>Quantity</th>
                  <th t-if="display_taxamount">
                    <span>Taxes</span>
                    <t t-set="colspan" t-value="colspan+1"/>
                  </th>
                  <th t-if="display_discount">
                    <span>Discount</span>
                    <t t-set="colspan" t-value="colspan+1"/>
                  </th>
                  <th class="text-right">Unit Price</th>
                  <th class="text-right" >
                    <span groups="account.group_show_line_subtotals_tax_excluded">Amount</span>
                    <span groups="account.group_show_line_subtotals_tax_included">Total Price</span>
                  </th>
              </tr>
            </thead>
            <tbody class="sale_tbody">

              <t t-set="current_subtotal" t-value="0"/>

              <t t-foreach="quotation.order_line" t-as="line">

                <t t-set="current_subtotal" t-value="current_subtotal + line.price_subtotal" groups="account.group_show_line_subtotals_tax_excluded"/>
                <t t-set="current_subtotal" t-value="current_subtotal + line.price_total" groups="account.group_show_line_subtotals_tax_included"/>

                <tr t-attf-class="{{ 'o_is_' + line.display_type if line.display_type else '' }}">
                  <t t-if="not line.display_type">
                    <td class="text-center">
                        <div class="d-none d-xl-block">
                            <span t-field="line.product_image" t-options="{'widget': 'image', 'class': 'rounded', 'style':'width: 48px;height:48px'}" />
                        </div>
                    </td>
                    <td id="product_name"><span t-field="line.name"/></td>
                    <td>
                      <div id="quote_qty">
                        <span t-field="line.product_uom_qty"/>
                        <span t-field="line.product_uom" groups="uom.group_uom"/>
                      </div>
                    </td>
                    <td t-if="display_taxamount">
                      <span t-esc="', '.join(map(lambda x: (x.description or x.name), line.tax_id))"/>
                    </td>
                    <td t-if="display_discount">
                      <strong t-if="line.discount" class="text-info">
                        <t t-esc="((line.discount % 1) and '%s' or '%d') % line.discount"/>% discount
                      </strong>
                    </td>
                    <td class="text-right">
                      <div
                        t-field="line.price_unit"
                        t-options='{"widget": "monetary", "display_currency": quotation.pricelist_id.currency_id}'
                        t-att-style="line.discount and 'text-decoration: line-through' or None"
                        t-att-class="(line.discount and 'text-danger' or '') + ' text-right'"
                      />
                      <div t-if="line.discount">
                        <t t-esc="(1-line.discount / 100.0) * line.price_unit" t-options='{"widget": "monetary", "display_currency": quotation.pricelist_id.currency_id}'/>
                      </div>
                    </td>
                    <td class="text-right">
                      <span
                        t-field="line.price_subtotal"
                        t-options='{"widget": "monetary", "display_currency": quotation.pricelist_id.currency_id}'
                        groups="account.group_show_line_subtotals_tax_excluded"
                      />
                      <span
                        t-field="line.price_total"
                        t-options='{"widget": "monetary", "display_currency": quotation.pricelist_id.currency_id}'
                        groups="account.group_show_line_subtotals_tax_included"
                      />
                    </td>
                  </t>
                  <t t-if="line.display_type == 'line_section'">
                    <td t-att-colspan="colspan">
                      <span t-field="line.name"/>
                    </td>
                    <t t-set="current_section" t-value="line"/>
                    <t t-set="current_subtotal" t-value="0"/>
                  </t>
                  <t t-if="line.display_type == 'line_note'">
                    <td t-att-colspan="colspan">
                      <span t-field="line.name"/>
                    </td>
                  </t>
                </tr>

                <t t-if="current_section and (line_last or quotation.order_line[line_index+1].display_type == 'line_section')">
                  <tr class="is-subtotal text-right">
                    <td t-att-colspan="colspan">
                      <strong>Subtotal:</strong> <span
                        t-esc="current_subtotal"
                        t-options='{"widget": "monetary", "display_currency": quotation.pricelist_id.currency_id}'
                      />
                    </td>
                  </tr>
                </t>
              </t>
            </tbody>
          </table>
        </div>

          <div class="clearfix">
            <div id="total" class="row" name="total">
              <div t-attf-class="col-md-4 float-right #{'col-4' if not type_html else ''}">
                <table class="table table-sm" style="min-width: 250px;max-width: 400px;">
                  <tr class="border-black" style="border-bottom:1px solid #dddddd;">
                    <td><strong>Subtotal</strong></td>
                    <td class="text-right">
                        <span
                          data-id="total_amount"
                          t-field="quotation.amount_untaxed"
                          t-options='{"widget": "monetary","display_currency": quotation.pricelist_id.currency_id}'
                        />
                    </td>
                </tr>
                <t t-foreach="quotation._get_tax_amount_by_group()" t-as="amount_by_group">
                    <tr style="border-bottom:1px solid #dddddd;">
                      <t t-if="amount_by_group[3] == 1 and quotation.amount_untaxed == amount_by_group[2]">
                        <td>
                          <span t-esc="amount_by_group[0]"/>
                          <span>&amp;nbsp;<span>on</span>&amp;nbsp;<t t-esc="amount_by_group[2]" t-options='{"widget": "monetary", "display_currency": quotation.pricelist_id.currency_id}'/></span>
                        </td>
                        <td class="text-right">
                          <span t-esc="amount_by_group[1]"
                              t-options='{"widget": "monetary", "display_currency": quotation.pricelist_id.currency_id}'/>
                        </td>
                      </t>
                      <t t-else ="">
                        <td>
                          <span t-esc="amount_by_group[0]"/>
                        </td>
                        <td class="text-right">
                          <span t-esc="amount_by_group[1]"
                              t-options='{"widget": "monetary", "display_currency": quotation.pricelist_id.currency_id}'/>
                        </td>
                      </t>
                    </tr>
                </t>
                <tr class="border-black">
                  <td><strong>Total</strong></td>
                  <td class="text-right">
                    <span data-id="total_amount" t-field="quotation.amount_total" t-options='{"widget": "monetary", "display_currency": quotation.pricelist_id.currency_id}'/>
                  </td>
                </tr>
              </table>
            </div>
          </div>
        </div>
      </section>
      <section id="terms" class="container" t-if="quotation.note">
          <h2 class="page-header">Terms &amp; Conditions</h2>
          <p t-field="quotation.note"/>
      </section>
  </template>

  <template id="signature" name="Signature">
      <div t-if="quotation.signature" class="row mt64" name="signature">
          <div class="offset-8 col-4">
              <strong>Signature</strong>
          </div>
          <div class="offset-8 col-4">
              <img t-att-src="'data:image/png;base64,%s' % to_text(quotation.signature)" style="max-height: 4cm; max-width: 8cm;"/>
          </div>
          <div class="offset-8 col-4 text-center">
              <p t-field="quotation.signed_by"/>
          </div>
      </div>
  </template>

  <template id="change_quantity" inherit_id="sale.pricing" active="False"  name="Change Quantity">
      <xpath expr="//div[@id='quote_qty']" position="replace">
          <div class="input-group oe_website_spinner">
              <div class="input-group-prepend d-print-none">
                  <span class="input-group-text">
                      <a t-attf-href="./update_line/#{ line.id }/?order_id=#{ quotation.id }&amp;remove=True&amp;token=#{ quotation.access_token }" class="mb8 js_update_line_json" aria-label="Remove one" title="Remove one">
                          <span class="fa fa-minus"/>
                      </a>
                  </span>
              </div>
              <input type="text" class="js_quantity form-control" t-att-data-id="line.id" t-att-value="line.product_uom_qty"/>
              <div class="input-group-append d-print-none">
                  <span class="input-group-text">
                      <a t-attf-href="./update_line/#{ line.id }/?order_id=#{ quotation.id }&amp;token=#{ quotation.access_token }" class="mb8 js_update_line_json" aria-label="Add one" title="Add one">
                          <span class="fa fa-plus"/>
                      </a>
                  </span>
              </div>
          </div>
      </xpath>
  </template>

    <!-- duplicata of the template payment.payment_confirmation_status.
        The duplication avoid to break an existing installation in stable version-->
    <template id="payment_confirmation_status">
        <div t-if="payment_tx_id and payment_tx_id.state == 'done'" class="alert alert-success alert-dismissable" role="status">
            <button type="button" class="close" data-dismiss="alert" aria-label="Close">&amp;times;</button>
            <span t-if='payment_tx_id.acquirer_id.done_msg' t-raw="payment_tx_id.acquirer_id.done_msg"/>
            <span t-if='payment_tx_id.acquirer_id.post_msg' t-raw="payment_tx_id.acquirer_id.post_msg"/>
        </div>
        <div t-if="payment_tx_id and payment_tx_id.state == 'pending'" class="alert alert-warning alert-dismissable" role="alert">
            <button type="button" class="close" data-dismiss="alert" aria-label="Close">&amp;times;</button>
            <span t-if='payment_tx_id.acquirer_id.pending_msg' t-raw="payment_tx_id.acquirer_id.pending_msg"/>
            <span t-if='payment_tx_id.acquirer_id.post_msg' t-raw="payment_tx_id.acquirer_id.post_msg"/>
        </div>
        <div t-if="payment_tx_id and payment_tx_id.state == 'cancel'" class="alert alert-danger alert-dismissable" role="alert">
            <button type="button" class="close" data-dismiss="alert" aria-label="Close">&amp;times;</button>
            <span t-if='payment_tx_id.acquirer_id.cancel_msg' t-raw="payment_tx_id.acquirer_id.cancel_msg"/>
        </div>
        <div t-if="payment_tx_id and payment_tx_id.state == 'error'" class="alert alert-danger alert-dismissable" role="alert">
            <button type="button" class="close" data-dismiss="alert" aria-label="Close">&amp;times;</button>
            <span t-if='payment_tx_id.acquirer_id.error_msg' t-raw="payment_tx_id.acquirer_id.error_msg"/>
        </div>
        <div t-if="payment_tx_id and payment_tx_id.state == 'authorized'" class="alert alert-success alert-dismissable" role="status">
            <button type="button" class="close" data-dismiss="alert" aria-label="Close">&amp;times;</button>
            Your payment has been authorized.
            <span t-if='payment_tx_id.acquirer_id.post_msg' t-raw="payment_tx_id.acquirer_id.post_msg"/>
        </div>
    </template>

  <!-- Complete page of the quotation -->
  <template id="so_quotation" name="Product Quotation" inherit_id="portal.portal_sidebar" primary="True">
        <xpath expr="//div[hasclass('o_portal_sidebar')]" position="inside">
          <t t-set="sales_order" t-value="quotation"/> <!-- rename to ensure breadcrumb compatibility with website_portal_sale's portal_layout inheritance -->
              <div class="row mt16 o_portal_sale_sidebar">
                <!-- Sidebar -->
                  <div class="col-lg-3 d-print-none">
                      <div class="bs-sidebar">
                          <div class="text-center" t-if="quotation.state in ('draft', 'sent', 'waiting_date')" style="padding: 10px">
                              <a role="button" t-if="order_valid and not quotation.signature and quotation.has_to_be_signed()" class="btn btn-primary btn-block" data-toggle="modal" data-target="#modalaccept">
                                  <i class="fa fa-check"/> Accept Order
                              </a>
                              <a role="button" t-elif="order_valid and quotation.has_to_be_paid()" class="btn btn-primary btn-block" data-toggle="modal" data-target="#modalaccept">
                                  <i class="fa fa-check"/> <t t-if="not quotation.signature">Accept &amp; </t>Pay
                              </a>
                              <a role="button" t-if="not order_valid" href="#discussion" class="btn btn-info btn-block o_normalwhitespace">
                                  <strong>This offer expired!</strong><br/>
                                  Contact us for new quote.
                              </a>
                              <div class="mt8" t-if="order_valid">
                                  <a data-toggle="modal" data-target="#modaldecline">
                                      Reject
                                  </a>
                              </div>
                          </div>
                          <div class="text-center" t-if="need_payment or (quotation.state in ('sale') and quotation.has_to_be_paid() and tx_state != 'done')" style="padding: 10px">
                              <a role="button" class="btn btn-primary btn-block" data-toggle="modal" data-target="#modalaccept">
                                  <i class="fa fa-check"></i> Pay Now
                              </a>
                          </div>
                          <hr class="mt0 mb0"/>
                          <div class="navspy" t-ignore="true" role="complementary">
                              <ul class="nav flex-column bs-sidenav" data-id="quote_sidebar"></ul>
                          </div>
                          <hr class="mt0 mb0"/>
                          <div t-if="order_valid and quotation.state in ['draft', 'sent']" class="text-center">
                              <input type="hidden" t-att-value="quotation.validity_date" id="validity_date"/>
                              <div class="mt8" t-if="days_valid &gt; 0">
                                  <strong>This offer expires in</strong>
                                  <div class="day_counter mt8 mb16">
                                      <i class="fa fa-clock-o" aria-title="Dates" title="Dates"></i>
                                      <t t-esc="days_valid"/>
                                      <t t-if="days_valid &gt; 1">
                                          days
                                      </t>
                                      <t t-if="days_valid &lt;= 1">
                                          day
                                      </t>
                                  </div>
                              </div>


                              <div class="text-center mb16" t-if="quotation.amount_undiscounted &gt; quotation.amount_untaxed">
                                  <p class="text-muted mb8">Your advantage:</p>
                                  <t t-if="quotation.amount_untaxed == quotation.amount_total">
                                      <strong t-field="quotation.amount_total"
                                          t-options='{"widget": "monetary", "display_currency": quotation.pricelist_id.currency_id}'/>
                                      <strong t-field="quotation.amount_undiscounted"
                                          t-options='{"widget": "monetary", "display_currency": quotation.pricelist_id.currency_id}'
                                          style="text-decoration: line-through"
                                          class="text-danger"/>
                                  </t>
                                  <t t-if="quotation.amount_untaxed != quotation.amount_total">
                                      <strong t-field="quotation.amount_untaxed"
                                          t-options='{"widget": "monetary", "display_currency": quotation.pricelist_id.currency_id}'/>
                                      <strong t-field="quotation.amount_undiscounted"
                                          t-options='{"widget": "monetary", "display_currency": quotation.pricelist_id.currency_id}'
                                          style="text-decoration: line-through"
                                          class="text-danger"/>
                                      <br />
                                      (<span t-field="quotation.amount_total"
                                          t-options='{"widget": "monetary", "display_currency": quotation.pricelist_id.currency_id}'/> Incl. tax)
                                  </t>
                              </div>
                         </div>
                      </div>
                  </div>
                  <!-- Page content -->
                  <div id="quote_content" class="col-lg-9">

                      <div class="alert alert-success alert-dismissable" t-if="message==1" role="status">
                          <button type="button" class="close" data-dismiss="alert" aria-label="Close">&amp;times;</button>
                          Your message has been successfully sent!
                      </div>
                      <div class="alert alert-warning alert-dismissable" t-if="message==3" role="status">
                          <button type="button" class="close" data-dismiss="alert" aria-label="Close">&amp;times;</button>
                          This order has been validated. Thanks for your trust
                          and do not hesitate to <a href="#discussion">contact us</a> for
                          any question.
                      </div>
                      <t t-if="payment_tx">
                          <t t-set="payment_tx_id" t-value="payment_tx"/>
                          <t t-call="sale.payment_confirmation_status"/>
                      </t>
                      <div class="alert alert-warning alert-dismissable" t-if="message==4 and quotation.state != 'sent'" role="alert">
                          <button type="button" class="close" data-dismiss="alert" aria-label="Close">&amp;times;</button>
                          This order
                            <t t-if="quotation.state=='draft'">has not yet been sent!</t>
                            <t t-if="quotation.state=='cancel'">has already been cancelled!</t>
                            <t t-if="quotation.state not in ('cancel','draft')">has already been validated!</t>
                          You can <a href="#discussion">contact us</a> for
                          any questions.
                      </div>

                      <!-- modal relative to the actions Accept/Reject/Cancel -->
                      <div role="dialog" class="modal fade" id="modalaccept">
                        <div class="modal-dialog" t-if="not quotation.signature and quotation.has_to_be_signed()">
                           <form id="accept" method="POST" t-att-data-order-id="quotation.id" t-att-data-token="quotation.access_token" class="js_accept_json modal-content js_website_submit_form">
                            <input type="hidden" name="csrf_token" t-att-value="request.csrf_token()"/>
                            <header class="modal-header">
                              <h4 class="modal-title">Validate Order</h4>
                              <button type="button" class="close" data-dismiss="modal" aria-label="Close">&amp;times;</button>
                            </header>
                            <main class="modal-body" id="sign-dialog">
                                <p>
                                    <span>I agree that by signing this proposal, I
                                    accept it on the behalf of </span><b t-field="quotation.partner_id.commercial_partner_id"/><span>, for an amount of </span>
                                    <b data-id="total_amount" t-field="quotation.amount_total"
                                        t-options='{"widget": "monetary", "display_currency": quotation.pricelist_id.currency_id}'/>
                                    <span>with payment terms: </span><b t-field="quotation.payment_term_id"/>.
                                </p>
                                <t t-call="portal.portal_signature">
                                    <t t-set="object" t-value="quotation"/>
                                    <t t-set="partner_name" t-value="quotation.partner_id.name"/>
                                    <t t-set="callUrl" t-value="'/my/quotes/accept'"/>
                                    <t t-set="accessToken" t-value="quotation.access_token"/>
                                </t>
                            </main>
                          </form>
                        </div>

                        <div class="modal-dialog modal-content" t-if="not (quotation.has_to_be_signed() and not quotation.signature) and (quotation.has_to_be_paid() or need_payment)">
                          <header class="modal-header">
                            <h4 class="modal-title">Validate Order</h4>
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">&amp;times;</button>
                          </header>
                          <main class="modal-body" id="sign-dialog">
                            <p>
                                <span>I agree that by paying this proposal, I
                                accept it on the behalf of </span><b t-field="quotation.partner_id.commercial_partner_id"/><span>, for an amount of </span>
                                <b data-id="total_amount" t-field="quotation.amount_total"
                                  t-options='{"widget": "monetary", "display_currency": quotation.pricelist_id.currency_id}'/>
                                <span>with payment terms: </span><b t-field="quotation.payment_term_id"/>.
                            </p>
                        </main>
                        <footer class="modal-footer">
                            <div t-if="pms or s2s_acquirers or form_acquirers" id="payment_method" class="text-left">
                                <h3 class="mb24">Pay with</h3>
                                <t t-call="payment.payment_tokens_list">
                                    <t t-set="mode" t-value="'payment'"/>
                                    <t t-set="submit_txt" t-value="'Pay &amp; Confirm'"/>
                                    <t t-set="icon_class" t-value="'fa-lock'"/>
                                    <t t-set="form_action" t-value="'/quotation/' + str(quotation.id) + '/transaction/token'"/>
                                    <t t-set="prepare_tx_url" t-value="'/quotation/' + str(quotation.id) + '/transaction/'"/>
                                    <t t-set="access_token" t-value="quotation.access_token"/>
                                </t>
                            </div>
                          </footer>
                        </div>
                      </div>

                      <div role="dialog" class="modal fade" id="modaldecline">
                        <div class="modal-dialog">
                          <form id="decline" method="POST" t-attf-action="/quotation/#{quotation.id}/decline?access_token=#{quotation.access_token}" class="modal-content">
                            <input type="hidden" name="csrf_token" t-att-value="request.csrf_token()"/>
                            <header class="modal-header">
                              <h4 class="modal-title">Reject This Quote</h4>
                              <button type="button" class="close" data-dismiss="modal" aria-label="Close">&amp;times;</button>
                            </header>
                            <main class="modal-body">
                              <p>
                                  Tell us why you are refusing this quotation, this will help us improve our services.
                              </p>
                              <textarea rows="4" name="decline_message" placeholder="Your feedback....." class="form-control"/>
                            </main>
                            <footer class="modal-footer">
                                <button type="submit" t-att-id="quotation.id" class="btn btn-primary">Reject</button>
                                <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                            </footer>
                          </form>
                        </div>
                      </div>

                      <div class="alert alert-warning alert-dismissable d-print-none" t-if="quotation.state == 'cancel'" role="alert">
                          <button type="button" class="close" data-dismiss="alert" aria-label="close">&amp;times;</button>
                          <strong>This quotation has been canceled.</strong> Contact us to get a new quote.
                      </div>

                      <t t-call="sale.so_quotation_content"/>

                      <div class="text-center d-print-none mt16 mb16" id="quotation_toolbar" t-if="quotation.state in ('draft', 'sent', 'waiting_date')">
                          <a role="button" class="btn btn-success" data-toggle="modal" data-target="#modalaccept" t-if="order_valid and not quotation.has_to_be_paid()">
                              <i class="fa fa-check"></i> Accept
                          </a>
                          <a role="button" class="btn btn-success" data-toggle="modal" data-target="#modalaccept" t-if="order_valid and quotation.has_to_be_paid()">
                              <i class="fa fa-check"></i> Accept &amp; Pay
                          </a>
                          <a role="button" class="btn btn-danger" data-toggle="modal" data-target="#modaldecline">
                              <i class="fa fa-times"></i> Reject
                          </a>
                      </div>
                      <div class="text-center" t-if="need_payment or (quotation.state in ('sale') and quotation.has_to_be_paid() and tx_state != 'done')" style="padding: 10px">
                          <a role="button" class="btn btn-primary" data-toggle="modal" data-target="#modalaccept">
                              <i class="fa fa-check"></i> Pay Now
                          </a>
                      </div>

                  </div><!-- //col-lg-9 -->
              </div>
            </xpath>
  </template>

  <template id="chatter" name="Allow Comments &amp; History" inherit_id="sale.so_quotation">
      <xpath expr="//div[@id='quote_content']" position="inside">
          <h1 class="page-header">History</h1>
          <!-- Options:Quotation Chatter: user can reply -->
          <t t-call="portal.message_thread">
            <t t-set="object" t-value="quotation"/>
          </t>
      </xpath>
      <xpath expr="//a[@data-target='#modaldecline']" position="before">
          <a type="submit" href="#discussion">
              Ask Changes
          </a>
      </xpath>
      <xpath expr="//div[@id='quotation_toolbar']/a[@data-target='#modaldecline']" position="before">
          <a role="button" class="btn btn-info" type="submit" href="#discussion">
              <i class="fa fa-comment"></i> Feedback
          </a>
      </xpath>
  </template>

  <!--
      Quotation content : intro, informations, order lines, remarks, descriptions ....
      This template should contains all the printable element of the SO. This is the
      template rendered in PDF with the report engine.
  -->
  <template id="so_quotation_content" name="Quotation Content">
      <!-- Intro -->
      <div id="introduction" class="page-header mt16">
        <h1>
            <t t-if="quotation.state in ('draft','sent','cancel')">Quotation</t>
            <t t-if="quotation.state not in ('draft','sent','cancel')">Order</t>
            <em t-esc="quotation.name"/>
            <small t-field="quotation.state"/>
            <div t-ignore="true" class="float-right css_editable_mode_hidden d-print-none">
               <ul class="list-inline">
                  <li groups="sales_team.group_sale_salesman" class="list-inline-item">
                    <a role="button" t-if="quotation.state not in ('manual')" class="btn btn-info" t-att-href="'/web#return_label=Website&amp;model=%s&amp;id=%s&amp;action=%s&amp;view_type=form' % (quotation._name, quotation.id, action)">Edit Quote</a>
                    <a role="button" t-if="quotation.state in ('manual')" class=" btn btn-info" t-att-href="'/web#return_label=Website&amp;model=%s&amp;id=%s&amp;action=%s&amp;view_type=form' % (quotation._name, quotation.id, action)">Back to Sales Order</a>
                  </li>
                  <li class="list-inline-item">
                     <a role="button" class="btn btn-info" target="_blank" t-att-href="'/my/orders/%s?access_token=%s&amp;pdf=True' % (quotation.id, quotation.access_token)">Print</a>
                  </li>
               </ul>
            </div>
        </h1>
      </div>
        <!-- Informations -->
        <div id="informations">
            <t t-if="error or warning" t-call="sale.portal_order_error"/>
            <t t-if="success and (not error and not warning)" t-call="sale.portal_order_success"/>
            <div t-if="quotation.transaction_ids and not invoices and quotation.state in ('sent', 'sale') and portal_confirmation == 'pay' and not success and not error" t-att-data-order-id="quotation.id">
                <t t-set="payment_tx_id" t-value="quotation.get_portal_last_transaction()"/>
                <t t-call="payment.payment_confirmation_status"/>
            </div>
            <div class="mb8">
                <strong>Date:</strong> <span t-field="quotation.create_date" t-options='{"widget": "date"}'/>
            </div>
            <div class="mb8" t-if="quotation.validity_date">
                <strong>Expiration Date:</strong> <span t-field="quotation.validity_date" t-options='{"widget": "date"}'/>
            </div>
            <div class='row'>
                <div class="col-lg-6">
                    <div>
                        <strong>Invoicing Address</strong>
                    </div>
                    <div>
                        <address t-field="quotation.partner_invoice_id" t-options='{"widget": "contact", "fields": ["address", "name"], "no_marker": True}'/>
                    </div>
                    <t t-set="tx_ids" t-value="quotation.transaction_ids.filtered(lambda tx: tx.state != 'draft')"/>
                    <t t-if="tx_ids">
                        <div>
                            <strong>Transactions</strong>
                        </div>
                        <div>
                            <t t-foreach="tx_ids" t-as="tx">
                                <div>
                                    <span t-esc="tx.reference"/>
                                    <span class="text-muted" t-field="tx.create_date"/>
                                    <t t-if="tx.state == 'done'">
                                        <span class="badge badge-success orders_label_text_align"><i class="fa fa-fw fa-check"/> Done</span>
                                    </t>
                                    <t t-if="tx.state != 'done'">
                                        <span class="badge badge-info orders_label_text_align"><i class="fa fa-fw fa-clock-o"/> Waiting</span>
                                        <t t-if="tx.state_message"><br /><span t-esc="tx.state_message"/></t>
                                    </t>
                                </div>
                            </t>
                        </div>
                    </t>
                </div>
                <div id="shipping_address" class="col-lg-6" groups="sale.group_delivery_invoice_address">
                    <div>
                        <strong>Shipping Address</strong>
                    </div>
                    <div>
                        <address t-field="quotation.partner_shipping_id" t-options='{"widget": "contact", "fields": ["address", "name"], "no_marker": True}'/>
                    </div>
                </div>
            </div>
        </div>
      <div class="oe_structure"/>
      <!-- Pricing -->
      <t t-call="sale.pricing"/>
      <!-- Signature -->
      <t t-call="sale.signature"/>
  </template>

</odoo>
