-
  I create a partner which is a my customer
-
  !record {model: res.partner, id: res_partner_test22}:
    name: Junjun wala
    supplier: False
    customer: True
    opt_out: True
-
  I create one Sale Order
-
  !record {model: sale.order, id: sale_order_test}:
    partner_id: res_partner_test22
    partner_invoice_id: base.res_partner_address_3
    partner_order_id: base.res_partner_address_3
    partner_shipping_id: base.res_partner_address_3
    pricelist_id: 1
    order_line:
      - product_id: product.product_product_pc1
        product_uom_qty: 1.0
        product_uom: 1
        price_unit: 150.0
        name: 'basic pc'
    order_line:
      - product_id: product.product_product_pc3
        product_uom_qty: 10.0
        product_uom: 1
        price_unit: 200.0
        name: 'medium pc'
-
  I Open the sale order
-
  !python {model: sale.order}: |
    
    orders = self.browse(cr, uid, ref("sale_order_test"))
    import netsvc
    wf_service = netsvc.LocalService("workflow")
    wf_service.trg_validate(uid, 'sale.order',orders.id,'order_confirm', cr)

-
  I Tesing of EDI functionality. First I export Sale Order from my company than import that Order into customer company
-
  !python {model: ir.edi.document}: |
    sale_order_pool = self.pool.get('sale.order')
    orders = sale_order_pool.browse(cr, uid, ref("sale_order_test"))

    tokens = self.export_edi(cr, uid, [orders])
    assert tokens, 'Token is not generated'

-
 I import Sale order from EDI Document of purchase order
-
  !python {model: ir.edi.document}: |
    sale_order_pool = self.pool.get('sale.order')
    edi_document = {
        "order_line": [{
                "name": "basic pc", 
                "product_uom": ["5af1272e-dd26-11e0-b65e-701a04e25543:product.product_uom_unit", "PCE"], 
                "date_planned": "2011-09-30", 
                "price_unit": 150.0, 
                "__last_update": False, 
                "__id": "5af1272e-dd26-11e0-b65e-701a04e25543:purchase.purchase_order_line-AlhsVDZGoKvJ", 
                "product_qty": 1.0, 
                "product_id": ["5af1272e-dd26-11e0-b65e-701a04e25543:product.product_product_pc1", "[PC1] Basic PC"]
        },
        {
                "name": "medium pc", 
                "product_uom": ["5af1272e-dd26-11e0-b65e-701a04e25543:product.product_uom_unit", "PCE"], 
                "date_planned": "2011-09-15", 
                "price_unit": 100.0, 
                "__last_update": False, 
                "__id": "5af1272e-dd26-11e0-b65e-701a04e25543:purchase.purchase_order_line-AlhsVDZGoKvJ", 
                "product_qty": 2.0, 
                "product_id": ["5af1272e-dd26-11e0-b65e-701a04e25543:product.product_product_pc3", "[PC3] Medium PC"]
        }], 
        "partner_address_id": ["5af1272e-dd26-11e0-b65e-701a04e25543:base.res_partner_address_11", "Sebastien LANGE, France, Alencon, 1 place de l'\u00c9glise"],
        "__id": "5af1272e-dd26-11e0-b65e-701a04e25543:purchase.purchase_order_test", 
        "date_order": "2011-09-12", 
        "partner_id": ["5af1272e-dd26-11e0-b65e-701a04e25543:purchase.res_partner_test20", "jones white"], 
        "__attachments": [], 
        "__module": "sale", 
        "amount_total": 350.0, 
        "company_address": {
                "phone": "(+32).81.81.37.00", 
                "street": "Chaussee de Namur 40", 
                "city": "Gerompont", 
                "zip": "1367", 
                "__last_update": False, 
                "country_id": ["5af1272e-dd26-11e0-b65e-701a04e25543:base.be", "Belgium"], 
                "__id": "5af1272e-dd26-11e0-b65e-701a04e25543:base.main_address", 
        }, 
        "amount_untaxed": 350.0, 
        "name": "PO00011", 
        "__model": "sale.order", 
        "__last_update": False, 
        "company_id": ["5af1272e-dd26-11e0-b65e-701a04e25543:base.main_company", "Client S.A."], 
        "__version": [6, 1], 
        "pricelist_id": ["5af1272e-dd26-11e0-b65e-701a04e25543:product.list0", "Public Pricelist (EUR)"]
    }
    new_sale_order_id = sale_order_pool.edi_import(cr, uid, edi_document, context=context)
    assert new_sale_order_id,  'Sale order is not imported'

-
  I Checking the sale order become purchase order or not after import
-
  !python {model: sale.order}: |
    
    ids = self.search(cr, uid, [('partner_id','=','Client S.A.'), ('client_order_ref', '=', 'PO00011')])
    assert ids, 'Order does not have created of party'
    order_new = self.browse(cr, uid, ids[0])
    assert order_new.pricelist_id.name == 'Public Pricelist' , "Public Price list is not imported"
    assert order_new.amount_total == 350, "Amount total is not same"
    assert order_new.amount_untaxed == 350, "untaxed amount is not same"
    assert len(order_new.order_line) == 2, "sale lines are not same"
    for sale_line in order_new.order_line:
        if sale_line.name == 'basic pc':
            assert sale_line.delay == 18 , "delay is not same"
            assert sale_line.product_uom.name == "PCE" , "uom is not same"
            assert sale_line.price_unit == 150 , "price unit is not same"
            assert sale_line.product_uom_qty == 1 , "product qty is not same"
        elif sale_line.name == 'medium pc':
            assert sale_line.delay == 3 , "delay is not same"
            assert sale_line.product_uom.name == "PCE" , "uom is not same"
            assert sale_line.price_unit == 100 , "price unit is not same"
            assert sale_line.product_uom_qty == 2 , "product qty is not same"
        else:
            assert 'wrong product imported in sale lines'
