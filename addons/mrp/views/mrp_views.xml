<?xml version="1.0" encoding="utf-8"?>
<odoo>

        <!-- Top menu item -->
        <menuitem id="base.menu_mrp_root"
            name="Manufacturing"
            groups="group_mrp_user,group_mrp_manager"
            icon="fa-wrench"
            web_icon="mrp,static/description/icon.png"
            sequence="35"/>

        <menuitem id="menu_mrp_manufacturing"
            name="Operations"
            parent="base.menu_mrp_root"
            sequence="10"/>

        <menuitem id="menu_mrp_bom"
            name="Master Data"
            parent="base.menu_mrp_root"
            sequence="20"/>

        <menuitem id="menu_mrp_reporting"
              name="Reporting"
              parent="base.menu_mrp_root"
              sequence="25"/>

        <menuitem id="menu_mrp_configuration"
            name="Configuration"
            parent="base.menu_mrp_root"
            groups="group_mrp_manager"
            sequence="100"/>

        <menuitem id="menu_pm_resources_config"
            name="Resources"
            parent="menu_mrp_configuration"
            sequence="100"/>

        <menuitem id="menu_view_resource_calendar_search_mrp"
            action="resource.action_resource_calendar_form"
            parent="menu_pm_resources_config"
            sequence="10"
            groups="base.group_no_one"/>

        <menuitem id="menu_view_resource_calendar_leaves_search_mrp"
            action="resource.action_resource_calendar_leave_tree"
            parent="menu_pm_resources_config"
            sequence="20"
            groups="base.group_no_one"/>

        <!-- Work Centers -->
        <record id="mrp_workcenter_tree_view" model="ir.ui.view">
            <field name="name">mrp.workcenter.tree</field>
            <field name="model">mrp.workcenter</field>
            <field name="arch" type="xml">
                <tree string="Work Center">
                    <field name="sequence" widget="handle"/>
                    <field name="name"/>
                    <field name="code"/>
                    <field name="company_id" groups="base.group_multi_company"/>
                </tree>
            </field>
        </record>

        <record id="oee_pie_view" model="ir.ui.view">
            <field name="name">mrp.workcenter.productivity.graph</field>
            <field name="model">mrp.workcenter.productivity</field>
            <field name="priority">20</field>
            <field name="arch" type="xml">
                <graph string="Workcenter Productivity" type="pie">
                    <field name="loss_id"/>
                    <field name="duration" type="measure"/>
                </graph>
            </field>
        </record>
        <record model="ir.actions.act_window" id="mrp_workcenter_productivity_report_oee">
            <field name="name">Overall Equipment Efficiency</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">mrp.workcenter.productivity</field>
            <field name="view_type">form</field>
            <field name="view_id" eval="oee_pie_view"/>
            <field name="view_mode">graph,pivot,tree,form</field>
            <field name="domain">[('workcenter_id','=',active_id')]</field>
            <field name="context">{'search_default_thismonth':True}</field>
            <field name="help" type="html">
              <p>
                Overall Equipment Efficiency: no working or blocked time.
              </p>
            </field>
        </record>
        <record model="ir.actions.act_window" id="mrp_workcenter_productivity_report_blocked">
            <field name="name">Productivity Losses</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">mrp.workcenter.productivity</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form,graph,pivot</field>
            <field name="domain">[('loss_type','&lt;&gt;', 'productive'), ('workcenter_id','=',active_id')]</field>
            <field name="context">{}</field>
            <field name="help" type="html">
              <p>
                No productivity loss for this equipment.
              </p>
            </field>
        </record>



        <record model="ir.actions.act_window" id="mrp_workorder_workcenter_report">
            <field name="name">Work Orders Performance</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">mrp.production.work.order</field>
            <field name="domain">[('workcenter_id','=', active_id),('state','=','done')]</field>
            <field name="view_type">form</field>
            <field name="view_mode">pivot,graph,tree,form,gantt</field>
        </record>

        <record model="ir.actions.act_window" id="mrp_workorder_report">
            <field name="name">Work Orders Performance</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">mrp.production.work.order</field>
            <field name="domain">[('state','=','done')]</field>
            <field name="view_type">form</field>
            <field name="view_mode">graph,pivot,tree,form,gantt</field>
        </record>

        <record id="mrp_workcenter_view" model="ir.ui.view">
            <field name="name">mrp.workcenter.form</field>
            <field name="model">mrp.workcenter</field>
            <field name="arch" type="xml">
                <form string="Work Center">
                    <sheet>
                        <div class="oe_button_box" name="button_box">
                            <button class="oe_stat_button" name="toggle_active" type="object" icon="fa-archive">
                                <field name="active" widget="boolean_button"
                                    options='{"terminology": "archive"}'/>
                            </button>
                            <button name="%(mrp_workcenter_productivity_report_oee)d" type="action" class="oe_stat_button" icon="fa-pie-chart">
                                <div class="o_form_field o_stat_info">
                                    <span class="o_stat_value"><field name="oee" widget="statinfo" nolabel="1"/>%</span>
                                    <span class="o_stat_text">OEE</span>
                                </div>
                            </button>
                            <button name="%(mrp_workcenter_productivity_report_blocked)d" type="action" class="oe_stat_button" icon="fa-bar-chart">
                                <div class="o_form_field o_stat_info">
                                    <span class="o_stat_value"><field name="blocked_time" widget="statinfo" nolabel="1"/> hour(s)</span>
                                    <span class="o_stat_text">Lost</span>
                                </div>
                            </button>
                            <button name="%(mrp_workorder_report)d" type="action" class="oe_stat_button" icon="fa-bar-chart" context="{'search_default_workcenter_id': active_id, 'search_default_thisyear'}">
                                <div class="o_form_field o_stat_info">
                                    <span class="o_stat_value"><field name="stat_perf" widget="statinfo" nolabel="1"/>%</span>
                                    <span class="o_stat_text">Performance</span>
                                </div>
                            </button>
                        </div>
                        <group>
                            <group>
                                <field name="name" string="Work Center Name"/>
                            </group>
                            <group>
                                <field name="code"/>
                                <field name="calendar_id" widget="selection"/>
                                <field name="company_id" groups="base.group_multi_company" options="{'no_create': True}"/>
                            </group>
                        </group>
                        <notebook>
                            <page string="General Information">
                                <group>
                                    <group name="capacity">
                                        <label for="time_efficiency"/>
                                        <div class="o_row">
                                            <field name="time_efficiency"/> %
                                        </div>
                                        <field name="capacity"/>

                                        <label for="oee_target"/>
                                        <div class="o_row">
                                            <field name="oee_target"/> %
                                        </div>
                                    </group>
                                    <group>
                                        <label for="time_start"/>
                                        <div>
                                            <field name="time_start" widget="float_time" class="oe_inline"/> minutes
                                        </div>
                                        <label for="time_stop"/>
                                        <div>
                                            <field name="time_stop" widget="float_time" class="oe_inline"/> minutes
                                        </div>
                                    </group>
                                </group>
                                <separator string="Description"/>
                                <field name="note" nolabel="1" placeholder="Description of the work center..."/>
                            </page>
                        </notebook>
                    </sheet>
                </form>
            </field>
        </record>
        <record id="view_mrp_workcenter_search" model="ir.ui.view">
            <field name="name">mrp.workcenter.search</field>
            <field name="model">mrp.workcenter</field>
            <field name="arch" type="xml">
                <search string="Search for mrp workcenter">
                    <field name="name" string="Mrp Workcenter" filter_domain="['|',('name','ilike',self),('code','ilike',self)]"/>
                    <filter string="Archived" domain="[('active','=',False)]"/>
                    <group expand="0" string="Group By...">
                        <filter string="Company" domain="[]" context="{'group_by':'company_id'}" groups="base.group_multi_company"/>
                    </group>
                </search>
            </field>
        </record>

        <!-- Routings Workcenter -->
        <record id="mrp_routing_workcenter_tree_view" model="ir.ui.view">
            <field name="name">mrp.routing.workcenter.tree</field>
            <field name="model">mrp.routing.workcenter</field>
            <field name="arch" type="xml">
                <tree string="Routing Work Centers">
                    <field name="sequence" widget="handle"/>
                    <field name="name"/>
                    <field name="workcenter_id"/>
                    <field name="time_cycle" widget="float_time"/>
                    <field name="company_id" options="{'no_create': True}" groups="base.group_multi_company"/>
                </tree>
            </field>
        </record>
        <record id="mrp_routing_workcenter_form_view" model="ir.ui.view">
            <field name="name">mrp.routing.workcenter.form</field>
            <field name="model">mrp.routing.workcenter</field>
            <field name="arch" type="xml">
                <form string="Routing Work Centers">
                    <sheet>
                        <group>
                            <group>
                                <field name="name"/>
                                <field name="workcenter_id"/>
                                <field name="company_id" options="{'no_create': True}" groups="base.group_multi_company"/>
                                <field name="sequence" groups="base.group_no_one"/>
                            </group><group>
                                <field name="wo_count" invisible="1"/>
                                <field name="time_mode" widget="radio"/>
                                <label for="time_mode_batch" attrs="{'invisible': [('time_mode','=','manual')]}"/>
                                <div attrs="{'invisible': [('time_mode','=','manual')]}">
                                    last
                                    <field name="time_mode_batch" class="oe_inline"/>
                                    work orders
                                </div>
                                <label for="time_cycle_manual" attrs="{'invisible': [('time_mode','=','auto'), ('wo_count','&gt;',0)]}" string="Default Duration"/>
                                <div attrs="{'invisible': [('time_mode','=','auto'), ('wo_count','&gt;',0)]}">
                                    <field name="time_cycle_manual" widget="float_time" class="oe_inline"/> minutes
                                </div>
                            </group><group>
                                <field name="batch"/>
                                <field name="batch_size" attrs="{'invisible': [('batch','=','no')]}"/>
                            </group>
                        </group>
                        <notebook>
                            <page string="Description">
                                <field name="note"/>
                            </page>
                            <page string="Work Sheet">
                                <field name="worksheet" widget="image"/>
                            </page>
                        </notebook>
                    </sheet>
                </form>
            </field>
        </record>
        <record id="mrp_workcenter_action" model="ir.actions.act_window">
            <field name="name">Work Centers</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">mrp.workcenter</field>
            <field name="view_type">form</field>
            <field name="view_id" ref="mrp_workcenter_tree_view"/>
            <field name="search_view_id" ref="view_mrp_workcenter_search"/>
            <field name="help" type="html">
              <p class="oe_view_nocontent_create">
                Click to add a work center.
              </p><p>
                Work Centers allow you to create and manage manufacturing
                units. They consist of workers and/or machines, which are
                considered as units for task assignation as well as capacity
                and planning forecast.
              </p>
            </field>
        </record>

        <record id="view_mrp_production_work_order_search" model="ir.ui.view">
            <field name="name">mrp.production.work.order.search</field>
            <field name="model">mrp.production.work.order</field>
            <field name="arch" type="xml">
                <search>
                    <field name="workcenter_id"/>
                    <filter string="Today" name="today" domain="[('date_start','&gt;=',time.strftime('%%Y-%%m-%%d'))]"/>
                    <filter string="This Month" name="thismonth" domain="[('date_start','&gt;=',time.strftime('%%Y-%%m-01'))]"/>
                    <filter string="This Year" name="thisyear" domain="[('date_start','&gt;=',time.strftime('%%Y-01-01'))]"/>
                    <separator/>
                    <filter string="Ready" name="ready" domain="[('state','=','ready')]"/>
                    <filter string="Pending" name="pending" domain="[('state','=','pending')]"/>
                    <filter string="In Progress" name="progress" domain="[('state','=','progress')]"/>
                    <filter string="Done" name="done" domain="[('state','=', 'done')]"/>
                    <separator/>
                </search>
            </field>

        </record>

        <record id="action_work_orders" model="ir.actions.act_window">
            <field name="name">Work Orders</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">mrp.production.work.order</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form,gantt,pivot,graph,calendar</field>
            <!--<field name="context">{'default_workcenter_id': }</field>-->
            <field name="search_view_id" ref="view_mrp_production_work_order_search"/>
            <field name="domain">[('workcenter_id', '=', active_id), ('state', '!=', 'done')]</field>
            <field name="help" type="html">
              <p class="oe_view_nocontent_create">
                Click to add a work center.
              </p><p>
                Work Centers allow you to create and manage manufacturing
                units. They consist of workers and/or machines, which are
                considered as units for task assignation as well as capacity
                and planning forecast.
              </p>
            </field>
        </record>

        <!-- Manufacturing Order -->
        <record id="mrp_production_tree_view" model="ir.ui.view">
            <field name="name">mrp.production.tree</field>
            <field name="model">mrp.production</field>
            <field name="arch" type="xml">
                <tree decoration-bf="message_needaction==True" decoration-info="state in ('draft','confirmed')" decoration-danger="date_planned&lt;current_date and state not in ('done','cancel')" decoration-muted="state in ('done','cancel')" string="Manufacturing Orders">
                    <field name="message_needaction" invisible="1"/>
                    <field name="name"/>
                    <field name="date_planned"/>
                    <field name="product_id"/>
                    <field name="product_qty" sum="Total Qty" string="Quantity"/>
                    <field name="product_uom_id" string="Unit of Measure" options="{'no_open':True,'no_create':True}" groups="product.group_uom"/>
                    <field name="availability"/>
                    <field name="routing_id" groups="mrp.group_mrp_routings"/>
                    <field name="origin"/>
                    <field name="state"/>
                </tree>
            </field>
        </record>

        <!-- Actions for Work Center  -->
        <record id="act_product_mrp_production_workcenter" model="ir.actions.act_window">
            <field name="context">{'search_default_todo': 1}</field>
            <field name="name">Manufacturing Orders</field>
            <field name="res_model">mrp.production</field>
            <field name="view_id" ref="mrp_production_tree_view"/>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form,gantt</field>
            <field name="domain">[('routing_id', '!=', False),('routing_id.workorder_ids.workcenter_id','=', active_id)]</field>
        </record>

        <record id="production_order_server_action" model="ir.actions.server">
            <field name="name">Plan Orders</field>
            <field name="model_id" ref="mrp.model_mrp_production"/>
            <field name="state">code</field>
            <field name="code">
                if context.get('active_model') == 'mrp.production' and context.get('active_ids'):
                    self.button_plan(cr, uid, context['active_ids'], context=context)
            </field>
        </record>

        <record id="run_procurement_order_action" model="ir.values">
            <field name="model_id" ref="mrp.model_mrp_production" />
            <field name="name">Plan Orders</field>
            <field name="key2">client_action_multi</field>
            <field name="key">action</field>
            <field name="model">mrp.production</field>
            <field name="value" eval="'ir.actions.server,' + str(ref('production_order_server_action'))" />
        </record>


        <record id="mrp_workorder_delta_report" model="ir.actions.act_window">
            <field name="name">Work Orders Deviation</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">mrp.production.work.order</field>
            <field name="view_type">form</field>
            <field name="view_mode">graph,pivot,tree,form,gantt,calendar</field>
            <field name="context">{'search_default_workcenter_id': active_id}</field>
            <field name="domain">[]</field>
            <field name="help" type="html">
                <p>
                  No data to display. You will get here statistics about the
                  work orders duration related to this routing.
                </p>
            </field>
        </record>


        <!-- Workcenter Kanban view-->
        <record model="ir.ui.view" id="mrp_workcenter_kanban">
            <field name="name">mrp.workcenter.kanban</field>
            <field name="model">mrp.workcenter</field>
            <field name="arch" type="xml">
                <kanban class="oe_background_grey o_kanban_dashboard o_workcenter_kanban" create="0">
                    <field name="name"/>
                    <field name="color"/>
                    <field name="nb_orders"/>
                    <field name="working_state"/>
                    <field name="oee_target"/>
                    <templates>
                        <t t-name="kanban-box">
                            <div t-attf-class="#{kanban_color(record.color.raw_value)}" style="min-width: 400px;">
                                <div class="o_kanban_card_header">
                                    <div class="o_kanban_card_header_title">
                                        <div class="o_primary"><field name="name"/></div>
                                    </div>
                                    <div class="o_kanban_manage_button_section">
                                        <a class="o_kanban_manage_toggle_button" href="#">More <i class="fa fa-caret-down"/></a>
                                    </div>
                                </div>
                                <div class="container o_kanban_card_content o_visible">
                                    <div class="row">
                                        <div class="col-xs-6 o_kanban_primary_left">
                                            <div class="btn-group" name="o_wo">
                                            <t t-if="record.nb_orders.raw_value &gt; 0">
                                                <button class="btn btn-primary" name="%(action_work_orders)d" type="action" context="{'search_default_ready': 1, 'search_default_progress': 1}">
                                                    <span>Work Orders</span>
                                                </button>
                                            </t>
                                            <t  t-if="record.nb_orders.raw_value &lt;= 0">
                                                <button class="btn btn-warning" name="%(act_product_mrp_production_workcenter)d" type="action">
                                                    <span>Plan Orders</span>
                                                </button>
                                            </t>
                                            </div>
                                        </div>
                                        <div class="col-xs-6 o_kanban_primary_right">
                                            <div class="row" t-if="record.count_ready_order.raw_value &gt; 0">
                                                <div class="col-xs-8">
                                                    <a name="%(action_work_orders)d" type="action" context="{'search_default_ready': 1}">
                                                        To Launch
                                                    </a>
                                                </div>
                                                <div class="col-xs-4 text-right">
                                                    <field name="count_ready_order"/>
                                                </div>
                                            </div>
                                            <div class="row" t-if="record.count_progress_order.raw_value &gt; 0">
                                                <div class="col-xs-8">
                                                    <a name="%(action_work_orders)d" type="action" context="{'search_default_progress': 1}">
                                                        In Progress
                                                    </a>
                                                </div>
                                                <div class="col-xs-4 text-right">
                                                    <field name="count_progress_order"/>
                                                </div>
                                            </div>
                                            <div class="row" t-if="record.oee.raw_value &gt; 0">
                                                <div class="col-xs-8">
                                                    <a name="%(mrp_workcenter_productivity_report_oee)d" type="action">
                                                        OEE
                                                    </a>
                                                </div>
                                                <div class="col-xs-4 text-right">
                                                    <span t-att-class="record.oee_target.value and (record.oee.value &lt; record.oee_target.value) and 'label label-danger' or None">
                                                        <field name="oee"/>%
                                                    </span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-xs-6 o_kanban_primary_left" style="position:absolute; bottom:0;" name="wc_stages">
                                            <a name="%(act_mrp_block_workcenter)d" type="action" class="oe_kanban_status"
                                                title="No workorder currently in progress. Click to mark work center as blocked."
                                                attrs="{'invisible': [('working_state','in',('blocked','done'))]}"/>
                                            <a name="unblock" type="object" class=" oe_kanban_status oe_kanban_status_red"
                                                title="Workcenter blocked, click to unblock."
                                                attrs="{'invisible': [('working_state','in',('normal','done'))]}"/>
                                            <a name="%(act_mrp_block_workcenter)d" type="action" class="oe_kanban_status oe_kanban_status_green"
                                                title="Work orders in progress. Click to block work center."
                                                attrs="{'invisible': [('working_state','in',('normal','blocked'))]}"/>
                                        </div> 
                                    </div>
                                </div><div class="container o_kanban_card_manage_pane o_invisible">
                                    <div class="row">
                                        <div class="col-xs-6 o_kanban_card_manage_section o_kanban_manage_view">
                                            <div class="o_kanban_card_manage_title">
                                                <span>Actions</span>
                                            </div>
                                            <div name="plan_order">
                                                <a name="%(action_work_orders)d" type="action">Plan Orders</a>
                                            </div>
                                        </div>
                                        <div class="col-xs-6 o_kanban_card_manage_section o_kanban_manage_new">
                                            <div class="o_kanban_card_manage_title">
                                                <span>Reports</span>
                                            </div>
                                            <div>
                                                <a name="%(mrp_workcenter_productivity_report_oee)d" type="action">OEE</a>
                                            </div>
                                            <div>
                                                <a name="%(mrp_workorder_workcenter_report)d" type="action" context="{'search_default_thisyear':True}">
                                                    Performance
                                                </a>
                                            </div>
                                            <div>
                                                <a name="%(action_work_orders)d" type="action" context="{'search_default_waiting': 1}">Waiting Availability</a>
                                            </div>
                                        </div>
                                    </div>

                                    <div t-if="widget.editable" class="o_kanban_card_manage_settings row">
                                        <div class="col-xs-8">
                                            <ul class="oe_kanban_colorpicker" data-field="color"/>
                                        </div>
                                        <div class="col-xs-4 text-right">
                                            <a type="edit">Settings</a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </t>
                    </templates>
                </kanban>
            </field>
        </record>


        <record id="mrp_workcenter_kanban_action" model="ir.actions.act_window">
            <field name="name">Work Centers Dashboard</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">mrp.workcenter</field>
            <field name="view_type">form</field>
            <field name="view_mode">kanban,form</field>
            <field name="search_view_id" ref="view_mrp_workcenter_search"/>
            <field name="help" type="html">
              <p class="oe_view_nocontent_create">
                Click to add a work center.
              </p><p>
                Work Centers allow you to create and manage manufacturing
                units. They consist of workers and/or machines, which are
                considered as units for task assignation as well as capacity
                and planning forecast.
              </p>
            </field>
        </record>

        <menuitem id="menu_view_resource_search_mrp"
            action="mrp_workcenter_action"
            groups="group_mrp_routings"
            parent="menu_mrp_bom"
            sequence="100"/>
        <menuitem id="menu_mrp_dashboard"
            name="Dashboard"
            action="mrp_workcenter_kanban_action"
            groups="group_mrp_routings"
            parent="base.menu_mrp_root"
            sequence="5"/>


        <record id="action_mrp_routing_time" model="ir.actions.act_window">
            <field name="name">Work Orders</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">mrp.production.work.order</field>
            <field name="view_type">form</field>
            <field name="view_mode">graph,pivot,tree,form,gantt,calendar</field>
            <field name="context">{'search_default_done': True}</field>
            <field name="search_view_id" ref="view_mrp_production_work_order_search"/>
            <field name="domain">[('production_id.routing_id', '=', active_id), ('state', '=', 'done')]</field>
            <field name="help" type="html">
                <p>
                  No data to display. You will get here statistics about the
                  work orders duration related to this routing.
                </p>
            </field>
        </record>


        <!-- Routings -->
        <record id="mrp_routing_form_view" model="ir.ui.view">
            <field name="name">mrp.routing.form</field>
            <field name="model">mrp.routing</field>
            <field name="arch" type="xml">
                <form string="Routing">
                    <sheet>
                        <div class="oe_button_box" name="button_box">
                            <button name="%(action_mrp_routing_time)d" type="action" class="oe_stat_button" icon="fa-clock-o">
                                <div class="o_form_field o_stat_info">
                                    <span class="o_stat_text">Time<br/> Analysis</span>
                                </div>
                            </button>
                            <button class="oe_stat_button" name="toggle_active" type="object" icon="fa-archive">
                                <field name="active" widget="boolean_button"
                                    options='{"terminology": "archive"}'/>
                            </button>
                        </div>
                        <div class="oe_title">
                            <h1>
                                <field name="code"/>
                            </h1>
                        </div>
                        <group>
                            <group>
                                <field name="name"/>
                            </group>
                            <group>
                                <field name="location_id"/>
                                <field name="company_id" options="{'no_create': True}" groups="base.group_multi_company"/>
                           </group>
                        </group>
                        <notebook>
                            <page string="Work Center Operations">
                                <field name="workorder_ids" string="Operation"/>
                            </page>
                            <page string="Notes">
                                <field name="note"/>
                            </page>
                        </notebook>
                    </sheet>
                </form>
            </field>
        </record>
        <record id="mrp_routing_tree_view" model="ir.ui.view">
            <field name="name">mrp.routing.tree</field>
            <field name="model">mrp.routing</field>
            <field name="arch" type="xml">
                <tree string="Routing">
                    <field name="code"/>
                    <field name="name"/>
                    <field name="active" invisible="1"/>
                    <field name="location_id"/>
                    <field name="company_id" groups="base.group_multi_company"/>
                </tree>
            </field>
        </record>
        <record id="mrp_routing_search_view" model="ir.ui.view">
            <field name="name">mrp.routing.search</field>
            <field name="model">mrp.routing</field>
            <field name="arch" type="xml">
                <search string="Routing">
                    <field name="name" string="Routing" filter_domain="['|',('name','ilike',self),('code','ilike',self)]"/>
                    <filter string="Archived" name="inactive" domain="[('active','=',False)]"/>
                    <field name="location_id"/>
                    <field name="company_id" groups="base.group_multi_company"/>
                    <group expand="0" string="Group By...">
                        <filter string="Production Location" domain="[]" context="{'group_by':'location_id'}"/>
                    </group>
                </search>
            </field>
        </record>
        <record id="mrp_routing_action" model="ir.actions.act_window">
            <field name="name">Routings</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">mrp.routing</field>
            <field name="view_type">form</field>
            <field name="view_id" ref="mrp_routing_tree_view"/>
            <field name="search_view_id" ref="mrp_routing_search_view"/>
            <field name="help" type="html">
              <p class="oe_view_nocontent_create">
                Click to create a new routing.
              </p><p>
                Routings allow you to create and manage the manufacturing
                operations that should be followed within your work centers in
                order to produce a product.  They are attached to bills of
                materials that will define the required raw materials.
              </p>
            </field>
        </record>
        <menuitem id="menu_mrp_routing_action"
          action="mrp_routing_action"
          parent="menu_mrp_bom"
          groups="group_mrp_routings"
          sequence="50"/>

        <!-- Bill of Materials -->
        <record id="mrp_bom_form_view" model="ir.ui.view">
            <field name="name">mrp.bom.form</field>
            <field name="model">mrp.bom</field>
            <field name="arch" type="xml">
                <form string="Bill of Material">
                    <sheet>
                        <div class="oe_button_box" name="button_box">
                            <button name="toggle_active" type="object"
                                    class="oe_stat_button" icon="fa-archive">
                                <field name="active" widget="boolean_button"
                                    options='{"terminology": "archive"}'/>
                            </button>
                        </div>
                    <group>
                        <group>
                            <field name="product_tmpl_id"/>
                            <field name="product_id" groups="product.group_product_variant"/>
                            <label for="product_qty" string="Quantity"/>
                            <div class="o_row">
                                <field name="product_qty"/>
                                <field name="product_uom_id" options="{'no_open':True,'no_create':True}" groups="product.group_uom"/>
                            </div>
                            <field name="routing_id" groups="mrp.group_mrp_routings"/>
                        </group>
                        <group>
                            <field name="code"/>
                            <field name="bom_type" widget="radio"/>
                            <p colspan="2" class="oe_grey" attrs="{'invisible': [('bom_type','=','normal')]}">
                                When processing a sales order for this product, the delivery order
                                will contain the raw materials, instead of the finished product.
                            </p>
                            <field name="company_id" groups="base.group_multi_company" options="{'no_create': True}"/>
                        </group>
                    </group>
                    <notebook>
                        <page string="Components">
                            <field name="bom_line_ids" widget="one2many_list">
                                <tree string="Components" editable="bottom">
                                    <field name="sequence" widget="handle"/>
                                    <field name="product_id"/>
                                    <button name="show_documents" type="object" icon="fa-files-o" attrs="{'invisible': [('has_attachments', '=', False)]}"/>
                                    <button name="show_documents" type="object" icon="fa-file" attrs="{'invisible': [('has_attachments', '=', True)]}"/>
                                    <field name="has_attachments" invisible="1"/>
                                    <field name="product_qty"/>
                                    <field name="product_uom_id" options="{'no_open':True,'no_create':True}" groups="product.group_uom"/>
                                    <field name="attribute_value_ids" widget="many2many_tags" domain="[('product_ids.product_tmpl_id', '=', parent.product_tmpl_id)]" groups="product.group_product_variant"/>
                                    <field name="operation_id" groups="mrp.group_mrp_routings" domain="[('routing_id', '=', parent.routing_id)]"/>
                                </tree>
                            </field>
                        </page>
                        <page string="Miscellaneous">
                            <group>
                                <group>
                                    <field name="sequence"/>
                                    <field name="operation_id" domain="[('routing_id', '=', routing_id)]" groups="mrp.group_mrp_routings"/>
                                </group>
                                <group>
                                    <field name="ready_to_produce" string="Manufacturing Readiness"/>
                                    <field name="picking_type_id" string="Operation"/>
                                </group>
                            </group>
                        </page>
                    </notebook>
                    </sheet>
                    <div class="oe_chatter">
                         <field name="message_follower_ids" widget="mail_followers"/>
                         <field name="message_ids" colspan="4" widget="mail_thread" nolabel="1"/>
                    </div>
                </form>
            </field>
        </record>
       <record id="mrp_bom_tree_view" model="ir.ui.view">
            <field name="name">mrp.bom.tree</field>
            <field name="model">mrp.bom</field>
            <field name="arch" type="xml">
                <tree string="Bill of Materials">
                    <field name="active" invisible="1"/>
                    <field name="product_tmpl_id"/>
                    <field name="code"/>
                    <field name="product_id" groups="product.group_product_variant"/>
                    <field name="product_qty"/>
                    <field name="product_uom_id" groups="product.group_uom"/>
                </tree>
            </field>
        </record>
        <record id="view_mrp_bom_filter" model="ir.ui.view">
            <field name="name">mrp.bom.select</field>
            <field name="model">mrp.bom</field>
            <field name="arch" type="xml">
                <search string="Search Bill Of Material">
                    <field name="code" filter_domain="['|',('code','ilike',self),('product_tmpl_id','ilike',self)]"/>
                    <field name="bom_line_ids" string="Components"/>
                    <field name="product_tmpl_id" string="Product"/>
                    <field name="company_id" groups="base.group_multi_company"/>
                    <filter string="Archived" name="inactive" domain="[('active','=',False)]"/>
                    <group expand="0" string="Group By...">
                        <filter string="Product" domain="[]" context="{'group_by':'product_tmpl_id'}"/>
                        <filter string='Default Unit of Measure' domain="[]" context="{'group_by' : 'product_uom_id'}"/>
                        <filter string="Routings" domain="[]" context="{'group_by':'routing_id'}"/>
                   </group>
                </search>
            </field>
        </record>
        <record id="mrp_bom_form_action" model="ir.actions.act_window">
            <field name="name">Bill of Materials</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">mrp.bom</field>
            <field name="domain">[]</field> <!-- force empty -->
            <field name="view_type">form</field>
            <field name="search_view_id" ref="view_mrp_bom_filter"/>
            <field name="help" type="html">
              <p class="oe_view_nocontent_create">
                Click to create a bill of material.
              </p><p>
                Bills of Materials allow you to define the list of required raw
                materials used to make a finished product; through a manufacturing
                order or a pack of products.
              </p><p>
                Odoo uses these BoMs to automatically propose manufacturing
                orders according to procurement needs.
              </p>
            </field>
        </record>
        <menuitem id="menu_mrp_bom_form_action"
            action="mrp_bom_form_action"
            parent="menu_mrp_bom"
            sequence="99"/>

        <!-- BOM Line -->
        <record id="mrp_bom_component_tree_view" model="ir.ui.view">
            <field name="name">mrp.bom.component.tree</field>
            <field name="model">mrp.bom.line</field>
            <field name="arch" type="xml">
                <tree string="Components" editable="top">
                    <field name="sequence" widget="handle"/>
                    <field name="bom_id"/>
                    <field name="product_id"/>
                    <field name="product_qty"/>
                    <field name="product_uom_id" options="{'no_open':True,'no_create':True}" groups="product.group_uom"/>
                    <field name="routing_id"/>
                    <field name="attribute_value_ids" widget="many2many_tags" groups="product.group_product_variant"/>
                </tree>
            </field>
        </record>
       <record id="mrp_bom_line_tree_view" model="ir.ui.view">
            <field name="name">mrp.bom.tree</field>
            <field name="model">mrp.bom.line</field>
            <field name="field_parent">child_line_ids</field>
            <field name="arch" type="xml">
                <tree string="Bill of Materials">
                    <field name="sequence" invisible="1"/>
                    <field name="product_id"/>
                    <field name="product_uom_id" options="{'no_open':True,'no_create':True}" groups="product.group_uom"/>
                    <field name="routing_id" groups="mrp.group_mrp_routings"/>
                </tree>
            </field>
        </record>
        <record id="view_mrp_bom_line_filter" model="ir.ui.view">
            <field name="name">mrp.bom.line.select</field>
            <field name="model">mrp.bom.line</field>
            <field name="arch" type="xml">
                <search string="Search Bill Of Material Components">
                    <field name="bom_id"/>
                    <field name="product_id"/>
                    <group expand="0" string="Group By...">
                        <filter string="Bill Of Material" domain="[]" context="{'group_by':'bom_id'}"/>
                        <filter string="Product" domain="[]" context="{'group_by':'product_id'}"/>
                        <filter string='Default Unit of Measure' domain="[]" context="{'group_by' : 'product_uom_id'}"/>
                        <filter string="Routings" domain="[]" context="{'group_by':'routing_id'}"/>
                   </group>
                </search>
            </field>
        </record>
        <record id="action2" model="ir.actions.act_window">
            <field name="name">Bill of Materials Structure</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">mrp.bom.line</field>
            <field name="domain">[('bom_id', 'in', active_ids)]</field>
            <field name="view_type">tree</field>
            <field name="view_id" ref="mrp_bom_line_tree_view"/>
            <field name="view_type">tree</field>
        </record>
        <record id="ir_BOM_structure" model="ir.values">
            <field eval="'client_action_multi'" name="key2"/>
            <field eval="'mrp.bom'" name="model"/>
            <field name="name">Bill of Materials Structure</field>
            <field eval="'ir.actions.act_window,'+str(action2)" name="value"/>
        </record>

        <record model="ir.actions.act_window" id="action_mrp_workorder_production_specific">
            <field name="name">Work Orders</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">mrp.production.work.order</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form,gantt,calendar,pivot,graph</field>
            <field name="domain">[('production_id', '=', active_id)]</field>
            <field name="help" type="html">
              <p class="oe_view_nocontent_create">
                Click to start a new work order.
              </p><p>
                Work Orders is the list of operations to be performed for each
                manufacturing order. Once you start the first work order of a
                manufacturing order, the manufacturing order is automatically
                marked as started. Once you finish the latest operation of a
                manufacturing order, the MO is automatically done and the related
                products are produced.
              </p>
            </field>
        </record>

        <record model="ir.actions.act_window" id="action_mrp_production_moves">
            <field name="name">Stock Moves</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">stock.move</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form</field>
            <field name="domain">['|', ('raw_material_production_id', '=', active_id), ('production_id', '=', active_id)]</field>
        </record>

        <record id="view_stock_move_lots" model="ir.ui.view">
            <field name="name">stock.move.lots.form</field>
            <field name="model">stock.move</field>
            <field name="priority">1000</field>
            <field name="arch" type="xml">
                <form string="Lots">
                    <field name="state" invisible="1"/>
                    <group>
                        <group>
                            <field name="product_id" readonly="1"/>
                            <label for="quantity_done"/>
                            <div>
                                <field name="quantity_done" readonly="1" class="oe_inline"/>
                                <field name="product_uom" readonly="1" class="oe_inline" groups="product.group_uom"/>
                            </div>
                            <field name="is_done" invisible="1"/>
                            <field name="workorder_id" invisible="1"/>
                        </group>
                    </group>
                    <field name="move_lot_ids" attrs="{'readonly': [('is_done', '=', True)]}" context="{'default_workorder_id': workorder_id}">
                        <tree editable="bottom" decoration-success="quantity==quantity_done" decoration-danger="(quantity &gt; 0) and (quantity_done&gt;quantity)">
                            <field name="lot_id" domain="[('product_id', '=', parent.product_id)]"/>
                            <field name="quantity" invisible="not context.get('show_reserved') or context.get('serial') or context.get('state_done')" readonly="1"/>
                            <field name="quantity_done" invisible="context.get('serial')"/>
                            <button name="do_minus" type="object" icon="fa-minus-square" attrs="{'invisible': [('quantity_done', '&lt;=', 0.99)]}" invisible="not context.get('show_reserved') or context.get('state_done')"/>
                            <button name="do_plus" type="object" icon="fa-plus-square" attrs="{'invisible': [('plus_visible', '=', False)]}" invisible="not context.get('show_reserved') or context.get('state_done')"/>
                            <field name="plus_visible" invisible="1"/>
                            <field name="workorder_id" invisible="1"/>
                        </tree>
                    </field>
                    <footer class="oe_edit_only">
                        <button name="dummy" type="object" string="Save" class="oe_highlight"/>
                        <button string="Discard" special="cancel"/>
                    </footer>
                </form>
            </field>
        </record>

        <!-- Production Order -->
        <record id="mrp_production_form_view" model="ir.ui.view">
            <field name="name">mrp.production.form</field>
            <field name="model">mrp.production</field>
            <field name="arch" type="xml">
                <form string="Manufacturing Orders">
                <header>
                    <button name="button_mark_done" attrs="{'invisible': [('check_to_done', '=', False)]}" string="Mark as Done" type="object" class="oe_highlight"/>
                    <button name="action_assign" attrs="{'invisible': [('availability', '=', 'assigned')]}" string="Check availability" type="object" class="oe_highlight"/>
                    <button name="button_plan" attrs="{'invisible': ['|', ('state', '!=', 'confirmed'), ('routing_id', '=', False)]}" type="object" string="Create Workorders" class="oe_highlight"/>
                    <button name="%(act_mrp_product_produce)d" attrs="{'invisible': ['|', ('state', 'not in', ('confirmed','progress')), ('routing_id', '!=', False)]}" string="Produce" type="action" class="oe_highlight"/>
                    <button name="%(act_mrp_product_produce)d" attrs="{'invisible': ['|', '|', ('nb_orders', '=', 0), ('state', '=', 'done'), ('routing_id', '!=', False)]}" string="Produce" type="action"/>
                    <button name="post_inventory" string="Post Inventory" type="object" class="oe_highlight" attrs="{'invisible': [('post_visible', '=', False)]}"/>
                    <button name="action_cancel" type="object" string="Cancel" attrs="{'invisible': ['|', ('state', 'in', ('done','cancel')), ('check_to_done', '=', True)]}"/>
                    <button name="button_scrap" type="object" string="Scrap" attrs="{'invisible': [('state', 'in', ('cancel'))]}"/>
                    <button name="button_unreserve" type="object" string="Unreserve" attrs="{'invisible': ['|', ('state', 'in', ['done', 'cancel']), ('availability', 'in', ['none', 'waiting'])]}"/>
                    <span class="label label-danger" attrs="{'invisible': ['|', ('availability', 'in', ('assigned', 'none')), ('state', 'not in', ('confirmed','progress'))]}">Raw materials not available!</span>
                    <field name="state" widget="statusbar" statusbar_visible="confirmed,progress,done" statusbar_colors='{"confirmed":"blue"}'/>
                </header>
                <sheet>
                    <field name="post_visible" invisible="1"/>
                    <field name="has_scrap_move" invisible="1"/>
                    <div class="oe_button_box" name="button_box">
                        <button name="%(action_mrp_workorder_production_specific)d" type="action" attrs="{'invisible': [('nb_orders', '=', 0)]}" class="oe_stat_button" icon="fa-play-circle-o">
                            <div class="o_form_field o_stat_info">
                                <span class="o_stat_value"><field name="nb_done" widget="statinfo" nolabel="1"/> / <field name="nb_orders" widget="statinfo" nolabel="1"/></span>
                                <span class="o_stat_text">Work Orders</span>
                            </div>
                        </button>
                        <button name="%(action_mrp_production_moves)d" type="action" string="Inventory Moves" class="oe_stat_button" icon="fa-arrows-v" attrs="{'invisible': [('state', 'not in', ('progress', 'done'))]}"/>
                        <button class="oe_stat_button" name="button_scrapped_moves" string="Scrapped Moves" type="object" icon="fa-arrows-v" attrs="{'invisible': [('has_scrap_move', '=', False)]}"/>
                        <field name="workorder_ids" invisible="1"/>
                    </div>
                    <div class="oe_title">
                        <h1><field name="name" placeholder="Manufacturing Reference" nolabel="1"/></h1>
                    </div>
                    <group>
                        <group>
                            <field name="has_moves" invisible="1"/>
                            <field name="check_to_done" invisible="1"/>
                            <field name="product_id" attrs="{'readonly': [('has_moves', '=', True)]}" domain="[('bom_ids', '!=', [])]"/>
                            <field name="product_tmpl_id" invisible="1"/>
                            <label for="product_qty"/>
                            <div class="o_row">
                                <field name="product_qty" attrs="{'readonly': [('has_moves', '=', True)]}"/>
                                <field name="product_uom_id" options="{'no_open':True,'no_create':True}" groups="product.group_uom" attrs="{'readonly': [('has_moves', '=', True)]}"/>
                                <button type="action"
                                    name="%(mrp.action_change_production_qty)d"
                                    string="Update" states="confirmed,planned,progress" class="oe_link" attrs="{'invisible': [('state','=','done')]}"/>
                            </div>
                            <field name="bom_id"
                                domain="['|',
                                            ('product_id','=',product_id),
                                            '&amp;',
                                                ('product_tmpl_id.product_variant_ids','=',product_id),
                                                ('product_id','=',False),
                                                ('bom_type', '=', 'normal')]"
                                context="{'default_product_tmpl_id': product_tmpl_id}" required="1" attrs="{'readonly': [('has_moves', '=', True)]}"/>
                            <field name="routing_id" groups="mrp.group_mrp_routings"/>
                        </group>
                        <group>
                            <field name="date_planned" attrs="{'readonly': [('has_moves', '=', True)]}"/>
                            <field name="user_id" attrs="{'readonly': [('has_moves', '=', True)]}"/>
                            <field name="origin" attrs="{'readonly': [('has_moves', '=', True)]}"/>
                            <field name="company_id" groups="base.group_multi_company" options="{'no_create': True}" attrs="{'readonly': [('has_moves', '=', True)]}"/>
                            <field name="move_prod_id" groups="base.group_no_one" attrs="{'readonly': [('has_moves', '=', True)]}"/>
                        </group>
                    </group>
                    <notebook>
                        <page string="Consumed Materials">
                            <field name="move_raw_ids" options="{'reload_on_button': True}" context="{'default_location_id': location_src_id, 'default_location_dest_id': location_dest_id}">
                                <tree editable="bottom" delete="0" default_order="is_done desc,sequence" decoration-muted="is_done" decoration-danger="quantity_done&gt;product_uom_qty" decoration-success="quantity_done==product_uom_qty" >
                                    <field name="product_id" on_change="onchange_product_id(product_id, location_id, location_dest_id)" required="1"/>
                                    <field name="product_uom" groups="product.group_uom"/>
                                    <field name="has_tracking" invisible="1"/>
                                    <field name="is_done" invisible="1"/>
                                    <field name="sequence" invisible="1"/>
                                    <field name="location_id" domain="[('id', 'child_of', parent.location_id)]" invisible="1"/>
                                    <field name="location_dest_id" domain="[('id', 'child_of', parent.location_dest_id)]" invisible="1"/>
                                    <field name="state" invisible="1"/>
                                    <field name="quantity_available" attrs="{'invisible': [('is_done', '=', True)]}"/>
                                    <field name="product_uom_qty" readonly="1" attrs="{'required': [('product_id', '!=', False)]}" string="To Consume"/>
                                    <field name="quantity_done" attrs="{'readonly': ['|', ('is_done', '=', True), ('has_tracking', 'in', ['lot','serial'])]}" string="Consumed"/>
                                    <button name="split_move_lot" string="Register lots" type="object" icon="fa-list"
                                        attrs="{'invisible': [('has_tracking', 'not in', ['lot','serial'])]}"/>
                                </tree>
                            </field>
                        </page>
                        <page string="Finished Products">
                            <field name="move_finished_ids" options="{'reload_on_button': True}" context="{'default_location_id': location_src_id, 'default_location_dest_id': location_dest_id}">
                                <tree editable="bottom" delete="0" default_order="is_done desc,sequence" decoration-muted="is_done" decoration-danger="quantity_done&gt;product_uom_qty" decoration-success="quantity_done==product_uom_qty">
                                    <field name="product_id" on_change="onchange_product_id(product_id, location_id, location_dest_id)" required="1"/>
                                    <field name="product_uom" groups="product.group_uom"/>
                                    <field name="is_done" invisible="1"/>
                                    <field name="sequence" invisible="1"/>
                                    <field name="has_tracking" invisible="1"/>
                                    <field name="location_id" domain="[('id', 'child_of', parent.location_id)]" invisible="1"/>
                                    <field name="location_dest_id" domain="[('id', 'child_of', parent.location_dest_id)]" invisible="1"/>
                                    <field name="state" invisible="1"/>
                                    <field name="product_uom_qty" readonly="1" attrs="{'required': [('product_id', '!=', False)]}" string="To Produce"/>
                                    <field name="quantity_done" attrs="{'readonly': ['|', ('is_done', '=', True), ('has_tracking', 'in', ['lot','serial'])]}" string="Produced"/>

                                    <button name="split_move_lot" string="Register lots" type="object" icon="fa-list"
                                        attrs="{'invisible': [('has_tracking', 'not in', ['lot','serial'])]}"/>
                                </tree>
                            </field>
                        </page>
                        <page string="Miscellaneous">
                            <group>
                                <group groups="stock.group_stock_multi_locations">
                                    <field name="picking_type_id" attrs="{'readonly': [('has_moves', '=', True)]}"/>
                                    <field name="location_src_id" domain="[('usage','=','internal')]" attrs="{'readonly': [('has_moves', '=', True)]}"/>
                                    <field name="location_dest_id" domain="[('usage','=','internal')]" attrs="{'readonly': [('has_moves', '=', True)]}"/>
                                </group>
                                <group>
                                    <field name="availability"/>
                                </group>
                            </group>
                        </page>
                    </notebook>
                </sheet>
                <div class="oe_chatter">
                    <field name="message_follower_ids" widget="mail_followers"/>
                    <field name="message_ids" widget="mail_thread"/>
                </div>
                </form>
            </field>
        </record>

        <record id="mrp_production_kanban_view" model="ir.ui.view">
            <field name="name">mrp.production.kanban</field>
            <field name="model">mrp.production</field>
            <field name="arch" type="xml">
                <kanban class="o_kanban_mobile">
                    <field name="name"/>
                    <field name="product_id"/>
                    <field name="product_qty"/>
                     <field name="product_uom_id" options="{'no_open':True,'no_create':True}"/>
                    <field name="date_planned"/>
                    <field name="state"/>
                    <templates>
                        <t t-name="kanban-box">
                            <div t-attf-class="oe_kanban_card oe_kanban_global_click">
                                <div class="row">
                                    <div class="col-xs-6">
                                        <strong><span><t t-esc="record.product_id.value"/></span></strong>
                                    </div>
                                    <div class="col-xs-6">
                                        <strong><span class="pull-right text-right"><t t-esc="record.product_qty.value"/> <t t-esc="record.product_uom_id.value"/></span></strong>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-xs-6 text-muted">
                                        <span><t t-esc="record.name.value"/> <t t-esc="record.date_planned.value and record.date_planned.value.split(' ')[0] or False"/></span>
                                    </div>
                                    <div class="col-xs-6">
                                        <span t-attf-class="pull-right text-right label #{['draft', 'cancel'].indexOf(record.state.raw_value) > -1 ? 'label-default' : ['none'].indexOf(record.state.raw_value) > -1 ? 'label-danger' : ['confirmed'].indexOf(record.state.raw_value) > -1 ? 'label-warning' : ['done'].indexOf(record.state.raw_value) > -1 ? 'label-success' : 'label-primary'}"><t t-esc="record.state.value"/></span>
                                    </div>
                                </div>
                            </div>
                        </t>
                    </templates>
                </kanban>
            </field>
        </record>
        <record id="view_production_calendar" model="ir.ui.view">
            <field name="name">mrp.production.calendar</field>
            <field name="model">mrp.production</field>
            <field eval="2" name="priority"/>
            <field name="arch" type="xml">
                <calendar color="routing_id" date_start="date_planned" string="Manufacturing Orders">
                    <field name="name"/>
                    <field name="product_id"/>
                    <field name="product_qty"/>
                </calendar>
            </field>
        </record>
        <record id="view_production_gantt" model="ir.ui.view">
            <field name="name">mrp.production.gantt</field>
            <field name="model">mrp.production</field>
            <field name="arch" type="xml">
                <gantt date_stop="date_finished" date_start="date_start" progress="progress" string="Productions" default_group_by="routing_id">
                </gantt>
            </field>
        </record>
        <record id="view_production_pivot" model="ir.ui.view">
            <field name="name">mrp.production.pivot</field>
            <field name="model">mrp.production</field>
            <field name="arch" type="xml">
                <pivot string="Manufacturing Orders">
                    <field name="date_planned" type="row"/>
                </pivot>
            </field>
        </record>
        <record id="view_production_graph" model="ir.ui.view">
            <field name="name">mrp.production.graph</field>
            <field name="model">mrp.production</field>
            <field name="arch" type="xml">
                <graph string="Manufacturing Orders">
                    <field name="date_planned"/>
                </graph>
            </field>
        </record>
        <record id="view_mrp_production_filter" model="ir.ui.view">
            <field name="name">mrp.production.select</field>
            <field name="model">mrp.production</field>
            <field name="arch" type="xml">
                <search string="Search Production">
                    <field name="name" string="Production" filter_domain="['|',('name','ilike',self),('origin','ilike',self)]"/>
                    <filter string="To Do" name="todo" domain="[('state','in',('confirmed', 'planned','progress'))]"
                        help="Manufacturing Orders which are in confirmed state."/>
                    <separator/>
                    <filter string="Confirmed" name="confirmed" domain="[('state','=','confirmed')]"/>
                    <filter string="Planned" name="planned" domain="[('state','=','planned')]"/>
                    <filter string="In Progress" name="inprogress" domain="[('state','=','progress')]"
                        help="Manufacturing Orders which are currently in production."/>
                    <separator/>
                    <filter string="Late" domain="['&amp;', ('date_planned','&lt;', current_date), ('state', 'in', ('draft', 'confirmed', 'ready'))]"
                        name="late" help="Production started late"/>
                    <separator/>
                    <filter string="No Routing" domain="[('routing_id','=', False)]" name="norouting" groups="mrp.group_mrp_routings"/>
                    <field name="product_id"/>
                    <field name="product_id" string="Raw Material" filter_domain="[('move_raw_ids.product_id','ilike',self)]"/>
                    <field name="name" string="Work Center" filter_domain="[('routing_id.workorder_ids.workcenter_id','ilike',self)]"/>
                    <field name="routing_id" groups="mrp.group_mrp_routings"/>
                    <group expand="0" string="Group By...">
                        <filter string="Product" domain="[]" context="{'group_by':'product_id'}"/>
                        <filter string="Routing" domain="[]" context="{'group_by':'routing_id'}"/>
                        <filter string="Status" domain="[]" context="{'group_by':'state'}"/>
                        <filter string="Scheduled Month" domain="[]" context="{'group_by':'date_planned'}" help="Scheduled Date by Month"/>
                    </group>
               </search>
            </field>
        </record>
        <record id="mrp_production_action" model="ir.actions.act_window">
            <field name="name">Manufacturing Orders</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">mrp.production</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,kanban,form,calendar,pivot,graph,gantt</field>
            <field name="view_id" eval="False"/>
            <field name="search_view_id" ref="view_mrp_production_filter"/>
            <field name="context">{'search_default_todo': True}</field>
            <field name="help" type="html">
              <p class="oe_view_nocontent_create">
                Click to create a manufacturing order.
              </p><p>
                A manufacturing order, based on a bill of materials, will
                consume raw materials and produce finished products.
              </p><p>
                Manufacturing orders are usually proposed automatically based
                on customer requirements or automated rules like the minimum
                stock rule.
              </p>
            </field>
        </record>

        <record id="mrp_production_action_picking_deshboard" model="ir.actions.act_window">
            <field name="name">Manufacturing Orders</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">mrp.production</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form</field>
            <field name="view_id" eval="False"/>
            <field name="search_view_id" ref="view_mrp_production_filter"/>
            <field name="context">{}</field>
        </record>


        <menuitem action="mrp_production_action"
            id="menu_mrp_production_action"
            parent="menu_mrp_manufacturing"
            sequence="1"/>


    <!-- Where to put production order planning??? -->

        <record id="mrp_production_action_planning" model="ir.actions.act_window">
            <field name="name">Manufacturing Orders</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">mrp.production</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form,calendar,pivot,graph</field>
            <field name="domain">[('state','in',('ready','confirmed','in_production')), ('routing_id', '!=', False)]</field>
            <field name="help" type="html">
              <p class="oe_view_nocontent_create">
                Click to start a new manufacturing order.
              </p><p>
                A manufacturing order, based on a bill of materials, will
                consume raw materials and produce finished products.
              </p><p>
                Manufacturing orders are usually proposed automatically based
                on customer requirements or automated rules like the minimum
                stock rule.
              </p>
            </field>
        </record>

        <!-- Procurements -->
        <record id="view_procurement_rule_form_stock_inherit_mrp" model="ir.ui.view">
            <field name="name">procurement.rule.form.stock.inherit.mrp</field>
            <field name="model">procurement.rule</field>
            <field name="inherit_id" ref="stock.view_procurement_rule_form_stock_inherit"/>
            <field name="arch" type="xml">
                <field name="location_src_id" position="attributes">
                    <attribute name="attrs">{'required': [('action', '=', 'move')], 'invisible': [('action', 'not in', ['move', 'manufacture'])]}</attribute>
                </field>
            </field>
        </record>

        <record id="view_procurement_form_inherit" model="ir.ui.view">
            <field name="name">procurement.order.form.inherit</field>
            <field name="model">procurement.order</field>
            <field name="inherit_id" ref="procurement.procurement_form_view"/>
            <field name="arch" type="xml">
            <data>
                <field name="origin" position="before">
                    <field name="bom_id" domain="[('product_id','=',product_id)]"/>
                    <field name="production_id" attrs="{'invisible': [('production_id','=',False)]}"/>
                </field>
               </data>
            </field>
        </record>

        <!-- Product Template -->
        <record id="view_mrp_product_template_form_inherited" model="ir.ui.view">
            <field name="name">product.form.mrp.inherited</field>
            <field name="model">product.template</field>
            <field name="inherit_id" ref="stock.view_template_property_form"/>
            <field name="arch" type="xml">
                <group name="sale_condition" position="inside">
                    <label for="produce_delay" attrs="{'invisible':[('type','=','service')]}"/>
                    <div attrs="{'invisible':[('type','=','service')]}">
                        <field name="produce_delay" class="oe_inline"/> days
                    </div>
                </group>
            </field>
        </record>
        <record id="product_template_search_view_procurment" model="ir.ui.view">
             <field name="name">product.template.search.bom</field>
             <field name="model">product.template</field>
             <field name="inherit_id" ref="product.product_template_search_view"/>
             <field name="arch" type="xml">
                 <xpath expr="//filter[@name='consumable']" position="after">
                     <separator/>
                    <filter string="Components" name="components" domain="[('bom_ids','not in',[])]"/>
                 </xpath>
             </field>
        </record>
        <record id="product_template_action" model="ir.actions.act_window">
            <field name="name">Products</field>
            <field name="res_model">product.template</field>
            <field name="view_type">form</field>
            <field name="view_mode">kanban,tree,form</field>
            <field name="context">{}</field>
        </record>
        <menuitem id="menu_mrp_product_form"
            name="Products"
            action="product_template_action"
            parent="menu_mrp_bom"/>

        <record id="template_open_bom" model="ir.actions.act_window">
            <field name="context">{'default_product_tmpl_id': active_id, 'search_default_product_tmpl_id': active_id}</field>
            <field name="name">Bill of Materials</field>
            <field name="res_model">mrp.bom</field>
            <field name="view_type">form</field>
        </record>
        <record id="product_template_form_view_bom_button" model="ir.ui.view">
            <field name="name">product.template.procurement</field>
            <field name="model">product.template</field>
            <field name="inherit_id" ref="product.product_template_only_form_view"/>
            <field name="groups_id" eval="[(4, ref('mrp.group_mrp_user'))]"/>
            <field name="arch" type="xml">
                <div name="button_box" position="inside">
                    <button class="oe_stat_button" name="%(template_open_bom)d" type="action"
                        attrs="{'invisible':[('type', 'not in', ['product', 'consu'])]}" icon="fa-flask">
                        <field string="Bill of Materials" name="bom_count" widget="statinfo" />
                    </button>
                    <button class="oe_stat_button" name="action_view_mos" type="object"
                        attrs="{'invisible':[('type', 'not in', ['product', 'consu'])]}" icon="fa-list-alt">
                        <field string="Manufacturing" name="mo_count" widget="statinfo" />
                    </button>
                </div>
            </field>
        </record>

        <!-- Product Product -->
        <record id="product_open_bom" model="ir.actions.act_window">
            <field name="context">{'default_product_id': active_id, 'search_default_product_id': active_id}</field>
            <field name="name">Bill of Materials</field>
            <field name="res_model">mrp.bom</field>
            <field name="domain">[]</field> <!-- Force empty -->
            <field name="view_type">form</field>
        </record>
        <record id="act_product_mrp_production" model="ir.actions.act_window">
            <field name="context">{'search_default_product_id': [active_id]}</field>
            <field name="name">Manufacturing Orders</field>
            <field name="res_model">mrp.production</field>
            <field name="view_id" ref="mrp_production_tree_view"/>
        </record>

        <record id="product_product_form_view_bom_button" model="ir.ui.view">
            <field name="name">product.product.procurement</field>
            <field name="model">product.product</field>
            <field name="inherit_id" ref="product.product_normal_form_view"/>
            <field name="groups_id" eval="[(4, ref('mrp.group_mrp_user'))]"/>
            <field name="arch" type="xml">
                <div name="button_box" position="inside">
                    <button class="oe_stat_button" name="action_view_bom" type="object"
                        attrs="{'invisible':[('type', 'not in', ['product', 'consu'])]}" icon="fa-flask">
                        <field string="Bill of Materials" name="bom_count" widget="statinfo" />
                    </button>
                    <button class="oe_stat_button" name="%(act_product_mrp_production)d" type="action"
                        attrs="{'invisible':[('type', 'not in', ['product', 'consu'])]}" icon="fa-list-alt">
                        <field string="Manufacturing" name="mo_count" widget="statinfo" />
                    </button>
                </div>
            </field>
        </record>

        <!-- Warehouse -->
        <record id="view_warehouse_inherited" model="ir.ui.view">
            <field name="name">Stock Warehouse Inherited</field>
            <field name="model">stock.warehouse</field>
            <field name="inherit_id" ref="stock.view_warehouse"/>
            <field name="arch" type="xml">
                 <xpath expr="//field[@name='default_resupply_wh_id']" position="before">
                    <field name="manufacture_to_resupply" />
                </xpath>
                <xpath expr="//field[@name='out_type_id']" position="after">
                    <field name="manu_type_id" readonly="True"/>
                </xpath>
            </field>
        </record>


        <!-- Coming from mrp_operations -->

    <record model="ir.ui.view" id="mrp_production_workcenter_tree_view_inherit">
        <field name="name">mrp.production.work.order.tree</field>
        <field name="model">mrp.production.work.order</field>
        <field name="arch" type="xml">
            <tree string="Work Orders" delete="0" create="0" decoration-success="date_planned_start&gt;=current_date and state == 'ready'" decoration-muted="state in ('done','cancel')" decoration-danger="date_planned_start&lt;current_date and state in ('ready')">
                <field name="name"/>
                <field name="date_planned_start"/>
                <field name="workcenter_id" widget="selection"/>
                <field name="production_id"/>
                <field name="product"/>
                <field name="qty"/>
                <field name="uom"/>
                <field name="state"/>
            </tree>
        </field>
    </record>

    <record model="ir.ui.view" id="mrp_production_workcenter_form_view_inherit">
        <field name="name">mrp.production.work.order.form</field>
        <field name="model">mrp.production.work.order</field>
        <field name="arch" type="xml">
            <form string="Production Workcenter" delete="0" create="0">
            <header>
                <button name="button_finish" type="object" string="Finish Order" attrs="{'invisible': ['|', ('state', '!=', 'progress'), ('is_produced', '=', False)]}" class="btn-info"/>
                <button name="button_start" type="object" string="Start Working" attrs="{'invisible': ['|', ('working_state', '=', 'blocked'), ('state', '!=', 'pending')]}"/>
                <button name="button_start" type="object" string="Start Working" attrs="{'invisible': ['|', ('working_state', '=', 'blocked'), ('state', '!=', 'ready')]}" class="btn-success"/>
                <button name="record_production" type="object" string="Record Production" class="btn-success" attrs="{'invisible': ['|', ('state', '!=', 'progress'), ('show_state', '=', False)]}"/>
                <button name="button_pending" type="object" string="Pause" class="btn-warning" attrs="{'invisible': ['|', ('state', 'in', ('done', 'pending', 'ready', 'cancel')), ('show_state', '=', False)]}"/>
                <button name="%(act_mrp_block_workcenter)d" type="action" string="Block" class="btn-danger" attrs="{'invisible': ['|', ('state', 'in', ('done', 'pending', 'ready', 'cancel')), ('show_state', '=', False)]}"/>
                <button name="button_unblock" type="object" string="Unblock" class="btn-danger" attrs="{'invisible': [('working_state', '!=', 'blocked')]}"/>
                <button name="button_start" type="object" string="Continue Production" class="btn-warning" attrs="{'invisible': ['|', '|', ('working_state', '=', 'blocked'), ('show_state', '=', True), ('state', 'in', ('done', 'pending', 'ready', 'cancel'))]}"></button>
                <button name="button_start" type="object" string="Continue Production" attrs="{'invisible': ['|', '|', ('production_state', '=', 'done'), ('working_state', '=', 'blocked'), ('state', '!=', 'done')]}"/>
                <button name="button_scrap" type="object" string="Scrap" attrs="{'invisible': [('state', 'in', ('confirmed', 'cancel'))]}"/>
                <field name="state" widget="statusbar" statusbar_visible="pending,ready,progress,done"/>
                <field name="show_state" invisible="1"/>
                <field name="working_state" invisible="1"/>
                <field name="production_state" invisible="1"/>
            </header>
            <sheet>
                <div class="oe_button_box" name="button_box"/>
                <group>
                    <group>
                        <field name="product" string="To Produce"/>
                        <label for="qty_produced" string="Quantity Produced"/>
                        <div class="o_row">
                            <field name="qty_produced"/> /
                            <field name="qty"/>
                            <field name="uom" widget="selection"/>
                            <field name="availability" nolabel="1" widget="bullet_state" options="{'classes': {'assigned': 'success', 'waiting': 'danger'}}" attrs="{'invisible': [('state', '=', 'done')]}"/>
                        </div>
                        <field name="is_produced" invisible="1"/>
                    </group>
                    <div class="alert alert-danger alert-dismissible text-left" role="alert" attrs="{'invisible': [('inv_message', '=', False)]}">
                        <a href="#" class="close" data-dismiss="alert" aria-label="close">x</a>
                        <field name="inv_message" style="height: 50px;"/>
                    </div>
                </group>
                <notebook>
                <page string="Work Instruction" attrs="{'invisible': [('worksheet', '=', False)]}">
                    <field name="worksheet" widget="image"/>
                </page>
                <page string="Current Production">
                    <group>
                        <group>
                            <field name="qty_producing" string="Current Qty" attrs="{'readonly': [('has_tracking', '=', 'serial')]}"/>
                            <field name="final_lot_id" context="{'default_product_id': product}" attrs="{'invisible': [('has_tracking', '=', 'none')]}" groups="stock.group_production_lot"/>
                            <field name="has_tracking" invisible="1"/>
                        </group>
                    </group>
                    <field name="move_raw_ids" invisible="1"/>
                    <field name="active_move_lot_ids" attrs="{'invisible': [('active_move_lot_ids', '=', [])]}">
                        <tree editable="bottom" create="0" delete="0">
                            <field name="product_id"/>
                            <field name="quantity" readonly="1"/>
                            <field name="lot_id" context="{'default_product_id': product_id}"/>
                            <field name="quantity_done"/>
                            <field name="done_wo" invisible="1"/>
                        </tree>
                    </field>
                </page>
                <page string="Time Tracking" groups="mrp.group_mrp_manager">
                    <group>
                        <group>
                            <label for="date_planned_start" string="Planned Date"/>
                            <div class="o_row">
                                from <field name="date_planned_start"/>
                                <div attrs="{'invisible': [('date_planned_end', '=', False)]}">
                                    to
                                    <field name="date_planned_end"/>
                                </div>
                            </div>
                            <label for="date_start" string="Effective Date"/>
                            <div class="o_row">
                                <field name="date_start" readonly="1"/>
                                <div  attrs="{'invisible': [('date_finished', '=', False)]}">
                                    to
                                    <field name="date_finished" readonly="1"/>
                                </div>
                            </div>
                        </group>
                        <group>
                            <label for="duration"/>
                            <div>
                                <field name="duration" widget="float_time" class="oe_inline"/>
                                minutes
                            </div>
                            <label for="delay"/>
                            <div>
                                <button style="pointer-events: none;" class="oe_inline label label-default">
                                    <field name="delay" widget="mrp_time_counter"/>
                                </button>
                            </div>
                        </group>
                    </group>
                    <field name="show_state" invisible="1"/>
                    <group>
                        <field name="time_ids" readonly="1" nolabel="1">
                            <tree>
                                <field name="date_start"/>
                                <field name="date_end"/>
                                <field name="duration" widget="float_time"/>
                                <field name="user_id"/>
                                <field name="loss_id" string="Efficiency"/>
                            </tree>
                            <form>
                                <group>
                                    <group>
                                        <field name="date_start"/>
                                        <field name="date_end"/>
                                        <field name="duration" widget="float_time"/>
                                    </group>
                                    <group>
                                        <field name="user_id"/>
                                        <field name="loss_id"/>
                                    </group>
                                </group>
                            </form>
                        </field>
                    </group>
                </page>
                <page string="Miscellaneous" groups="mrp.group_mrp_manager">
                    <group>
                        <group>
                            <field name="name"/>
                            <field name="workcenter_id" readonly="1"/>
                            <field name="production_id" readonly="1"/>
                        </group>
                    </group>
                </page>
                </notebook>
            </sheet>
            <div class="oe_chatter" groups="mrp.group_mrp_manager">
                <field name="message_follower_ids" widget="mail_followers"/>
                <field name="message_ids" widget="mail_thread"/>
            </div>
            </form>
        </field>
    </record>

    <record id="view_mrp_production_workcenter_form_view_filter" model="ir.ui.view">
        <field name="name">mrp.production.work.order.select</field>
        <field name="model">mrp.production.work.order</field>
        <field name="arch" type="xml">
            <search string="Search Work Orders">
                <field name="name" string="Work Orders"/>
                <field name="date_planned_start"/>
                <field name="state"/>
                <filter string="In Progress" name="progress" domain="[('state','=','progress')]"/>
                <filter string="Ready" name="ready" domain="[('state','=','ready')]"/>
                <filter string="Pending" name="pending" domain="[('state','=','pending')]"/>
                <filter string="Finished" name="finish" domain="[('state','=','done')]"/>
                <filter string="Available" domain="[('availability','=', 'assigned')]"/>
                <separator/>
                <filter string="Late" domain="['&amp;', ('date_planned_start','&lt;', current_date), ('state', '=', 'ready')]"
                    help="Production started late"/>
                <field name="workcenter_id"/>
                <field name="production_id"/>
                <group expand="0" string="Group By">
                    <filter string="Work Center" domain="[]" context="{'group_by':'workcenter_id'}"/>
                    <filter string="Production" domain="[]" context="{'group_by':'production_id'}"/>
                    <filter string="Status" domain="[]" context="{'group_by':'state'}"/>
                    <filter string="Scheduled Month" domain="[]" context="{'group_by':'date_planned_start'}" help="Scheduled Date by Month"/>
                </group>
             </search>
        </field>
    </record>

    <record id="workcenter_line_calendar" model="ir.ui.view">
        <field name="name">mrp.production.work.order.calendar</field>
        <field name="model">mrp.production.work.order</field>
        <field name="arch" type="xml">
            <calendar color="workcenter_id" date_stop="date_planned_end" date_start="date_planned_start" string="Operations">
                <field name="workcenter_id"/>
                <field name="production_id"/>
            </calendar>
        </field>
    </record>

    <record id="workcenter_line_graph" model="ir.ui.view">
        <field name="name">mrp.production.work.order.graph</field>
        <field name="model">mrp.production.work.order</field>
        <field name="arch" type="xml">
            <graph string="Operations">
                <field name="production_id"/>
                <field name="delay_percent" type="measure"/>
            </graph>
        </field>
    </record>

    <record id="workcenter_line_pivot" model="ir.ui.view">
        <field name="name">mrp.production.work.order.pivot</field>
        <field name="model">mrp.production.work.order</field>
        <field name="arch" type="xml">
            <pivot string="Operations">
                <field name="date_start"/>
                <field name="operation_id"/>
                <field name="delay" type="measure"/>
                <field name="duration" type="measure"/>
            </pivot>
        </field>
    </record>


    <record id="workcenter_line_gantt_production" model="ir.ui.view">
        <field name="name">mrp.production.work.order.gantt.production</field>
        <field name="model">mrp.production.work.order</field>
        <field name="arch" type="xml">
            <gantt date_stop="date_planned_end" date_start="date_planned_start" string="Operations" default_group_by="production_id">
            </gantt>
        </field>
    </record>

    <record id="workcenter_line_gantt_workcenter" model="ir.ui.view">
        <field name="name">mrp.production.work.order.gantt.workcenter</field>
        <field name="model">mrp.production.work.order</field>
        <field name="arch" type="xml">
            <gantt date_stop="date_planned_end" date_start="date_planned_start" string="Operations" default_group_by="workcenter_id">
            </gantt>
        </field>
    </record>

    <record model="ir.ui.view" id="workcenter_line_kanban">
        <field name="name">mrp.production.work.order.kanban</field>
        <field name="model">mrp.production.work.order</field>
        <field name="arch" type="xml">
            <kanban class="o_kanban_small_column" create="0">
                <field name="name"/>
                <field name="production_id"/>
                <field name="state"/>
                <field name="workcenter_id"/>
                <field name="product"/>
                <field name="qty"/>
                <field name="uom"/>
                <templates>
                    <t t-name="kanban-box">
                        <div t-attf-class="oe_kanban_card oe_kanban_global_click">
                            <div class="oe_kanban_content">
                                <div>
                                    <span><strong><t t-esc="record.product.value"/></strong></span>
                                </div>
                                <div class="row">
                                    <div class="col-xs-7 o_kanban_primary_left">
                                        <span><t t-esc="record.qty.value"/> <t t-esc="record.uom.value"/></span>
                                    </div>
                                    <div class="col-xs-5 o_kanban_primary_right">
                                        <span><t t-esc="record.production_id.value"/></span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </t>
                </templates>
            </kanban>
        </field>
    </record>



    <!-- Actions for Work Orders  -->


    <record model="ir.actions.act_window" id="action_mrp_workorder_workcenter">
        <field name="name">Work Orders</field>
        <field name="type">ir.actions.act_window</field>
        <field name="res_model">mrp.production.work.order</field>
        <field name="view_type">form</field>
        <field name="view_mode">gantt,tree,form,calendar,pivot,graph</field>
        <field name="search_view_id" ref="view_mrp_production_workcenter_form_view_filter"/>
        <field name="view_id" ref="workcenter_line_gantt_workcenter"/>
        <field name="help" type="html">
          <p class="oe_view_nocontent_create">
            Click to start a new work order.
          </p><p>
            Work Orders is the list of operations to be performed for each
            manufacturing order. Once you start the first work order of a
            manufacturing order, the manufacturing order is automatically
            marked as started. Once you finish the latest operation of a
            manufacturing order, the MO is automatically done and the related
            products are produced.
          </p>
        </field>
    </record>

    <record model="ir.actions.act_window" id="action_mrp_workorder_production">
        <field name="name">Work Orders Planning</field>
        <field name="type">ir.actions.act_window</field>
        <field name="res_model">mrp.production.work.order</field>
        <field name="view_type">form</field>
        <field name="domain">[('production_state','not in',('done','cancel'))]</field>
        <field name="view_mode">gantt,tree,form,calendar,pivot,graph</field>
        <field name="view_id" ref="workcenter_line_gantt_production"/>
        <field name="help" type="html">
          <p class="oe_view_nocontent_create">
            Click to start a new work order.
          </p><p>
            To manufacture or assemble products, and use raw materials and
            finished products you must also handle manufacturing operations.
            Manufacturing operations are often called Work Orders. The various
            operations will have different impacts on the costs of
            manufacturing and planning depending on the available workload.
          </p>
        </field>
    </record>

    <record model="ir.actions.act_window" id="mrp_workorder_todo">
        <field name="name">Work Orders</field>
        <field name="type">ir.actions.act_window</field>
        <field name="res_model">mrp.production.work.order</field>
        <field name="view_type">form</field>
        <field name="view_mode">kanban,tree,form,calendar,pivot,graph</field>
        <field name="search_view_id" ref="view_mrp_production_workcenter_form_view_filter"/>
        <field name="context">{'search_default_ready': True, 'search_default_progress': True}</field>
        <field name="help" type="html">
          <p class="oe_view_nocontent_create">
            Click to start a new work order.
          </p><p>
            Work Orders is the list of operations to be performed for each
            manufacturing order. Once you start the first work order of a
            manufacturing order, the manufacturing order is automatically
            marked as started. Once you finish the latest operation of a
            manufacturing order, the MO is automatically done and the related
            products are produced.
          </p>
        </field>
    </record>

    <record id="mrp_production_report" model="ir.actions.act_window">
        <field name="name">Manufacturing Orders</field>
        <field name="type">ir.actions.act_window</field>
        <field name="res_model">mrp.production</field>
        <field name="view_type">form</field>
        <field name="view_mode">pivot,graph,list,form</field>
    </record>

    <!-- OEE Losses -->

    <record id="oee_loss_form_view" model="ir.ui.view">
        <field name="name">mrp.workcenter.productivity.loss.form</field>
        <field name="model">mrp.workcenter.productivity.loss</field>
        <field name="arch" type="xml">
            <form string="Workcenter Productivity Loss">
                <group>
                    <group>
                        <field name="name"/>
                        <field name="loss_type"/>
                    </group><group>
                        <field name="manual"/>
                    </group>
                </group>
            </form>
        </field>
    </record>

    <record id="oee_loss_tree_view" model="ir.ui.view">
        <field name="name">mrp.workcenter.productivity.loss.tree</field>
        <field name="model">mrp.workcenter.productivity.loss</field>
        <field name="arch" type="xml">
            <tree string="Workcenter Productivity Loss">
                <field name="sequence" widget="handle"/>
                <field name="name"/>
                <field name="loss_type"/>
                <field name="manual"/>
            </tree>
        </field>
    </record>

    <record id="oee_loss_search_view" model="ir.ui.view">
        <field name="name">mrp.workcenter.productivity.loss.search</field>
        <field name="model">mrp.workcenter.productivity.loss</field>
        <field name="arch" type="xml">
            <search string="Operations">
                <field name="name"/>
            </search>
        </field>
    </record>


    <record model="ir.actions.act_window" id="mrp_workcenter_productivity_loss_action">
        <field name="name">Productivity Losses</field>
        <field name="type">ir.actions.act_window</field>
        <field name="res_model">mrp.workcenter.productivity.loss</field>
        <field name="view_type">form</field>
        <field name="view_mode">tree,form</field>
        <field name="domain">[]</field>
        <field name="help" type="html">
          <p>
            No productivity loss defined.
          </p>
        </field>
    </record>

    <menuitem id="menu_mrp_workcenter_productivity_loss"
            action="mrp_workcenter_productivity_loss_action"
            groups="group_mrp_routings"
            sequence="20"
            parent="menu_mrp_configuration"/>

    <!-- OEE -->

    <record id="oee_search_view" model="ir.ui.view">
        <field name="name">mrp.workcenter.productivity.search</field>
        <field name="model">mrp.workcenter.productivity</field>
        <field name="arch" type="xml">
            <search string="Operations">
                <field name="workcenter_id"/>
                <filter string="Today" name="today" domain="[('date_start','&gt;=',time.strftime('%%Y-%%m-%%d'))]"/>
                <filter string="This Month" name="thismonth" domain="[('date_start','&gt;=',time.strftime('%%Y-%%m-01'))]"/>
                <filter string="This Year" name="thisyear" domain="[('date_start','&gt;=',time.strftime('%%Y-01-01'))]"/>
                <separator/>
                <field name="workcenter_id"/>
                <field name="loss_id"/>
                <separator/>
                <filter name="availability" string="Availability Losses" domain="[('loss_type','=','availability')]"/>
                <filter name="performance" string="Performance Losses" domain="[('loss_type','=','performance')]"/>
                <filter name="quality" string="Quality Losses" domain="[('loss_type','=','quality')]"/>
                <filter name="productive" string="Fully Productive" domain="[('loss_type','=','productive')]"/>
                <separator/>
                <group expand='0' string='Group by...'>
                    <filter string="Date" name="loss_date" context="{'group_by': 'date_start'}"/>
                    <filter string="User" name="user" context="{'group_by': 'create_uid'}"/>
                    <filter string='Workcenter' name="workcenter_group" context="{'group_by': 'workcenter_id'}"/>
                    <filter string="Loss Reason" name="loss_group" context="{'group_by': 'loss_id'}"/>
                    <filter string="TPM Big Loss" name="loss_group_main" context="{'group_by': 'loss_type'}"/>
                </group>
            </search>
        </field>
    </record>

    <record id="oee_form_view" model="ir.ui.view">
        <field name="name">mrp.workcenter.productivity.form</field>
        <field name="model">mrp.workcenter.productivity</field>
        <field name="priority">5</field>
        <field name="arch" type="xml">
            <form string="Workcenter Productivity">
                <group>
                    <group>
                        <field name="workcenter_id"/>
                        <field name="loss_id"/>
                    </group><group>
                        <field name="date_start"/>
                        <field name="date_end"/>
                        <field name="duration"/>
                    </group>
                    <field name="description"/>
                </group>
            </form>
        </field>
    </record>

    <record id="oee_tree_view" model="ir.ui.view">
        <field name="name">mrp.workcenter.productivity.tree</field>
        <field name="model">mrp.workcenter.productivity</field>
        <field name="arch" type="xml">
            <tree string="Workcenter Productivity">
                <field name="date_start"/>
                <field name="date_end"/>
                <field name="workcenter_id"/>
                <field name="user_id"/>
                <field name="loss_id"/>
                <field name="duration" string="Duration (hours)" sum="Duration"/>
            </tree>
        </field>
    </record>

    <record id="oee_graph_view" model="ir.ui.view">
        <field name="name">mrp.workcenter.productivity.graph</field>
        <field name="model">mrp.workcenter.productivity</field>
        <field name="arch" type="xml">
            <graph string="Workcenter Productivity">
                <field name="workcenter_id"/>
                <field name="loss_id"/>
                <field name="duration" type="measure"/>
            </graph>
        </field>
    </record>

    <record id="oee_pivot_view" model="ir.ui.view">
        <field name="name">mrp.workcenter.productivity.pivot</field>
        <field name="model">mrp.workcenter.productivity</field>
        <field name="arch" type="xml">
            <pivot string="Workcenter Productivity">
                <field name="date_start" type="row" interval="day"/>
                <field name="loss_type" type="col"/>
                <field name="duration" type="measure"/>
            </pivot>
        </field>
    </record>

    <record model="ir.actions.act_window" id="mrp_workcenter_productivity_report">
        <field name="name">Overall Equipment Efficiency</field>
        <field name="type">ir.actions.act_window</field>
        <field name="res_model">mrp.workcenter.productivity</field>
        <field name="view_type">form</field>
        <field name="view_mode">graph,pivot,tree,form</field>
        <field name="domain">[]</field>
        <field name="context">{'search_default_thismonth':True}</field>
        <field name="help" type="html">
          <p>
            Overall Equipment Efficiency: no working or blocked time.
          </p>
        </field>
    </record>



    <menuitem id="menu_mrp_workorder_todo"
            name="Work Orders"
            action="mrp_workorder_todo"
            parent="menu_mrp_manufacturing"
            groups="group_mrp_routings"/>

    <menuitem id="menu_mrp_traceability"
          name="Traceability: Lots"
          parent="menu_mrp_reporting"
          action="stock.action_production_lot_form"
          groups="stock.group_production_lot"
          sequence="10"/>

    <menuitem id="menu_mrp_production_report"
          name="Manufacturing Orders"
          parent="menu_mrp_reporting"
          action="mrp_production_report"
          sequence="11"/>

    <menuitem id="menu_mrp_workcenter_productivity_report"
          parent="menu_mrp_reporting"
          action="mrp_workcenter_productivity_report"
          groups="group_mrp_routings"
          sequence="12"/>

    <menuitem id="menu_mrp_work_order_report"
          name="Work Orders"
          parent="menu_mrp_reporting"
          action="mrp_workorder_report"
          groups="group_mrp_routings"
          sequence="11"/>


    <!--  Unbuild and scrap menu -->

        <record id="mrp_unbuild_search_view" model="ir.ui.view">
            <field name="name">mrp.unbuild.search</field>
            <field name="model">mrp.unbuild</field>
            <field name="arch" type="xml">
                <search string="Search">
                    <field name="product_id"/>
                    <field name="state"/>
                    <field name="mo_id"/>
                    <group expand="0" string="Filters">
                        <filter name="draft" string="Draft" domain="[('state', '=', 'draft')]"/>
                        <filter name="done" string="Done" domain="[('state', '=', 'done')]"/>
                    </group>
                    <group expand='0' string='Group by...'>
                        <filter string='Product' name="productgroup" context="{'group_by': 'product_id'}"/>
                        <filter string="Manufacturing Order" name="mogroup" context="{'group_by': 'mo_id'}"/>
                    </group>
               </search>
            </field>
        </record>

        <record model="ir.actions.act_window" id="action_mrp_unbuild_moves">
            <field name="name">Stock Moves</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">stock.move</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form</field>
            <field name="domain">['|', ('unbuild_id', '=', active_id), ('raw_material_unbuild_id', '=', active_id)]</field>
        </record>

        <record id="mrp_unbuild_form_view" model="ir.ui.view">
            <field name="name">mrp.unbuild.form</field>
            <field name="model">mrp.unbuild</field>
            <field name="arch" type="xml">
                <form string="Unbuild Orders">
                    <header>
                        <button name="button_unbuild" string="Unbuild" type="object" states="draft" class="oe_highlight"/>
                        <field name="state" widget="statusbar" statusbar_visible="draft,done" statusbar_colors="{&quot;draft&quot;:&quot;blue&quot;}"/>
                    </header>
                    <sheet>
                        <div class="oe_button_box" name="button_box">
                            <button class="oe_stat_button" name="%(action_mrp_unbuild_moves)d"
                                    string="Moves" type="action" icon="fa-arrows-v" states="done"/>
                        </div>
                        <div class="oe_title">
                            <h1><field name="name" placeholder="Unbuild Order" nolabel="1"/></h1>
                        </div>
                        <group>
                            <group>
                                <field name="product_id" domain="[('bom_ids', '!=', False)]"/>
                                <field name="bom_id" domain="['|',
                                            ('product_id','=',product_id),
                                            '&amp;',
                                                ('product_tmpl_id.product_variant_ids','=',product_id),
                                                ('product_id','=',False),
                                                ('bom_type', '=', 'normal')]"/>
                                <label for="product_qty"/>
                                <div class="o_row">
                                    <field name="product_qty"/>
                                    <field name="product_uom_id" options="{'no_open':True,'no_create':True}" groups="product.group_uom"/>
                                </div>
                            </group>
                            <group>
                                <field name="mo_id"/>
                                <field name="location_id" groups="stock.group_stock_multi_locations"/>
                                <field name="location_dest_id" groups="stock.group_stock_multi_locations"/>
                                <field name="lot_id"/>
                            </group>
                        </group>
                    </sheet>
                    <div class="oe_chatter">
                        <field name="message_follower_ids" widget="mail_followers"/>
                        <field name="message_ids" widget="mail_thread"/>
                    </div>
                </form>
            </field>
        </record>

        <record id="mrp_unbuild_tree_view" model="ir.ui.view">
            <field name="name">mrp.unbuild.tree</field>
            <field name="model">mrp.unbuild</field>
            <field name="arch" type="xml">
                <tree>
                    <field name="name"/>
                    <field name="product_id"/>
                    <field name="bom_id"/>
                    <field name="lot_id"/>
                    <field name="product_qty"/>
                    <field name="product_uom_id"/>
                    <field name="state"/>
                    <field name="location_id" groups="stock.group_stock_multi_locations"/>
                </tree>
            </field>
        </record>

    <record model="ir.actions.act_window" id="mrp_unbuild">
        <field name="name">Unbuild Orders</field>
        <field name="type">ir.actions.act_window</field>
        <field name="res_model">mrp.unbuild</field>
        <field name="view_type">form</field>
        <field name="view_mode">tree,form</field>
        <field name="help" type="html">
          <p class="oe_view_nocontent_create">
            Click to start a new Unbuild Order
          </p><p>
            An unbuild order will do a reverse bill of materials, unbuilding products
            you produced, but you can also use it to unbuild products you purchased.
          </p>
        </field>
    </record>

    <menuitem id="menu_mrp_unbuild"
          name="Unbuild Orders"
          parent="menu_mrp_manufacturing"
          action="mrp_unbuild"
          sequence="20"/>
    <menuitem id="menu_mrp_scrap"
            name="Scrap"
            parent="menu_mrp_manufacturing"
            action="stock.action_stock_scrap"
            sequence="25"/>

    <record id="action_mrp_production_form" model="ir.actions.act_window">
        <field name="name">Manufacturing Orders</field>
        <field name="type">ir.actions.act_window</field>
        <field name="res_model">mrp.production</field>
        <field name="view_type">form</field>
        <field name="view_mode">form</field>
    </record>

    <record id="stock_production_type_kanban" model="ir.ui.view">
        <field name="name">stock.picking.type.kanban</field>
        <field name="model">stock.picking.type</field>
        <field name="inherit_id" ref="stock.stock_picking_type_kanban"/>
        <field name="arch" type="xml">
            <field name="code" position="after">
                <field name="count_mo_todo"/>
                <field name="count_mo_waiting"/>
                <field name="count_mo_late"/>
            </field>

            <xpath expr='//div[@name="stock_picking"]' position="after">
                <div t-if="record.code.raw_value == 'mrp_operation'">
                    <div t-attf-class="#{kanban_color(record.color.raw_value)}">
                        <div class="o_kanban_card_header">
                            <div class="o_kanban_card_header_title">
                                <div class="o_primary"><field name="name"/></div>
                                <div class="o_secondary"><field class="o_secondary"  name="warehouse_id"/></div>
                            </div>
                            <div class="o_kanban_manage_button_section">
                                <a class="o_kanban_manage_toggle_button" href="#">More <i class="fa fa-caret-down"/></a>
                            </div>
                        </div>
                        <div class="container o_kanban_card_content o_visible">
                            <div class="row">
                                <div class="col-xs-6 o_kanban_primary_left">
                                    <button class="btn btn-primary" name="%(mrp_production_action_picking_deshboard)d" type="action" context="{'search_default_todo': 1}">
                                        <span t-if="record.code.raw_value =='mrp_operation'"><t t-esc="record.count_mo_todo.value"/> To Do</span>
                                    </button>
                                </div>
                                <div class="col-xs-6 o_kanban_primary_right">
                                    <div t-if="record.count_mo_waiting.raw_value > 0" class="row">
                                        <div class="col-xs-9">
                                            <a name="%(mrp_production_action_picking_deshboard)d" type="action" context="{'search_default_waiting': 1}">
                                                Waiting
                                            </a>
                                        </div>
                                        <div class="col-xs-3">
                                            <field name="count_mo_waiting"/>
                                        </div>
                                    </div>
                                    <div t-if="record.count_mo_late.raw_value > 0" class="row">
                                        <div class="col-xs-9">
                                            <a class="oe_kanban_stock_picking_type_list" name="%(mrp_production_action_picking_deshboard)d" type="action" context="{'search_default_late': 1}">
                                                Late
                                            </a>
                                        </div>
                                        <div class="col-xs-3">
                                            <field name="count_mo_late"/>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div><div class="container o_kanban_card_manage_pane o_invisible">
                            <div class="row">
                                <div class="col-xs-6 o_kanban_card_manage_section o_kanban_manage_view" name="picking_left_manage_pane">
                                    <div class="o_kanban_card_manage_title">
                                        <span>View</span>
                                    </div>
                                    <div>
                                        <a name="%(mrp_production_action_picking_deshboard)d" type="action">All</a>
                                    </div>
                                    <div>
                                        <a name="%(mrp_production_action_picking_deshboard)d" type="action" context="{'search_default_inprogress': 1}">In Progress</a>
                                    </div>
                                    <div>
                                        <a name="%(mrp_production_action_picking_deshboard)d" type="action" context="{'search_default_planned': 1}">Planned</a>
                                    </div>
                                </div>
                                <div class="col-xs-6 o_kanban_card_manage_section o_kanban_manage_new">
                                    <div class="o_kanban_card_manage_title">
                                        <span>New</span>
                                    </div>
                                    <div>
                                        <a name="%(action_mrp_production_form)d" type="action">New Production Order</a>
                                    </div>
                                </div>
                            </div>

                            <div t-if="widget.editable" class="o_kanban_card_manage_settings row">
                                <div class="col-xs-8">
                                    <ul class="oe_kanban_colorpicker" data-field="color"/>
                                </div>
                                <div class="col-xs-4 text-right">
                                    <a type="edit">Settings</a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </xpath>
        </field>
    </record>

    <!-- Inventory Messages-->
    <record id="inventory_message_form_view" model="ir.ui.view">
            <field name="name">inventory.message.form</field>
            <field name="model">inventory.message</field>
            <field name="arch" type="xml">
                <form string="Inventory Message">
                    <sheet>
                        <group>
                            <group>
                                <field name="picking_type_id" widget="selection"/>
                                <field name="product_id" required="True"/>
                                <field name="valid_until"/>
                                <field name="code" invisible="True"/>
                            </group>
                            <group>
                                <field name="bom_id" attrs="{'invisible': [('code', '!=', 'mrp_operation')]}"/>
                                <field name="workcenter_id" attrs="{'invisible': [('code', '!=', 'mrp_operation')]}"/>
                            </group>
                        </group>
                        <field name="message" widget="html" editor_height="450px"/>
                    </sheet>
                </form>
            </field>
        </record>

        <record id="inventory_message_tree_view" model="ir.ui.view">
            <field name="name">inventory.message.tree</field>
            <field name="model">inventory.message</field>
            <field name="arch" type="xml">
                <tree>
                    <field name="valid_until" string="Validity Date"/>
                    <field name="create_uid" string="Author"/>
                    <field name="picking_type_id" string="Operation"/>
                    <field name="product_id"/>
                    <field name="name" string="Message"/>
                </tree>
            </field>
        </record>

        <record id="inventory_message_search_view" model="ir.ui.view">
            <field name="name">inventory.message.search</field>
            <field name="model">inventory.message</field>
            <field name="arch" type="xml">
                <search string="Search">
                    <field name="picking_type_id"/>
                    <filter string="Active Messages" name="active_message" domain="[('valid_until','&gt;=', current_date)]"/>
                    <filter string="My Messages" name="my_messages" domain="[('create_uid', '=', uid)]"/>
                    <group expand='0' string='Group by...'>
                        <filter string='Picking Type' name="picktype" context="{'group_by': 'picking_type_id'}"/>
                    </group>
               </search>
           </field>
        </record>

    <record model="ir.actions.act_window" id="action_inventory_message">
        <field name="name">Inventory Messages</field>
        <field name="type">ir.actions.act_window</field>
        <field name="res_model">inventory.message</field>
        <field name="view_type">form</field>
        <field name="view_mode">tree,form</field>
        <field name="context">{'search_default_active_message': True}</field>
        <field name="help" type="html">
            <p class="oe_view_nocontent_create">
                Click to create a new message.
            </p><p>
                Use messages to warn manufacturing or inventory people about any change in the
                products, process, or actions to take care of. (e.g; Warning, the bill of material changed,
                check the details in new worksheet)
            </p><p>
                Messages can be configurred to appear during any operation: receptions, delivery orders,
                manufacturing orders, work orders, etc.
            </p>
        </field>
    </record>

    <menuitem id="menu_inventory_messages"
          parent="menu_mrp_manufacturing"
          action="action_inventory_message"
          sequence="26"/>
</odoo>
