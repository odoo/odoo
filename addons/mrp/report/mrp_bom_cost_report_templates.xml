<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <template id="mrp_bom_cost_report">
        <t t-call="web.html_container">
            <div class="form-horizontal mt32" t-if="print_mode == 'html' and len(bom_products.keys()) > 1" >
                <div class="form-group">
                    <label for="product_select" class="col-sm-3 control-label col-md-offset-5">Select Product Variant:</label>
                    <div class="col-md-4 col-sm-9 pull-right">
                        <select class="form-control" id="product_select">
                            <t t-foreach="bom_products.keys()" t-as="variant">
                                <option t-att-value="variant.id"><t t-esc="variant.display_name"/></option>
                            </t>
                        </select>
                    </div>
                </div>
            </div>
            <t t-call="web.internal_layout">
                <t t-foreach="bom_products" t-as="product">
                    <t t-set="line" t-value="product_value"/>
                    <div t-attf-class="page variant_#{product.id}">
                        <t t-set="currency" t-value="line['currency']"/>
                        <h1>BoM Structure &amp; Cost</h1>
                        <span>
                            <t t-if="line['reference']">
                                Reference:
                                <t t-esc="line['reference']"/>
                            </t>
                        </span>
                        <h4 class="mb64">
                            <a class="reports_m2o_web_action pull-left" href="#" t-att-res-id="line['id']" res-model="product.product">
                                <t t-esc="line['name']"/>
                            </a>
                            <span class="pull-right">
                                Quantity:
                                <strong>
                                    <t t-esc="line['product_uom_qty']"/>
                                    <t t-esc="line['product_uom'].name"/>
                                </strong>
                            </span>
                        </h4>
                        <table class="table table-condensed bom_cost_table">
                            <thead>
                                <tr>
                                    <th colspan="3">Product</th>
                                    <th class="col-sm-2 text-right">Quantity</th>
                                    <th class="col-sm-2 text-left" groups="product.group_uom">Unit of Measure</th>
                                    <th class="col-sm-2 text-right">Unit Cost</th>
                                    <th class="col-sm-2 text-right">Total Cost</th>
                                </tr>
                            </thead>
                            <tbody>
                                <t t-foreach="line['lines']" t-as="bom_line">
                                    <tr
                                        t-att-data-id="bom_line['id']"
                                        t-att-data-parent-id="bom_line['parent_id']"
                                        t-attf-class="#{'tr_expandable' if bom_line['has_child'] else ''}#{' hidden' if bom_line['level'] and print_mode == 'html' else ''}"
                                        t-attf-style="#{'cursor:pointer' if bom_line['has_child'] else ''}">
                                        <td colspan="3">
                                            <span style="color: white;" t-esc="'... '*(bom_line['level'])"/>
                                            <t t-if="bom_line['has_child'] and print_mode == 'html'">
                                                <i class="fa fa-caret-right td-caret" aria-hidden="true"></i>
                                            </t>
                                            <a class="mt8 mb16 reports_m2o_web_action" href="#" t-att-res-id="bom_line['product_id'].id" res-model="product.product">
                                                <span t-esc="bom_line['product_id'].display_name"/>
                                            </a>
                                        </td>
                                        <td class="text-right">
                                            <span t-esc="bom_line['product_uom_qty']"/>
                                        </td>
                                        <td class="text-left" groups="product.group_uom">
                                            <span t-esc="bom_line['product_uom'].name"/>
                                        </td>
                                        <td class="text-right">
                                            <span t-esc="bom_line['price_unit']" t-options='{"widget": "monetary", "display_currency": currency}'/>
                                        </td>
                                        <td class="text-right">
                                            <span t-esc="bom_line['total_price']" t-options='{"widget": "monetary", "display_currency": currency}'/>
                                        </td>
                                    </tr>
                                </t>
                                <tr>
                                    <th t-att-colspan="'6' if request.env.user.user_has_groups('product.group_uom') else '5'" class="text-left">Total Cost of Components</th>
                                    <th class="text-right">
                                        <span t-esc="line['total']" t-options='{"widget": "monetary", "display_currency": currency}'/>
                                    </th>
                                </tr>
                            </tbody>
                        </table>
                        <t t-set="operations" t-value="line['operations']"/>
                        <t t-set="operations_total" t-value="line['operations_total']"/>
                        <table t-if="operations" groups="mrp.group_mrp_routings" class="table table-condensed bom_operation_table">
                            <thead>
                                <tr>
                                    <th colspan="3">Operation</th>
                                    <th class="col-sm-2">Work Center
                                    </th>
                                    <th class="col-sm-2 text-left">
                                        Duration (Minutes)</th>
                                    <th class="col-sm-2 text-right">Cost per Hour</th>
                                    <th class="col-sm-2 text-right">Total Cost</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr t-foreach="operations" t-as="operation">
                                    <td colspan="3">
                                        <span t-esc="operation['name']"/>
                                    </td>
                                    <td>
                                        <span t-esc="operation['workcenter']"/>
                                    </td>
                                    <td>
                                        <span t-esc="operation['duration_expected']" t-options='{"widget": "float_time"}'/>
                                    </td>
                                     <td class="text-right">
                                        <span t-esc="operation['costs_hour']" t-options='{"widget": "monetary", "display_currency": currency}'/>
                                  </td>
                                      <td class="text-right">
                                        <span t-esc="operation['total']" t-options='{"widget": "monetary", "display_currency": currency}'/>
                                    </td>
                                </tr>
                                <tr>
                                    <th t-att-colspan="6" class="text-left">Total Cost of Operations</th>
                                    <th class="text-right">
                                        <span t-esc="operations_total" t-options='{"widget": "monetary", "display_currency": currency}'/>
                                    </th>
                                </tr>
                            </tbody>
                        </table>
                        <hr t-if="print_mode == 'html'" class="mt128"/>
                    </div>
                    <p style='page-break-before: always'/>
                </t>
            </t>
        </t>
    </template>
</odoo>