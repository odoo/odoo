<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <template id="unavailable_products_warning">
        <div name="unavailable_products_warning" class="alert alert-warning mt-2">
            Some of the products are not available at <strong><t t-out="wh_name"/></strong>.
            <div
                t-foreach="unavailable_order_lines"
                t-as="order_line"
                t-attf-class="d-flex m-2 position-relative"
            >
                <div class="d-flex align-items-center gap-2">
                    <a t-att-href="order_line.product_id.website_url">
                        <span
                            t-field="order_line.product_id.image_128"
                            t-options="{'widget': 'image', 'qweb_img_responsive': False, 'class': 'o_image_64_max rounded'}"
                        />
                    </a>
                    <t t-out="order_line.product_id.name"/>
                    <a
                        href='#'
                        class="js_delete_product small"
                        aria-label="Remove from cart"
                        title="Remove from cart"
                    >
                        <i t-att-data-product-id="order_line.product_id.id" class="fa fa-trash"/>
                    </a>
                     ( <t t-out="order_line.shop_warning"/> )
                </div>
             </div>
        </div>
    </template>

    <template id="in_store_delivery_method" inherit_id="website_sale.delivery_method">
        <xpath expr="//t[@t-set='is_pickup_needed']" position="attributes">
            <attribute name="t-value" add="dm.delivery_type=='in_store'" separator=" or "/>
        </xpath>
        <div name="o_pickup_location" position="after">
            <t t-if="dm.delivery_type=='in_store' and order.carrier_id.id==dm.id">
                <t
                    t-if="unavailable_order_lines"
                    t-call="website_sale_collect.unavailable_products_warning"
                >
                    <t t-set="wh_name" t-value="order.pickup_location_data.get('name')"/>
                </t>
            </t>
        </div>
        <span name="o_pickup_location_selector" position="attributes">
            <attribute name="t-if">len(dm.warehouse_ids) &gt; 1</attribute>
        </span>
        <button name="o_pickup_location_selector" position="attributes">
            <attribute
                name="t-attf-class"
                add="{{'btn btn-primary ms-4' if len(dm.warehouse_ids) > 1 else 'd-none'}}"
            />
        </button>
        <div name="o_pickup_location_details" position="after">
            <t t-if="dm.delivery_type=='in_store' and len(dm.warehouse_ids) == 1">
                <t t-foreach="pickup_locations" t-as="location">
                    <t t-if="location.get('dm_id') == dm.id">
                        <t t-set="pickup_location_data" t-value="location.get('pickup_location')"/>
                        <div name="o_single_pickup_location_details" class="ms-4">
                            <span>
                                <b
                                    name="o_pickup_location_name"
                                    t-out="pickup_location_data.get('name', '')"
                                />
                                <br/>
                                <i
                                    name="o_pickup_location_address"
                                    t-out="(pickup_location_data.get('street', ) or '')
                                           + ' '
                                           + (pickup_location_data.get('zip_code') or '')
                                           + ' '
                                           + (pickup_location_data.get('city') or '')"
                                />
                            </span>
                            <span
                                name="o_pickup_location_selector"
                                class="d-none"
                                t-att-data-location-id="pickup_location_data.get('id')"
                                t-att-data-zip-code="pickup_location_data.get('zip_code')"
                                t-att-data-pickup-location-data="json.dumps(pickup_location_data)"
                            />
                        </div>
                    </t>
                </t>
            </t>
        </div>
        <div name="o_pickup_location_details" position="attributes">
            <attribute name="t-if">len(dm.warehouse_ids) &gt; 1</attribute>
        </div>
    </template>

</odoo>
