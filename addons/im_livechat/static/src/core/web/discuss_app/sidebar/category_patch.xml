<?xml version="1.0" encoding="UTF-8"?>
<templates xml:space="preserve">
    <t t-inherit="mail.DiscussSidebarChannel.main" t-inherit-mode="extension">
        <xpath expr="//*[@name='threadAvatar']" position="before">
            <i t-if="store.discuss.isSidebarCompact and props.channel.discussAppCategory.eq(store.discuss.livechatLookingForHelpCategory) and props.channel.matchesSelfExpertise"
               class="fa fa-star o-mail-starred position-absolute top-0 start-0 z-1"
               role="image"
               title="Relevant to your expertise"
            />
            <t t-else="" t-call="im_livechat.LivechatStatusLabelOfThread">
                <t t-set="templateParams" t-value="{ livechatThread: props.channel.thread, small: true }"/>
            </t>
        </xpath>
    </t>

    <t t-name="im_livechat.LivechatStatusLabel">
        <t t-set="btn" t-value="templateParams.btn"/>
        <t t-set="inThreadActions" t-value="templateParams.inThreadActions"/>
        <span class="o-livechat-LivechatStatusLabel fa" t-att-title="btn.label" t-att-class="{
            'text-success': btn.status === 'in_progress',
            'o-help': btn.status === 'need_help',
        }">
            <i
                 t-if="btn.icon"
                 class="o-livechat-LivechatStatusLabel-icon"
                 t-attf-class="{{ btn.icon }}"
            />
        </span>
    </t>

    <t t-name="im_livechat.LivechatStatusLabelOfThread">
        <t t-set="livechatThread" t-value="templateParams.livechatThread"/>
        <t t-set="small" t-value="templateParams.small"/>
        <span t-if="livechatThread.channel?.channel_type === 'livechat' and (livechatThread.channel.livechat_status === 'need_help' or livechatThread.livechat_end_dt)" class="o-livechat-LivechatStatusLabel" t-att-title="livechatThread.channel.livechatStatusLabel" t-att-class="{
            'position-absolute top-0 start-0': env.inDiscussSidebar or env.inChatBubble or env.inNotificationItem,
            'o-livechat-LivechatStatusLabel-Sidebar end-0 bottom-0 rounded-2 border': env.inDiscussSidebar,
            'd-flex z-1 bg-opacity-100': env.inChatBubble or env.inNotificationItem,
            'mx-n1': env.inChatBubble,
            'mx-n2 my-n1': env.inNotificationItem,
            'o-selfMember': livechatThread.channel.self_member_id,
            'o-help': livechatThread.channel.livechat_status === 'need_help',
            'bg-info': env.inDiscussSidebar and livechatThread.channel.livechat_status === 'need_help' and !livechatThread.channel.self_member_id,
        }">
            <t t-set="livechatStatusButton" t-value="store.livechatStatusButtons.find(btn => btn.status === livechatThread.channel.livechat_status)"/>
            <i class="o-livechat-LivechatStatusLabel-icon" t-attf-class="{{ livechatThread.livechat_end_dt ? ('fa fa-flag-checkered' + (small ? ' o-xsmaller' : '')) : small ? livechatStatusButton?.iconSmall : livechatStatusButton?.icon }}" t-att-class="{
                'o-white': livechatThread.livechat_end_dt,
                'position-absolute start-0 top-0 z-1 o-inDiscussSidebar rounded-circle o-px-0_5': env.inDiscussSidebar,
                'fa-fw': !env.inDiscussSidebar,
            }"/>
        </span>
    </t>

    <t t-name="im_livechat.LivechatStatusSelection">
    <t t-set="livechatThread" t-value="templateParams.livechatThread"/>
        <div class="o-livechat-LivechatStatusSelection list-group" t-ref="livechat-status-selection">
            <t t-foreach="store.livechatStatusButtons" t-as="btn" t-key="btn.status">
                <t t-set="isBtnActive" t-value="livechatThread.channel.livechat_status === btn.status"/>
                <button
                    class="list-group-item list-group-item-action d-flex align-items-center gap-2"
                    t-att-class="{
                        'active': isBtnActive,
                        'o-inProgress': btn.status === 'in_progress',
                        'bg-view': isBtnActive and btn.status === 'in_progress',
                        'o-need-help': isBtnActive and btn.status === 'need_help',
                    }"
                    t-att-disabled="!store.has_access_livechat"
                    t-on-click="() => livechatThread.channel.updateLivechatStatus(btn.status)"
                >
                    <input
                            type="radio"
                            t-att-checked="isBtnActive"
                            class="form-check-input m-0"
                    />
                    <span class="o-livechat-LivechatStatusSelection-Label text-truncate cursor-pointer flex-grow-1 " t-esc="btn.label"/>
                    <t t-call="im_livechat.LivechatStatusLabel">
                        <t t-set="templateParams" t-value="{ btn }"/>
                    </t>
                </button>
            </t>
        </div>
    </t>
</templates>
