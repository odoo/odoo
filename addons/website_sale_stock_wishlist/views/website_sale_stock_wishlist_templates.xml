<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <template id="product_wishlist" inherit_id="website_sale_wishlist.product_wishlist">
        <xpath expr="//button[hasclass('o_wish_rm')]" position="before">
            <small
                t-if="product._is_sold_out() and not product.allow_out_of_stock_order"
                class="text-danger d-md-block"
            >
                Temporarily out of stock
            </small>
        </xpath>
        <xpath expr="//button[hasclass('o_wish_rm')]" position="after">
            <t t-if="not product.allow_out_of_stock_order and product._is_sold_out()">
                <t t-set="has_stock_notification"
                   t-value="product._has_stock_notification(wish.partner_id) or request and product.id in request.session.get('product_with_stock_notification_enabled', set())"/>
                <div
                    t-if="not product.allow_out_of_stock_order"
                    id="stock_notification_div"
                    class="small d-inline-block"
                >
                    <!-- FIXME LOTI all the elements here shouldn't have ids, it's an error if multiple products are displayed in the wishlist -->
                    <div
                        t-if="not has_stock_notification"
                        class="btn btn-link px-0"
                        id="wishlist_stock_notification_message"
                    >
                        <small>
                            <i class="fa fa-envelope-o me-2"/>Get notified when back in stock
                        </small>
                    </div>
                    <div id="stock_notification_form" class="d-none">
                        <div class="input-group">
                            <input
                                id="stock_notification_input"
                                class="form-control"
                                name="email"
                                type="text"
                                placeholder="youremail@gmail.com"
                                t-att-value="request.env.user.partner_id.email or request.session.get('stock_notification_email', '')"/>
                            <div
                                id="wishlist_stock_notification_form_submit_button"
                                class="btn btn-primary"
                            >
                                <i class="fa fa-paper-plane"/>
                            </div>
                        </div>
                        <div id="stock_notification_input_incorrect" class="d-none form-text text-danger">
                            Invalid email
                        </div>
                    </div>
                    <div
                        id="stock_notification_success_message"
                        class="text-muted"
                        t-att-class="'text-muted' if has_stock_notification else 'd-none'"
                    >
                        <i class="fa fa-bell"/>
                        We'll notify you once the product is back in stock.
                    </div>
                </div>
            </t>
        </xpath>
        <button name="add_to_cart_button" position="attributes">
            <attribute name="t-att-disabled">
                not product.allow_out_of_stock_order and product._is_sold_out()
            </attribute>
        </button>
    </template>
</odoo>
