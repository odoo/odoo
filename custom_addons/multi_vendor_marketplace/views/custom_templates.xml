<odoo>
    <!-- Custom User Profile Template -->
    <template id="custom_user_profile" name="Custom User Profile">
        <t t-call="website.layout">
            <div class="container mt-5 o_custom_profile_page">
                <!-- User Info -->
                <div class="row text-center">
                    <div class="col-md-12">
                        <h2 t-esc="user.name" class="mt-3">Nickname</h2>
                        <p>Email: <span t-esc="user.email" /></p>
                        <p>Phone: <span t-esc="user.phone" /></p>
                        <p>Address: <span t-esc="user.partner_id.contact_address" /></p>
                        <a href="/profile/edit" class="btn btn-primary mt-3">Edit Info</a>
                    </div>
                </div>

                <!-- Navigation Buttons -->
                <div class="button-group-container mt-5">
                    <div class="row">
                        <div class="col-md-4 text-center">
                            <a href="/user/orders/status" class="btn btn-warning w-100">Order Status</a>
                        </div>
                        <div class="col-md-4 text-center">
                            <a href="/user/orders/history" class="btn btn-warning w-100">Order History</a>
                        </div>
                        <div class="col-md-4 text-center">
                            <a href="/user/orders/returns" class="btn btn-warning w-100">Returns</a>
                        </div>
                    </div>
                </div>

                <div class="button-group-container mt-4">
                    <div class="row">
                        <div class="col-md-4 text-center">
                            <button class="btn btn-warning w-100">Wallet</button>
                        </div>
                        <div class="col-md-4 text-center">
                            <a href="/shop/checkout" class="btn btn-warning w-100">Shipping Address</a>
                        </div>
                        <div class="col-md-4 text-center">
                            <button class="btn btn-warning w-100">Change Currency</button>
                        </div>
                    </div>
                </div>

                <div class="button-group-container mt-4">
                    <div class="row">
                        <div class="col-md-6 text-center">
                            <a href="/seller_reg" class="btn btn-warning w-100">Open Store</a>
                        </div>
                        <div class="col-md-6 text-center">
                            <button class="btn btn-warning w-100">Accounting and Taxes</button>
                        </div>
                    </div>
                </div>
            </div>
        </t>
    </template>

    <template id="edit_user_profile" name="Edit User Profile">
        <t t-call="website.layout">
            <div class="container mt-5">
                <h2>Edit Profile</h2>
                <form method="post" action="/profile/save">
                    <input type="hidden" name="csrf_token" t-att-value="request.csrf_token()" />

                    <div class="form-group">
                        <label for="name">Name</label>
                        <input type="text" id="name" name="name" class="form-control" t-att-value="user.name" />
                    </div>
                    <div class="form-group">
                        <label for="email">Email</label>
                        <input type="email" id="email" name="email" class="form-control" t-att-value="user.email" />
                    </div>
                    <div class="form-group">
                        <label for="phone">Phone</label>
                        <input type="text" id="phone" name="phone" class="form-control" t-att-value="user.phone" />
                    </div>

                    <!-- Password Change Fields -->
                    <div class="form-group">
                        <label for="new_password">New Password</label>
                        <input type="password" id="new_password" name="new_password" class="form-control" />
                    </div>
                    <div class="form-group">
                        <label for="confirm_password">Confirm New Password</label>
                        <input type="password" id="confirm_password" name="confirm_password" class="form-control" />
                    </div>

                    <button type="submit" class="btn btn-success mt-3">Save</button>
                    <a href="/profile" class="btn btn-secondary mt-3">Cancel</a>
                </form>
            </div>
        </t>
    </template>
    <template id="user_order_status" name="Order Status">
        <t t-call="website.layout">
            <div class="container mt-5">
                <h3 class="mb-4">Order Status</h3>
                <div class="row" t-foreach="orders" t-as="order">
                    <div class="col-md-12 mb-3">
                        <div class="card p-3 d-flex flex-row align-items-center">
                            <img t-att-src="order.image_url" class="img-thumbnail me-3" style="width: 100px; height: 100px;" />
                            <div class="flex-grow-1">
                                <h5 t-esc="order.name">Product Name</h5>
                                <p>Quantity: <t t-esc="order.quantity" /></p>
                                <p>Status: <span class="badge bg-info" t-esc="order.status">Pending Shipment</span></p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </t>
    </template>
    <template id="user_order_history" name="Order History">
        <t t-call="website.layout">
            <div class="container mt-5">
                <h3 class="mb-4">Order History</h3>
                <div class="row" t-foreach="orders" t-as="order">
                    <div class="col-md-12 mb-3">
                        <div class="card p-3 d-flex flex-row align-items-center justify-content-between">
                            <div class="d-flex align-items-center">
                                <img t-att-src="order.image_url" class="img-thumbnail me-3" style="width: 100px; height: 100px;" />
                                <div>
                                    <h5 t-esc="order.name">Product Name</h5>
                                    <p>Quantity: <t t-esc="order.quantity" /></p>
                                    <p>Status: <span class="badge bg-success" t-esc="order.status">Delivered</span></p>
                                </div>
                            </div>
                            <div>
                                <p>Date: <t t-esc="order.date_order" /></p>
                                <p>Time: <t t-esc="order.time_order" /></p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </t>
    </template>
    <template id="user_order_returns" name="Returns">
        <t t-call="website.layout">
            <div class="container mt-5">
                <h3 class="mb-4">Returns</h3>
                <div class="row" t-foreach="returns" t-as="ret">
                    <div class="col-md-12 mb-3">
                        <div class="card p-3 d-flex flex-row align-items-center justify-content-between">
                            <div class="d-flex align-items-center">
                                <img t-att-src="ret.image_url" class="img-thumbnail me-3" style="width: 100px; height: 100px;" />
                                <div>
                                    <h5 t-esc="ret.name">Product Name</h5>
                                    <p>Quantity: <t t-esc="ret.quantity" /></p>
                                    <p>Status: <span class="badge bg-warning" t-esc="ret.status">Return Requested</span></p>
                                </div>
                            </div>
                            <div>
                                <p>Return Date: <t t-esc="ret.date_return" /></p>
                                <p>Return Time: <t t-esc="ret.time_return" /></p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </t>
    </template>

    <!-- Inherit website.layout to add mobile bottom navigation -->
    <template id="website_layout_bottom_mobile_nav" inherit_id="website.layout" name="Mobile Bottom Navigation">
        <xpath expr="//div[@id='wrapwrap']" position="inside">
            <nav class="o_mobile_bottom_nav d-lg-none" style="z-index: 1000;">
                <a href="/shop" class="nav-item">
                    <i class="fa fa-home"/>
                    <span>Home</span>
                </a>
                <a href="/shop/cart" class="nav-item">
                    <i class="fa fa-shopping-cart"/>
                    <span>Cart</span>
                    <span class="badge bg-primary rounded-pill o_mobile_cart_count d-none">0</span>
                </a>
                <a href="/profile" class="nav-item">
                    <i class="fa fa-user"/>
                    <span>Profile</span>
                </a>
            </nav>
        </xpath>
    </template>

    <!-- Hide desktop header -->
    <template id="mobile_header_logo" inherit_id="website.layout" name="Mobile Only Logo Header">
        <!-- Hide desktop header -->
        <xpath expr="//header" position="attributes">
            <attribute name="class" add="d-none d-lg-block" separator=" "/>
        </xpath>
        <!-- Remove mobile header completely -->
        <xpath expr="//header" position="after">
            <t t-if="0">
                <header class="d-block d-lg-none text-center" data-anchor="true">
                    <t t-set="_link_class" t-value=""/>
                    <t t-call="website.placeholder_header_brand"/>
                </header>
            </t>
        </xpath>
    </template>

    <template id="hide_mobile_navbar_toggler" inherit_id="website.navbar_toggler" name="Hide Navbar Toggler On Mobile">
        <xpath expr="//button" position="attributes">
            <attribute name="class" add="d-none d-lg-block" separator=" "/>
        </xpath>
    </template>

    <!-- Mobile Product Detail Template -->
    <template id="mobile_product_detail" name="Mobile Product Detail" inherit_id="website_sale.product">
        <!-- Hide desktop version on mobile -->
        <xpath expr="//div[@id='wrap']" position="attributes">
            <attribute name="class" add="d-none d-lg-block" separator=" "/>
        </xpath>

        <!-- Add mobile version -->
        <xpath expr="//div[@id='wrap']" position="after">
            <div id="wrap_mobile" class="d-block d-lg-none" style="padding-top: 0;">
                <!-- Add styles at the top of the mobile template -->
                <style>
                    #wrap_mobile {
                        padding-top: 0 !important;
                    }
                    
                    #productImageCarousel {
                        margin: 0 -12px;
                    }
                    
                    #productImageCarousel .carousel-item {
                        background-color: #fff;
                        height: 375px;
                        margin-top: 0;
                    }
                    
                    #productImageCarousel .carousel-item img {
                        height: 100%;
                        width: 100%;
                        object-fit: contain;
                    }
                    
                    #productImageCarousel .carousel-indicators {
                        margin: 0;
                        padding: 10px 12px;
                        position: relative;
                        display: flex;
                        gap: 8px;
                        overflow-x: auto;
                        justify-content: flex-start;
                        background: #fff;
                    }
                    
                    #productImageCarousel .carousel-indicators button {
                        width: 60px;
                        height: 60px;
                        border: 2px solid transparent;
                        border-radius: 4px;
                        opacity: 0.7;
                        transition: all 0.3s ease;
                        padding: 0;
                        margin: 0;
                    }
                    
                    #productImageCarousel .carousel-indicators button.active {
                        opacity: 1;
                        border-color: #089454;
                    }
                    
                    #productImageCarousel .carousel-indicators button img {
                        border-radius: 2px;
                    }

                    /* Hide carousel controls */
                    #productImageCarousel .carousel-control-prev,
                    #productImageCarousel .carousel-control-next {
                        display: none;
                    }

                    /* Remove top spacing */
                    .o_header_standard {
                        display: none !important;
                    }
                    
                    #wrapwrap > main {
                        margin-top: 0 !important;
                    }

                    /* Product Options Modal Styles */
                    #productOptionsModal .modal-content {
                        border-radius: 16px 16px 0 0;
                        margin-top: auto;
                    }

                    #productOptionsModal .modal-dialog {
                        position: fixed;
                        left: 0;
                        right: 0;
                        bottom: 0;
                        margin: 0;
                        max-width: none;
                    }

                    #productOptionsModal .quantity-selector {
                        display: flex;
                        align-items: center;
                        gap: 10px;
                    }

                    #productOptionsModal .quantity-selector button {
                        width: 36px;
                        height: 36px;
                        border-radius: 50%;
                        border: 1px solid #ddd;
                        background: white;
                        font-size: 18px;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                    }

                    #productOptionsModal .quantity-selector input {
                        width: 60px;
                        text-align: center;
                        border: none;
                        font-size: 16px;
                    }

                    #productOptionsModal .variant-select {
                        border: 1px solid #ddd;
                        padding: 10px;
                        border-radius: 8px;
                        width: 100%;
                        margin-top: 5px;
                    }

                    #productOptionsModal .modal-footer {
                        padding: 16px;
                        gap: 10px;
                    }

                    #productOptionsModal .modal-footer button {
                        flex: 1;
                        border-radius: 8px;
                        padding: 12px;
                    }
                </style>

                <div class="container pb-5">
                    <!-- Product Images Carousel -->
                    <div class="product-images-container position-relative mb-3">
                        <div id="productImageCarousel" class="carousel slide" data-bs-ride="carousel" data-bs-interval="0">
                            <div class="carousel-inner">
                                <!-- Главная картинка -->
                                <div class="carousel-item active" t-if="product.image_1920">
                                    <img t-att-src="image_data_uri(product.image_1920)" class="d-block w-100" t-att-alt="product.name"/>
                                </div>
                                <!-- Остальные картинки, кроме главной -->
                                <t t-set="slide_index" t-value="1"/>
                                <t t-foreach="product.product_template_image_ids" t-as="image">
                                    <t t-if="not image.image_1920 == product.image_1920">
                                        <div class="carousel-item">
                                            <img t-att-src="image_data_uri(image.image_1920)" class="d-block w-100" t-att-alt="product.name"/>
                                        </div>
                                        <t t-set="slide_index" t-value="slide_index + 1"/>
                                    </t>
                                </t>
                            </div>

                            <!-- Image Indicators -->
                            <div class="carousel-indicators position-relative mt-2">
                                <button type="button" data-bs-target="#productImageCarousel" data-bs-slide-to="0" class="active">
                                    <img t-att-src="image_data_uri(product.image_1920)" class="d-block w-100" style="height: 60px; object-fit: cover;"/>
                                </button>
                                <t t-set="indicator_index" t-value="1"/>
                                <t t-foreach="product.product_template_image_ids" t-as="image">
                                    <t t-if="not image.image_1920 == product.image_1920">
                                        <button type="button" data-bs-target="#productImageCarousel" t-att-data-bs-slide-to="indicator_index">
                                            <img t-att-src="image_data_uri(image.image_1920)" class="d-block w-100" style="height: 60px; object-fit: cover;"/>
                                        </button>
                                        <t t-set="indicator_index" t-value="indicator_index + 1"/>
                                    </t>
                                </t>
                            </div>
                        </div>
                    </div>

                    <!-- Product Info -->
                    <div class="product-info-container">
                        <h1 class="product-title h4 mb-2" t-field="product.name"/>
                        
                        <!-- Price -->
                        <div class="product_price mt-2" t-cache="price">
                            <h2 class="text-success">
                                <t t-esc="combination_info['price']" t-options="{'widget': 'monetary', 'display_currency': website.currency_id}"/>
                            </h2>
                        </div>

                        <!-- Product Description -->
                        <div class="product-description mt-3">
                            <p t-field="product.description_sale" class="text-muted"/>
                        </div>

                        <!-- Seller Info -->
                        <div class="seller-info mt-4" t-if="product.seller_id">
                            <div class="d-flex align-items-center mb-3">
                                <a t-if="product.seller_id.image_1920" t-att-href="'/shop/seller/%s' % (product.seller_id.id)" style="display:inline-block;">
                                    <img t-att-src="image_data_uri(product.seller_id.image_1920)" class="rounded-circle" style="width: 40px; height: 40px;" alt="Seller"/>
                                </a>
                                <div class="ms-2">
                                    <h5 class="mb-0" t-field="product.seller_id.name"/>
                                    <p class="text-muted mb-0" t-field="product.seller_id.company_name"/>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Seller Contact Modal -->
                    <div class="modal fade" id="sellerContactModal" tabindex="-1" aria-labelledby="sellerContactModalLabel" aria-hidden="true">
                        <div class="modal-dialog modal-dialog-centered">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title" id="sellerContactModalLabel">Contact Seller</h5>
                                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                </div>
                                <div class="modal-body">
                                    <div class="seller-contact-info">
                                        <div class="d-flex align-items-center mb-4">
                                            <img t-if="product.seller_id.image_1920" t-att-src="image_data_uri(product.seller_id.image_1920)" class="rounded-circle me-3" style="width: 60px; height: 60px;" alt="Seller"/>
                                            <div>
                                                <h5 class="mb-1" t-field="product.seller_id.name"/>
                                                <p class="text-muted mb-0" t-field="product.seller_id.company_name"/>
                                            </div>
                                        </div>
                                        <div class="contact-methods">
                                            <a t-if="product.seller_id.phone" t-attf-href="tel:#{product.seller_id.phone}" class="btn btn-outline-primary w-100 mb-3">
                                                <i class="fa fa-phone me-2"></i>
                                                <span t-field="product.seller_id.phone"/>
                                            </a>
                                            <a t-if="product.seller_id.email" t-attf-href="mailto:#{product.seller_id.email}" class="btn btn-outline-primary w-100 mb-3">
                                                <i class="fa fa-envelope me-2"></i>
                                                <span t-field="product.seller_id.email"/>
                                            </a>
                                            <a t-if="product.seller_id.website" t-att-href="product.seller_id.website" target="_blank" class="btn btn-outline-primary w-100 mb-3">
                                                <i class="fa fa-globe me-2"></i>
                                                Visit Website
                                            </a>
                                            <a href="/contactus" class="btn btn-outline-primary w-100">
                                                <i class="fa fa-message me-2"></i>
                                                Send Message
                                            </a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Product Options Modal -->
                    <div class="modal fade" id="productOptionsModal" tabindex="-1" aria-hidden="true">
                        <div class="modal-dialog">
                            <div class="modal-content">
                                <div class="modal-header border-0 pb-0">
                                    <h5 class="modal-title" id="productOptionsModalLabel">
                                        <span t-field="product.name"/>
                                    </h5>
                                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                </div>
                                <div class="modal-body">
                                    <!-- Product Basic Info -->
                                    <div class="d-flex gap-3 mb-4">
                                        <img t-if="product.image_128" t-att-src="image_data_uri(product.image_128)" 
                                             class="rounded" style="width: 80px; height: 80px; object-fit: cover;"/>
                                        <div>
                                            <div class="product_price" t-cache="price">
                                                <h4 class="text-success mb-0">
                                                    <t t-esc="combination_info['price']" t-options="{'widget': 'monetary', 'display_currency': website.currency_id}"/>
                                                </h4>
                                            </div>
                                            <small class="text-muted" t-if="product.default_code">
                                                SKU: <span t-field="product.default_code"/>
                                            </small>
                                        </div>
                                    </div>

                                    <!-- Quantity Selector -->
                                    <div class="mb-4">
                                        <label class="form-label">Quantity</label>
                                        <div class="quantity-selector">
                                            <button type="button" class="btn-quantity-decrease">-</button>
                                            <input type="number" value="1" min="1" class="quantity-input"/>
                                            <button type="button" class="btn-quantity-increase">+</button>
                                        </div>
                                    </div>

                                    <!-- Variants Selection -->
                                    <div t-if="product.attribute_line_ids" class="mb-4">
                                        <t t-foreach="product.attribute_line_ids" t-as="attribute_line">
                                            <div class="mb-3">
                                                <label class="form-label">
                                                    <t t-esc="attribute_line.attribute_id.name"/>
                                                </label>
                                                <select class="variant-select" 
                                                        t-att-name="'attribute-%s-%s' % (product.id, attribute_line.attribute_id.id)">
                                                    <t t-foreach="attribute_line.value_ids" t-as="value">
                                                        <option t-att-value="value.id">
                                                            <t t-esc="value.name"/>
                                                        </option>
                                                    </t>
                                                </select>
                                            </div>
                                        </t>
                                    </div>
                                </div>
                                <div class="modal-footer border-0">
                                    <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Cancel</button>
                                    <button type="button" class="btn btn-success modal-action-button">Confirm</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Fixed Bottom Action Buttons -->
                    <div class="product-actions-container fixed-bottom bg-white border-top py-2 px-3" style="z-index: 1050;">
                        <div class="d-flex gap-2 align-items-stretch">
                            <!-- Secondary Actions -->
                            <div class="product-secondary-actions">
                                <button class="btn btn-light rounded-circle" style="width: 45px; height: 45px;" data-bs-toggle="modal" data-bs-target="#sellerContactModal">
                                    <i class="fa fa-comments"></i>
                                </button>
                            </div>

                            <!-- Main Actions -->
                            <div class="product-main-actions flex-grow-1">
                                <div class="d-flex gap-2 h-100">
                                    <button type="button" class="btn btn-success opacity-75 flex-grow-1" 
                                            data-action="add_to_cart" 
                                            data-bs-toggle="modal" 
                                            data-bs-target="#productOptionsModal">
                                        <i class="fa fa-shopping-cart me-1"></i>Add
                                    </button>
                                    <button type="button" class="btn btn-success flex-grow-1" 
                                            data-action="buy_now"
                                            data-bs-toggle="modal" 
                                            data-bs-target="#productOptionsModal" 
                                            style="background-color: #089454;">
                                        <i class="fa fa-bolt me-1"></i>Buy Now
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Hidden Forms -->
                    <form id="add_to_cart_form" t-att-action="keep('/shop/cart/update')" method="POST" class="d-none">
                        <input type="hidden" name="csrf_token" t-att-value="request.csrf_token()"/>
                        <input type="hidden" name="product_id" t-att-value="product_variant.id"/>
                        <input type="hidden" name="add_qty" value="1"/>
                    </form>

                    <form id="buy_now_form" t-att-action="keep('/shop/cart/update')" method="POST" class="d-none">
                        <input type="hidden" name="csrf_token" t-att-value="request.csrf_token()"/>
                        <input type="hidden" name="product_id" t-att-value="product_variant.id"/>
                        <input type="hidden" name="add_qty" value="1"/>
                        <input type="hidden" name="express" value="1"/>
                    </form>

                    <!-- Add JavaScript for modal handling -->
                    <script type="text/javascript">
                        document.addEventListener('DOMContentLoaded', function() {
                            var modal = document.getElementById('productOptionsModal');
                            var quantityInput = modal.querySelector('.quantity-input');
                            var decreaseBtn = modal.querySelector('.btn-quantity-decrease');
                            var increaseBtn = modal.querySelector('.btn-quantity-increase');
                            var actionButton = modal.querySelector('.modal-action-button');
                            var addToCartForm = document.getElementById('add_to_cart_form');
                            var buyNowForm = document.getElementById('buy_now_form');
                            var currentAction = '';

                            // Handle quantity changes
                            decreaseBtn.addEventListener('click', function() {
                                var value = parseInt(quantityInput.value);
                                if (value > 1) {
                                    quantityInput.value = value - 1;
                                }
                            });

                            increaseBtn.addEventListener('click', function() {
                                var value = parseInt(quantityInput.value);
                                quantityInput.value = value + 1;
                            });

                            // Update modal based on which button was clicked
                            modal.addEventListener('show.bs.modal', function(event) {
                                var button = event.relatedTarget;
                                currentAction = button.dataset.action;
                                actionButton.textContent = currentAction === 'buy_now' ? 'Buy Now' : 'Add to Cart';
                            });

                            // Handle form submission
                            actionButton.addEventListener('click', function() {
                                var form = currentAction === 'buy_now' ? buyNowForm : addToCartForm;
                                var formData = new FormData(form);
                                
                                // Update quantity
                                formData.set('add_qty', quantityInput.value);
                                
                                // Add variant selections if any
                                modal.querySelectorAll('.variant-select').forEach(function(select) {
                                    formData.append(select.name, select.value);
                                });

                                if (currentAction === 'buy_now') {
                                    // Submit form directly for buy now
                                    form.querySelector('[name="add_qty"]').value = quantityInput.value;
                                    form.submit();
                                } else {
                                    // Use AJAX for add to cart
                                    fetch('/shop/cart/update_json', {
                                        method: 'POST',
                                        body: formData,
                                        headers: {
                                            'X-Requested-With': 'XMLHttpRequest'
                                        }
                                    })
                                    .then(response => response.json())
                                    .then(data => {
                                        if (data.cart_quantity !== undefined) {
                                            var quantityElements = document.querySelectorAll('.my_cart_quantity');
                                            quantityElements.forEach(function(el) {
                                                el.textContent = data.cart_quantity;
                                                el.parentElement.classList.remove('d-none');
                                            });
                                        }
                                        // Close modal
                                        var modalInstance = bootstrap.Modal.getInstance(modal);
                                        modalInstance.hide();
                                    });
                                }
                            });
                        });
                    </script>
                </div>
            </div>
        </xpath>
    </template>
</odoo>