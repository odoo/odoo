
<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- ============================== -->
    <!-- 1. „ÅäÂÆ¢„Åï„ÇìÂêë„Åë „Çª„É´„Éï„Ç™„Éº„ÉÄ„ÉºÁîªÈù¢ -->
    <!-- ============================== -->
    <template id="self_order_page" name="Self Order Page" inherit_id="website.layout">
        <xpath expr="//main" position="replace">
            <main id="wrap" class="oe_structure">
                <section class="py-5">
                    <div class="container">

                        <!-- „Éò„ÉÉ„ÉÄ -->
                        <div class="row mb-4">
                            <div class="col-12 text-center">
                                <h1 class="mb-2">„Çª„É´„Éï„Ç™„Éº„ÉÄ„Éº</h1>
                                <t t-if="table">
                                    <p class="lead">
                                        „ÉÜ„Éº„Éñ„É´Ôºö
                                        <strong t-esc="table.name"/>
                                    </p>
                                </t>
                                <t t-if="not table">
                                    <p class="text-muted">
                                        „ÉÜ„Éº„Éñ„É´ÊÉÖÂ†±„ÅåÂèñÂæó„Åß„Åç„Åæ„Åõ„Çì„Åß„Åó„Åü„ÄÇ
                                        „Çπ„Çø„ÉÉ„Éï„Çí„ÅäÂëº„Å≥„Åè„Å†„Åï„ÅÑ„ÄÇ
                                    </p>
                                </t>
                            </div>
                        </div>

                        <!-- „É°„Éã„É•„Éº‰∏ÄË¶ß -->
                        <t t-if="products">
                            <form action="/self_order/submit" method="post">
                                <input type="hidden" name="table_code" t-att-value="table_code"/>

                                <div class="row">
                                    <t t-foreach="products" t-as="p">
                                        <div class="col-12 col-md-6 col-lg-4 mb-3">
                                            <div class="card h-100 shadow-sm">
                                                <div class="card-body d-flex flex-column">
                                                    <h5 class="card-title" t-esc="p.display_name"/>
                                                    <p class="card-text text-muted mb-2">
                                                        <t t-if="p.lst_price">
                                                            ¬•<t t-esc="('%.0f' % p.lst_price)"/>
                                                        </t>
                                                        <t t-if="not p.lst_price">
                                                            ‰æ°Ê†ºÊú™Ë®≠ÂÆö
                                                        </t>
                                                    </p>
                                                    <t t-if="p.description_sale">
                                                        <p class="card-text small text-muted mb-3"
                                                           t-esc="p.description_sale"/>
                                                    </t>

                                                    <div class="mt-auto">
                                                        <label class="form-label mb-1">
                                                            Êï∞Èáè
                                                        </label>
                                                        <div class="input-group mb-2">
                                                            <input type="number"
                                                                   class="form-control"
                                                                   min="0"
                                                                   step="1"
                                                                   value="0"
                                                                   t-att-name="'product_%s' % p.id"/>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </t>
                                </div>

                                <!-- ÂÖ®‰Ωì„É°„É¢ -->
                                <div class="row mt-4">
                                    <div class="col-12">
                                        <label class="form-label">
                                            ÂÖ®‰Ωì„Å∏„ÅÆ„ÅîË¶ÅÊúõÔºà„Ç¢„É¨„É´„ÇÆ„Éº„ÉªÂ∏≠ÊåáÂÆö„Å™„Å©Ôºâ
                                        </label>
                                        <textarea name="global_note"
                                                  class="form-control"
                                                  rows="3"
                                                  placeholder="‰æãÔºâ„Éç„ÇÆÊäú„Åç„Åß„ÅäÈ°ò„ÅÑ„Åó„Åæ„Åô„ÄÇ"></textarea>
                                    </div>
                                </div>

                                <!-- ÈÄÅ‰ø°„Éú„Çø„É≥ -->
                                <div class="row mt-4">
                                    <div class="col-12 text-center">
                                        <button type="submit" class="btn btn-primary btn-lg px-5">
                                            „Åì„ÅÆÂÜÖÂÆπ„ÅßÊ≥®Êñá„Åô„Çã
                                        </button>
                                    </div>
                                </div>

                            </form>
                        </t>

                        <t t-if="not products">
                            <div class="row">
                                <div class="col-12 text-center">
                                    <p>ÁèæÂú®„ÄÅÊ≥®ÊñáÂèØËÉΩ„Å™„É°„Éã„É•„Éº„Åå„ÅÇ„Çä„Åæ„Åõ„Çì„ÄÇ</p>
                                </div>
                            </div>
                        </t>

                    </div>
                </section>
            </main>
        </xpath>
    </template>

    <!-- ============================== -->
    <!-- 2. „ÅäÂÆ¢„Åï„ÇìÂêë„Åë Ê≥®ÊñáÂÆå‰∫ÜÁîªÈù¢ -->
    <!-- ============================== -->
    <template id="self_order_thanks_page" name="Self Order Thanks Page" inherit_id="website.layout">
        <xpath expr="//main" position="replace">
            <main id="wrap" class="oe_structure">
                <section class="py-5">
                    <div class="container">
                        <div class="row justify-content-center">
                            <div class="col-12 col-md-8 text-center">
                                <h1 class="mb-3">„ÅîÊ≥®Êñá„ÅÇ„Çä„Åå„Å®„ÅÜ„Åî„Åñ„ÅÑ„Åæ„Åó„Åü</h1>
                                <p class="lead mb-4">
                                    „ÅîÊ≥®Êñá„ÇíÂèó„Åë‰ªò„Åë„Åæ„Åó„Åü„ÄÇ„Çπ„Çø„ÉÉ„Éï„ÅåÁ¢∫Ë™ç„Åó„ÄÅÈ†ÜÊ¨°„ÅîÊèê‰æõ„ÅÑ„Åü„Åó„Åæ„Åô„ÄÇ
                                </p>
                                <t t-if="table">
                                    <p class="mb-2">
                                        „ÉÜ„Éº„Éñ„É´Ôºö
                                        <strong t-esc="table.name"/>
                                    </p>
                                </t>
                                <t t-if="order">
                                    <p class="text-muted small">
                                        Âèó‰ªòÁï™Âè∑Ôºö
                                        <t t-esc="order.name"/>
                                    </p>
                                </t>
                                <p class="mt-4">
                                    ËøΩÂä†„Åß„ÅîÊ≥®Êñá„Åå„ÅÇ„ÇãÂ†¥Âêà„ÅØ„ÄÅÂêå„ÅòQR„Ç≥„Éº„Éâ„Åã„ÇâÂÜçÂ∫¶„Ç¢„ÇØ„Çª„Çπ„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ
                                </p>
                            </div>
                        </div>
                    </div>
                </section>
            </main>
        </xpath>
    </template>
    <!-- ============================== -->
    <!-- 3. Âé®ÊàøÂêë„Åë „Ç≠„ÉÉ„ÉÅ„É≥ÁîªÈù¢Ôºà„Ç®„É™„Ç¢Âà•„Ç´„É©„É†Ôºâ -->
    <!-- ============================== -->
    <template id="kitchen_screen_page" name="Kitchen Screen Page" inherit_id="web.layout">
        <xpath expr="//main" position="replace">
            <main id="wrap" class="oe_structure">
                <section class="py-3">
                    <div class="container-fluid">

                        <!-- „Éò„ÉÉ„ÉÄÔºà„Çø„Ç§„Éà„É´ & Êõ¥Êñ∞„Éú„Çø„É≥Ôºâ -->
                        <div class="row align-items-center mb-3">
                            <div class="col-12 col-md-6">
                                <h1 class="h3 mb-0">üçΩ Kitchen Screen</h1>
                                <p class="text-muted mb-0 small">
                                    „Çª„É´„Éï„Ç™„Éº„ÉÄ„Éº„ÅÆÂé®ÊàøÂêë„ÅëÁîªÈù¢„Åß„ÅôÔºà„Ç®„É™„Ç¢Âà•Ë°®Á§∫Ôºâ„ÄÇ
                                </p>
                            </div>
                            <div class="col-12 col-md-6 text-md-end mt-2 mt-md-0">
                                <span class="me-3 small">
                                    Ëá™ÂãïÊõ¥Êñ∞Ôºö<span id="rsk-auto-refresh-status">„Ç™„É≥</span>
                                    Ôºà10Áßí„Åî„Å®Ôºâ
                                </span>
                                <button type="button"
                                        class="btn btn-sm btn-secondary"
                                        id="rsk-manual-refresh">
                                    ÊâãÂãïÊõ¥Êñ∞
                                </button>
                            </div>
                        </div>

                        <!-- „Ç®„É™„Ç¢Âà•„Å´„ÉÅ„Ç±„ÉÉ„Éà„Çí„Ç∞„É´„Éº„Éî„É≥„Ç∞ -->
                        <t t-set="kitchen_new" t-value="[t for t in tickets_new if any(ln.area == 'kitchen' for ln in t.line_ids)]"/>
                        <t t-set="kitchen_in_progress" t-value="[t for t in tickets_in_progress if any(ln.area == 'kitchen' for ln in t.line_ids)]"/>

                        <t t-set="drink_new" t-value="[t for t in tickets_new if any(ln.area == 'drink' for ln in t.line_ids)]"/>
                        <t t-set="drink_in_progress" t-value="[t for t in tickets_in_progress if any(ln.area == 'drink' for ln in t.line_ids)]"/>

                        <t t-set="dessert_new" t-value="[t for t in tickets_new if any(ln.area == 'dessert' for ln in t.line_ids)]"/>
                        <t t-set="dessert_in_progress" t-value="[t for t in tickets_in_progress if any(ln.area == 'dessert' for ln in t.line_ids)]"/>

                        <!-- 3„Ç´„É©„É†Ôºö„Ç≠„ÉÉ„ÉÅ„É≥ / „Éâ„É™„É≥„ÇØ / „Éá„Ç∂„Éº„Éà -->
                        <div class="row">
                            <!-- „Ç≠„ÉÉ„ÉÅ„É≥„Ç®„É™„Ç¢ -->
                            <div class="col-12 col-lg-4 mb-4">
                                <div class="card">
                                    <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
                                        <div>üë®‚Äçüç≥ „Ç≠„ÉÉ„ÉÅ„É≥</div>
                                        <div class="small">
                                            Êñ∞Ë¶è: <t t-esc="len(kitchen_new)"/> /
                                            Ë™øÁêÜ‰∏≠: <t t-esc="len(kitchen_in_progress)"/>
                                        </div>
                                    </div>
                                    <div class="card-body p-2" style="max-height: 80vh; overflow-y: auto;">

                                        <!-- Êñ∞Ë¶è -->
                                        <h6 class="mt-1 mb-2">üîµ Êñ∞Ë¶è</h6>
                                        <t t-if="kitchen_new">
                                            <t t-foreach="kitchen_new" t-as="tkt">
                                                <t t-set="lines" t-value="[ln for ln in tkt.line_ids if ln.area == 'kitchen']"/>
                                                <t t-if="lines">
                                                    <div class="card mb-2 shadow-sm rsk-ticket-card rsk-ticket-new">
                                                        <div class="card-body p-2">
                                                            <div class="d-flex justify-content-between align-items-center mb-1">
                                                                <div>
                                                                    <strong t-esc="tkt.name"/>
                                                                    <t t-if="tkt.table_id">
                                                                        Ôºà<t t-esc="tkt.table_id.name"/>Ôºâ
                                                                    </t>
                                                                </div>
                                                                <div class="small text-muted">
                                                                    <t t-esc="tkt.create_date"/>
                                                                </div>
                                                            </div>
                                                            <hr class="my-2"/>

                                                            <ul class="mb-2 ps-3">
                                                                <t t-foreach="lines" t-as="ln">
                                                                    <li class="small">
                                                                        <strong t-esc="ln.product_id.display_name"/> √ó
                                                                        <t t-esc="ln.qty"/>
                                                                        <t t-if="ln.note">
                                                                            Ôºç
                                                                            <span class="text-muted" t-esc="ln.note"/>
                                                                        </t>
                                                                    </li>
                                                                </t>
                                                            </ul>

                                                            <t t-if="tkt.note">
                                                                <p class="mb-2 small">
                                                                    <span class="fw-bold">„É°„É¢Ôºö</span>
                                                                    <span t-esc="tkt.note"/>
                                                                </p>
                                                            </t>

                                                            <div class="d-flex justify-content-end gap-2">
                                                                <button type="button"
                                                                        class="btn btn-sm btn-outline-secondary rsk-btn-set-state"
                                                                        data-ticket-id="<t t-esc='tkt.id'/>"
                                                                        data-target-state="in_progress">
                                                                    Ë™øÁêÜÈñãÂßã
                                                                </button>
                                                                <button type="button"
                                                                        class="btn btn-sm btn-outline-danger rsk-btn-set-state"
                                                                        data-ticket-id="<t t-esc='tkt.id'/>"
                                                                        data-target-state="done">
                                                                    „Ç≠„É£„É≥„Çª„É´/Êèê‰æõÊ∏àÊâ±„ÅÑ
                                                                </button>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </t>
                                            </t>
                                        </t>
                                        <t t-if="not kitchen_new">
                                            <p class="text-muted small">Êñ∞Ë¶è„ÅÆ„Ç≠„ÉÉ„ÉÅ„É≥„Ç™„Éº„ÉÄ„Éº„ÅØ„ÅÇ„Çä„Åæ„Åõ„Çì„ÄÇ</p>
                                        </t>

                                        <!-- Ë™øÁêÜ‰∏≠ -->
                                        <h6 class="mt-3 mb-2">üü† Ë™øÁêÜ‰∏≠</h6>
                                        <t t-if="kitchen_in_progress">
                                            <t t-foreach="kitchen_in_progress" t-as="tkt">
                                                <t t-set="lines" t-value="[ln for ln in tkt.line_ids if ln.area == 'kitchen']"/>
                                                <t t-if="lines">
                                                    <div class="card mb-2 shadow-sm rsk-ticket-card rsk-ticket-in-progress">
                                                        <div class="card-body p-2">
                                                            <div class="d-flex justify-content-between align-items-center mb-1">
                                                                <div>
                                                                    <strong t-esc="tkt.name"/>
                                                                    <t t-if="tkt.table_id">
                                                                        Ôºà<t t-esc="tkt.table_id.name"/>Ôºâ
                                                                    </t>
                                                                </div>
                                                                <div class="small text-muted">
                                                                    <t t-esc="tkt.create_date"/>
                                                                </div>
                                                            </div>
                                                            <hr class="my-2"/>

                                                            <ul class="mb-2 ps-3">
                                                                <t t-foreach="lines" t-as="ln">
                                                                    <li class="small">
                                                                        <strong t-esc="ln.product_id.display_name"/> √ó
                                                                        <t t-esc="ln.qty"/>
                                                                        <t t-if="ln.note">
                                                                            Ôºç
                                                                            <span class="text-muted" t-esc="ln.note"/>
                                                                        </t>
                                                                    </li>
                                                                </t>
                                                            </ul>

                                                            <t t-if="tkt.note">
                                                                <p class="mb-2 small">
                                                                    <span class="fw-bold">„É°„É¢Ôºö</span>
                                                                    <span t-esc="tkt.note"/>
                                                                </p>
                                                            </t>

                                                            <div class="d-flex justify-content-end gap-2">
                                                                <button type="button"
                                                                        class="btn btn-sm btn-success rsk-btn-set-state"
                                                                        data-ticket-id="<t t-esc='tkt.id'/>"
                                                                        data-target-state="done">
                                                                    Êèê‰æõÊ∏à„Å´„Åô„Çã
                                                                </button>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </t>
                                            </t>
                                        </t>
                                        <t t-if="not kitchen_in_progress">
                                            <p class="text-muted small">Ë™øÁêÜ‰∏≠„ÅÆ„Ç≠„ÉÉ„ÉÅ„É≥„Ç™„Éº„ÉÄ„Éº„ÅØ„ÅÇ„Çä„Åæ„Åõ„Çì„ÄÇ</p>
                                        </t>

                                    </div>
                                </div>
                            </div>
                            <!-- „Éâ„É™„É≥„ÇØ„Ç®„É™„Ç¢ -->
                            <div class="col-12 col-lg-4 mb-4">
                                <div class="card">
                                    <div class="card-header bg-info text-white d-flex justify-content-between align-items-center">
                                        <div>ü•§ „Éâ„É™„É≥„ÇØ</div>
                                        <div class="small">
                                            Êñ∞Ë¶è: <t t-esc="len(drink_new)"/> /
                                            Ë™øÁêÜ‰∏≠: <t t-esc="len(drink_in_progress)"/>
                                        </div>
                                    </div>
                                    <div class="card-body p-2" style="max-height: 80vh; overflow-y: auto;">

                                        <!-- Êñ∞Ë¶è -->
                                        <h6 class="mt-1 mb-2">üîµ Êñ∞Ë¶è</h6>
                                        <t t-if="drink_new">
                                            <t t-foreach="drink_new" t-as="tkt">
                                                <t t-set="lines" t-value="[ln for ln in tkt.line_ids if ln.area == 'drink']"/>
                                                <t t-if="lines">
                                                    <div class="card mb-2 shadow-sm rsk-ticket-card rsk-ticket-new">
                                                        <div class="card-body p-2">
                                                            <div class="d-flex justify-content-between align-items-center mb-1">
                                                                <div>
                                                                    <strong t-esc="tkt.name"/>
                                                                    <t t-if="tkt.table_id">
                                                                        Ôºà<t t-esc="tkt.table_id.name"/>Ôºâ
                                                                    </t>
                                                                </div>
                                                                <div class="small text-muted">
                                                                    <t t-esc="tkt.create_date"/>
                                                                </div>
                                                            </div>
                                                            <hr class="my-2"/>

                                                            <ul class="mb-2 ps-3">
                                                                <t t-foreach="lines" t-as="ln">
                                                                    <li class="small">
                                                                        <strong t-esc="ln.product_id.display_name"/> √ó
                                                                        <t t-esc="ln.qty"/>
                                                                        <t t-if="ln.note">
                                                                            Ôºç
                                                                            <span class="text-muted" t-esc="ln.note"/>
                                                                        </t>
                                                                    </li>
                                                                </t>
                                                            </ul>

                                                            <t t-if="tkt.note">
                                                                <p class="mb-2 small">
                                                                    <span class="fw-bold">„É°„É¢Ôºö</span>
                                                                    <span t-esc="tkt.note"/>
                                                                </p>
                                                            </t>

                                                            <div class="d-flex justify-content-end gap-2">
                                                                <button type="button"
                                                                        class="btn btn-sm btn-outline-secondary rsk-btn-set-state"
                                                                        data-ticket-id="<t t-esc='tkt.id'/>"
                                                                        data-target-state="in_progress">
                                                                    Ë™øÁêÜÈñãÂßã
                                                                </button>
                                                                <button type="button"
                                                                        class="btn btn-sm btn-outline-danger rsk-btn-set-state"
                                                                        data-ticket-id="<t t-esc='tkt.id'/>"
                                                                        data-target-state="done">
                                                                    „Ç≠„É£„É≥„Çª„É´/Êèê‰æõÊ∏àÊâ±„ÅÑ
                                                                </button>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </t>
                                            </t>
                                        </t>
                                        <t t-if="not drink_new">
                                            <p class="text-muted small">Êñ∞Ë¶è„ÅÆ„Éâ„É™„É≥„ÇØ„Ç™„Éº„ÉÄ„Éº„ÅØ„ÅÇ„Çä„Åæ„Åõ„Çì„ÄÇ</p>
                                        </t>

                                        <!-- Ë™øÁêÜ‰∏≠ -->
                                        <h6 class="mt-3 mb-2">üü† Ë™øÁêÜ‰∏≠</h6>
                                        <t t-if="drink_in_progress">
                                            <t t-foreach="drink_in_progress" t-as="tkt">
                                                <t t-set="lines" t-value="[ln for ln in tkt.line_ids if ln.area == 'drink']"/>
                                                <t t-if="lines">
                                                    <div class="card mb-2 shadow-sm rsk-ticket-card rsk-ticket-in-progress">
                                                        <div class="card-body p-2">
                                                            <div class="d-flex justify-content-between align-items-center mb-1">
                                                                <div>
                                                                    <strong t-esc="tkt.name"/>
                                                                    <t t-if="tkt.table_id">
                                                                        Ôºà<t t-esc="tkt.table_id.name"/>Ôºâ
                                                                    </t>
                                                                </div>
                                                                <div class="small text-muted">
                                                                    <t t-esc="tkt.create_date"/>
                                                                </div>
                                                            </div>
                                                            <hr class="my-2"/>

                                                            <ul class="mb-2 ps-3">
                                                                <t t-foreach="lines" t-as="ln">
                                                                    <li class="small">
                                                                        <strong t-esc="ln.product_id.display_name"/> √ó
                                                                        <t t-esc="ln.qty"/>
                                                                        <t t-if="ln.note">
                                                                            Ôºç
                                                                            <span class="text-muted" t-esc="ln.note"/>
                                                                        </t>
                                                                    </li>
                                                                </t>
                                                            </ul>

                                                            <t t-if="tkt.note">
                                                                <p class="mb-2 small">
                                                                    <span class="fw-bold">„É°„É¢Ôºö</span>
                                                                    <span t-esc="tkt.note"/>
                                                                </p>
                                                            </t>

                                                            <div class="d-flex justify-content-end gap-2">
                                                                <button type="button"
                                                                        class="btn btn-sm btn-success rsk-btn-set-state"
                                                                        data-ticket-id="<t t-esc='tkt.id'/>"
                                                                        data-target-state="done">
                                                                    Êèê‰æõÊ∏à„Å´„Åô„Çã
                                                                </button>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </t>
                                            </t>
                                        </t>
                                        <t t-if="not drink_in_progress">
                                            <p class="text-muted small">Ë™øÁêÜ‰∏≠„ÅÆ„Éâ„É™„É≥„ÇØ„Ç™„Éº„ÉÄ„Éº„ÅØ„ÅÇ„Çä„Åæ„Åõ„Çì„ÄÇ</p>
                                        </t>

                                    </div>
                                </div>
                            </div>
                            <!-- „Éá„Ç∂„Éº„Éà„Ç®„É™„Ç¢ -->
                            <div class="col-12 col-lg-4 mb-4">
                                <div class="card">
                                    <div class="card-header bg-success text-white d-flex justify-content-between align-items-center">
                                        <div>üç∞ „Éá„Ç∂„Éº„Éà</div>
                                        <div class="small">
                                            Êñ∞Ë¶è: <t t-esc="len(dessert_new)"/> /
                                            Ë™øÁêÜ‰∏≠: <t t-esc="len(dessert_in_progress)"/>
                                        </div>
                                    </div>
                                    <div class="card-body p-2" style="max-height: 80vh; overflow-y: auto;">

                                        <!-- Êñ∞Ë¶è -->
                                        <h6 class="mt-1 mb-2">üîµ Êñ∞Ë¶è</h6>
                                        <t t-if="dessert_new">
                                            <t t-foreach="dessert_new" t-as="tkt">
                                                <t t-set="lines" t-value="[ln for ln in tkt.line_ids if ln.area == 'dessert']"/>
                                                <t t-if="lines">
                                                    <div class="card mb-2 shadow-sm rsk-ticket-card rsk-ticket-new">
                                                        <div class="card-body p-2">
                                                            <div class="d-flex justify-content-between align-items-center mb-1">
                                                                <div>
                                                                    <strong t-esc="tkt.name"/>
                                                                    <t t-if="tkt.table_id">
                                                                        Ôºà<t t-esc="tkt.table_id.name"/>Ôºâ
                                                                    </t>
                                                                </div>
                                                                <div class="small text-muted">
                                                                    <t t-esc="tkt.create_date"/>
                                                                </div>
                                                            </div>
                                                            <hr class="my-2"/>

                                                            <ul class="mb-2 ps-3">
                                                                <t t-foreach="lines" t-as="ln">
                                                                    <li class="small">
                                                                        <strong t-esc="ln.product_id.display_name"/> √ó
                                                                        <t t-esc="ln.qty"/>
                                                                        <t t-if="ln.note">
                                                                            Ôºç
                                                                            <span class="text-muted" t-esc="ln.note"/>
                                                                        </t>
                                                                    </li>
                                                                </t>
                                                            </ul>

                                                            <t t-if="tkt.note">
                                                                <p class="mb-2 small">
                                                                    <span class="fw-bold">„É°„É¢Ôºö</span>
                                                                    <span t-esc="tkt.note"/>
                                                                </p>
                                                            </t>

                                                            <div class="d-flex justify-content-end gap-2">
                                                                <button type="button"
                                                                        class="btn btn-sm btn-outline-secondary rsk-btn-set-state"
                                                                        data-ticket-id="<t t-esc='tkt.id'/>"
                                                                        data-target-state="in_progress">
                                                                    Ë™øÁêÜÈñãÂßã
                                                                </button>
                                                                <button type="button"
                                                                        class="btn btn-sm btn-outline-danger rsk-btn-set-state"
                                                                        data-ticket-id="<t t-esc='tkt.id'/>"
                                                                        data-target-state="done">
                                                                    „Ç≠„É£„É≥„Çª„É´/Êèê‰æõÊ∏àÊâ±„ÅÑ
                                                                </button>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </t>
                                            </t>
                                        </t>
                                        <t t-if="not dessert_new">
                                            <p class="text-muted small">Êñ∞Ë¶è„ÅÆ„Éá„Ç∂„Éº„Éà„Ç™„Éº„ÉÄ„Éº„ÅØ„ÅÇ„Çä„Åæ„Åõ„Çì„ÄÇ</p>
                                        </t>

                                        <!-- Ë™øÁêÜ‰∏≠ -->
                                        <h6 class="mt-3 mb-2">üü† Ë™øÁêÜ‰∏≠</h6>
                                        <t t-if="dessert_in_progress">
                                            <t t-foreach="dessert_in_progress" t-as="tkt">
                                                <t t-set="lines" t-value="[ln for ln in tkt.line_ids if ln.area == 'dessert']"/>
                                                <t t-if="lines">
                                                    <div class="card mb-2 shadow-sm rsk-ticket-card rsk-ticket-in-progress">
                                                        <div class="card-body p-2">
                                                            <div class="d-flex justify-content-between align-items-center mb-1">
                                                                <div>
                                                                    <strong t-esc="tkt.name"/>
                                                                    <t t-if="tkt.table_id">
                                                                        Ôºà<t t-esc="tkt.table_id.name"/>Ôºâ
                                                                    </t>
                                                                </div>
                                                                <div class="small text-muted">
                                                                    <t t-esc="tkt.create_date"/>
                                                                </div>
                                                            </div>
                                                            <hr class="my-2"/>

                                                            <ul class="mb-2 ps-3">
                                                                <t t-foreach="lines" t-as="ln">
                                                                    <li class="small">
                                                                        <strong t-esc="ln.product_id.display_name"/> √ó
                                                                        <t t-esc="ln.qty"/>
                                                                        <t t-if="ln.note">
                                                                            Ôºç
                                                                            <span class="text-muted" t-esc="ln.note"/>
                                                                        </t>
                                                                    </li>
                                                                </t>
                                                            </ul>

                                                            <t t-if="tkt.note">
                                                                <p class="mb-2 small">
                                                                    <span class="fw-bold">„É°„É¢Ôºö</span>
                                                                    <span t-esc="tkt.note"/>
                                                                </p>
                                                            </t>

                                                            <div class="d-flex justify-content-end gap-2">
                                                                <button type="button"
                                                                        class="btn btn-sm btn-success rsk-btn-set-state"
                                                                        data-ticket-id="<t t-esc='tkt.id'/>"
                                                                        data-target-state="done">
                                                                    Êèê‰æõÊ∏à„Å´„Åô„Çã
                                                                </button>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </t>
                                            </t>
                                        </t>
                                        <t t-if="not dessert_in_progress">
                                            <p class="text-muted small">Ë™øÁêÜ‰∏≠„ÅÆ„Éá„Ç∂„Éº„Éà„Ç™„Éº„ÉÄ„Éº„ÅØ„ÅÇ„Çä„Åæ„Åõ„Çì„ÄÇ</p>
                                        </t>

                                    </div>
                                </div>
                            </div>
                        </div>

                    </div>

                    <!-- Á∞°Êòì„Çπ„Çø„Ç§„É´ -->
                    <style>
                        .rsk-ticket-card {
                            border-left-width: 4px;
                        }
                        .rsk-ticket-new {
                            border-left-color: #0d6efd; /* new: primary */
                        }
                        .rsk-ticket-in-progress {
                            border-left-color: #ffc107; /* in progress: warning */
                        }
                    </style>

                    <!-- OWL„ÅßÁä∂ÊÖãÂ§âÊõ¥ & Ëá™ÂãïÊõ¥Êñ∞ -->
                    <div id="rsk-kitchen-controller"></div>
                    <script type="module">
                        import { Component, onMounted, onWillUnmount } from "@odoo/owl";
                        import { mount } from "@odoo/owl";
                        import { useService } from "@web/core/utils/hooks";

                        class KitchenController extends Component {
                            setup() {
                                this.rpc = useService("rpc");
                                this.autoRefreshTimer = null;
                                this.onClickSetState = this.onClickSetState.bind(this);
                                this.onClickManualRefresh = this.onClickManualRefresh.bind(this);

                                onMounted(() => {
                                    this.bindButtons();
                                    this.startAutoRefresh();
                                });
                                onWillUnmount(() => {
                                    this.stopAutoRefresh();
                                    this.unbindButtons();
                                });
                            }

                            bindButtons() {
                                this.buttons = Array.from(document.querySelectorAll(".rsk-btn-set-state"));
                                this.buttons.forEach((btn) => {
                                    btn.addEventListener("click", this.onClickSetState);
                                });
                                const manual = document.querySelector("#rsk-manual-refresh");
                                if (manual) {
                                    manual.addEventListener("click", this.onClickManualRefresh);
                                }
                            }

                            unbindButtons() {
                                if (this.buttons) {
                                    this.buttons.forEach((btn) => {
                                        btn.removeEventListener("click", this.onClickSetState);
                                    });
                                }
                                const manual = document.querySelector("#rsk-manual-refresh");
                                if (manual) {
                                    manual.removeEventListener("click", this.onClickManualRefresh);
                                }
                            }

                            startAutoRefresh() {
                                this.autoRefreshTimer = setInterval(() => {
                                    window.location.reload();
                                }, 10000);
                            }

                            stopAutoRefresh() {
                                if (this.autoRefreshTimer) {
                                    clearInterval(this.autoRefreshTimer);
                                }
                            }

                            async onClickSetState(ev) {
                                ev.preventDefault();
                                const btn = ev.currentTarget;
                                const ticketId = btn.dataset.ticketId;
                                const targetState = btn.dataset.targetState;
                                if (!ticketId || !targetState) {
                                    return;
                                }
                                if (targetState === "done") {
                                    const ok = window.confirm("„Åì„ÅÆ‰ºùÁ•®„ÇíÊèê‰æõÊ∏à„Å®„Åó„Å¶Âá¶ÁêÜ„Åó„Åæ„Åô„ÅãÔºü");
                                    if (!ok) {
                                        return;
                                    }
                                }
                                btn.disabled = true;
                                try {
                                    await this.rpc("/kitchen/ticket/set_state", {
                                        ticket_id: parseInt(ticketId),
                                        state: targetState,
                                    });
                                } finally {
                                    window.location.reload();
                                }
                            }

                            onClickManualRefresh(ev) {
                                ev.preventDefault();
                                window.location.reload();
                            }
                        }
                        KitchenController.template = "restaurant_self_order_kitchen.KitchenController";

                        mount(KitchenController, document.getElementById("rsk-kitchen-controller"));
                    </script>

                    <!-- OWL„Å´Ê∏°„ÅôÁ©∫„ÉÜ„É≥„Éó„É¨„Éº„ÉàÔºàDOMÂà∂Âæ°„ÅÆ„Åø„ÅßÊèèÁîª„ÅØË°å„Çè„Å™„ÅÑÔºâ -->
                    <templates>
                        <t t-name="restaurant_self_order_kitchen.KitchenController">
                            <div/>
                        </t>
                    </templates>

                </section>
            </main>
        </xpath>
    </template>

</odoo>
